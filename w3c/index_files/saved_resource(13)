_.Module.define({path:"pb/widget/postList/FeedBack",sub:{initial:function(){try{this.autoResponseHelp(),this.autoResponseForNotLouzhu(),this.autoResponseClickEvt()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/feedback.js",method:"",ln:13}),e}},autoResponseForNotLouzhu:function(){0!=$(".not-louzhu-response").length&&$(".not-louzhu-response").each(function(e,l){var t=$(l).data("replyHelp"),p="",a={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$(l),closeBtn:!1,level:1,arrowReq:!0};1==t?p='<div class="reply-help-tips">\u697C\u4E3B\u6682\u672A\u5BF9\u6B64\u7B54\u590D\u8FDB\u884C\u8BC4\u4EF7\u54E6~</div>':2==t?p='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u6709\u5E2E\u52A9\u201D\u54E6~</div>':t>2&&(p='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u65E0\u5E2E\u52A9\u201D\u54E6~\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>',a.bubble_css.width=345),a.content=p;var i=new UiBubbleTipBase(a);i.showBubble()})},autoResponseHelp:function(){if(0!=$("#plReplyHelpBubble").length){var e={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#plReplyHelpBubble"),closeBtn:!1,level:1,arrowReq:!0},l=$("#plReplyHelpBubble").data("replyHelp");1==l?e.content='<div class="reply-help-tips">\u4EB2\uFF0C\u4EE5\u4E0A\u5185\u5BB9\u662F\u5426\u89E3\u51B3\u4E86\u60A8\u7684\u95EE\u9898\u5462\uFF1F</div><div class="reply-help-tips"><label>\u662F<input type="radio" name="p-is-helpable" value="2"/></label><label>\u5426<input type="radio" name="p-is-helpable" value="0"/></label></div><ul class="p-not-helpable"><li><label><input type="radio" value="4" name="why-nothelp"/>\u592A\u7B80\u5355\u7528\u4E0D\u4E0A</li></label><li><label><input type="radio" value="8" name="why-nothelp"/>\u5B57\u592A\u591A\u4E0D\u60F3\u770B</li></label><li><label><input type="radio" value="16" name="why-nothelp"/>\u592A\u590D\u6742\u770B\u4E0D\u61C2</li></label><li><label><input type="radio" value="32" name="why-nothelp"/>\u641C\u7D22\u5230\u7684\u5185\u5BB9\u4E0D\u5339\u914D</li></label></ul>':l>1&&(e.content='<div class="reply-help-tips">\u611F\u8C22\u60A8\u7684\u53CD\u9988\uFF0C\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>');var t=new UiBubbleTipBase(e);t.showBubble(),this.autoResponseClickEvt()}},autoResponseClickEvt:function(){var e=this;$("#plReplyHelpBubble").on("click",".reply-help-tips input",function(){try{var l=$(this).val(),t={};2==l?($("#plReplyHelpBubble .p-not-helpable").hide(),t={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:l},e.autoResponsePost(t)):$("#plReplyHelpBubble .p-not-helpable").show()}catch(p){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:p.message||p.description,path:"pb:widget/post_list/feedback.js",method:"",ln:105}),p}}).on("click",".p-not-helpable li input",function(){try{var l={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:$(this).val()};e.autoResponsePost(l)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/feedback.js",method:"",ln:112}),t}})},autoResponsePost:function(e){var l=this;$.post("/hermes/commit/help",e,function(e){e.errno||($("#plReplyHelpBubble").html("").data("replyHelp",2),l.autoResponseHelp())},"json")}}});
;_.Module.define({path:"pb/widget/postList/PostPic",sub:{initial:function(){try{"album_pb"!=PageData.pageType&&this._bindOpenImg()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_pic.js",method:"",ln:15}),t}},_isAlbumImg:function(t){var e=/^https?:\/\/[^\/\?]*?\.baidu\.com[:8082]*\/(\w+)\/([^\/\?]+)\/([^\/\?]+)\/(\w+?)\.(?:webp|jpg|jpeg)/;return e.test(t)},_bindOpenImg:function(){for(var t,e,a,i,s=this,o=$("#j_p_postlist").find(".BDE_Image"),n=($.browser.msie&&$.browser.version<=7,0),p=o.length;p>n;n++){var d=o[n];if(d&&(t=$(d),a=t.height(),i=t.width(),s._isAlbumImg(d.src)&&a>=80&&i>=80&&a*i>=1e4&&t.click(function(t){try{var a=t.target||t.srcElement,i=1,s=$(a).tbattr("src"),o=$(a).closest(".j_l_post");if(o){postData=o.getData(),postData.author.user_name!=PageData.thread.author&&(i=0),e=s.substring(s.lastIndexOf("/")+1,s.lastIndexOf("."));var n=$(a).closest(".j_d_post_content").find("#j_pb_repost"),p="";if(0==n.length)p="//tieba.baidu.com/photo/p?kw="+encodeURIComponent($.tb.escapeHTML(PageData.forum.forum_name))+"&flux=1&tid="+PageData.thread.thread_id+"&pic_id="+e+"&pn=1&fp=2&see_lz="+i;else{var d=n.getData();p="//tieba.baidu.com/photo/p?kw="+encodeURIComponent($.tb.escapeHTML(d.fname))+"&flux=1&tid="+d.tid+"&pic_id="+e+"&pn=1&fp=2&see_lz="+i}window.open(p,"_blank")}}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_pic.js",method:"",ln:64}),t}}),a>999)){var c=$(document.createElement("div")),r=$(document.createElement("div"));html=i>160?'<i class="icon-expand"></i>\u70B9\u51FB\u5C55\u5F00\uFF0C\u67E5\u770B\u5B8C\u6574\u56FE\u7247':'<i class="icon-expand"></i>',r.html(html),c.addClass("replace_div").css("width",i),r.addClass("replace_tip").css("width",i-2);var l=t.clone(!0);c.append(l),c.append(r),t.replaceWith(c)}}}}});
;_.Module.define({path:"pb/widget/postList/HidePost",sub:{initial:function(){try{1==PageData.forum.shield_post&&this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:13}),e}},_bindEvent:function(){var e,t,s,o,a=$('<div class="user-hide-post-down"></div>'),i=$('<div class="user-hide-post-action"><a href="javascript:void(0)" class="hide-author">\u5BF9\u6211\u9690\u85CF\u8BE5\u7528\u6237\u7684\u6240\u6709\u8D34\u5B503\u5929</a></div>'),n=!1,d=!1,l={110000:"\u4F60\u8FD8\u6CA1\u6709\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\u3002",210009:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002",210004:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002","000000":"\u64CD\u4F5C\u6210\u529F\u3002"},r=function(r){var p={},h=d?void 0:o.content.post_no;1==h?"hide-post"==r?(p.type=2,p.fname=PageData.forum.forum_name,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t):"hide-post"==r?(p.type=3,p.pid=d?o.spid:o.content.post_id,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t),p.ie="utf-8",$.ajax({url:"/tphide/add",data:p,type:"post",dataType:"json",success:function(o){if(0==o.no)if(n=!1,1==h)$.tb.location.setHref("/f?kw="+PageData.forum.forum_name);else if("hide-post"==r)if(s.close(),a.hide(),i.hide(),$("body").append(a).append(i),d===!1)e.parents(".j_l_post").remove();else{var p=e.parent().find("li.lzl_single_post");if(p.length<2){e.parents("div.j_lzl_container").hide().find("li.lzl_li_pager").remove();var c=e.parents("div.j_lzl_wrapper");c.find("a.lzl_link_unfold").show().text("\u56DE\u590D"),c.find("span.lzl_link_fold").hide()}e.remove()}else t==PageData.thread.author?$.tb.location.setHref("/f?kw="+PageData.forum.forum_name):$.tb.location.reload();else{s.close();var u=new $.dialog({html:'<div class="user-hide-post-tip center-text">'+(l[o.no]||"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002")+"</div>",title:"\u63D0\u793A",width:400,closeable:!0,draggable:!1,show:!0});setTimeout(function(){u.close(),n=!1},4500)}}})};$("#pb_content").delegate(".user-hide-post-action","click",function(e){try{var a,i=$(e.target).tbattr("class"),l=d?void 0:o.content.post_no;if("hide-post"==i)a=1==l?"\u9690\u85CF1\u697C\u8D34\u5B50\uFF0C\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u4E2A\u8D34\u5B50\u5417\uFF1F":"\u64CD\u4F5C\u4E4B\u540E\uFF0C\u5C06\u65E0\u6CD5\u6062\u590D\u8FD9\u6761\u8D34\u5B50\u7684\u9690\u85CF\u72B6\u6001<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u6761\u8D34\u5B50\u5417\uFF1F";else{if("hide-author"!=i)return;a=t==PageData.thread.author?'\u9690\u85CF\u7684\u7528\u6237\u4E3A\u672C\u8D34\u7684\u697C\u4E3B\uFF0C\u64CD\u4F5C\u4E4B\u540E\uFF1A\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF\uFF0C\u4E14<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F":'\u64CD\u4F5C\u4E4B\u540E\uFF0C<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F"}a+='<div class="user-hide-post-confirm"><button class="btn-sub btn-small confirm">\u786E\u8BA4</button>&nbsp;&nbsp;<button class="btn-sub btn-small cancel">\u53D6\u6D88</button></div>',s=new $.dialog({html:'<div class="user-hide-post-tip center-text">'+a+"</div>",title:"\u63D0\u793A",width:400,closeable:!1,draggable:!1,show:!0}),$(".user-hide-post-confirm").on("click","button",function(e){try{$(this).hasClass("cancel")?s.close():$(this).hasClass("confirm")&&n===!1&&(n=!0,r(i))}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:144}),e}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:145}),e}}).delegate(".user-hide-post-down","click",function(){try{var s=$(this);s.tbattr("class","user-hide-post-up"),i.css({top:parseInt(s.css("top"))+15,right:parseInt(s.css("right"))+2}).appendTo(e),d===!1?(o=e.parents(".j_l_post").getData(),t=o.author.user_name):(o=e.getData(),t=o.user_name),i.show()}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:161}),s}}).delegate(".user-hide-post-up","click",function(){try{var e=$(this);e.tbattr("class","user-hide-post-down"),i.hide()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:165}),e}}).delegate(".p_content","mouseenter",function(){var t=$(this).parents(".j_l_post"),s=t.getData();return""==PageData.user.user_name||PageData.user.user_name==(s&&s.author&&s.author.user_name)?!1:(e=$(this),d=!1,window.postDown=$(this).find(".user-hide-post-down"),window.postDown.show(),void 0)}).delegate(".p_content","mouseleave",function(){var e=window.postDown;return"undefined"==typeof e?!1:(e.hasClass("user-hide-post-up")&&e.tbattr("class","user-hide-post-down"),e.hide(),$(this).find(".user-hide-post-action").hide(),void 0)}).find("li.lzl_single_post").live("mouseenter","li.lzl_single_post",function(){e=$(this);var t=e.getData();if(""==PageData.user.user_name||PageData.user.user_name==t.user_name)return!1;a.appendTo(e);var s={};PageData.is_posts_admin||PageData.is_thread_admin?(s=e.find(".j_lzl_o_l").position(),a.css({top:s.top,right:543-s.left}).show()):(s=e.find(".lzl_time").position(),a.css({top:s.top,right:543-s.left+38}).show()),d=!0}).live("mouseleave","li.lzl_single_post",function(){a.hasClass("user-hide-post-up")&&a.tbattr("class","user-hide-post-down"),a.hide(),i.hide()}),window.global=window.global||{},window.global.shieldPost=function(){$("body").append(a).append(i)}}}});
;_.Module.define({path:"pb/widget/postList/TbmallGuide",requires:["common/component/Card"],sub:{initial:function(){try{this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:12}),e}},_private_guide_card:"",_guideTimeoutId:"",_bindEvent:function(){var e=this;$("#j_p_postlist").delegate(".j_tbmall_guide","click",function(){try{e.preventDefault(),$(window).scrollTop($("[name='sub']").offset().top),$(".edui-btn-medal").click(),e.stopPropagation()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:22}),e}}).delegate(".j_nameplate","mouseenter",function(){clearTimeout(e._guideTimeoutId),e._showTip($(this))}).delegate(".j_nameplate","mouseleave",function(){clearTimeout(e._guideTimeoutId),e._guideTimeoutId=setTimeout(function(){e._hideTip($(this))},300)})},_showTip:function(e){var t=this;t._private_guide_card&&t._private_guide_card.closeCard();var a=e.offset(),i=(e.hasClass("j_nameplate")||e.hasClass("p_mall_tail")?a.top:a.top+43,e.hasClass("p_mall_tail")?a.left+132:a.left+105,""),l=180;e.hasClass("j_self_has_nameplate")?(i='<a class="pb_nameplate_recast_guide" href="/tbmall/propslist?category=112&ps=24" target="_blank" style="color: #1d53bf;">\u94ED\u724C\u73B0\u5728\u53EF\u4EE5\u91CD\u94F8\u4E86\u54E6~</a>',l=140):e.hasClass("j_self_nameplate")?(i='<a class="pb_nameplate_recast j_nameplate_recast" href="javascript:;" data-nameplate="'+$.json.encode(e.data("field")).replace(/\"/g,"&quot;")+'">\u91CD\u94F8\u94ED\u724C</a>',l=100):i=e.hasClass("j_self_no_nameplate")?'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-pb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/tshow" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>':'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-pb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/home" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>',t._private_guide_card=t.use("common/component/Card",{content:i,arrow_dir:"left",arrow_pos:{left:-7,top:9},card_css:{top:a.top+(e.outerHeight()-34)/2,left:a.left+e.outerWidth()+7,width:l,height:50}}),t._private_guide_card.showCard(),t._private_guide_card._j_card.on("mouseenter",function(){clearTimeout(t._guideTimeoutId)}).on("mouseleave",function(){t._private_guide_card.closeCard()}).on("click",".ui_btn",function(){try{$.stats.track("\u94ED\u724C","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"PB\u9875\u94ED\u724C\u5F39\u51FA\u5C42\u70B9\u51FB"})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:76}),e}})},_hideTip:function(){self._private_guide_card&&self._private_guide_card.closeCard()}}});
;_.Module.define({path:"pb/widget/postList",requires:["pb/widget/Posts","pb/widget/sub_list/subListTotal","common/widget/tbshare","pb/widget/complientThread","pb/widget/bindHover"],sub:{initial:function(t){try{var e=this;if(this.params=t,this.posts=e.requireInstance("pb/widget/Posts",[{maskDays:this.params.maskDays}]),this._bindOperatePower(),this._getCommentList(t),this.requireInstance("pb/widget/postList/FeedBack"),this.requireInstance("pb/widget/postList/PostPic"),this.requireInstance("ppb/widget/postList/PostBeyondPush",{firstPost:t.firstPost,beyondChannel:t.beyondChannel}),this.requireInstance("comforum/widget/promoterPostBody",[{pn:t.pn,promoterAttr:t.promoterAttr,promoterMasterTitle:t.promoterMasterTitle,promoterUserIds:t.promoterUserIds}]),Page.checkLoadedModules("forumList"))return;this.requireInstance("pb/widget/postList/HidePost"),this.requireInstance("pb/widget/postList/TbmallGuide"),this.requireInstance("pb/widget/complientThread"),this.requireInstance("pb/widget/bindHover"),this._bindEvents(),this._initPbShare()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:61}),i}},_loadCommentList:function(t,e){var i=this;i.requireInstance("pb/widget/postList/Lzl"),i._loadSubList=i.requireInstance("pb/widget/sub_list/subListTotal",[{commentData:t,searchCid:e}]),this.require.async(["datalazyload"],function(t){window.datalazyload=new t($(document.body),{diff:500,autoDestroy:!1,subListOnloadCallback:function(t){i._loadSubList.showLzlPost(t)}})})},_getCommentList:function(t){var e=this,i=t.searchCid||0,s=t.pn||1,o=t.isSeeLz||0,n="/p/totalComment?t="+(new Date).getTime();$.getJSON(n,{tid:PageData.thread.thread_id,fid:PageData.forum.forum_id,pn:s,see_lz:o},function(t){0==t.errno&&e._loadCommentList(t.data,i)})},_bindEvents:function(){var t=this;$("#pb_content").delegate(".j_quick_reply, a.p_reply_first","click",function(e){try{return e.preventDefault(),e.stopPropagation(),setTimeout(function(){t.fire("wanna_post")},50),$.stats.track("pb\u56DE\u590D\u6309\u94AE\u70B9\u51FB\u91CF","\u53D1\u8D34\u4F18\u5316\u7EDF\u8BA1","pb","click"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:123}),e}}).delegate(".j_louzhubiaoshi","mouseenter",function(){var t=$(this),e=t.position(),i={content:"\u70B9\u51FB\u5373\u53EF\u201C\u53EA\u770B\u697C\u4E3B\u201D\u54DF~",arrow_dir:"up",arrow_pos:{left:20},bubble_css:{top:e.top+36,left:e.left,width:140},wrap:t.parent(),closeBtn:!1},s=new UiBubbleTipBase(i);s.showBubble({zIndex:$.getcurzIndex()}),t.one("mouseleave",function(){s.closeBubble()})}).delegate(".j_voice_ad_gif","click",function(){try{$.stats.track("voice_ad_gif","voice"),$("body").trigger("showvoicedialog",!0)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:150}),t}}).delegate(".replace_tip","click",function(){try{$(this).hide().parent(".replace_div").css("height","auto"),$(this).closest(".j_d_post_content").find(".cnt_act_vote_area").css("z-index",10)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:153}),t}}).delegate(".j_lzl_forbidden_tip_close","click",function(){try{$(this).parent().parent().slideUp()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:155}),t}}).on("click",".j_go_my_achievement_page",function(t){try{t.preventDefault(),PageData.user.is_login?window.open("/home/achievement?un="+encodeURIComponent(PageData.user.user_name)+"&ie=utf8&fr=pb_achievement_btn"):TbCom.process("User","buildLoginFrame",null,null,null,"j_go_my_achievement_page")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:163}),t}}).delegate(".d_author .icon_tbworld","click",function(){try{$.stats.track("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"PB\u697C\u5C42\u5DE6\u4FA7\u7687\u51A0\u70B9\u51FB"})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:167}),t}})},_bindOperatePower:function(){Page.checkLoadedModules("pbAdmin")||(PageData.is_thread_admin||PageData.is_posts_admin)&&this.requireInstanceAsync("pb/widget/Admin",[{needPaypostAgree:this.params.needPaypostAgree}],function(t){t.loadThreadManage(),t.bindAdminEvents(),t.bindLzlAdminEvents()})},_initPbShare:function(){return this.requireInstance("common/widget/tbshare/tbshare_popup",[{$container:$("#pb_tbshare_container")}]),!0}}});
;_.Module.define({path:"pb/widget/novel_level","extends":"",requires:["encourage/widget/novel_icons"],sub:{initial:function(e){try{var t=this;this.opt=e||{},this.uidList=e.userList||[],this.novelIcons=this.requireInstance("encourage/widget/novel_icons",[]),this.$postList=$("#pb_content").find(".left_section"),this.$userListDom=this.$postList.find(".p_author"),this.getPosterLevelList(function(e){return t.setPosterLevel(e)})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/post_list/novel_level.js",method:"",ln:23}),i}},getPosterLevelList:function(e){$.post("/novel/getFansLevel",{tbs:PageData.tbs,forum_id:this.opt.forumId,author_id:this.opt.authorId,novel_id:this.opt.novelId,reader_ids:this.uidList},function(t){0===t.no&&e(t.data)})},setPosterLevel:function(e){var t=this.$userListDom.find(".d_name"),i=this;t.each(function(){var t=$(this),s=t.data("field");t&&s&&s.user_id&&s.user_id in e&&e[s.user_id]&&e[s.user_id].fans_level&&e[s.user_id].fans_level>0&&t.before("<li>"+i.novelIcons.getNovelLevelIcon(e[s.user_id].fans_level,"\u7C89\u4E1D\u79EF\u5206\u5DF2\u7ECF\u8FBE\u5230"+e[s.user_id].reward,"/f?kw="+encodeURIComponent(i.opt.forumName)+"&novel_tab=ranking#novel-fans-rules")+"</li>")})}}});
;_.Module.define({path:"ppb/widget/postList/PostBeyondPush",sub:{initial:function(t){try{this.post=t.firstPost,this.channel=t.beyondChannel,this.$root=$("#pb_content"),this.bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_beyond_push.js",method:"",ln:18}),e}},bindEvent:function(){var t=this;t.$root.on("click",".j-beyond-push-btn",function(){try{t.showBeyondTypeDialog()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_beyond_push.js",method:"",ln:24}),e}})},showBeyondTypeDialog:function(){var t=this,e='<!-- \u63A8\u9001\u5230\u8D34\u5427\u5A31\u4E50\u9891\u9053\u5F00\u5173\u5F39\u7A97 --> <div class="beyond-push-wrapper">  <div class="col2-left">   <label>\u9009\u62E9\u5206\u7C7B\uFF1A</label>  </div>     <div class="col2-right">      <div class="beyond-list">             <% _.each(category, function (cate) { %>                 <span class="item" data-type="<%= cate.id %>"><%= cate.name %></span>             <% }) %>   </div>     </div>   <div class="beyond-submit">   <button class="btn-default btn-middle beyond-submit-btn">\u786E\u5B9A</button>  </div> </div>',s=_.template(e),o=$.dialog,n=new o({html:s(this.channel),title:"\u63A8\u9001\u5230"+this.channel.name,closeable:!0,width:420}),i=n.element;i.on("click",".beyond-list .item",function(){try{$(this).addClass("selected").siblings().removeClass("selected")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_beyond_push.js",method:"",ln:47}),t}}),i.on("click",".beyond-submit-btn",function(){try{var e=i.find(".beyond-list .selected");t.beyondType=e.data("type"),e.length?(n.hide(),t.push(t.beyondType)):new o({html:"\u8BF7\u9009\u62E9\u4E00\u9879\u5206\u7C7B",title:"\u767E\u5EA6\u8D34\u5427",closeable:!0})}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/post_list/post_beyond_push.js",method:"",ln:64}),s}})},push:function(t,e){var s=this,o=$.dialog;$.post("/beyond/posts/push",{beyondType:t,threadId:this.post.thread_id,forumId:this.post.forum_id},function(t){0===t.no?(new o({html:"\u611F\u8C22\u4F60\u7684\u53C2\u4E0E\uFF0C\u5E16\u5B50\u6B63\u5728\u7B49\u5F85\u7F16\u8F91\u5BA1\u6838\uFF0C\u6211\u4EEC\u4F1A\u5C06\u7ED3\u679C\u4EE5\u6D88\u606F\u7684\u5F62\u5F0F\u901A\u77E5\u4F60\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85",title:"\u63A8\u9001\u6210\u529F",closeable:!0}),s.$root.find(".post-beyond-push-wrapper").addClass("has-pushed"),e&&e()):new o({html:"\u62B1\u6B49\uFF0C\u63A8\u9001\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01",title:"\u767E\u5EA6\u8D34\u5427",closeable:!0})},"json")}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"pb/widget/scrollEvent",sub:{initial:function(){try{this.isStartListenScroll=!1,this.initListenFunction(),this.initARAttribute(),this.initScrollEvent(),this.initListenAjaxDom()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/scroll_event/scroll_event.js",method:"",ln:17}),t}},initListenFunction:function(){var t=this,i=7;t.startListenARScroll=function(){var e=t.levels,o=$(window).scrollTop()+t.getHalfScreenHeight();for(var n in e){var s=parseInt(n,10),l=e[s].offsetTop,r=e[s].height,a=e[s].templateId,c=e[s].monitorId,p=e[s].isFlaged,h=e[s].type||0;if(o>=l&&l+r>o&&!p){var u=Number(h)!==i?"p0248":"p0272";$.stats.track(u,"tpoint","PB","view",{tpointShow:a,line:"PT",action_type:"VIEW_TRUE",obj_id:a,obj_name:c,obj_cpid:0,obj_good_id:0,obj_throw_type:"BY_POST",err_no:0,user_timestamp:Math.round((new Date).getTime()/1e3),pro:"tieba",mid:"adtpoint",urlkey:"adtpoint",log_ver:1.1}),e[s].isFlaged=!0}}}},initARAttribute:function(){var t=this,i=t.getAutoReplys();t.isExitAutoReply&&(t.levels=i)},initScrollEvent:function(){var t=this,i=$(window);t.isExitAutoReply&&(i.on("scroll",_.throttle(t.startListenARScroll,250)),t.isStartListenScroll=!0)},initListenAjaxDom:function(){var t=this,i=$(window);$(document).on("startListenScroll",function(){t.initARAttribute(),!t.isExitAutoReply&&t.isStartListenScroll&&(i.off("scroll",t.startListenARScroll),t.isStartListenScroll=!1),t.isExitAutoReply&&!t.isStartListenScroll&&t.initScrollEvent()})},getAutoReplys:function(){var t=this,i={},e=null;return t.isExitAutoReply=!1,$(".l_post").each(function(o){var n=$(this).data("isautoreply"),s=$(this).data("field"),l="",r="";if(s&&s.content&&s.content.pb_tpoint&&(e=s.content.pb_tpoint,l=e.monitor_id,r=e.tp_type),n||0===n){var a=$(this).height(),c=$(this).offset().top,p={offsetTop:c,height:a,isFlaged:!1,templateId:n,monitorId:l,type:r};i[o]=p,t.isExitAutoReply=!0}}),i},getHalfScreenHeight:function(){return $(window).height()/2}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"tbmall/widget/forumMemberDialog",requires:["tbmall/widget/tbean_safe_ajax","common/widget/cashierDialog","common/widget/messenger","common/widget/baseUserData","common/widget/payMember","common/widget/tcharge_dialog"],sub:{opts:{},tplData:{forums:null,bdRpTime:[1,3,6,12]},tpl:{hd:'<p class="title"><i class="forum-member-dialog-title-icon"></i>#{title}</p>'},bt:window.baidu.template,pageData:window.PageData||{},Dialog:$.dialog,initial:function(e){if(!$.getPageData("user.is_login",0))return this.requireInstanceAsync("common/widget/LoginDialog",["","userBar"]),void 0;var t=this,i={};i.is_show_features=!0,i.is_show_forum=!0,i.current_time_order=1,i.current_option=null,i.current_time_unit=3,i.current_forum_id="",i.current_forum_name="",i.isCurForumMember=!1,i.forums=null,i.celebrity_type=-1,this.opts=$.extend({},i,e),this.tplData.forums=this.opts.forums,this.opts.scores=this.opts.scores||this.pageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.forumMemberTitle="\u5355\u5427\u4F1A\u5458",!this.opts.isCurForumMember&&this._checkIsForumMember(),this.safeAjax=this.requireInstance("tbmall/widget/tbean_safe_ajax"),this.showDialog({showTitle:!1,width:710,html:t.buildInitHtml(),scrollable:!1}),t.bindEvents(),this.JoinVipDialog=this.requireInstance("common/widget/JoinVipDialog"),t.setDefaultContent()},setDefaultContent:function(){this._dialog.element.find(".j_pertime_unit:eq("+this.opts.current_time_order+")").click()},checkTdouEnough:function(){var e=this,t=e.getTimeValue(),i=parseInt(5e3*t);e.tdouInUser<i?(e._dialog.element.find(".not-enough-tbean-alert").css("display","inline-block"),e._dialog.element.find(".get-tdou-text").show(),e._dialog.element.find(".j_charge_tdou").addClass("btn-disabled")):(e._dialog.element.find(".not-enough-tbean-alert").hide(),e._dialog.element.find(".get-tdou-text").hide(),e._dialog.element.find(".j_charge_tdou").removeClass("btn-disabled"))},_checkIsForumMember:function(){var e=this.opts.current_forum_id;if(e){var t=$.getPageData("user.mParr_props.forum_member."+e);this.opts.isCurForumMember=t&&1e3*+t.end_time>+new Date}},bindEvents:function(){var e=this;this._dialog.element.on("click",".j_charge_tdou",function(){if(!$(this).hasClass("btn-disabled")){if($.isArray(e.opts.forums)&&!e.opts.current_forum_id)return e.showForumError(),void 0;var t=e.getTimeValue();return e.util._isPositiveDigital(t)?parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):(e.initBuyMember(t),void 0):(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0)}}),this._dialog.element.on("click",".j_close_excharge",function(t){t.preventDefault(),e.closeDialog()}),this._dialog.element.on("click",".j_pertime_unit",function(t){t.preventDefault(),e.changeCurrentOpt($(this),"current_time_unit"),e._closeTipBubble(),e.changeTdouNum(),e.checkTdouEnough(),$("#customTime").val("")}),this._dialog.element.on("focus","#customTime",function(){e.changeCurrentOpt($(this).closest(".j_customTime_unit"),"current_time_unit"),e.changeTdouNum()}),this._dialog.element.on("keyup","#customTime",function(){var t=$(this).val();return $.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),e.changeTdouNum(),void 0):(e._closeTipBubble(),e.checkTdouEnough(),e.changeTdouNum(),void 0)});var t=e._dialog.element.find(".select-forum-list-container"),i=e._dialog.element.find(".select-forum-input");this._dialog.element.on("click",".select-forum-input",function(){e.hideForumError(),t.show()}),this._dialog.element.on("mouseleave",".sel_forum",function(){t.hide()}),this._dialog.element.on("click",".select-forum-list-container span",function(){e.opts.current_forum_id=$(this).data("id"),e.opts.current_forum_name=$(this).html(),e._checkIsForumMember(),i.val($(this).html()),t.hide()}),this._dialog.element.on("click",".open-super-member",function(){e.closeDialog(),e.JoinVipDialog.getMemberDialog("forumMembersDisalog",1005001e3)}),this._dialog.element.on("click",".get-tdou-text",function(t){t.preventDefault(),e.closeDialog(),e.requireInstance("common/widget/tcharge_dialog")})},initTdouNotEnough:function(e,t){var i=this,s=i.getTimeValue(),o={};o.month=s,o.baidu_charge=t,o.tdou_num=e,i.closeDialog();var a={};a.f_name=i.opts.current_forum_name,i.chargeFailFn($.extend({},o,a))},purchaseMember:function(e){var t=this,i={};i.open_id=e.open_id,i.order_id=e.order_id,i.timestamp=e.timestamp,i.scene_id=e.scene_id,i.pay_type=e.pay_type,i.from="\u5355\u5427\u4F1A\u5458\u4E2D\u5FC3",i.goods_name=e.goods_name,i.goods_image=e.goods_image||"",i.goods_price=e.goods_price,i.goods_amount=e.goods_amount,i.goods_unit="\u4E2A",i.goods_duration=e.goods_duration,i.free_vip_level=e.free_vip_level,i.tdou_num=e.tdou_num,i.chargeType="platform",t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&(t.closeDialog(),t.chargeSuccessFn(e.data||{}))}),t.payment.createMain(i)},initBuyMember:function(e){var t=this,i={from:"pc",tbs:t.pageData.tbs};i.props_id=t.opts.current_forum_id,i.forum_id=t.opts.current_forum_id,i.props_num=e,$.post("/celebrity/submit/genOrder",i,function(e){return 0===e.no?(t.opts.celebrity_type=e.data.celebrity_type,t.purchaseMember(e.data||{}),void 0):(t.closeDialog(),t.chargeFailFn(e),void 0)})},changeCurrentOpt:function(e,t){var i=this;i.opts.current_option&&i.opts.current_option.removeClass(t),i.opts.current_option=e,i.opts.current_option.addClass(t)},changeTdouNum:function(){var e=this;this._dialog.element.find(".sel_tdou .tdou_num").text(5e3*e.getTimeValue())},getTimeValue:function(){var e=$.trim($("#customTime").val());return this.opts.current_option&&this.opts.current_option.data("value")?this.opts.current_option.data("value"):0===e.length&&""===e?0:e},chargeFailFn:function(e){var t,i=this,s="auto";if(2270046===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro">\u60A8\u5DF2\u5F00\u901A25\u4E2A\u5427\u7684\u7279\u6743\u5305\uFF0C\u8FBE\u5230\u7279\u6743\u5305\u6570\u91CF\u4E0A\u9650</p>     <p class="sub_intro">\u7ACB\u5373\u5F00\u901A\u8D34\u5427\u4F1A\u5458\uFF0C\u5C3D\u4EAB\u8D34\u5427\u7279\u6743\u65E0\u4E0A\u9650</p>     <a class="j_charge_confirm charge_tdou btn_default btn_small" href="#">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a> </div>" '.replace(/^ "|" $/g,"")),s=216;else if(2270074===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u7528\u6237\u6700\u591A\u4E00\u6B21\u53EA\u80FD\u8D2D\u4E70120\u4E2A\u6708"}),s=216;else if(170003===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u60A8\u8FD8\u672A\u5173\u6CE8\u8BE5\u5427"}),s=216;else{if(1990018===e.no){var o=$.dialog.confirm("T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5151\u6362T\u8C46");return o.bind("onaccept",function(){i.requireInstance("common/widget/tcharge_dialog"),i.dialog.close()}),void 0}t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8D2D\u4E70\u5931\u8D25",subContent:"\u5F88\u9057\u61BE\uFF0C\u8D2D\u4E70\u5931\u8D25\u4E86..."}),s=216}i.showDialog({width:537,height:s,showTitle:!1,html:t}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),i.closeDialog()})},chargeSuccessFn:function(e){var t=this,i="",s="auto";0===+e.no&&(t.opts.scores=$.extend(t.opts.scores,e.data.left_scores),t.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,i=t.buildSuccessHtml(e.data)),t.showDialog({width:708,height:s,showTitle:!1,html:i}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()}),this._dialog.element.on("click",".get-exp-gift",function(){var e={};e.is_show_features=!1,e.is_show_forum=!1,e.current_forum_id=t.opts.current_forum_id,e.current_forum_name=t.opts.current_forum_name,e.scores=t.opts.scores,e.cnt_height=225,e.celebrity_type=t.opts.celebrity_type,e.isCurForumMember=t.opts.isCurForumMember,e.user=t.opts.user,t.requireInstanceAsync("tbmall/widget/exp_package_dialog",e)})},getUserName:function(){var e=this.requireInstance("user/widget/userApi",[]),t="",i=this.pageData.user,s=$.getPageData("forum.id")||this.opts.current_forum_id;return t=e.checkSuperMemberShipOf(i)?'<i class="icon-vip2-16"></i> <a class="vip-red">'+$.getPageData("user.user_name")+"</a>":e.checkSingleForumMembershipOf(i,s)?'<i class="icon-vip3-16"></i> <a class="vip-red">'+$.getPageData("user.user_name")+"</a>":$.getPageData("user.user_name")},buildInitHtml:function(){var e=this,t="";t=e.opts.is_show_forum?"\u5151\u6362"+e.forumMemberTitle:"\u5151\u6362["+e.opts.current_forum_name+"\u5427]"+e.forumMemberTitle;var i=this.getUserName(),s={};return s.title=t,s.tdou_num=5e3*e.opts.current_time_unit,s.bdRpTime=e.tplData.bdRpTime,s.p_style=e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",s.tip=e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743",s.tdouInUser=this.tdouInUser,s.username=i,s.forums=e.opts.forums,e.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_hd">     <p class="title">         <i class="forum-member-dialog-title-icon"></i><%- title %>         <span class="user-info">             <span class="user-name">\u5E10\u53F7\uFF1A<%- username %></span>             <span class="tdou-in-user">T\u8C46\u4F59\u989D\uFF1A<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p> </div> <div class="excharge_bd">     <div class="sel_member">         <span class="sel_label">\u9009\u62E9\u4F1A\u5458:</span>          <div class="single-forum-member">             <i class="single-forum-icon"></i>              <p class="member-label-title">\u5355\u5427\u4F1A\u5458</p>              <p>                 <span class="member-label-orange">5000</span>                 <span class="member-label-text">T\u8C46/\u6708</span>             </p>             <span class="decorate_icon"></span>         </div>         <span class="member-label-text">\u60F3\u76F4\u63A5\u5347\u7EA7\u4E3A800\u4E07\u4E2A\u5427\u7684\u5355\u5427\u4F1A\u5458\uFF1F</span>         <span class="open-super-member">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</span>     </div>     <% if($.isArray(forums)) { %>     <div class="sel_forum">         <span class="sel_label">\u9009\u62E9\u5427:</span>         <input class="select-forum-input" aria-readonly="true" readonly placeholder="\u9009\u62E9\u9700\u8981\u5F00\u901A\u4F1A\u5458\u7684\u5427"/>         <% if(!forums.length) { %>         <span style="line-height: 37px; color: #e64545;">* \u81F3\u5C11\u5173\u6CE8\u4E00\u4E2A\u5427\u624D\u80FD\u5F00\u901A\u5355\u5427\u4F1A\u5458\u54E6</span>         <% } %>         <div class="select-forum-list-container">             <div class="select-forum-list">                 <% for(var i = 0; i < forums.length; i++) { %>                 <span data-id="<%= forums[i].forum_id %>"><%= forums[i].forum_name %></span>                 <% } %>             </div>         </div>     </div>     <% } %>     <div class="sel_time">         <span class="sel_label">\u9009\u62E9\u65F6\u957F:</span>         <span class="sel_cnt">             <%for(var i = 0; i< bdRpTime.length; i++){%>             <a class="j_pertime_unit per_time_unit" data-value="<%=bdRpTime[i]%>">                 <strong><%=bdRpTime[i]%></strong>\u4E2A\u6708                 <span class="decorate_icon"></span>             </a>             <%}%>             <a class="j_customTime_unit per_time_unit custom_time">                 <input id="customTime" type="text" value="" placeholder="\u5176\u4ED6"/><span>\u4E2A\u6708</span>                 <span class="decorate_icon"></span>             </a>         </span>     </div>     <p class="long_time_warning" <%= p_style %>>\u7279\u6743\u5305\u65F6\u957F(\u7D2F\u8BA1\u8D85\u7EA7\u4F1A\u5458)\u6700\u591A\u8FDE\u7EED24\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</p>     <div class="sel_tdou">         <span class="sel_label">\u8FD8\u9700\u652F\u4ED8:</span>         <span class="tdou_num"><%= tdou_num %></span>          <div class="not-enough-tbean-alert">             \u60A8\u7684T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u8BF7\u5148\u83B7\u53D6T\u8C46         </div>     </div>     <a class="j_charge_tdou btn-encourage btn-larger charge_tdou" onclick="return false;" href="#">\u7ACB\u5373\u5151\u6362</a>     <span class="get-tdou-text">\u83B7\u53D6T\u8C46</span> </div>" '.replace(/^ "|" $/g,""),s)},buildSuccessHtml:function(e){var t=this,i={celebrityType:t.opts.celebrity_type,isCurForumMember:t.opts.isCurForumMember,forumName:t.opts.current_forum_name,endTime:t.util._getDate(e.member_end_time),userName:t.getUserName(),tdouInUser:t.tdouInUser};return t.bt(' "<div class="forum-member-success-dialog">     <div class="header">         <span class="pull-left">             <i class="icon-ori"></i>             <span class="exchange">\u5151\u6362[<%= forumName %>\u5427]\u5355\u5427\u4F1A\u5458</span>         </span>         <span class="pull-right">             <span class="user-name">\u5E10\u53F7: <%- userName %></span>             <span class="tbean-scores">                 T\u8C46\u4F59\u989D: <i class="icon icon-tbean"></i> <%- tdouInUser %>             </span>         </span>         <a class="outpage_close j_close_excharge" href="javascript:"></a>     </div>     <div class="body">         <div class="title">             <%= isCurForumMember             ? (\'\u60A8\u7684[\' + forumName + \'\u5427]\u4F1A\u5458\u7EED\u8D39\u6210\u529F\')             : (\'\u606D\u559C\u60A8\u6210\u4E3A[\' + forumName + \'\u5427]\u4F1A\u5458\')             %>         </div>         <ul class="pr-list">             <li>                 <i class="icon-pr pr-crown"></i>                 <span>\u7687\u51A0\u8EAB\u4EFD</span>             </li>             <li>                 <i class="icon-pr pr-red-name"></i>                 <span>\u663E\u793A\u7EA2\u540D</span>             </li>             <li>                 <i class="icon-pr pr-sign"></i>                 <span>\u7B7E\u52306\u500D\u7ECF\u9A8C</span>             </li>             <li>                 <i class="icon-pr pr-red-title"></i>                 <span>\u7EA2\u8272\u6807\u9898</span>             </li>             <% if (celebrityType === 1) { %>             <li>                 <i class="icon-pr pr-mark"></i>                 <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>             </li>             <li>                 <i class="icon-pr pr-card-bg"></i>                 <span>\u5B9A\u5236\u540D\u7247\u80CC\u666F</span>             </li>             <li>                 <i class="icon-pr pr-top-thread"></i>                 <span>\u540D\u4EBA\u9876\u8D34</span>             </li>             <li>                 <i class="icon-pr pr-head-border"></i>                 <span>\u5B9A\u5236\u5934\u50CF\u8FB9\u6846</span>             </li>             <% } %>         </ul>         <div class="pr-tip<%= celebrityType === 0 ? \'\' : \' hidden\' %>">             <div class="tips">\u5427\u4E3B<a href="/celebrity/rankHome">\u7533\u8BF7\u540D\u4EBA\u5802</a>\u540E, \u624D\u80FD\u89E3\u9501\u4EE5\u4E0B\u7279\u6743:</div>             <ul class="pr-tip-list">                 <li>                     <i class="icon-pr-sm pr-mark"></i>                     <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-card-bg"></i>                     <span>\u5B9A\u5236\u540D\u7247\u80CC\u666F</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-top-thread"></i>                     <span>\u540D\u4EBA\u9876\u8D34</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-head-border"></i>                     <span>\u5B9A\u5236\u5934\u50CF\u8FB9\u6846</span>                 </li>             </ul>         </div>         <div class="gift-title"><span>\u83B7\u5F97\u793C\u7269</span></div>         <ul class="gift-list">             <li>                 <i class="gift-icon gift-resign"></i>                 <span>\u8865\u7B7E\u5361x1</span>             </li>             <li>                 <i class="gift-icon gift-exp-privilege"></i>                 <span>\u672C\u5427\u7ECF\u9A8C\u4E66\u8D2D\u4E70\u6743</span>             </li>         </ul>     </div>     <div class="footer">         <button class="btn-sub btn-middle j_close_excharge">\u786E\u5B9A</button>         <button class="btn-encourage btn-middle get-exp-gift">\u8D2D\u4E70\u7ECF\u9A8C\u4E66</button>     </div> </div> " '.replace(/^ "|" $/g,""),i)},showErrorForum:function(){},hideErrorForum:function(){},checkHasForum:function(e,t){var i=this,s={};s.forum_name=encodeURIComponent(e),s.tbs=i.pageData.tbs,$.post("../get/checkForum",s).done(function(e){0===e.no&&(0===e.data.forum_id&&null===e.data.forum_name?i.showErrorForum("hasNot"):(i.hideErrorForum(),$.isFunction(t)&&t(e)))})},showDialog:function(e){this._dialog=new this.Dialog(e)},closeDialog:function(){this._dialog&&this._dialog.close()},showForumError:function(e){var t=this,i=t._dialog.element.find(".sel_forum"),s={content:e||"\u8BF7\u9009\u62E9\u8981\u8D2D\u4E70\u7684\u5427",attr:"",wrap:i,closeBtn:!0};s.bubble_css={top:54,left:100,zIndex:9999},s.arrow_pos={left:10},t._dialog.forumErrorBubble=t._dialog.forumErrorBubble||new window.UiBubbleTipBase(s),t._dialog.forumErrorBubble.showBubble()},hideForumError:function(){this._dialog.forumErrorBubble&&this._dialog.forumErrorBubble.hideBubble()},_buildTipBubble:function(e){var t=this,i={content:e,attr:"",wrap:$(".sel_time"),closeBtn:!0};i.arrow_dir="up",i.bubble_css={top:54,right:45,width:133,zIndex:9999},i.arrow_pos={left:10},this.opts.tip_bubble=new window.UiBubbleTipBase(i);var s=this.opts.tip_bubble;s.showBubble(),s.bind("onclose",function(){t._closeTipBubble()})},_closeTipBubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.hideBubble()},_showTipBubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.showBubble()},_printTimeErrorInfo:function(e){this.opts.tip_bubble?this._showTipBubble():this._buildTipBubble(e)},util:{_isEmpty:function(e){return 0===$.trim(e).length},_isPositiveDigital:function(e){return/^[1-9]+[0-9]*]*$/.test(e)},_getDate:function(e){var t=new Date(1e3*e),i=t.getFullYear(),s=t.getMonth()+1,o=t.getDate();return i+"\u5E74"+s+"\u6708"+o+"\u65E5"}}}});_.Module.define({path:"tbmall/widget/exp_package_dialog",requires:["tbmall/widget/tbean_safe_ajax","user/widget/userApi","common/widget/Tdou/TdouViewPay","common/widget/tcharge_dialog","tbmall/widget/forumMemberDialog"],sub:{opts:{},initial:function(e){var t=this,a={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:"",isCurForumMember:!1};this.opts=$.extend({},a,e),this.opts.scores=this.opts.scores||PageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.FORUM_MEMBER_TITLE=this.opts.is_celebrity_forum?"\u5355\u5427\u4F1A\u5458":"\u5427\u7279\u6743\u5305",this.safeAjax=this.requireInstance("tbmall/widget/tbean_safe_ajax"),this.showDialog(),this.bindEvents()},getUserName:function(){var e=this.requireInstance("user/widget/userApi",[]),t="",a=window.PageData.user,n=$.getPageData("forum.forum_id");return t=e.checkSuperMemberShipOf(a)?'<i class="icon-vip2-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":e.checkSingleForumMembershipOf(a,n)?'<i class="icon-vip3-16"></i><a class="vip-red">'+$.getPageData("user.user_name")+"</a>":$.getPageData("user.user_name")},showDialog:function(){var e=this,t=this.getUserName(),a=_.template('<div class="exp-pageckage-dialog">     <a class="outpage-close j-close-excharge" href="#"></a>     <p class="title">         <i class="forum-member-dialog-title-icon"></i>\u5151\u6362[<%= forumName %>\u5427]\u7ECF\u9A8C\u4E66         <span class="user-info">             <span class="user-name">\u5E10\u53F7\uFF1A<%= username %></span>             <span class="tdou-in-user">T\u8C46\u4F59\u989D\uFF1A<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p>     <div class="exp-package-dialog-body">         <div class="exp-package-intro">             <i class="icon-exp-package-logo"></i>             <p>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text">5000</span>/\u4E2A             </p>             <p>\uFF08\u6BCF\u4E2A\u7ECF\u9A8C\u4E66<span class="exp-orange-text">+50</span>\uFF0C\u8D2D\u4E70\u7ACB\u5373\u751F\u6548\uFF09</p>         </div>         <div class="exp-package-parchase-container">             <p class="input-container">                 <label>\u9009\u62E9\u65F6\u957F\uFF1A</label>                 <span class="controller-input-container">                     <button class="cut-btn">-</button>                     <input class="exp-num-input" type="text" value="3"/>                     <button class="add-btn">+</button>                 </span>             </p>             <p class="input-container">                 <label>\u8FD8\u9700\u652F\u4ED8\uFF1A</label>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text exp-tbean-num">15000</span>             </p>             <%             if (!isCurForumMember) {             %>             <p class="open-member-text">\u5F00\u901A                 <i class="icon-vip3-16"></i>                 <span class="orange-text j-open-single-member">\u672C\u5427\u4F1A\u5458</span>                 \u4E4B\u540E\u624D\u80FD\u5151\u6362\u7ECF\u9A8C\u4E66             </p>             <button class="btn-middle btn-encourage single-member-btn j-open-single-member">\u5F00\u901A\u5355\u5427\u4F1A\u5458</button>             <% } else { %>             <button class="btn-middle btn-encourage exp-btn">\u7ACB\u5373\u5151\u6362</button>             <% } %>         </div>     </div> </div>')({tdou_num:5e3*e.opts.current_time_unit,p_style:e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",tip:e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743",tdouInUser:this.tdouInUser,forumName:e.opts.current_forum_name||$.getPageData("forum.forum_name"),username:t,isCurForumMember:e.opts.isCurForumMember});this.dialog=new $.dialog({showTitle:!1,width:700,html:a})},_changeExpInputValue:function(e){e=e||0;var t=this.getExpInputValue();t+=e,t=0>t?0:t,this.$expInput.val(t)},getExpInputValue:function(){var e=parseInt(this.$expInput.val(),10)||0;return e},_updateView:function(e){this.dialog.element.find(".exp-tbean-num").html(e)},purchaseExp:function(e){var t=this,a={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4F1A\u5458\u7ECF\u9A8C\u4E66",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4E2A",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(a,{chargeType:"platform"}),t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&$.tb.location.reload()}),t.payment.createMain(a)},bindEvents:function(){var e=this;this.$expInput=this.dialog.element.find(".exp-num-input"),this.dialog.element.on("click",".add-btn",function(){e._changeExpInputValue(1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".cut-btn",function(){e._changeExpInputValue(-1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".exp-btn",function(){var t=e.getExpInputValue();if(t>200)return $.dialog.alert("\u6700\u591A\u53EA\u80FD\u8D2D\u4E70200\u4E2A\u7ECF\u9A8C\u4E66"),void 0;var a={from:"pc",tbs:PageData.tbs};a.props_id=2000163,a.forum_id=$.getPageData("forum.forum_id")||e.opts.current_forum_id,a.props_num=e.getExpInputValue(),$.post("/celebrity/submit/genOrder",a,function(t){if(1990043===t.no)$.dialog.alert("\u60A8\u4E0D\u662F\u6B64\u5427\u7684\u4F1A\u5458");else if(170003===t.no)$.dialog.alert("\u60A8\u8FD8\u672A\u5173\u6CE8\u6B64\u5427");else if(1990018===t.no){var a=$.dialog.confirm("T\u8C46\u4E0D\u8DB3\uFF0C\u8BF7\u5151\u6362T\u8C46");a.bind("onaccept",function(){e.requireInstance("common/widget/tcharge_dialog"),e.dialog.close()})}else 0===t.no&&e.purchaseExp(t.data)})}),this.dialog.element.on("click",".j-open-single-member",function(){e.dialog.close();var t=PageData.forum,a={};a.is_show_features=!1,a.is_show_forum=!1,a.current_forum_id=t.id||e.opts.current_forum_id,a.current_forum_name=t.forum_name||e.opts.current_forum_name,a.scores=e.opts.scores,a.cnt_height=225,a.isCurForumMember=e.opts.isCurForumMember,a.callback=function(){$.tb.location.reload()},e.requireInstance("tbmall/widget/forumMemberDialog",[a])}),this.dialog.element.on("click",".j-close-excharge",function(){e.dialog.close()}),this.$expInput.keyup(function(){e._changeExpInputValue(0);var t=e.getExpInputValue();e._updateView(5e3*t)})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});window._.Module.define({path:"user/widget/celebrity_widget",sub:{initial:function(){this.tplLevel=this.parseTpl(' "<a href="<%= href %>" target="_blank" class="celebrity-level">     <span class="label">\u7B49\u7EA7: </span>     <span class="level">         <span class="level-text"><%= npc_info.cur_level %></span>     </span> </a>" ')},getLevelHtml:function(e,l){return l=null===l?"/f/like/level?kw="+e.npc_forum_name+"&ie=utf-8":l===!1?"javascript:":l,this.tplLevel($.extend({href:l},e))},parseTpl:function(e){return window.baidu.template(e.replace(/^ "|" $/g,""))}}});_.Module.define({path:"user/widget/celebrity_forum_dialog",requires:["user/widget/celebrity_widget"],sub:{initial:function(i){this._params=i||{},this.pageData=window.PageData||{},this._user=this.pageData.user||{},this.tbs=this.pageData.tbs,this.Dialog=$.dialog,this.widget=this.requireInstance("user/widget/celebrity_widget"),this.tpl=this.widget.parseTpl(' "<div class="celebrity_forum_dialog_wrap">  <div class="dialog_content">   <div class="dialog_left">    <div class="npc_info">     <a href="/celebrity/rankHome" target="_blank">     <img src="https://gss0.baidu.com/7Ls0a8Sm2Q5IlBGlnYG/sys/portraitm/item/<%=npc_info.npc_avatar%>" width="140" height="140" />     </a>     <div class="user_level">      <p class="uname">       <i class="icon-vip2-18"></i>       <a href="/celebrity/rankHome" target="_blank"><%=npc_info.npc_name%></a>       <i class="icon_red"></i>      </p>                     <div class="level-wrapper">                         <%- levelHtml %>                     </div>      <div class="exp">       <div class="exp_lable">\u7ECF\u9A8C\uFF1A</div>       <a class="exp_bar exp_bar_f" href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank">        <div class="exp_bar_current exp_bar_current_f" style="width:<%=(npc_info.cur_score * 100) / (npc_info.cur_score + npc_info.score_left)%>%;"></div>        <div class="exp_num">         <span class="exp_current_num"><%=npc_info.cur_score%></span>         <span>/<%=npc_info.cur_score + npc_info.score_left%></span>        </div>       </a>      </div>      <p>\u540D\u4EBA\u699C\u6392\u540D\uFF1A<span class="red_text"><%=npc_info.npc_rank%></span></p>      <p><a href="/celebrity/rankHome" target="_blank">\u67E5\u770B\u540D\u4EBA\u699C>></a></p>     </div>    </div>    <div class="npc_sign_info">     <div class="info_top">      \u52A9\u653B\u8BE6\u60C5     </div>     <div class="info_content">      <p class="today">\u672C\u6708\u52A9\u653B\u4EBA\u6570\uFF1A<b><%=npc_info.total_person%></b></p>      <div class="detail">       <div class="col2_left">        <p class="my-orange-text"><%=user.my_continue_days%></p>        <p>\u6211\u8FDE\u7EED\u52A9\u653B</p>       </div>       <div class="col2_right">        <p class="my-orange-text"><%=user.my_total_days%></p>        <p>\u6211\u7D2F\u79EF\u52A9\u653B</p>       </div>      </div>     </div>    </div>    <div class="npc_sign">     <a href="javascript:;" data-forumid="<%=npc_info.npc_forum_id%>" data-npcid="<%=npc_info.npc_id%>" class="sign_btn j_sign_btn <% if (user.is_signed) { %> disable <% } %>"><% if (user.is_signed) { %>\u4ECA\u65E5\u5DF2\u52A9\u653B<% } else { %>\u70B9\u6211\u52A9\u653B<% } %></a>    </div>   </div>   <div class="dialog_right">    <div class="scroll_wrapper">    <ul>     <% for (var i = 0, l = props.length; i < l; i++) { %>     <li class="npc_prop_item">      <div class="item_pic">       <img src="<%=props[i].logo_picurl%>" width="70" height="70" />       <% if (props[i].is_unlock == 0) { %>        <div class="lock" style="height: <%=100 - props[i].lock_npc_percent %>%"></div>        <div class="lock_num">        <% if (props[i].lock_npc_percent == 0) { %>         <i class="icon_lock"></i>        <% } else { %>         <%= props[i].lock_npc_percent %>%        <% } %>        </div>       <% } %>      </div>      <div class="item_intro">        <h4><%=props[i].title%></h4>        <p class="title-sub-text">\u89E3\u9501\u6761\u4EF6\uFF1A         <%=npc_info[\'npc_name\']%>\u8D26\u53F7\u8FBE\u5230<b><%=props[i].lock_npc_level%></b>\u7EA7</p>        <p class="title-sub-text">\u9886\u53D6\u6761\u4EF6\uFF1A        <% if (props[i].props_category == 300) { %>         \u6BCF\u5929\u53EF\u4F7F\u75281\u6B21\uFF0C\u672C\u5427\u4F1A\u5458\u4F7F\u7528\u6B21\u6570\u4E0D\u9650        <% } else { %>         <% if (props[i].limit_sign_level == 0 && props[i].lock_need_vip == 0) { %>          \u65E0         <% }         if (props[i].limit_sign_level > 0) { %>          <%=npc_info[\'npc_fans_name\']%>\u8FDE\u7EED\u52A9\u653B<b><%=props[i].limit_sign_level%></b>\u6B21         <% }          if ( props[i].lock_need_vip == 1 ) {            if (props[i].limit_sign_level > 0) {%>\uFF0C<% } %>          <span class="red_text">\u672C\u5427\u4F1A\u5458\u4E13\u5C5E</span>         <% }         }        %>       </p>      </div>      <div class="item_action">       <% if (props[i].is_unlock == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u89E3\u9501</button>       <% } else if (props[i].can_get == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u9886\u53D6</button>       <% } else if (props[i].is_used == 0) { %>        <button class="btn_default btn_middle j_btn_get" data-propsid="<%=props[i].props_id%>">&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;</button>       <% } else if (props[i].props_category == 200 || props[i].props_category == 113 || props[i].props_category == 300) { %>        <button class="btn_sub btn_middle btn_disable" data-propsid="<%=props[i].props_id%>">\u5DF2\u83B7\u5F97</button>       <% } else { %>        <button class="btn_sub btn_middle j_btn_unuse" data-propsid="<%=props[i].props_id%>">\u53D6\u6D88\u4F7F\u7528</button>       <% } %>       </div>     </li>     <% } %>    </ul>    </div>    <div class="privilege-wrapper">     <p class="title-sub-text">\u5151\u6362\u672C\u5427\u4F1A\u5458\uFF0C\u4EAB\u53D7\u66F4\u591A\u7279\u6743</p>     <div class="privilege-container">      <div class="privilege-item">       <i class="privilege-crown privilege-icon"></i>       <br>       <span>\u7687\u51A0\u8EAB\u4EFD</span>      </div>      <div class="privilege-item">       <i class="privilege-red-name privilege-icon"></i>       <br>       <span>\u663E\u793A\u7EA2\u540D</span>      </div>      <div class="privilege-item">       <i class="privilege-sign privilege-icon"></i>       <br>       <span>\u7B7E\u5230\u516D\u500D\u7ECF\u9A8C</span>      </div>      <div class="privilege-item">       <i class="privilege-red-title privilege-icon"></i>       <br>       <span>\u53D1\u8D34\u7EA2\u8272\u6807\u9898</span>      </div>      <div class="privilege-item">       <i class="privilege-mark privilege-icon"></i>       <br>       <span>\u672C\u5427\u4E13\u5C5E\u5370\u8BB0</span>      </div>      <div class="privilege-item">       <i class="privilege-card-bg privilege-icon"></i>       <br>       <span>\u5236\u5B9A\u540D\u7247\u80CC\u666F</span>      </div>      <div class="privilege-item">       <i class="privilege-top-thread privilege-icon"></i>       <br>       <span>\u9E23\u4EBA\u81EA\u52A8\u9876\u8D34</span>      </div>      <div class="privilege-item">       <i class="privilege-head-border privilege-icon"></i>       <br>       <span>\u5236\u5B9A\u5934\u50CF\u8FB9\u6846</span>      </div>     </div>    </div>   </div>  </div>  <div class="dialog_footer">   <p class=text-overflow>    <a class="btn_default btn_small j_buy_npc_member" data-fid="<%=npc_info[\'npc_forum_id\']%>" data-fname="<%=npc_info[\'npc_forum_name\']%>" href="javascript:;">\u5151\u6362\u672C\u5427\u4F1A\u5458</a>    <button class="btn-sub btn-small hide-privilege">\u6536\u8D77\u4F1A\u5458\u529F\u80FD<i class="triangle-down"></i></button>    <button class="btn-sub btn-small show-privilege">\u67E5\u770B\u4F1A\u5458\u529F\u80FD<i class="triangle-up"></i></button>    \u666E\u901A\u7B7E\u5230,\u672C\u5427\u7ECF\u9A8C<span class="my-orange-text">+1</span>,    <%=npc_info[\'npc_name\']%>\u7ECF\u9A8C<span class="my-orange-text">+0.01</span>    &nbsp;&nbsp;    <%=npc_info[\'npc_fans_name\']%>\u4F1A\u5458\u52A9\u653B,\u672C\u5427\u7ECF\u9A8C<span class="my-orange-text">+2</span>,    <%=npc_info[\'npc_name\']%>\u7ECF\u9A8C<span class="my-orange-text">+0.1</span>    &nbsp;&nbsp;   </p>  </div> </div> " '),this._bindEvents()},_bindEvents:function(){var i=this._params.$root,s=this;i&&i.on&&i.on("click",function(){var i=$(this).data("forumid")||s._params.forumId||s.pageData.forum.id;s.checkShowDialog(i)})},checkShowDialog:function(i,s){var e=this;if(!e._user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var t={};t.forum_id=i,t.tbs=e.tbs,$.post("/celebrity/submit/getForumSupport",t,function(i){i.data&&i.data.length>0&&e._showDialog(i.data[0],s)})},_showDialog:function(i){i.npc_info=i.npc_info||{},i.levelHtml=this.widget.getLevelHtml(i,this._params.levelHref||null);var s=this.tpl(i),e=i.npc_info,t="\u52A0\u5165"+e.npc_fans_name+", \u53C2\u52A0"+e.npc_forum_name+"\u517B\u6210\u8BA1\u5212";this._params.memberLastDays&&(t+='<span class="title-sub-text">\uFF08\u60A8\u7684\u5355\u5427\u4F1A\u5458\u8FD8\u6709<span class="red-text">'+this._params.memberLastDays+"</span>\u5929\u5230\u671F\uFF09</span>"),this._dialog=new this.Dialog({holderClassName:"celebrity_forum_dialog",html:s,width:745,height:526,title:t,draggable:!1}),this._bindDialogEvents(this._dialog)},_bindDialogEvents:function(i){var s=this,e=$(i.element),t=!1;e.find(".j_sign_btn").on("click",function(){if(!$(this).hasClass("disable")&&!t){t=!0;var i=$(this).data("npcid"),e=$(this).data("forumid"),a={tbs:s.tbs};a.forum_id=e,a.npc_id=i,$.post("/celebrity/submit/support",a,function(i){switch(i.no){case 0:s._dialog.close(),s._showDialog(i.data);break;case 340027:$.dialog.alert("\u5F88\u62B1\u6B49\uFF0C\u5C01\u7981\u7528\u6237\u65E0\u6CD5\u52A9\u653B",{title:"\u63D0\u793A"});break;case 3110004:$.dialog.alert("\u4F60\u8FD8\u672A\u5173\u6CE8\u5F53\u524D\u5427\u54E6, \u5FEB\u53BB\u5173\u6CE8\u5427~",{title:"\u63D0\u793A"});break;default:$.dialog.alert("\u62BD\u98CE\u4E86~",{title:"\u63D0\u793A"})}t=!1}).fail(function(){t=!1})}}),e.find(".j_buy_npc_member").on("click",function(){var i=$(this).data("fid"),e=$(this).data("fname"),t={};t.scores_money=0,t.scores_other=0;var a={};a.is_show_features=!1,a.is_show_forum=!1,a.current_forum_id=i,a.current_forum_name=e,a.scores=s._user.Parr_scores||t,a.cnt_height=225,a.is_celebrity_forum=!0,a.callback=function(){$.tb.location.reload()},s.requireInstance("tbmall/widget/forum_member_dialog",a),s._dialog.close()}),e.on("click",".j_btn_get",function(){var i=$(this),e=i.data("propsid"),t={tbs:s.tbs};t.props_id=e,$.post("/celebrity/submit/getNpcProps",t,function(s){0===+s.no?200===+s.data.props_category||300===+s.data.props_category||113===+s.data.props_category?i.text("\u5DF2\u83B7\u5F97").tbattr("class","btn_sub btn_middle btn_disable"):i.text("\u53D6\u6D88\u4F7F\u7528").tbattr("class","btn_sub btn_middle j_btn_unuse"):$.dialog.alert("\u62BD\u98CE\u4E86")})}),e.on("click",".j_btn_unuse",function(){var i=$(this),e=i.data("propsid"),t={tbs:s.tbs};t.props_id=e,$.post("/tbmall/post/closeProps",t,function(s){0===+s.no?i.html("&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;").tbattr("class","btn_default btn_middle j_btn_get"):$.dialog.alert("\u62BD\u98CE\u4E86")})});var a=e.find(".hide-privilege"),n=e.find(".show-privilege"),l=e.find(".privilege-wrapper");e.on("click",".hide-privilege",function(){a.hide(),n.show(),l.hide()}),e.on("click",".show-privilege",function(){a.show(),n.hide(),l.show()})}}});window._.Module.define({path:"encourage/widget/util",requires:["common/widget/LoginDialog"],sub:{tbs:null,Dialog:null,pageData:null,user:null,bt:window.baidu.template,initial:function(){this.pageData=window.PageData||{},this.tbs=this.pageData.tbs,this.user=this.pageData.user||{},this.Dialog=$.dialog},fine:function(e,t,a){var r,n,i;if(1===arguments.length){for(r in e)e.hasOwnProperty(r)&&r.indexOf("$")>-1&&(e[r.replace(/\$/g,"_")]=e[r],delete e[r]);return e}if(2===arguments.length){for(n=t.split("."),i=e,r=0;r<n.length;r++){if(t=n[r],!(i&&i.hasOwnProperty&&i.hasOwnProperty(t))){i=void 0;break}i=i[t]}return i}if(3===arguments.length){if(-1===t.indexOf("."))e[t]=a;else{n=t.split(".");var s=n.length-1;for(i=e,r=0;s>r;r++)i[n[r]]=i[n[r]]||{},i=i[n[r]];i[n[n.length-1]]=a}return e}},trimTpl:function(e){return e.replace(/^ "|" $/g,"")},parseTpl:function(e){return this.bt(this.trimTpl(e))},pad:function(e,t,a,r){if(e=String(e),t=+t||2,a=String(a||"0"),r=r||"L",e.length>=t)return e;for(var n="",i=0;t>i;i+=a.length)n+=a;var s=n.substr(0,t-e.length);return"L"===r?s+e:e+s},ucfirst:function(e){return e=String(e),e[0].toUpperCase()+e.substr(1)},checkLogin:function(e,t){return!t&&this.user.is_login?!0:(e&&this.requireInstance("common/widget/LoginDialog",["","userBar"]),!1)},formatTime:function(e,t){t=String(t||""),e=parseInt(e||0,10);var a,r,n=new Date(e),i=n.getFullYear(),s=n.getMonth()+1,g=n.getDate(),u=n.getHours(),l=n.getMinutes(),o=n.getSeconds(),c=n.getMilliseconds(),h=i,f=this.pad(s),p=this.pad(g),d=this.pad(u),b=this.pad(l),k=this.pad(o),w=this.pad(c,3);return t.replace(/[a-z\\A-Z]+/g,function(e){for(r="",a=0;a<e.length;a++)if("\\"!==e[a])switch(e[a]){case"Y":r+=h;break;case"y":r+=i;break;case"M":r+=f;break;case"m":r+=s;break;case"D":r+=p;break;case"d":r+=g;break;case"H":r+=d;break;case"h":r+=u;break;case"I":r+=b;break;case"i":r+=l;break;case"S":r+=k;break;case"s":r+=o;break;case"F":r+=w;break;case"f":r+=c;break;default:r+=e[a]}else a<e.length-1&&(r+=e[a+1]),a+=1;return r})}}});_.Module.define({path:"tbmall/component/NetProxy",requires:["tbmall/widget/TbeanSafeAjax"],sub:{_buyPropUrl:"/tbmall/post/buyprops",_mBuyPropUrl:"/tbmall/post/mbuyprops",_usePropUrl:"/tbmall/post/openProps",_mUsePropUrl:"/tbmall/post/mopenProps",_cancelPropUrl:"/tbmall/post/closeProps",initial:function(){},buyProp:function(t,o){var r=this;t.tbs=PageData.tbs;var s=this.requireInstance("tbmall/widget/TbeanSafeAjax");s.post(r._buyPropUrl,t,o)},mBuyProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mBuyPropUrl,t,o)},useProp:function(t,o){var r=this;$.tb.post(r._usePropUrl,{props_id:t,tbs:PageData.tbs},o)},mUseProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mUsePropUrl,t,o)},cancelProp:function(t,o){var r=this;$.tb.post(r._cancelPropUrl,{props_id:t,tbs:PageData.tbs},o)}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});_.Module.define({path:"tbmall/component/UseController",requires:["tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/component/util"],sub:{buy_number:0,initial:function(){this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util")},doUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u4F7F\u7528"),o.netProxy.useProp(t,function(a){var e="";if(0==a.no)e="\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap&&o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})},cancelUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u53D6\u6D88\u4F7F\u7528"),o.netProxy.cancelProp(t,function(a){var e="";if(0==a.no)e="\u53D6\u6D88\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})}}});_.Module.define({path:"ihome/widget/Interaction",sub:{initial:function(n){n?(this.dataObj=n,this._bindEvents()):this._bindFloatEvents()},_resetDataObj:function(n){this.dataObj=n},_follow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,0);$.tb.post("/home/post/follow",{un:t.un,tbs:t.tbs},function(t){t?0==t.no?o._clearLoading(n,e,0):1130036==t.no?o._showError("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",n,0):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0)})},_showError:function(n,t,o){var e=new $.dialog({html:'<p style="text-align:center">'+n+"<p>",width:300,height:30});e.bind("onclose",function(){var n=1==o?"btn-sub btn-middle btn_concern_done":"btn_concern btn-attention btn-middle",e=1==o?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8";t.text(e).removeClass().addClass(n)})},_addLoading:function(n,t){var o=$("<span></span>"),e="",r=0,a=[".","..","..."],i=["\u5173\u6CE8\u4E2D","\u53D6\u6D88\u4E2D"],s=setInterval(function(){e=a[r++%3],o.text(e)},400);return n.text(i[t]).append(o),s},_clearLoading:function(n,t,o){var e=1==o?"btn_concern btn-attention btn-small":"btn_concern_done btn-sub btn-small",r=1==o?"\u5173\u6CE8":"\u53D6\u6D88\u5173\u6CE8";n.text(r).removeClass().addClass(e),clearInterval(t)},_unfollow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,1);$.tb.post("/home/post/unfollow",{un:t.un,tbs:t.tbs},function(t){t&&0==t.no?o._clearLoading(n,e,1):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25",n,1)})},_bindEvents:function(){var n=this;$("#userinfo_wrap").delegate(".btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("#userinfo_wrap").delegate(".btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})},_bindFloatEvents:function(){var n=this;$("body").delegate(".card_headinfo_wrap .btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("body").delegate(".card_headinfo_wrap .btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})}}});_.Module.define({path:"ihome/widget/MonthIcon",sub:{iconTitle:{"01":"\u6469\u7FAF\u5EA7","02":"\u6C34\u74F6\u5EA7","03":"\u53CC\u9C7C\u5EA7","04":"\u767D\u7F8A\u5EA7","05":"\u91D1\u725B\u5EA7","06":"\u53CC\u5B50\u5EA7","07":"\u5DE8\u87F9\u5EA7","08":"\u72EE\u5B50\u5EA7","09":"\u5904\u5973\u5EA7",10:"\u5929\u79E4\u5EA7",11:"\u5929\u874E\u5EA7",12:"\u5C04\u624B\u5EA7"},initial:function(){},getMonthIcon:function(i,n){i=i||{},n=n||1;var t='<div class="month_icon_theme_'+n+'">',o="",e={};for(var a in i){var c=a.length;if(6==c){var h=a.substr(c-2,2);e[h]=i[a]}else 2==c&&(e[a]=i[a])}for(var l in this.iconTitle)o=e&&e[l]?" month_icon_"+l:" month_icon_gray_"+l,t+='<a href="/tbmall/monthicon" target="_blank" title="'+this.iconTitle[l]+'" class="'+o+'"></a>';return t+="</div>"}}});_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual","common/widget/JoinVipDialog","tbmall/widget/send_gift_dialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(a,i){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=a,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),i||this.bindEvents())},bindEvents:function(){var a=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return a.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card&&a._visit_card.closeCard({type:"delayClose",time:200}),a._visit_card=null,!1}),this._wrap.on("click","[j-user-visit-card-marriage-propose]",function(){var i=$(this);a.marryDialog={},a.marryDialog.hide=a.marryDialog.show=function(){};var t=i.tbattr("data-username");a.requireInstanceAsync("encourage/widget/post_marry",{type:"float",propose_name:t},function(i){a.marryDialog=i})}),this._wrap.on("click","[j-user-visit-card-send-gift]",function(i){var t=$(i.target),e=t.data("userid"),r=t.data("username");a.requireInstance("tbmall/widget/send_gift_dialog",{userId:e,userName:r,scene_from:"pc_home",account:"",onSuccess:function(){$.tb.location.reload()},onFail:function(){$.tb.location.reload()}})}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(a){var i=this;i._visit_card&&(i._visit_card.closeCard(),i._visit_card=null);var t='<div class="user_card_loading"><img src="//tb2.bdstatic.com/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:a,attr:"id='user_visit_card'",wrap:$("body")};i._visit_card=i.use("common/widget/Card",e),i._visit_card.showCard({type:"delayShow",time:200}),i.buildVisitCard(a)},getVisitCardContent:function(a){var i=this,t={ie:"utf-8"};a.un?t.un=a.un:t.id=a.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=a.bg_id;var r=i._util.getVisitCardTpl(1,e,!0);a.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a.wrap.html(r)}a.callBack&&$.isFunction(a.callBack)&&a.callBack()})},buildVisitCard:function(a){var i=this,t={ie:"utf-8"};a.getData().un?t.un=a.getData().un:t.id=a.getData().id,i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==i.dataObj.uname,s=i._util.getVisitCardTpl(r,e,!0);i._visit_card.setContent(s),i._visit_card._j_card.bindData({un:e.name}),i._visit_card.showCard(),i._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),i._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),i._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("common/widget/JoinVipDialog",[],function(a){a.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return i.buildCard(a),!1})}})},bindVisitCardEvent:function(){var a=this;a._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["user/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,r){var i=PageData.product||"",t=this.use("user/widget/Icons"),n=this.use("common/widget/UserHead"),s=this.use("ihome/widget/MonthIcon"),o=this.use("common/widget/MemberApi"),_=n.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done btn-sub":"btn_concern btn-attention",concernText:"0"==a.can_followed?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8",un:encodeURIComponent(a.name),btn_group:r?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:n.getHeadUrl(a),fr:i,icon_pre:t.getPreIconHtml(a.mParr_props,a),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.profession_manager_nick_name||a.name_show,icon_tbvip:t.getTbvipIconHtml(a.tb_vip),icon:t.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a),userId:a.id};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="";a.tb_vip&&a.tb_vip.type&&(l='<span class="userinfo_split"></span><span>\u7C89\u4E1D:'+a.followed_count+"</span>");var m="",d="",f="";!a.marriage||1!=a.marriage.status&&3!=a.marriage.status&&4!=a.marriage.status?a.marriage&&0!=a.marriage.length&&2!=a.marriage.status||(f='<a class="btn-attention btn-small  user-visit-card-marriage-propose" data-username="'+a.name+'" data-userid="'+a.id+'" j-user-visit-card-send-gift><i></i>\u7ED9\u4ED6\u9001\u793C</a>'):(c.marriage_date=$.dateFormat(new Date(1e3*a.marriage.time),"yyyy-MM-dd"),c.marriage_user_name=a.marriage.user_name,m=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_lover">\u7231\u4EBA:#{marriage_user_name}</span>',"</div>"].join(""),d=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_date">\u7ED3\u5A5A\u7EAA\u5FF5\u65E5: #{marriage_date}</span>',"</div>"].join(""));var u="";e||(u='<div class="interaction_wrap interaction_wrap_theme2">'+f+'<a class="btn-small #{concernClass}" target="_blank" href="#" onclick="return false">#{concernText}</a><a class="btn-small btn-default" target="sixin" href="/im/pcmsg?from=#{userId}">\u79C1\u4FE1</a></div>');var v=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',u,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>','<a href="javascript:" class="marriage" j-user-visit-card-marriage-propose target="_blank"><i></i>\u5411\u4ED6\u6C42\u5A5A</a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon_tbvip}',"</div>",m,'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>",l,"</div>",d,'<div class="card_userinfo_tbvip clearfix">',"#{icon}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(v,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var r=e.can_begcard,i="";0==r?i='<a class="btn_begcard j_begcard" href="#"></a>':1==r?i='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==r&&(i='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var t={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:i};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,t)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},r=e.manager,i=null,t="",n="";this.countLen=0;for(var s in r){i=r[s];var o=i.forum_list.join("\u3001"),_=a[s];o=i.count>2?o+"\u7B49\u5427"+_.title:o+"\u5427"+_.title,t+=this.getHonorItem(_.level,i.count,o),this.countLen+=String(i.count).length}var c=e.grade,l=[];for(var m in c)l.push(m);l.sort(function(e,a){return a-e});for(var d=0,f=l.length;f>d;d++){i=c[l[d]];var o=i.forum_list.join("\u3001");i.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(l[d],i.count,o),this.countLen+=String(i.count).length}return t+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,r){var i={level:e,title:r,count:a},t=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(t,i)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},r=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),i=0;i<e.length;i++)a.verify_forums+=this.getVForumItem(i,e[i].forum_name);return $.tb.format(r,a)},getVForumItem:function(e,a){var r="",i={},t=[];return a.length>5?(r=a.substring(0,5),r+="..."):r=a,i={index:e,verify_forum_name:r,origin_forum_name:encodeURIComponent(a)},t=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="//tb2.bdstatic.com/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(t,i)},getVipTips:function(e){var a="",r=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>r&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});_.Module.define({path:"tbmall/component/HeadPreview",requires:["common/widget/UserHead","tbmall/component/util","props/component/Guide","tbmall/component/UseController","ihome/widget/UserVisitCard"],sub:{initial:function(){this.initUI(),this.initFlashCallbacks(),this.guide=this.use("props/component/Guide"),this.visitCard=this.use("ihome/widget/UserVisitCard"),this.useC=this.use("tbmall/component/UseController"),this.util=this.use("tbmall/component/util")},options:{pngCount:{1090001:3,1090002:5,1090003:5,1090004:4,1090005:5,1090006:5,1090007:5,1090008:4,1090009:5,1090010:5,1090011:5,1090012:4,1090013:5},propIdForProp:{101:"bub",104:"font",108:"card",116:"card",117:"card",118:"card",114:"card",103:"printer"},stylesForAllPreview:{110:"frame",109:"frame"}},_centerElement:function(e){var t=e.height(),i=e.width();e.css({width:i,height:t,top:"50%",left:"50%","margin-left":-(i/2),"margin-top":-(t/2)})},_getData:function(e){$.json.encode($(e).closest("li.item").data("field"));return $(e).closest("li.item").getData()},doPreview:function(e){{var t=this,i=$.json.encode($(e).closest("li.item").data("field")),a=t._getData(e),r=a.props_category,s=a.props_id;t.options.stylesForAllPreview[r]}switch(r){case"107":t.$loading.remove(),t.guide.showMagicGuide(s);break;case"109":t._buildPreviewUI(t.getHtmlFor109(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-175px","margin-top":"-150px"}),t.hasFrame&&t.guide.$guideWrap.css({width:350,height:205,backgroundPosition:"105px 40px"});break;case"110":t._buildPreviewUI(t.getHtmlFor110(a.props_id));break;case"113":if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),void 0;t._buildPreviewUI(t.getHtmlForOther(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-200px"}),t.visitCard.getVisitCardContent({un:PageData.user.user_name,id:PageData.user.portrait,wrap:t.guide.$guideContent.find(".card_preview"),bg_id:a.props_id,callBack:function(){t.guide.$guideContent.find(".card_userinfo_img").one("load",function(){t._centerElement(t.guide.$guideWrap)})}});break;default:t._buildPreviewUI(t.getHtmlForOther(a.props_id))}t._buildChargeInfo(i,a),this.initToBuy(),this.initUse()},_buildChargeInfo:function(e,t){var i=this,a=("0"==t.props_type?t.free_user_level:2,i.util.getFreeInfo(t)),r=i.initBuyInfo(e);i.guide.$guideContent.append(r),"107"!=t.props_category&&i.guide.$guideContent.append(a)},_buildPreviewUI:function(e){var t=this;this.guide.initPreviewUI(),this.guide.$guideContent.html(e);var i=$(e).find(".j_resource_loading");i.length>0&&this.guide.$guideWrap.hide(),i.length>0&&i.one("load",function(){t._centerElement(t.guide.$guideWrap),t.guide.$guideWrap.show()})},initUI:function(){this.$portraitWrap=$('<div id="portrait_wrap" class="portrait_wrap"></div>'),this.$portraitFlash=$('<div class="portrait_flash"></div>'),this.$loading=$('<img class="portrait_loading" src="/tb/static-tbmall/img/loading.gif"/>'),this.$portraitWrap.append(this.$portraitFlash).append(this.$loading)},getHtmlForOther:function(e){var t=this,i=e.slice(0,3),a="",r="png",s={1170001:"-1~2",1170002:"0~3",1170003:"2~5",1170004:"5~8",1170005:"10~15"},o={108:'<p class="prop_intro">\u8FDE\u7EED\u7B7E\u5230\u795E\u5668\u3002\u9EBB\u9EBB\u518D\u4E5F\u4E0D\u7528\u62C5\u5FC3\u6211\u6F0F\u7B7E\u4E86\uFF01</p>',117:'<p class="prop_intro">\u4E3A\u697C\u4E3B\u633D\u5C0A\uFF0C\u88AB\u633D\u5C0A\u7528\u6237\u7ECF\u9A8C\u503C\u589E\u52A0('+(s[e]||"")+")\u3002</p>",116:'<p class="prop_intro">\u7ED9\u5973\u795E\u544A\u767D\uFF0C\u53EB\u57FA\u53CB\u56DE\u5BB6\u5403\u996D\uFF0C\u8BA9\u4F60\u7684\u53D1\u8A00\u63B7\u5730\u6709\u58F0\uFF01</p>',118:'<p class="prop_intro">\u4F1A\u5458\u5427\u4E3B\u4E13\u5C5E\u91D1\u8272\u7F6E\u9876\uFF0C\u4E0D\u53EF\u9690\u85CF\uFF0C\u5C0A\u8D35\u8EAB\u4EFD\uFF0C\u7ACB\u523B\u5F70\u663E\u3002</p>'};("1040003"===e||"1040011"===e||"1080002"===e)&&(r="gif");var n=["//tb1.bdstatic.com/tb/cms/tbmall/",t.options.propIdForProp[i],"/pc/"+e,"."+r].join("");return a+="113"===i?['<div class="card_preview">','<img class="card_loading" src="/tb/static-tbmall/img/loading.gif"/>','</div><div class="card_mask">'].join(""):['<div class="preview">','<img class="j_resource_loading" src="'+n+'" alt="\u56FE\u7247\u9884\u89C8" />'].join(""),a+=o[i]||"",a+="</div>"},_initUserHead:function(){this.userHead||(this.userHead=this.use("common/widget/UserHead"))},getHtmlFor109:function(e){var t=this,i="portrait="+PageData.user.portrait+"&props_id="+e+"&png_count="+t.options.pngCount[e],a="/tb/static-tbmall/swf/GIFMaker.swf?t=14010902",r='<embed width="150" height="150" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" allowfullscreen="true" wmode="transparent" allowscriptaccess="always" quality="high" bgcolor="#FFFFFF" src="'+a+'" type="application/x-shockwave-flash">';this.$portraitFlash.html(r),t._initUserHead();var s=this.userHead.getHeadFrameStyle(PageData.user,"150");s.hasFrame&&t.$portraitFlash.css({position:"static"});var o=t.$portraitWrap[0].outerHTML;return s.hasFrame&&(o='<div style="'+s.stylestr+'" class="head_preview_wrap">'+o+"</div>",t.hasFrame=!0),o},getHtmlFor110:function(e){this._initUserHead();var t=this.userHead,i=t.getImgFormat(e),a=["background-image: url(/tb/static-common/img/props/150/"+e+"."+i+")","background-repeat: no-repeat","background-position: center 0"],r=a.join(";");return'<a style="'+r+'" class="head_preview_wrap"><img class="j_resource_loading" src="'+t.getHeadUrl(PageData.user||{})+'"/></a>'},initFlashCallbacks:function(){window.finishMerge=function(){$("#portrait_wrap .portrait_loading").remove()}},initBuyInfo:function(e){var t=this,i=$.json.decode(e),a=PageData.user.is_login?t._buyInfoTpl(i):['<a class="ui_btn ui_btn_sub_s j_buy_button1">',"<span><em>\u5151&nbsp;&nbsp;\u6362</em></span>","</a>"].join(""),r="0"===i.props_type?t.util.convertToDay(i.time_interval):"1\u4E2A";return['<div class="j_buy_wrapper" data-field = '+e+">",'<p class="cost_info">',i.scores,"T\u8C46/",r,"</p>",a,"</div>"].join("")},_buyInfoTpl:function(e){var t=this.util.getBuyInfo(e);return t},initToBuy:function(){var e=this;$(".guide_wrap").delegate(".j_buy_button1","click",function(t){t.preventDefault();var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.use("tbmall/component/BuyController",$(this),i)})},initUse:function(){var e=this;$(".guide_wrap").delegate(".j_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.doUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_cancle_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.cancelUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_get_button1","click",function(t){e.guide.closeGuide(),e.use("tbmall/widget/getProp",$(this)),t.preventDefault()}),$(".guide_wrap").delegate(".j_tbmall_join_vip_btn","click",function(t){e.requireInstance("common/widget/JoinVipDialog",[]).getMemberDialog();var i=$(this).closest(".guide_content").find("div.j_buy_wrapper").getData();e._statClick(i),t.preventDefault()})},_statClick:function(e){switch(parseInt(e.props_category)){case 110:this._postTrack("\u5934\u50CF\u8FB9\u6846",e.props_id);break;case 109:this._postTrack("\u52A8\u6001\u5934\u50CF",e.props_id);break;case 113:this._postTrack("\u540D\u7247\u80CC\u666F",e.props_id);break;case 104:this._postTrack("\u70AB\u5F69\u5B57\u4F53",e.props_id);break;case 101:this._postTrack("\u53D1\u5E16\u6C14\u6CE1",e.props_id);break;case 103:this._postTrack("\u56FE\u7247\u6C34\u5370",e.props_id);break;case 108:this._postTrack("\u8865\u7B7E\u795E\u5668",e.props_id);break;case 117:this._postTrack("\u633D\u5C0A\u5361",e.props_id);break;case 107:this._postTrack("\u9B54\u6CD5\u5F39",e.props_id);break;case 118:this._postTrack("\u7F6E\u9876\u5361",e.props_id)}},_postTrack:function(e,t){$.stats.track(e,"\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u5F00\u901A\u7684\u70B9\u51FB\u91CF3",obj_id:t})}}});_.Module.define({path:"tbmall/component/BuyController",requires:["tbmall/component/captcha_payment","tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/widget/ContSignCard","tbmall/component/util","tbmall/component/HeadPreview","tbmall/component/UseController","tbmall/widget/paykey_dialog","tbmall/widget/TbeanSafe"],sub:{buy_number:0,set_pass_tpl:'<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>',buy_tpl0:'<div class="buy_tpl clearfix"> <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div></div> <div class="buy_tpl_right"><div class="price_tip">\u60A8\u9700\u8981<span class="strong_txt">#{price}</span>T\u8C46\u5151\u6362\u9053\u5177</div> #{TbeanCharge}<a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div></div></div> ',buy_tpl1:['<div class="buy_tpl buy_count_tpl clearfix">',' <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div>','</div> <div class="buy_tpl_right">','<p class="count_tip">\u60A8\u8981\u5151\u6362\u7684\u6570\u91CF</p>','<div class="count_wrap clearfix"><span class="count_number">\u6570\u91CF\uFF1A</span>','<span class="counter"><button class="j_minus minus"></button><input type="text" class="j_count" value="1"/><button class="j_plus plus"></button></span><span>\u4E2A</span>',"</div>",'<div class="count_tip count_sub_tip">\u9700\u8981T\u8C46\uFF1A<span class="t_dou_needed strong_txt">#{price}</span>\u4E2A  \u60A8\u76EE\u524DT\u8C46\uFF1A<span class="cur_t_dou">#{cur_t_dou}</span>\u4E2A</div>',"#{TbeanCharge}",'<div class="buy_and_tip"><a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><span class="error_tip"></span></div>','<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>'," </div></div> "].join(""),initial:function(e,t){this.data=t;$.stats.track(this.data.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u5151\u6362"),this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util"),this.headPreview=this.use("tbmall/component/HeadPreview"),this.useController=this.use("tbmall/component/UseController"),this.isAvailable()&&this.doBuy(e),$(e).data("clicked",!1)},isAvailable:function(){var e=this.data,t=this,a=PageData.scores,s=null!=a.scores_money?parseInt(a.scores_money):0,n=null!=a.scores_other?parseInt(a.scores_other):0,i=s+n,o=Math.min(parseInt(a.scores_fetch),parseInt(t.data.fetch_scores_limit||0)),c=parseInt(i+o);return PageData.user.is_login?PageData.user.no_un?(TbCom.process("User","BuildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u53EF\u4EE5\u5728T\u8C46\u5546\u57CE\u8D2D\u7269\u5662~"),!1):c<parseInt(e.scores)?(t.dialog.dialog("<p class='dialog_content'>T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u5151\u6362\u9053\u5177\u9700\u8981<span class='charge_bean_interaction_orange_tip' >"+e.scores+"</span>T\u8C46</p><div class='charge_bean_interaction_dialog_btn_wrap'><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_charge_btn' id='j_tcharge_dialog_tbmall'>\u83B7\u53D6T\u8C46</a><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_close_dialog'>\u53D6\u6D88</a></div>"),$("#j_tcharge_dialog_tbmall").on("click",function(){var t={consumption_path:"12",desc:"\u5151\u6362\u9053\u5177",current_need_tdou:parseInt(e.scores,10)-i,is_direct_cashier:!0,is_iframe:!0};_.Module.use("common/widget/tcharge_dialog",t)}),!1):!0:(TbCom.process("User","buildLoginFrame"),!1)},bindCountEvent:function(e){var t=this,a=t._buyDialog,s=a.element.find(".j_count");a.element.on("click",".j_minus",function(){var a=parseInt(s.val())||1;a=Math.max(1,a-1),a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}).on("click",".j_plus",function(){var a=parseInt(s.val())||1;a++,a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}),s.on("input propertychange",function(){var a=/^[1-9]\d*$/,n=s.val();(n&&!a.test(n)||a.test(n)&&n>999)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(999,n),s.val(n)),$(".t_dou_needed").text(e*n),t.checkCountError()}).on("blur",function(){var a=s.val()&&parseInt(s.val())>0&&parseInt(s.val())||1;a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a),t.checkCountError()})},checkCountError:function(){var e=this,t=e._buyDialog,a=t.element.find(".t_dou_needed"),s=t.element.find(".error_tip"),n=t.element.find(".j_count"),i=n.val(),o=t.element.find(".j_buy_button"),c=PageData.scores,l=parseInt(c.scores_money+c.scores_other),r=Math.min(parseInt(c.scores_fetch),parseInt(e.data.fetch_scores_limit||0)),_=parseInt(l+r);return 999==i?(s.text("\u5355\u6B21\u9650\u5151999\u4E2A"),s.show()):s.hide(),_<parseInt(a.text())?(s.text("T\u8C46\u4F59\u989D\u4E0D\u8DB3"),s.show(),o.addClass("ui_btn_disable ui_btn_m_disable").removeClass("ui_btn ui_btn_sub_m j_confirm_buy"),!1):(s.hide(),o.addClass("ui_btn ui_btn_sub_m j_confirm_buy").removeClass("ui_btn_disable ui_btn_m_disable"),!0)},doBuy:function(){var e,t=this.data,a=this,s="",n="",i=parseInt(t.fetch_scores_limit,10)||0,o=PageData.scores.scores_fetch;n=0===i||0===o?"":['<div class="TbeanCharge_container">','<input id="j_charge_checked" type="checkbox" name="TbeanCharge_check" />','\u53EF\u4F7F\u7528<span class="icon_Tbean_num"></span><span class="Tbean_num">',Math.min(o,i),"</span>\u8C46\u7968\u62B5\u7528T\u8C46","</div>"].join(""),"0"==t.props_type?(PageData.user.setpass&&(a.buy_tpl0=a.buy_tpl0.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl0,{price:t.scores,price_unit:t.scores+"T\u8C46/"+a.util.convertToDay(t.time_interval),title:t.name,imgsrc:t.imgsrc,level:t.free_user_level,TbeanCharge:n}),e=480):"1"==t.props_type&&(PageData.user.setpass&&(a.buy_tpl1=a.buy_tpl1.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl1,{price:t.scores,price_unit:t.scores+"T\u8C46/1\u4E2A",title:t.name,imgsrc:t.imgsrc,cur_t_dou:PageData.scores.scores_total,level:2,TbeanCharge:n}),e=560);var c=220;PageData.user.setpass&&(c=200),a._buyDialog=new $.dialog({html:s,title:"\u5151\u6362\u9053\u5177",width:e,height:c}),PageData.user.setpass?a._buyDialog.element.find(".buy_tpl_right").append(a.util.getFreeInfo(t)):a._buyDialog.element.find(".buy_tpl_left").append(a.util.getFreeInfo(t)),"1"==t.props_type&&a.bindCountEvent(t.scores),a._buyDialog.element.one("click",".j_confirm_buy",function(){var e={props_id:t.props_id};if("1"==t.props_type&&!a.checkCountError())return a._buyDialog.element.one("click",".j_confirm_buy",arguments.callee),void 0;"1"==t.props_type&&(e.buy_num=a._buyDialog.element.find(".j_count").val()),i>0&&$("#j_charge_checked").length&&$("#j_charge_checked")[0].checked&&(e.use_fetch_scores=$(".Tbean_num").text()),$.stats.track(t.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u786E\u5B9A\u5151\u6362");var s=function(n){n&&$.extend(e,n),a.netProxy.buyProp(e,function(n){var i="",o="",c=a.use("tbmall/widget/TbeanSafe",{json:n,sucCallback:s,content:a});if(!c.needCheck()){if(0==n.no){switch(t.props_category){case"107":o='\u5728\u8D34\u5427\u8BE6\u60C5\u9875\u70B9\u51FB<img style="vertical-align:middle;" src="/tb/static-tbmall/img/magic_show_icon.png" />\u4F7F\u7528';break;case"108":"1080001"==t.props_id&&(o="\u5728\u7B7E\u5230\u9875\u9762\u4F7F\u7528");break;case"101":o="\u4F60\u53EF\u4EE5\u5728\u8FD9\u91CC\u4F7F\u7528\u4F60\u7684\u53D1\u8D34\u6C14\u6CE1";break;case"104":o="\u5728\u53D1\u8D34\u6846\u4E2D\u4F7F\u7528";break;case"105":o="\u60A8\u5DF2\u6210\u529F\u62E5\u6709\u8BE5\u52CB\u7AE0\u5BF9\u5E94\u7684\u9053\u5177\u7279\u6743\uFF0C\u5FEB\u53BB\u4F7F\u7528\u5427\uFF01";break;case"109":case"110":o="\u5728\u5F53\u524D\u9875\u9762\u4F7F\u7528";break;case"113":o="\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u4F7F\u7528"}i="1"==t.props_type?"\u5151\u6362"+e.buy_num+"\u4E2A<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01<br>"+o:"\u5151\u6362<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3<span class='orange_txt'>"+a.util.formatDate(n.data.end_time)+"</span><br>"+o}else switch(n.no){case 2270005:i="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:i="\u9886\u53D6\u6210\u529F`(*\u2229_\u2229*)\u2032";break;case 2270004:i="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u5151\u6362\u672C\u52CB\u7AE0\uFF01";break;case 2270006:i="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u5151\u6362";break;case 360007:case 2150040:var l=a.use("tbmall/component/captcha_payment",{data:n});return l.showCaptcha(s),void 0;case 2270018:case 1990005:case 2190005:n.data=n.data||{};var r=a.use("tbmall/widget/paykey_dialog",{showType:2,errType:n.no,errTime:n.data.wrongtime});return r.showDialog(s,function(){},a),void 0;default:i="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}0==n.no&&($.inArray(t.props_category,["109","110","114"])>-1||"1080002"==t.props_id)?a.dialog.confirm('<div class="tip">'+i+"</div>",{button:[{txt:"\u7ACB\u5373\u4F7F\u7528",extraclass:"j_nameplate_recast1",callback:function(){a.dialog.close(),"1080002"==t.props_id?a.use("tbmall/widget/ContSignCard"):"1140001"==t.props_id?$(".j_nameplate_recast").trigger("click"):a.useController.doUse(parseInt(n.data.props_id))}},{txt:"\u7A0D\u540E\u4F7F\u7528",callback:function(){a.dialog.close(),$.tb.location.reload()}}]}):0==n.no&&$.inArray(t.props_category,["101"])>-1?(a.dialog.info('<div class="tip tip_center">'+i+'</div><div class="tip_bubble_intro"></div><div class="tip_operation"><input type="checkbox" class="tip_check_box"/>\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u6C14\u6CE1</div>',{title:"\u8D2D\u4E70\u6210\u529F",width:475,height:365,button:"\u6211\u77E5\u9053\u4E86"}),a.dialog.bind("onInfoClose",function(){$(".tip_operation .tip_check_box").tbattr("checked")?$.ajax({url:"/tbmall/submit/setBub",type:"post",dataType:"json",data:{props_id:t.props_id,tbs:PageData.tbs||PageData.user.tbs},success:function(){$.tb.location.reload()},error:function(){$.tb.location.reload()}}):$.tb.location.reload()})):(a.dialog.info('<div class="tip">'+i+"</div>"),0==n.no&&a.dialog.bind("onInfoClose",function(){$.tb.location.reload()}))}})};a._buyDialog.close(),s()})}}});_.Module.define({path:"encourage/widget/celebrity_expball",requires:["encourage/widget/util","tbmall/component/BuyController","common/widget/LoginDialog","tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","common/widget/payMember"],sub:{resources:{expballPropsCategoryId:119,expballPropsId:1190001,buyprops:"/tbmall/post/buyprops",voteNpc:"/celebrity/submit/voteNpc",ApiGenOrder:"/celebrity/submit/genOrder"},initial:function(e){this.opt=e||{},this.util=this.requireInstance("encourage/widget/util"),this.parrProps=this.util.user.Parr_props||{},this.forum=this.util.pageData.forum||this.opt.forum||{},this.user=this.util.user,this.tplMain=this.util.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-top">          <div class="celebrity-expball-top-left"></div>          <div class="celebrity-expball-top-right">              <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u6295\u7968\u7ECF\u9A8C\uFF01</h3>              <button class="celebrity-expball-buy-btn btn-encourage btn-large" j-celebrity-expball-buy-btn>\u53BB\u4E70\u9053\u5177</button>          </div>        </div>      <div class="celebrity-expball-bottom">          <p>\u66F4\u591A\u7FFB\u500D\u7968\u6570\u7279\u6743</p>            <p>              \u672C\u5427\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2;              <a href="javascript:;" j-celebrity-expball-local-vip>\u5F00\u901A>> </a>          </p>            <p>              \u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2\u3002              <a href="javascript:;" j-celebrity-expball-super-vip>\u5F00\u901A>> </a>          </p>      </div>  </div>" '),this.tplConfirm=this.util.parseTpl(' "<div class="celebrity-expball" >      <div class="celebrity-expball-vote">          <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u7968\u6570\u54E6!</h3>          <div class="celebrity-expball-vote-confirm-btn-wrapper">              <button class="btn-default celebrity-expball-vote-confirm-btn btn-middle" j-celebrity-expball-vote-use-btn>\u4F7F\u7528\u9053\u5177(\u8FD8\u5269<%=left_num %>\u4E2A)</button>              <button class="btn-sub celebrity-expball-vote-confirm-btn btn-middle"  j-celebrity-expball-vote-no-use-btn>\u76F4\u63A5\u6295\u7968</button>          </div>      </div>  <div>" '),this.tplVote=this.util.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-top">          <div class="celebrity-expball-vote">              <h3><i class="celebrity-expball-vote-icon"></i>\u6295\u7968\u6210\u529F\uFF0C<span class="orange-text">\u540D\u4EBA\u7968\u6570+<%=add_vote_num %></span></h3>              <% if (left_vote_times != -1) { %>              <p class="celebrity-expball-vote-tip">\u4ECA\u65E5\u8FD8\u5269<a><%=left_vote_times %></a>\u6B21\u6295\u7968\u673A\u4F1A</p>              <% } %>          </div>        </div>      <div class="celebrity-expball-bottom">          <p>\u7FFB\u500D\u7968\u6570\u7279\u6743</p>          <ul class="celebrity-expball-bottom-list">              <li>                  <span>\u53CC\u500D\u7403</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570*2 <a href="javascript:;" j-celebrity-expball-buy-btn>\u53BB\u8D2D\u4E70>> </a></span>              </li>              <li>                  <span>\u672C\u5427\u4F1A\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2 <a href="javascript:;" j-celebrity-expball-local-vip>\u5F00\u901A>> </a></span>              </li>          </ul>      </div>  </div>" '),this.bindEvent()},bindEvent:function(){var e=$("#celebrity"),t=this;e.on("click","[j-celebrity-vote-btn]",function(){var e=$(this);if(t.util.checkLogin(!0)){var i=e.tbattr("data-id");t.hasExpBall(t.parrProps)?(t.showVoteConfirmDialog(),t.dialog.element.on("click","[j-celebrity-expball-vote-use-btn]",function(){t.vote(i,1)}).on("click","[j-celebrity-expball-vote-no-use-btn]",function(){t.vote(i,0)})):t.vote(i,0)}}).on("click","[j-celebrity-expball-show]",function(){t.tbmallBuy(this)})},hasExpBall:function(e){return $.getPageData("119.1190001.left_num",0,e)||0},setForum:function(e,t){return this.forum=this.util.fine({forum$id:e,forum$name:t}),this},setCallback:function(e,t){this.callback=e,this.context=t},vote:function(e,t){var i=this,l=i.util.fine({id:e,use$num:t,tbs:i.util.tbs});$.post(this.resources.voteNpc,l,function(e){if(e)switch(e.no){case 0:t>0&&i.hasExpBall(i.parrProps)&&(i.parrProps["119"]["1190001"].left_num-=t),i.showVoteSuccessDialog(e.data),i.callback&&(i.context?i.callback.call(i.context,e.data):i.callback(e.data));break;case 952710:i.showAlert("\u60A8\u672A\u5173\u6CE8\u672C\u5427");break;case 11e4:i.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:i.showAlert("\u5427\u7B49\u7EA7\u8FBE\u5230"+(e.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6");break;case 952712:i.showAlert("\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~");break;case 952713:i.showAlert("\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5C06\u5728\u4E0B\u4E2A\u67081\u53F7\u65E9\u4E0A8\u70B9\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85");break;case 952724:i.showAlert("\u672C\u671F\u6295\u7968\u7ED3\u675F, \u4E0B\u671F\u6295\u7968\u5C06\u5728\u65E9\u4E0A8\u70B9\u542F\u52A8, \u656C\u8BF7\u671F\u5F85");break;case 952709:i.showAlert("\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B");break;case 65534:i.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5");break;case 65533:i.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301");break;case 65532:i.showAlert("\u5F53\u524DIP\u5DF2\u88AB\u9501\u5B9A");break;case 2160001:i.showAlert("\u89D2\u8272\u5DF2\u6EE1\u4E00\u4E07\u7968");break;default:i.showAlert("\u64CD\u4F5C\u5931\u8D25,"+e.error)}})},tbmallBuy:function(e){var t=this,i=this.util.fine({props$id:this.resources.expballPropsId,props$category:this.resources.expballPropsCategoryId,props$type:"1",scores:"200",name:"\u53CC\u500D\u7403",imgsrc:"//tb2.bdstatic.com/tb/static-encourage/widget/celebrity_expball/images/expball_buy_icon_552acff.jpg",free$user$level:"0",time$interval:"0",fetch$scores$limit:"0",is$default$usedd:"0"});this.util.pageData.scores=this.user.Parr_scores||{};var l=t.util.pageData.scores.scores_total||0;return 200>l?(t.showAlert("T\u8C46\u4F59\u989D\u4E0D\u8DB3, \u8BF7\u5148\u5151\u6362T\u8C46\u5427~"),void 0):(this.buyController=this.requireInstance("tbmall/component/BuyController",[$(e),i]),this.buyController._buyDialog.element.off("click",".j_confirm_buy").on("click",".j_confirm_buy",function(){t.genOrder(+t.buyController._buyDialog.element.find(".j_count").val())}),void 0)},genOrder:function(e){var t=this;$.post(t.resources.ApiGenOrder,t.util.fine({props$id:t.resources.expballPropsId,props$num:e,from:"pc",tbs:t.util.tbs}),function(e){0===+e.no?t.payOrder(e.data||{}):t.showAlert("\u8BA2\u5355\u751F\u6210\u5931\u8D25, \u8BF7\u7A0D\u5019\u91CD\u8BD5")})},payOrder:function(e){var t=this,i=$.extend(t.util.fine({from:"\u540D\u4EBA\u5802",chargeType:"platform",goods$unit:"\u4E2A"}),e),l=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){e.data=e.data||{},"encourage_paid"===e.command&&0===+e.data.no&&(t.updatePageData(t.util.fine(e,"data.data.order_info")||{}),t.buyController._buyDialog.close())});l.createMain(i)},updatePageData:function(e){var t=+e.tdou_num,i=+e.money_scores,l=+e.other_scores,a=t/200,o=+this.hasExpBall(this.parrProps)+a,r="user.Parr_scores.scores_total",s="user.Parr_scores.scores_money",c="user.Parr_scores.scores_other",n=this.util.fine(this.util.pageData,r)||0,u=this.util.fine(this.util.pageData,s)||0,b=this.util.fine(this.util.pageData,c)||0;this.util.fine(this.util.pageData,r,n-t),this.util.fine(this.util.pageData,s,u-i),this.util.fine(this.util.pageData,c,b-l),this.util.fine(this.util.pageData,"user.Parr_props.119.1190001.left_num",o)},showExpBallDialog:function(){var e=this;this.showDialog(this.tplMain({})),e.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){e.dialog.close(),e.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){e.dialog.close();var t=e.util.fine({scores$money:0,scores$other:0});e.requireInstance("tbmall/widget/forumMemberDialog",e.util.fine({is$show$features:!1,is$show$forum:!1,current$forum$id:e.forum.forum_id,current$forum$name:e.forum.forum_name,scores:e.user.Parr_scores||t,cnt$height:225,is$celebrity$forum:!0,callback:function(){$.tb.location.reload()}}))}).on("click","[j-celebrity-expball-super-vip]",function(){e.dialog.close();var t=e.requireInstance("common/widget/payMember"),i={fr:"celebrity"};t.showCashier(i)})},showVoteSuccessDialog:function(e){var t=this;e.left_vote_times=e.left_vote_times||-1,this.showDialog(t.tplVote(e)),t.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){t.dialog.close(),t.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){t.dialog.close();var e=t.util.fine({scores$money:0,scores$other:0});t.requireInstance("tbmall/widget/forumMemberDialog",t.util.fine({is$show$features:!1,is$show$forum:!1,current$forum$id:t.forum.forum_id,current$forum$name:t.forum.forum_name,scores:t.user.Parr_scores||e,cnt$height:225,is$celebrity$forum:!0,callback:function(){$.tb.location.reload()}}))}).on("click","[j-celebrity-expball-super-vip]",function(){t.dialog.close();var e=t.requireInstance("common/widget/payMember"),i={fr:"celebrity"};e.showCashier(i)})},showVoteConfirmDialog:function(){this.showDialog(this.tplConfirm(this.util.fine({left$num:this.hasExpBall(this.parrProps)})))},showAlert:function(e){$.dialog.alert(e,{title:"\u8D34\u5427\u63D0\u793A",acceptValue:"\u77E5\u9053\u5566",onaccept:function(){return!0}})},showDialog:function(e,t){this.dialog&&(this.dialog.close(),this.dialog=null),this.dialog=new this.util.Dialog({title:t,html:e,width:430})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"user/widget/celebrity",requires:["common/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","encourage/widget/npc_vote/npc_vote_action","tbmall/widget/exp_package_dialog","user/widget/celebrity_forum_dialog"],sub:{initial:function(e){this.$root=$("#celebrity"),this.pageData=window.PageData||{},this.forum=this.pageData.forum||{},this.user=this.pageData.user||{},this.opt=e,this.isCelebrityForum=e.isCelebrityForum||!1,this.isCurForumMember=e.isCurForumMember||!1,this._bindEvents()},purchaseExp:function(e){var r=this,o=$.extend({from:"\u5355\u5427\u4F1A\u5458\u7ECF\u9A8C\u4E66",chargeType:"platform"},e);e.goods_unit="\u4E2A",r.payment=r.requireInstance("common/widget/Tdou/TdouViewPay"),r.payment.createMain(o)},getEmptyScore:function(){var e={};e.scores_money=0,e.scores_other=0},_bindEvents:function(){var e=this;this.$root.find(".j-gift-buy").on("click",function(){var r={};r.is_show_features=!1,r.is_show_forum=!1,r.current_forum_id=e.forum.forum_id,r.current_forum_name=e.forum.forum_name,r.scores=e.user.Parr_scores||e.getEmptyScore(),r.cnt_height=225,r.is_celebrity_forum=e.isCelebrityForum,r.isCurForumMember=e.isCurForumMember,r.callback=function(){$.tb.location.reload()},e.requireInstance("tbmall/widget/forumMemberDialog",r)}),this.$root.on("click",".open-btn",function(){e.$root.find(".first-show-container").hide(),e.$root.find(".second-show-container").show()}),this.$root.on("click",".close-btn",function(){e.$root.find(".first-show-container").show(),e.$root.find(".second-show-container").hide()}),this.requireInstance("encourage/widget/npc_vote/npc_vote_action",{$root:e.$root}),this.$root.on("click",".celebrity-purchase-exp",function(){if(!$.getPageData("user.is_login",0))return e.requireInstanceAsync("common/widget/LoginDialog",["","userBar"]),void 0;var r={};r.is_show_features=!1,r.is_show_forum=!1,r.current_forum_id=e.forum.id,r.current_forum_name=e.forum.name,r.scores=e.user.Parr_scores||e.getEmptyScore(),r.cnt_height=225,r.is_celebrity_forum=e.isCelebrityForum,r.isCurForumMember=e.isCurForumMember,r.callback=function(){$.tb.location.reload()},e.requireInstance("tbmall/widget/exp_package_dialog",[r])}),this.requireInstance("user/widget/celebrity_forum_dialog",{$root:e.$root.find(".j-btn-celebrity"),celebrity:e.opt.celebrity,memberLastDays:e.opt.memberLastDays,levelHref:"/celebrity/rankHome"})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"pb/widget/video_player_html5",sub:{state:0,states:{UNSTART:0,BUFFERING:1,PLAYING:2,PAUSED:3,END:4,ERROR:-1},url:"",$element:null,initial:function(e){try{e=e||{},this.$element=e.element&&"VIDEO"===$(e.element)[0].tagName?$(e.element):this.createVideo(e),this.bindEvents()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/video_player_html5/video_player_html5.js",method:"",ln:43}),t}},getElement:function(){return this.$element},createVideo:function(e){var t="<video ";return $.each(e,function(e,n){t+=e+'="'+n+'" '}),t+="></video>",$(t)},play:function(){return this.$element[0].play(),this},pause:function(){return this.$element[0].pause(),this},volume:function(e){return void 0!==e&&$.isNumeric(e)?(e=e>1?1:0>e?0:e,this.$element[0].volume=e,this):this.$element[0].volume},muted:function(e){return"boolean"!=typeof e?this.$element[0].muted:(this.$element[0].muted=e,void 0)},load:function(){this.$element[0].load()},getBuffered:function(){for(var e=this.$element[0].buffered,t=[],n=0,i=e.length;i>n;n++)t[n]=[e.start(n),e.end(n)];return t},currentTime:function(e){var t=this.$element[0];if(void 0===e)return t.currentTime;if($.isNumeric(e))return t.currentTime=e,this;var n=e+"",i=this.getDuration(),r=n.indexOf("%");return r>0&&!1!==i?(e=+n.substring(0,r)/100*i,t.currentTime=e,this):void 0},getLeftTime:function(){return this.getDuration()-this.currentTime()},getDuration:function(){var e=this.$element[0].duration;return isNaN(e)||null===e?!1:e},fullScreen:function(){var e=this.$element[0];if(e.requestFullscreen)return e.requestFullscreen(),void 0;var t=["moz","ms","o","webkit"];$.each(t,function(t,n){var i=n+"RequestFullscreen";return e[i]?(e[i](),void 0):void 0})},bindEvents:function(){var e=this,t=["play","pause","error","waiting","canplay","loadedmetadata","volumechange","ended"];this.bindInterval(),$.each(t,function(t,n){e.$element.on(n,function(){e.trigger(n)})}),this.$element.on("play",function(){e.state=e.states.UNSTART}),this.$element.on("pause",function(){e.state=e.states.PAUSED}),this.$element.on("error",function(){e.state=e.states.ERROR}),this.$element.on("waiting",function(){e.state=e.states.BUFFERING}),this.$element.on("end",function(){e.state=e.states.END}),"ActiveXObject"in window&&this.bind("interval",function(){e.getReadyState()>=3&&e.trigger("canplay")})},getReadyState:function(){return this.$element[0].readyState},bindInterval:function(){var e=this;this.timer=setInterval(function(){e.trigger("interval")},1e3)},destructor:function(){clearInterval(this.timer)}}});_.Module.define({path:"pb/widget/video_player",requires:["pb/widget/video_player_html5"],sub:{_isInit:!1,_isShowVideo:!1,_isMuted:!0,_refreshProcessWrap:!0,_isPlay:!0,video:null,defaultOpt:{containerClass:"video_player_container"},src:"",initial:function(e){try{e=$.extend({},this.defaultOpt,e),this.$imgContainer=$(e.imgContainer),this.src=this.$imgContainer.data("src"),this.$imgContainer.addClass(e.containerClass),this.genPlayButton()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/video_player/video_player.js",method:"",ln:47}),i}},getHtml:function(){var e='<div class="j_wrap">                            <i class="center-btn btn-loading"></i>                            <i class="center-btn btn-buffer-fail"></i>                            <i class="center-btn error"></i>                            <i class="center-btn loading-wrap">                                <span class="loading-center"></span>                                <span class="loading-circle"></span>                            </i>                            <i class="voice-absolute voice-absolute-mute"><span></span></i>                            <div class="control-wrap">                                <i class="btn-contol btn-pause"></i>                                <i class="btn-contol btn-play"></i>                                <div class="process-outer-wrap"><div class="proess-wrap"><div class="process"><i></i></div></div></div>                                <span class="left-time">-00:00</span>                                <i class="voice-wrap mute">                                    <div class="voice-outer-wrap">                                        <div class="voice-inner-wrap">                                            <div class="process"><i class="image-round"></i></div>                                        </div>                                    </div>                                </i>                            <div>                        </div>';return e},bindEvents:function(){this._bindControlHover(),this._bindPause(),this._bindPlay(),this._bindVolume(),this._bindProcess(),this._bindError(),this._bindVideoClickPauseAndPlay(),this._bindListen()},_bindVideoClickPauseAndPlay:function(){var e=this;this.$imgContainer.on("click","video",function(){try{e._isPlay?e.pause():e.play()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/video_player/video_player.js",method:"",ln:92}),i}})},_bindControlHover:function(){var e=this.$imgContainer;e.on("mouseover",function(){e.find(".control-wrap").show()}).on("mouseout",function(){e.find(".control-wrap").hide().off("mousemove")})},_bindPause:function(){var e=this.$imgContainer,i=this.video;e.on("click",".btn-pause",function(){try{i.pause()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:109}),e}})},_bindPlay:function(){var e=this.$imgContainer,i=this;e.on("click",".control-wrap .btn-play",function(){try{i.play()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:116}),e}})},_bindVolume:function(){var e=this.$imgContainer,i=this,t=!1;e.on("click",".voice-wrap",function(){try{if(t)return $(this).find(".voice-outer-wrap").off("mousemove").off("mouseup").off("mouseleave"),void 0;i.setMuted(!i.getMuted())}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:129}),e}}).on("click",".voice-outer-wrap",function(e){try{e.stopPropagation()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:132}),e}}).on("mouseover",".voice-wrap",function(){$(this).find(".voice-outer-wrap").show()}).on("mouseleave",".voice-wrap",function(){$(this).find(".voice-outer-wrap").hide()}).on("mousedown",".voice-inner-wrap i",function(o){o.preventDefault(),t=!0;var n,s=e.find(".voice-inner-wrap")[0].getBoundingClientRect().top;e.find(".voice-outer-wrap").on("mousemove",function(e){e.preventDefault(),n=n||$(this).height();var t=e.clientY,o=n-(t-s)-7,r=o/n;i.setVolume(r)}).on("mouseup",function(e){setTimeout(function(){t=!1},0),e.preventDefault(),$(this).off("mousemove").off("mouseup").off("mouseleave")}),e.find(".voice-wrap").on("mouseleave",function(e){setTimeout(function(){t=!1},0),e.preventDefault(),$(this).find(".voice-outer-wrap").off("mousemove").off("mouseup").off("mouseleave")})}).on("click",".voice-inner-wrap",function(e){try{if(t)return;var o;o=o||$(this).height();for(var n=$(e.target),s=e.offsetY;;){if(n.is(".voice-inner-wrap"))break;s+=n.position().top,n=n.parent()}var r=o-s-2,a=r/o;i.setVolume(a)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:194}),e}})},_bindError:function(){var e=this;this.$imgContainer.on("click",".error",function(){try{e.destructor(),e.play()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/video_player/video_player.js",method:"",ln:201}),i}})},_bindProcess:function(){var e=this.$imgContainer,i=this,t=!1;e.on("click",".process-outer-wrap",function(e){try{if(t)return;var o=e.offsetX,n=$(this).width();i.setProcess(o/n*100+"%")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:214}),e}}),e.on("mousedown",".proess-wrap i",function(o){o.preventDefault(),i._refreshProcessWrap=!1,t=!0;var n=e.find(".proess-wrap").width(),s=0,r=e.find(".process-outer-wrap").offset().left;e.on("mousemove",".process-outer-wrap",function(e){e.preventDefault();var i=e.clientX;s=(i-r)/n,s=100*s+"%",$(this).find(".proess-wrap .process").css("width",s)}).on("mouseup",".process-outer-wrap",function(o){i._refreshProcessWrap=!0,i.setProcess(s),o.preventDefault(),e.off("mousemove").off("mouseup").off("mouseleave"),setTimeout(function(){t=!1},0)}).on("mouseleave",".process-outer-wrap",function(){t=!1,i._refreshProcessWrap=!0,e.off("mousemove").off("mouseup").off("mouseleave")})})},_bindListen:function(){var e=this,i=this.$imgContainer,t=this.video;t.bind("pause",function(){i.find(".center-btn").hide(),i.find(".btn-pause").hide(),i.find(".btn-play").show(),e._isPlay=!1}),t.bind("waiting",function(){i.find(".center-btn").hide(),i.find(".loading-wrap").show()}),t.bind("play",function(){i.find(".center-btn").hide(),i.find(".btn-play").hide(),i.find(".btn-pause").show(),e._isPlay=!0}),t.bind("canplay",function(){e._isShowVideo||(e._isShowVideo=!0,e.$videoElement.removeClass("video-hide"),e.$imgContainer.find("img").hide()),i.find(".loading-wrap").hide()}),t.bind("interval",function(){e.refreshProcess()}),t.bind("ended",function(){e.trigger("ended")}),t.bind("error",function(){i.find(".center-btn").hide(),i.find(".error").show()})},setVolume:function(e,i){if(!$.isNumeric(e))return!1;if(e=e>.9?.9:0>e?0:e,i)return this.video.volume(e),void 0;var t=100*e+"%";this.$imgContainer.find(".voice-inner-wrap .process").css("height",t),this.video.volume(e),this.setMuted(e>.01?!1:!0)},getMuted:function(){return this.video.muted()},setMuted:function(e){var i=this.video.volume()>.9?.9:this.video.volume(),t=100*i+"%",o=this.video;e?(o.muted(!0),this.$imgContainer.find(".voice-inner-wrap .process").css("height",0),this.$imgContainer.find(".voice-wrap").removeClass("voice").addClass("mute"),this.$imgContainer.find(".voice-absolute").addClass("voice-absolute-mute")):(o.muted(!1),this.$imgContainer.find(".voice-inner-wrap .process").css("height",t),this.$imgContainer.find(".voice-wrap").removeClass("mute").addClass("voice"),this.$imgContainer.find(".voice-absolute").removeClass("voice-absolute-mute")),this.trigger("mutedchange")},setProcess:function(e){var i=this.video,t=i.getDuration();"string"==typeof e&&e.indexOf("%")>-1&&(e=parseInt(e,10)/100*t),$.isNumeric(e)&&(e=e>t?t:0>e?0:e,i.currentTime(e)),this.$imgContainer.find(".left-time").html("-"+this._secondsFormat(t-e)),this.$imgContainer.find(".proess-wrap .process").css("width",e/t*100+"%")},refreshProcess:function(){var e=this.video,i=e.currentTime(),t=e.getDuration();this.$imgContainer.find(".left-time").html("-"+this._secondsFormat(t-i)),this._refreshProcessWrap&&this.$imgContainer.find(".proess-wrap .process").css("width",i/t*100+"%")},_secondsFormat:function(e){var i=[],t=this;return $.isNumeric(e)?(e=parseInt(e,10),e>=3600&&(i.push(Math.floor(e/3600)),e%=3600),e>=60?(i.push(Math.floor(e/60)),e%=60):i.push(0),i.push(e),$.each(i,function(e,o){i[e]=t._addZero(o)}),i.join(":")):!1},_addZero:function(e){return $.isNumeric(e)?e>9?e:"0"+e:!1},play:function(){this.trigger("beforePlay"),this._isInit||(this.firstPlay(),this._isInit=!0),this.video.play()},pause:function(){this._isInit&&this.video.pause()},genPlayButton:function(){var e='<i class="center-btn btn-center-play"></i>',i=this;$(e).click(function(){try{i.trigger("playButtonClick")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/video_player/video_player.js",method:"",ln:445}),e}}).appendTo(this.$imgContainer)},firstPlay:function(){var e=this.$imgContainer;this.video=this.requireInstance("pb/widget/video_player_html5",[{src:this.src}]),this.$videoElement=this.video.getElement().addClass("video-hide"),this.$wrap=$(this.getHtml()).append(this.$videoElement).appendTo(e),this.bindEvents()},destructor:function(){!1!==this._isInit&&(this._isInit=!1,this._isShowVideo=!1,this._isPlay=!0,this.$wrap.remove(),this.video.destructor(),this.$imgContainer.find(".btn-center-play").show(),this.$imgContainer.find("img").show(),this.$imgContainer.unbind())}}});_.Module.define({path:"pb/widget/avideo",requires:["pb/widget/video_player"],sub:{$_root:null,$_videoList:null,$_listWrap:null,_curPlayVideoIndex:-1,_realLogType:0,_visibleCount:4,_videos:[],_muted:!0,_initVolum:.25,_isScrolling:!1,_scrollInter:null,initial:function(i){try{this.$_root=$("#video_aside"),this.$_listWrap=this.$_root.find(".video_list_wrap"),this.$_videoList=this.$_listWrap.find("li"),this._videoTotalCount=this.$_videoList.length,this._visibleCount=+i.visibleCount||this._visibleCount,this._oneItemHeight=this._getOneItemHeight(),this._bindEvents(),this._initVideo();var t=this;setTimeout(function(){$(".j_d_post_content video").length&&$(".j_d_post_content video").on("play",function(){t.$_listWrap.find("video").each(function(i,t){t.pause()})})},1e3)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/avideo/avideo.js",method:"",ln:64}),e}},_initVideo:function(){var i=this;i.$_videoList.each(function(t){var e=i.requireInstance("pb/widget/video_player",{imgContainer:$(this).find(".video_list_container")});e.bind("ended",function(){i.autoPlay()}),e.bind("beforePlay",function(){try{$(".j_d_post_content video").get(0).pause()}catch(i){}}),e.bind("playButtonClick",function(){i.playVideo(t),$.stats.track("pb\u53F3\u4FA7\u89C6\u9891","pb\u53F3\u4FA7\u89C6\u9891","pb","click")}),e.bind("mutedchange",function(){i._muted=e.getMuted()}),i._videos.push(e)})},_getOneItemHeight:function(){var i=10,t=this.$_videoList.first().height();return i+t},autoPlay:function(){this.playVideo(this._curPlayVideoIndex)},playVideo:function(i){if(this._curPlayVideoIndex>=0&&(this._videos[this._curPlayVideoIndex].pause(),this._videos[this._curPlayVideoIndex].destructor()),i=void 0===i?this._curPlayVideoIndex:i,i=0>i?0:i,i=i>=this._videoTotalCount?0:i,!this._isScrolling){var t=this.$_listWrap.scrollTop();i*this._oneItemHeight-t<0?this.$_listWrap.animate({scrollTop:i*this._oneItemHeight}):(i+1)*this._oneItemHeight-t>this._visibleCount*this._oneItemHeight&&this.$_listWrap.animate({scrollTop:this._oneItemHeight*(i-this._visibleCount+1)})}this.$_listWrap.find("li").removeClass("focus").eq(i).addClass("focus");var e=this._videos[i];return e?(this._curPlayVideoIndex=i,this.trigger("beforePlay"),e.play(),e.setVolume(this._initVolum,!0),e.setMuted(this._muted),void 0):!1},stop:function(){this._curPlayVideoIndex>=0&&this._videos[this._curPlayVideoIndex].destructor()},_bindEvents:function(){var i=this;this.bind("afterEnd",function(){var t=i._visibleCount*i._curPage;i.playVideo(t)}),this.bind("beforePlay",function(){var t=i._curPlayVideoIndex,e=$(i.$_videoList[t]),o=e.find(".video_list_container"),n=o.data("video-md5"),s=o.data("fid"),d=o.data("tid");i._sendLog({forum_id:s,thread_id:d,video_md5:n,obj_locate:"pbaside",obj_id:i._realLogType,tbs:PageData.tbs})}),this.$_root.on("click",".video_link",function(){try{$.stats.track("pb\u53F3\u4FA7\u89C6\u9891","pb\u53F3\u4FA7\u89C6\u9891","pb","click")}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/avideo/avideo.js",method:"",ln:184}),i}}),this.$_listWrap.on("scroll",function(){clearTimeout(i._scrollInter),i._isScrolling=!0,i._scrollInter=setTimeout(function(){i._isScrolling=!1},500)});var t=$(document);t.on("visibilitychange",function(){var t=document.visibilityState;i._realLogType="hidden"===t?1:0})},_sendLog:function(i){0!==this._canSendLog&&$.post("/video/playStat",i)}}});_.Module.define({path:"encourage/widget/myApp",sub:{MY_APP_THEME_KEY:"my_app_theme_cls",initial:function(a){var t=this;t._root=$("#encourage_entry"),$.extend(t,a),$.tb.Storage.remove("my_app_theme_cls"),"1"==t.is_pull_recommendation&&t.pullRecommendation(),t._stats()},_stats:function(){var a=this,t=a._root.find(".list50").length>0;a._root.on("click","a",function(){var e=$(this).data("log"),n=$(this).closest(".j_app_item").find(".j_app_recommend").length>0||"1"!=a.is_pull_recommendation,p={is_recommendation:n,is_50:t};$.stats.track(e,"\u53F3\u4FA7\u5165\u53E3-\u6211\u7684\u5E94\u7528",PageData.product,"click",p)}),a._viewStats(a._root,{is_50:t})},_viewStats:function(a,t){var e=!1,n=null,p=function(){e||($.stats.track("\u5C55\u73B0","\u53F3\u4FA7\u5165\u53E3-\u6211\u7684\u5E94\u7528",PageData.product,"show",t),e=!0)},i=function(){var t=a.offset().top,e=a.offset().top+a.height(),n=$("body").scrollTop(),p=$(window).height()+n,i=!1;return(t>n&&p>=t||e>n&&p>=e)&&(i=!0),i};i()?p():$(window).on("scroll",function(){i()&&(clearTimeout(n),n=setTimeout(p,200))})},setTheme:function(){var a=this,t="list50",e="list60",n=$.tb.Storage.get(a.MY_APP_THEME_KEY);n||(n="1"==a.is_pull_recommendation?a.user_id%2==0?t:e:a.random(0,99)%2==0?t:e,$.tb.Storage.set(a.MY_APP_THEME_KEY,n)),a._root.find(".j_app_list").addClass(n)},random:function(a,t){return null==t&&(t=a,a=0),a+Math.floor(Math.random()*(t-a+1))},pullRecommendation:function(){var a=this,t={ie:"utf-8",tbs:PageData.tbs};a._ajax&&a._ajax.abort(),a._ajax=$.ajax({type:"post",url:"/tbapp/user/getRecommendApp",data:t,dataType:"json"}).success(function(t){t&&0===t.no&&a.renderAppList(t.data)})},renderAppList:function(a){var t=this,e=0;t.wrapper=$("#encourage_entry");for(var n="",p='<li  class="media_vertical app_icon_wrap j_app_item #{last_app_item}"><div class="media_top"><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank" class="app_icon_link"  title="#{app_name}"><img src="#{app_img}"></a>#{recommend_title}</div><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank"  class="media_bottom text_overflow"  title="#{app_name}">#{app_name}</a></li>',i=0,o=a.length;o>i&&12>i;i++){var _=a[i],r={last_app_item:(i+1)%3===0?"last_app_item":"",app_name:_.forum_name,app_img:_.forum_portrait_image,recommend_title:1==_.type?(e++,'<span  class="j_app_recommend media_caption app_recommend">\u8350</span>'):""};n+=$.tb.format(p,r)}var s=t.wrapper.find(".j_add_app_item");12==a.length?s.hide():s.show(),t.wrapper.find(".j_app_list").prepend(n),e==a.length?(t.wrapper.find(".j_encourage_title").html("\u63A8\u8350\u5E94\u7528"),t.wrapper.find(".j_app_recommend").hide()):(t.wrapper.find(".j_encourage_title").html("\u6211\u7684\u5E94\u7528"),t.wrapper.find(".j_app_recommend").show())}}});_.Module.define({path:"spage/widget/TopicRank",sub:{initial:function(){function t(){var t=$(".topic_list_box"),e=t.parent(),i=e.parent();e.height(t.height()),t.width(e.width()),$(window).scroll(function(){i[0].getBoundingClientRect().bottom<=0?t.addClass("topic-fixed"):t.removeClass("topic-fixed")}).scroll()}function e(t){$.stats.track(t.locate,t.task,t.page,t.type,{client_type:"pc_web"})}try{t(),$(".j_topic_toplist .topic_item").live("click",function(){try{e({locate:"\u70ED\u8BAE\u699C\u5355",task:"\u5427\u53CB\u70ED\u8BAE",page:"pb",type:"click"})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/topic_rank/topic_rank.js",method:"",ln:48}),t}}),e({locate:"\u70ED\u8BAE\u699C\u5355",task:"\u5427\u53CB\u70ED\u8BAE",page:"pb",type:"show"})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/topic_rank/topic_rank.js",method:"",ln:58}),i}}}});_.Module.define({path:"comforum/widget/u9Aside",requires:[],sub:{initial:function(e){this.gameName=e.game_name||"",this.gameType=e.game_type||"",this.viewData=e.view_data||[],this.bindEvents()},bindEvents:function(){if(this.gameType){var e=this,a=0,i=this.viewData.length,t=[],s=1==this.gameType?"U9\u5B9A\u5236\u7248":"U9\u901A\u7528\u7248";if(i>0)for(this.gameName=this.viewData[0].summary,a;i>a;a++)t.push(this.viewData[a].summary);$.stats.track("\u53F3\u4FA7",s,"","view",{obj_type:"U9",obj_name:e.gameName,obj_game:t}),$(".u9_aside").on("click",".u9_aside_list a",function(){$.stats.track("\u793C\u5305","U9\u901A\u7528\u7248","","click",{obj_type:"U9",obj_name:$(this).data("code")})})}}}});_.Module.define({path:"pb/widget/news_recommend",sub:{initial:function(){try{var e=$("#local-news-container"),t=$(".left_section"),n=$(".right_section"),o=$("#local-news-wrapper");t.height()>n.height()&&this.requireInstanceAsync("common/component/Follower",{ctn:e,getLimitTop:function(){return{minTop:o.offset().top,maxTop:t.offset().top+t.height()-e.height()}}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/news_recommend/news_recommend.js",method:"",ln:26}),i}}}});