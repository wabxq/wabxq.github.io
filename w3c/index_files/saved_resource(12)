_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"tbmall/widget/diamond_bind_mob",sub:{URL:{sendCaptcha:"/diamondmall/sms/mobile/bindSend",sendMob:"/diamondmall/sms/mobile/bindConfirm"},errorMap:{110003:"\u8BF7\u6C42\u670D\u52A1\u5931\u8D25",210009:"\u53C2\u6570\u9519\u8BEF",210011:"\u7528\u6237\u672A\u767B\u5F55/\u767B\u5F55\u72B6\u6001\u5F02\u5E38",3150004:"\u6BCF\u5929\u9650\u5236\u6210\u529F\u7ED1\u5B9A\u4E24\u6B21\uFF0C\u6BCF\u5C0F\u65F6\u53D1\u90015\u6B21",340020:"\u9A8C\u8BC1\u7801\u5DF2\u8FC7\u671F\u6216\u4E0D\u6B63\u786E"},mobReg:/^1\d{10}$/,initial:function(a){this.type=a.type||"normal",this.$container=a.$container,this.onBindSuccess=a.onSuccess||$.noop,this.onBindError=a.onError||$.noop,this.initTpl(),this.bindEvent()},reset:function(){this.$container.find("#mob-num").val(""),this.$container.find("#captcha-num").val(""),this.$captchaBtn.addClass("disabled"),this.$MobBtn.addClass("disabled"),this.removeErrorTips()},initTpl:function(){var a=this,n={type:a.type},t=_.template('<%if (\'pay\' === type) {%> <div class="tr">     <span class="tips">\u4E3A\u83B7\u5956\u540E\u6211\u4EEC\u53CA\u65F6\u901A\u77E5\u60A8\uFF0C\u8BF7\u586B\u5199\u60A8\u7684\u7535\u8BDD</span> </div> <%}%> <div class="tr">     <span class="title">\u624B\u673A\u53F7\u7801\uFF1A</span>     <span class="input">         <input id="mob-num" type="text"/>     </span> </div> <div class="tr">     <span class="title">\u77ED\u4FE1\u9A8C\u8BC1\u7801\uFF1A</span>     <span class="input">         <input id="captcha-num" type="text"/>         <a href="javascript:;" class="j-send-captcha disabled">\u83B7\u53D6\u9A8C\u8BC1\u7801</a>     </span> </div> <span class="error-tips"></span> <a href="javascript:;" class="j-set-mobile disabled">\u63D0\u4EA4</a>')(n);a.$container.html(t),a.$captchaBtn=a.$container.find(".j-send-captcha"),a.$MobBtn=a.$container.find(".j-set-mobile"),a.$errorTips=a.$container.find(".error-tips")},disabledMobBtn:function(){this.$MobBtn.addClass("disabled")},abledMobBtn:function(){this.$MobBtn.removeClass("disabled")},disabledCaptcha:function(){this.$captchaBtn.addClass("disabled")},abledCaptcha:function(){this.$captchaBtn.removeClass("disabled")},mobCheck:function(a){var n=this;a||(a=n.$container.find("#mob-num"));var t=a.val(),i=parseInt(t,10)||0;if(0===i)return a.val(""),n.disabledCaptcha(),n.disabledMobBtn(),!1;if(t!=i&&a.val(i),n.mobReg.test(i)){var e=n.$container.find("#captcha-num");return e&&n.abledMobBtn(),n.captchaTimer?(n.disabledCaptcha(),!1):(n.abledCaptcha(),!0)}return n.disabledCaptcha(),n.disabledMobBtn(),!1},errorTips:function(a){this.$errorTips.html(a)},removeErrorTips:function(){this.$errorTips.html("")},sendCaptcha:function(a){var n=this,t={tbs:window.PageData.tbs,user_mobile:n.$container.find("#mob-num").val()};$.post(n.URL.sendCaptcha,t,function(t){if(0==t.no)n.setCaptchaTimer(a);else{var i=n.errorMap[t.no];i||(i="\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),n.errorTips(i),n.abledCaptcha()}})},setCaptchaTimer:function(a){var n=30,t=this;a.html("("+n--+"s)\u540E\u91CD\u53D1..."),t.captchaTimer=setInterval(function(){return 0==n?(clearInterval(t.captchaTimer),t.captchaTimer=null,a.html("\u83B7\u53D6\u9A8C\u8BC1\u7801"),t.mobCheck(),void 0):(a.html("("+n--+"s)\u540E\u91CD\u53D1..."),void 0)},1e3)},captchaCheck:function(a){var n=this;a||(a=n.$container.find("#captcha-num"));var t=a.val();n.$container.find("#mob-num").val()&&(t?n.abledMobBtn():n.disabledMobBtn())},sendMob:function(){var a=this,n={tbs:window.PageData.tbs,user_mobile:a.$container.find("#mob-num").val(),bind_code:a.$container.find("#captcha-num").val()};$.post(a.URL.sendMob,n,function(n){if(0==n.no)a.onBindSuccess(n);else{var t=a.errorMap[n.no];t||(t="\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),a.errorTips(t)}})},bindEvent:function(){var a=this;a.$container.on("keyup","#mob-num",function(n){var t=$(n.target);a.mobCheck(t),a.removeErrorTips()}).on("keyup","#captcha-num",function(n){a.captchaCheck($(n.target)),a.removeErrorTips()}).on("click",".j-send-captcha",function(n){var t=$(n.target);t.hasClass("disabled")||(a.removeErrorTips(),a.disabledCaptcha(),a.sendCaptcha(t))}).on("click",".j-set-mobile",function(n){var t=$(n.target);t.hasClass("disabled")||(a.removeErrorTips(),a.sendMob())})}}});_.Module.define({path:"tbmall/widget/grab_treasure_report",sub:{URL:{report:"/diamondmall/feedback/add"},mobReg:/^1\d{10}$/,initial:function(e){this.opts=e,this.$container=e.$container,this.reprotDialog()},reprotDialog:function(){var e=this,t=_.template('<div class="report-container">     <p>\u53CD\u9988\u5185\u5BB9\uFF1A<span>\u6700\u591A\u53EF\u4EE5\u8F93\u51651000\u4E2A\u5B57</span></p>     <textarea maxlength="1000" class="report-txt"></textarea>     <p>\u8054\u7CFB\u7535\u8BDD\uFF1A</p>     <input type="text" class="report-num"/>     <a href="javascript:;" class="j-report-send">\u63D0\u4EA4</a>     <p id="error-tips" class="error-tips"></p> </div>')();e.dialog=new $.dialog({html:t,title:"\u53CD\u9988",width:560,holderClassName:"report-dialog"}),e.reportFlag||e.addReportEvent()},checkMob:function(e){return this.mobReg.test(e)?!0:!1},checkOrder:function(e){var t=this,r=this.dialog.element,i=r.find(".report-txt").val(),o=r.find(".report-num").val();if(i)if(o)if(t.checkMob(o)){var a={content:i,user_mobile:o,tbs:window.PageData.tbs,orderId:t.opts.orderId||""};$.post(t.URL.report,a,function(r){if(0==r.no)t.dialog.close(),t.dialog=null,t.reportSucDialog();else{var i="\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u63D0\u4EA4~";3150004==r.no&&(i="\u63D0\u4EA4\u6B21\u6570\u8FC7\u591A\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\u3002"),t.reportTips(i),e.removeClass("disabled")}})}else t.reportTips("\u624B\u673A\u53F7\u8F93\u5165\u9519\u8BEF"),e.removeClass("disabled");else t.reportTips("\u8BF7\u8F93\u5165\u53CD\u9988\u4EBA\u624B\u673A\u53F7"),e.removeClass("disabled");else t.reportTips("\u8BF7\u8F93\u5165\u53CD\u9988\u5185\u5BB9"),e.removeClass("disabled")},addReportEvent:function(){var e=this;e.reportFlag=!0,e.dialog.element.on("click",".j-report-send",function(t){var r=$(t.target);r.hasClass("disabled")||(r.addClass("disabled"),e.checkOrder(r))}).on("input","input",function(){e.dialog.element.find("#error-tips").html("")}).on("input","textarea",function(){e.dialog.element.find("#error-tips").html("")})},reportTips:function(e){this.dialog.element.find("#error-tips").html(e||"\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u63D0\u4EA4~")},reportSucDialog:function(){var e=new $.dialog({html:'<div class="report-suc-container"><p>\u8C22\u8C22\u60A8\u5BF9\u6211\u4EEC\u7684\u652F\u6301,</p><p>\u7A0D\u540E\u4F1A\u6709\u4E13\u95E8\u7684\u4EBA\u5458\u8FDB\u884C\u5904\u7406\uFF01</p></div>',title:"\u53CD\u9988\u6210\u529F",width:460,height:170});setTimeout(function(){e.close()},3e3)}}});_.Module.define({path:"tbmall/widget/treasure_payment_dialog",requires:["common/widget/payment_dialog_title","common/widget/show_dialog","tbmall/widget/diamond_bind_mob","tbmall/widget/grab_treasure_report"],sub:{URL:{getPayUrl:"/tbmall/getPayUrl",checkOrder:"/diamondmall/order/treasure/confirmStatus"},channel:2,terminal:"pc_jump",payType:13,cashierBuy:0,checkTimes:5,qianbaoLbscashierUrl:"//zhifu.baidu.com/static/js/pc/iframe/lbscashier-iframe.js?t="+(new Date).getTime(),iframeQianbaoId:"treasure-pay-dialog-container-qianbao",initial:function(e){var a=this;a.isShowSuc=e.isShowSuc,a.grabOrderData=e.grabOrderData,a.onSuccess=e.onSuccess||$.noop,a.onError=e.onError||$.noop,a.lastNum=e.lastNum||0,a.initDialog(),e.isShowSuc?(a.setLoading(),a.checkOrder(),a.setChangeTips()):($.stats.track("qianbao-view","\u8D34\u5427\u593A\u5B9D","","view"),a.initQianbao()),a.addEvents()},initQianbao:function(){var e=this,a=e.grabOrderData,r={channel:e.channel,user_id:window.PageData.user.id,terminal:e.terminal,third_order_id:a.third_order_id,scene_id:a.scene_id,fr:a.scene_id,pay_type:e.payType,props_name:a.props_name,open_id:a.open_id,pageUrl:a.page_url,margin:e.lastNum,cashier_buy:e.cashierBuy};$.get(e.URL.getPayUrl,r,function(a){0==a.no?(e.qianbaoUrl=a.data.return_url,e.initQianbaoView()):e.onError({no:2,msg:"qianbao error"})})},initQianbaoView:function(){var e=this;$.JsLoadManager.loadUrl(e.qianbaoLbscashierUrl,function(){e.buildCashier()})},buildCashier:function(){var e=this,a=e.qianbaoUrl;e.cashier?e.cashier.updateOrder(a):(e.cashier=new window.lbscashier({onmessage:function(a){e.onMessage.call(e,a)},containerId:e.iframeQianbaoId,data:a,height:410}),$("#cashier-iframe").css({border:"none"}))},onMessage:function(e){var a=this,r=e.type,i=e.data,o=e.option,t=o&&o.channel;switch(r){case"init":case"updateOrder":a.clearLoading();break;case"pay":var s="wechat"===t||"alipayqr"===t||"gameyeepay"===t||"mobileyeepay"===t;switch(i){case"submit":if(s)return;a.showPaymentTip();break;case"success":s&&(a.showAutoPaymentTip(),a.checkOrder())}}},initDialog:function(){var e=this;$(".treature-pay-dialog").length&&$(".treature-pay-dialog").remove(),e.dialog=new $.dialog({html:_.template('<div class="treasure-pay-dialog-container">     <section class="treasure-pay-dialog-container-title">     </section>     <section class="treasure-pay-dialog-container-loading">         <img src="<%=url%>" class="loading-img">         <p>\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </section>     <section class="treasure-pay-dialog-container-check-order">         <p class="check-order-txt">\u8BF7\u5728\u65B0\u6253\u5F00\u9875\u9762\u4E0A\u5B8C\u6210\u5145\u503C</p>         <p class="check-order-tips">\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>         <a href="javascript:;" class="retry-order-btn">\u5931\u8D25\uFF0C\u91CD\u65B0\u652F\u4ED8</a>         <a href="javascript:;" class="check-order-btn">\u652F\u4ED8\u6210\u529F</a>     </section>     <section class="treasure-pay-dialog-container-auto-check-order">         <p class="check-order-txt">\u60A8\u5DF2\u6210\u529F\u652F\u4ED8</p>         <p class="check-order-tips">\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>         <img src="<%=url%>" class="loading-img">     </section>     <section class="treasure-pay-dialog-container-order-suc">         <p class="order-msg"><i></i>\u606D\u559C\u60A8\uFF0C\u53C2\u4E0E\u6210\u529F</p>         <p class="order-tips">\u53EF\u5230\u4E2A\u4EBA\u4E2D\u5FC3\u4E0B\u67E5\u770B<a target="_blank" href="/diamondmall/center/orderList" class="orange-txt">\u6211\u7684\u593A\u5B9D</a></p>         <a data-type="suc" href="javascript:;" class="close-btn">\u786E\u5B9A</a>         <div class="order-suc-bind-mob"></div>         <p class="bind-mob-suc">\u7ED1\u5B9A\u624B\u673A\u53F7\u6210\u529F~</p>     </section>     <section class="treasure-pay-dialog-container-order-error">         <p class="order-msg"><i></i>\u593A\u5B9D\u5931\u8D25</p>         <p class="order-tips" id="pay">\u5DF2\u8F6C\u5316\u4E3A\u593A\u5B9D\u5E01\u653E\u5165\u60A8\u7684\u4F59\u989D\u4E2D\uFF0C\u4EE5\u4FBF\u4E0B\u6B21\u593A\u5B9D\uFF01</p>         <p class="order-tips" id="change">\u672C\u6B21\u593A\u5B9D\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u5C1D\u8BD5\uFF01</p>         <a data-type="error" href="javascript:;" class="close-btn">\u786E\u5B9A</a>         <p class="order-timer"><span class="j-auto-timer"><a href="javascript:;" class="j-dialog-report">\u8FDB\u884C\u53CD\u9988</a></p>     </section>     <section class="treasure-pay-dialog-container-order-view">         <span class="view-title">\u8D2D\u4E70\u5546\u54C1\uFF1A</span>         <div class="goods-view">             <div class="goods-view-title">\u83B7\u8D60<span class="orange-txt"><%=treasureNum%></span>\u593A\u5B9D\u5E01</div>             <div class="goods-view-info">                 <img src="<%=iconUrl%>" class="goods-view-info-img">                 <span class="txt">\u593A\u5B9D\u6210\u5C31\u5FBD\u7AE0</span>                 <p class="txt">\uFF08\u6709\u6548\u671F<%=days%>\u5929\uFF09</p>             </div>         </div>     </section>     <section id="treasure-pay-dialog-container-qianbao" class="treasure-pay-dialog-container-qianbao">     </section> </div>')({url:"//tb2.bdstatic.com/tb/static-tbmall/widget/treasure_payment_dialog/images/icon-loading_f0da091.gif",iconUrl:"//tb2.bdstatic.com/tb/static-tbmall/widget/treasure_payment_dialog/images/icon_treasure_9fce5bf.png",treasureNum:e.lastNum,days:2*e.lastNum}),show:!1,holderClassName:"treasure-pay-dialog",escable:!1,showTitle:!1,height:550,width:710}),e.$dialog=e.dialog.element,e.dialogCtrl=e.requireInstance("common/widget/show_dialog",{container:e.dialog,type:"normal"}),e.dialogCtrl.show(),e.$dialogTitle=e.$dialog.find(".treasure-pay-dialog-container-title"),e.$loadingView=e.$dialog.find(".treasure-pay-dialog-container-loading"),e.$checkOrderView=e.$dialog.find(".treasure-pay-dialog-container-check-order"),e.$autoCheckOrderView=e.$dialog.find(".treasure-pay-dialog-container-auto-check-order"),e.$orderSucView=e.$dialog.find(".treasure-pay-dialog-container-order-suc"),e.$orderErrorView=e.$dialog.find(".treasure-pay-dialog-container-order-error"),e.$autoTimerView=e.$dialog.find(".j-auto-timer"),e.$bindMobView=e.$dialog.find(".order-suc-bind-mob"),e.addTitle()},checkOrder:function(){var e=this,a={tbs:window.PageData.tbs,order_id:e.grabOrderData.order_id},r=e.checkTimes,i=function(){r--,e.autoCheckTimerCtrl&&clearTimeout(e.autoCheckTimerCtrl),e.autoCheckOrder&&e.autoCheckOrder.abort(),e.autoCheckOrder=$.ajax({type:"GET",url:e.URL.checkOrder,data:a,dataType:"json"}).success(function(a){0==a.no&&a.data.status>=1?(e.orderSuccessView(a.data.user_bind_info),r=5):r>0?e.autoCheckTimerCtrl=setTimeout(i,1e3):e.orderErrorView()}).error(function(){e.orderErrorView()})};e.autoCheckTimerCtrl=setTimeout(i,1e3)},setAutoTimer:function(){},orderSuccessView:function(e){var a=this;a.$orderSucView.show(),a.isOrderSuc=!0,e&&e.user_mobile||(a.$orderSucView.addClass("bind-mob"),a.requireInstance("tbmall/widget/diamond_bind_mob",{$container:a.$bindMobView,type:"pay",onSuccess:function(){a.$orderSucView.removeClass("bind-mob").addClass("bind-suc")},onError:function(){}}))},setChangeTips:function(){this.$dialog.find(".treasure-pay-dialog-container-order-error .order-tips").hide().eq(1).show()},orderErrorView:function(){this.$orderErrorView.show()},showPaymentTip:function(){var e=this;e.$checkOrderView.show()},showAutoPaymentTip:function(){var e=this;e.$autoCheckOrderView.show()},clearLoading:function(){var e=this;e.$loadingView.hide(),e.$autoCheckOrderView.hide(),e.$checkOrderView.hide()},setLoading:function(){this.$loadingView.show()},addTitle:function(){var e=this,a=e.isShowSuc?"\u8D34\u5427\u593A\u5B9D":"\u83B7\u53D6\u6210\u5C31\u5FBD\u7AE0",r={$container:e.$dialogTitle,title:a,isNameShow:!0,isTreasureShow:!0,onClose:function(){e.dialogCtrl.close(),e.isOrderSuc?e.onSuccess({no:1,msg:"success"}):e.onError({no:1,msg:"close dialog"})}};e.requireInstance("common/widget/payment_dialog_title",r)},orderMsg:function(e){var a=this;"suc"===e?a.onSuccess({no:0,msg:"order suc"}):a.onError({no:3,msg:"order error"})},addEvents:function(){var e=this;e.$dialog.on("click",".retry-order-btn",function(){e.clearLoading(),e.setLoading(),e.checkOrder()}).on("click",".check-order-btn",function(){e.clearLoading(),e.setLoading(),e.checkOrder()}).on("click",".close-btn",function(a){var r=$(a.target);e.dialogCtrl.close(),e.orderMsg(r.data("type"))}).on("click",".j-dialog-report",function(){e.requireInstance("tbmall/widget/grab_treasure_report",{orderId:e.grabOrderData.order_id})})}}});_.Module.define({path:"tbmall/widget/treasure_rule_dialog",requires:["common/widget/show_dialog","common/widget/payment_dialog_title"],sub:{initial:function(){var p=this;p.initDialog(),p.addEvents()},initDialog:function(){var p=this;p.dialog=new $.dialog({html:_.template('<a href="javascript:;" class="btn-close">X</a> <div class="treasure-rule-dialog-container">     <div class="info-txt">         <p class="title">\u7528\u6237\u534F\u8BAE</p>         <p>\u6B22\u8FCE\u8BBF\u95EE\u8D34\u5427\u593A\u5B9D\uFF0C\u5E76\u53C2\u4E0E\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u7684\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u3002\u8BF7\u60A8\uFF08\u4EE5\u4E0B\u79F0\u201C\u7528\u6237\u201D\u6216\u201C\u60A8\u201D\uFF09\u4ED4\u7EC6\u9605\u8BFB\u4EE5\u4E0B\u6761\u6B3E<span clas="under-line">\uFF08\u7279\u522B\u662F\u7C97\u4F53\u4E0B\u5212\u7EBF\u6807\u6CE8\u7684\u5185\u5BB9\uFF09</span>\uFF1B\u5982\u679C\u60A8\u672A\u6EE118\u5468\u5C81\uFF0C\u8BF7\u5728\u6CD5\u5B9A\u76D1\u62A4\u4EBA\u7684\u966A\u540C\u4E0B\u9605\u8BFB\u672C\u534F\u8BAE\u3002\u672C\u534F\u8BAE\u7CFB\u60A8\u4E0E\u767E\u5EA6\u8D34\u5427\u4E4B\u95F4\u5C31\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u6240\u8BA2\u7ACB\u7684\u6743\u5229\u4E49\u52A1\u89C4\u8303\u3002\u5982\u679C\u60A8\u5BF9\u672C\u534F\u8BAE\u7684\u4EFB\u4F55\u6761\u6B3E\u8868\u793A\u5F02\u8BAE\uFF0C\u60A8\u53EF\u4EE5\u9009\u62E9\u4E0D\u4F7F\u7528\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\uFF1B\u4F7F\u7528\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u5219\u610F\u5473\u7740\u60A8\u540C\u610F\u9075\u5B88\u672C\u534F\u8BAE\u5168\u90E8\u7EA6\u5B9A\uFF0C\u5E76\u5B8C\u5168\u670D\u4ECE\u767E\u5EA6\u8D34\u5427\u7684\u7EDF\u4E00\u7BA1\u7406\u3002</p>         <p class="header">\u4E00\u3001\u5B9A\u4E49</p>         <p>1.1  \u4E00\u5143\u593A\u5B9D\uFF1A\u662F\u767E\u5EA6\u8D34\u5427\u63A8\u51FA\u7684\u9762\u5411\u6D3B\u8DC3\u5427\u53CB\u7684\u4E00\u9879\u670D\u52A1,\u7528\u6237\u4F7F\u7528\u4E00\u5143\u94B1\u8D2D\u4E70\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u7684\u8D34\u5427\u593A\u5B9D\u6210\u5C31\u65F6\uFF0C\u53EF\u83B7\u8D60\u4E00\u6B21\u53C2\u4E0E\u593A\u5B9D\u7684\u673A\u4F1A\u3002</p>         <p>1.2 \u593A\u5B9D\u5E01\uFF1A\u6307\u7528\u6237\u53C2\u4E0E\u593A\u5B9D\u6240\u4F7F\u7528\u7684\u9053\u5177\uFF0C\u5F53\u60A8\u8D2D\u4E70\u8D34\u5427\u593A\u5B9D\u6210\u5C31\u6210\u529F\u65F6\uFF0C\u767E\u5EA6\u8D34\u5427\u4F1A\u5411\u7528\u6237\u8D60\u9001\u593A\u5B9D\u5E01\u3002\u593A\u5B9D\u5E01\u6CA1\u6709\u6709\u6548\u671F\u9650\uFF0C\u4F46\u6BCF\u4E2A\u8D34\u5427\u593A\u5B9D\u6210\u5C31\u7684\u6709\u6548\u671F\u4E3A2\u5929,\u4E14\u8D34\u5427\u593A\u5B9D\u6210\u5C31\u53EF\u91CD\u590D\u8D2D\u4E70\uFF0C\u6700\u5927\u53EF\u7D2F\u52A0\u6709\u6548\u671F\u81F390\u5929\u3002</p>         <p>1.3 \u593A\u5B9D\u53F7\u7801\uFF1A\u6307\u7528\u6237\u4F7F\u7528\u593A\u5B9D\u5E01\u53C2\u4E0E\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u65F6\u6240\u83B7\u53D6\u7684\u968F\u673A\u5206\u914D\u53F7\u7801\uFF0C\u7528\u6237\u53EF\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u7684\u593A\u5B9D\u8BB0\u5F55\u4E2D\u67E5\u8BE2\u3002</p>         <p>1.4 \u5E78\u8FD0\u53F7\u7801\uFF1A\u6307\u67D0\u4EF6\u5B9D\u8D1D\u7684\u5168\u90E8\u593A\u5B9D\u53F7\u7801\u5206\u914D\u5B8C\u6BD5\u540E\uFF0C\u767E\u5EA6\u8D34\u5427\u6839\u636E\u593A\u5B9D\u89C4\u5219\uFF08\u8BE6\u89C1\u4E00\u5143\u593A\u5B9D\u7F51\u7AD9\uFF09\u8BA1\u7B97\u51FA\u7684\u4E00\u4E2A\u53F7\u7801\u3002\u6301\u6709\u8BE5\u5E78\u8FD0\u53F7\u7801\u7684\u7528\u6237\u5728\u7B26\u5408\u672C\u534F\u8BAE\u7684\u6761\u4EF6\u4E0B\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u3002</p>         <p class="header">\u4E8C\u3001\u7528\u6237\u8D26\u53F7</p>         <p>2.1  \u60A8\u9700\u8981\u4F7F\u7528\u767E\u5EA6\u7684\u7528\u6237\u8D26\u53F7\u65B9\u53EF\u53C2\u4E0E\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u3002\u60A8\u5BF9\u8BE5\u8D26\u53F7\u7684\u7533\u8BF7\u3001\u4F7F\u7528\u7B49\u884C\u4E3A\u5E94\u7B26\u5408\u767E\u5EA6\u4E0D\u65F6\u4FEE\u8BA2\u5E76\u516C\u5E03\u7684\u300A\u767E\u5EA6\u7528\u6237\u534F\u8BAE\u300B\uFF08\u94FE\u63A5\u5730\u5740\u4E3A<a target="_blank" href="//passport.baidu.com/protocal.html">//passport.baidu.com/protocal.html</a>\uFF09\u7684\u89C4\u8303\u3002         </p>         <p>2.2 \u5728\u60A8\u9886\u5956\u524D\uFF0C\u60A8\u5E94\u6309\u8981\u6C42\u586B\u5199\u771F\u5B9E\u51C6\u786E\u7684\u6536\u8D27\u5730\u5740\u3001\u624B\u673A\u53F7\u7801\u7B49\u4FE1\u606F\u3002</p>         <p class="header">\u4E09\u3001\u4E00\u5143\u593A\u5B9D\u89C4\u5219</p>         <p>3.1  \u60A8\u53EF\u4F7F\u7528\u4EBA\u6C11\u5E01\u65B9\u5F0F\u8D2D\u4E70\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u7684\u8D34\u5427\u593A\u5B9D\u6210\u5C31\uFF0C\u5E76\u53C2\u4E0E\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u3002\u4E00\u7ECF\u8D2D\u4E70\uFF0C\u60A8\u4E0D\u5F97\u8981\u6C42\u9000\u6B3E\u3002         </p>         <p>3.2 \u60A8\u53EF\u4EE5\u4F7F\u7528\u83B7\u8D60\u7684\u593A\u5B9D\u5E01\u53C2\u4E0E\u593A\u5B9D\u6D3B\u52A8\u3002\u60A8\u63D0\u4EA4\u593A\u5B9D\u7533\u8BF7\u540E\uFF0C\u767E\u5EA6\u8D34\u5427\u4F1A\u5411\u60A8\u968F\u673A\u5206\u914D\u76F8\u5E94\u6570\u91CF\u7684\u593A\u5B9D\u53F7\u7801\uFF0C\u5F53\u67D0\u5B9D\u8D1D\u5728\u89C4\u5B9A\u65F6\u95F4\u5185\u6EE1\u5458\uFF0C\u5373\u6BCF\u4EF6\u5B9D\u8D1D\u7684\u5168\u90E8\u593A\u5B9D\u53F7\u7801\u5206\u914D\u5B8C\u6BD5\u540E\uFF0C\u767E\u5EA6\u8D34\u5427\u5C06\u6839\u636E\u593A\u5B9D\u89C4\u5219\u8BA1\u7B97\u51FA\u4E00\u4E2A\u5E78\u8FD0\u53F7\u7801\uFF0C\u6301\u6709\u8BE5\u5E78\u8FD0\u53F7\u7801\u7684\u7528\u6237\u53EF\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u3002         </p>         <p>3.3 \u82E5\u67D0\u5B9D\u8D1D\u4E00\u76F4\u5904\u4E8E\u672A\u6EE1\u5458\u72B6\u6001\uFF0C\u767E\u5EA6\u8D34\u5427\u5C06\u5728\u6D3B\u52A8\u7ED3\u675F\u540E\u7684\u4E00\u5B9A\u5468\u671F\u5185\u5C06\u593A\u5B9D\u5E01\u9000\u56DE\u81F3\u60A8\u7684\u593A\u5B9D\u5E01\u8D26\u6237\u4E2D\u3002         </p>         <p>3.4 \u82E5\u5B9D\u8D1D\u56E0\u5404\u79CD\u539F\u56E0\u9700\u8981\u4E0B\u67B6\uFF0C\u767E\u5EA6\u8D34\u5427\u5C06\u5728\u4E00\u5B9A\u5468\u671F\u5185\u5C06\u593A\u5B9D\u5E01\u9000\u56DE\u81F3\u60A8\u7684\u593A\u5B9D\u5E01\u8D26\u6237\u4E2D\u3002         </p>         <p>3.5 \u593A\u5B9D\u5E01\u5FC5\u987B\u901A\u8FC7\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u5E76\u83B7\u5F97\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u62D2\u7EDD\u4ECE\u975E\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u7684\u5E73\u53F0\u6240\u83B7\u5F97\u7684\u593A\u5B9D\u5E01\uFF0C\u5E76\u6709\u6743\u4E0D\u7ECF\u901A\u77E5\u6309\u534F\u8BAE3.13\u6761\u5904\u7406\u7528\u6237\u7684\u8FDD\u89C4\u884C\u4E3A\u548C\u6240\u5F97\u3002         </p>         <p>3.6 \u593A\u5B9D\u5E01\u6CA1\u6709\u6709\u6548\u671F\uFF0C\u4F46\u6BCF\u4E2A\u8D34\u5427\u593A\u5B9D\u6210\u5C31\u7684\u6709\u6548\u671F\u4E3A2\u5929\uFF0C\u4E14\u8D34\u5427\u593A\u5B9D\u6210\u5C31\u53EF\u91CD\u590D\u8D2D\u4E70\u83B7\u5F97\uFF0C\u6700\u5927\u6709\u6548\u671F\u53EF\u7D2F\u52A0\u81F390\u5929\u3002         </p>         <p>3.7 \u593A\u5B9D\u5E01\u4E0D\u80FD\u7528\u4E8E\u8D2D\u4E70\u6216\u5151\u6362\u767E\u5EA6\u8D34\u5427\u7684\u5176\u4ED6\u670D\u52A1\u6216\u8005\u8F6C\u79FB\u7ED9\u5176\u4ED6\u7528\u6237\uFF0C\u4E14\u4E0D\u5F97\u63D0\u73B0\uFF0C\u4E0D\u5F97\u9000\u6B3E\u3002         </p>         <p>3.8 \u767E\u5EA6\u8D34\u5427\u627F\u8BFA\u9075\u5FAA\u516C\u5E73\u3001\u516C\u6B63\u3001\u516C\u5F00\u7684\u539F\u5219\u8FD0\u8425\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\uFF0C\u786E\u4FDD\u6240\u6709\u7528\u6237\u5728\u4E00\u5143\u593A\u5B9D\u4E2D\u4EAB\u53D7\u540C\u7B49\u7684\u6743\u5229\u4E0E\u4E49\u52A1\uFF0C\u593A\u5B9D\u7ED3\u679C\u5411\u6240\u6709\u7528\u6237\u516C\u793A\u3002         </p>         <p>3.9 \u60A8\u77E5\u6089\uFF0C\u9664\u672C\u534F\u8BAE\u53E6\u6709\u7EA6\u5B9A\u5916\uFF0C\u65E0\u8BBA\u5728\u593A\u5B9D\u4E2D\u662F\u5426\u83B7\u5F97\u5B9D\u8D1D\uFF0C\u60A8\u7528\u4E8E\u53C2\u4E0E\u4E00\u5143\u593A\u5B9D\u7684\u593A\u5B9D\u5E01\u4E0D\u80FD\u9000\u56DE\uFF1B\u60A8\u5B8C\u5168\u4E86\u89E3\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u5B58\u5728\u7684\u98CE\u9669\uFF0C\u767E\u5EA6\u8D34\u5427\u4E0D\u4FDD\u8BC1\u60A8\u5728\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u4E2D\u4E00\u5B9A\u4F1A\u83B7\u5F97\u5B9D\u8D1D\u3002         </p>         <p>3.10 \u60A8\u901A\u8FC7\u53C2\u4E0E\u4E00\u5143\u593A\u5B9D\u83B7\u5F97\u5E78\u8FD0\u53F7\u7801\u540E\uFF0C\u60A8\u5E94\u572810\u5929\u5185\u767B\u5F55\u4E00\u5143\u593A\u5B9D\u7F51\u7AD9\u63D0\u4EA4\u6216\u786E\u8BA4\u6536\u8D27\u5730\u5740\uFF0C\u5426\u5219\u89C6\u4E3A\u60A8\u653E\u5F03\u8BE5\u5B9D\u8D1D\uFF0C\u60A8\u56E0\u6B64\u906D\u53D7\u7684\u635F\u5931\uFF0C\u767E\u5EA6\u8D34\u5427\u4E0D\u627F\u62C5\u4EFB\u4F55\u8D23\u4EFB\u3002         </p>         <p>3.11 \u60A8\u63D0\u4EA4\u6216\u786E\u8BA4\u6536\u8D27\u5730\u5740\u540E\uFF0C\u767E\u5EA6\u8D34\u5427\u4F1A\u81EA\u884C\u6216\u6307\u5B9A\u7B2C\u4E09\u65B9\u572815\u4E2A\u5DE5\u4F5C\u65E5\u5185\u5B89\u6392\u914D\u9001\u3002\u60A8\u6536\u5230\u8D27\u7269\u540E\u5E94\u5728\u767E\u5EA6\u8D34\u5427\u5185\u8FDB\u884C\u786E\u8BA4\u6536\u8D27\uFF0C\u7B7E\u6536\u540E7\u5929\u5185\u60A8\u672A\u786E\u8BA4\u6536\u8D27\u7684\uFF0C\u7CFB\u7EDF\u5C06\u81EA\u52A8\u786E\u8BA4\u6536\u8D27\u3002         </p>         <p>3.12 \u60A8\u5E94\u786E\u4FDD\u5728\u672C\u4EBA\u5BF9\u5B9D\u8D1D\u786E\u8BA4\u65E0\u8BEF\u540E\u518D\u7B7E\u6536\uFF0C\u82E5\u5B9D\u8D1D\u5DF2\u7B7E\u6536\uFF0C\u5219\u8BF4\u660E\u5B9D\u8D1D\u914D\u9001\u6B63\u786E\u65E0\u8BEF\u4E14\u4E0D\u5B58\u5728\u5F71\u54CD\u4F7F\u7528\u7684\u56E0\u7D20\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u4E0D\u53D7\u7406\u9000\u6362\u8D27\u7533\u8BF7\uFF0C\u4EC5\u627F\u62C5\u534F\u8C03\u5904\u7406\u7684\u4E49\u52A1\uFF1B\u5982\u56E0\u4E0D\u53EF\u6297\u529B\u9020\u6210\u5B9D\u8D1D\u914D\u9001\u5EF6\u8FDF\uFF0C\u767E\u5EA6\u8D34\u5427\u4E0D\u627F\u62C5\u8D23\u4EFB\u3002         </p>         <p>3.13 \u60A8\u5E94\u5F53\u9075\u5B88\u4E00\u5143\u593A\u5B9D\u7684\u6D3B\u52A8\u89C4\u5219\uFF0C\u4E0D\u6270\u4E71\u4E00\u5143\u593A\u5B9D\u7684\u6B63\u5E38\u79E9\u5E8F\uFF0C\u4E0D\u5F97\u901A\u8FC7\u4F7F\u7528\u4ED6\u4EBA\u5E10\u6237\u3001\u4E00\u4EBA\u6CE8\u518C\u591A\u4E2A\u5E10\u6237\u3001\u4F7F\u7528\u7A0B\u5E8F\u81EA\u52A8\u5904\u7406\u3001\u653B\u51FB\u6216\u5165\u4FB5\u7CFB\u7EDF\u3001\u5229\u7528\u7CFB\u7EDF\u7684BUG\u3001\u6F0F\u6D1E\u7B49\u65B9\u5F0F\u635F\u5BB3\u4ED6\u4EBA\u6216\u767E\u5EA6\u8D34\u5427\u7684\u5229\u76CA\uFF0C\u6216\u5229\u7528\u4E0A\u8FF0\u65B9\u5F0F\u725F\u5229\u3002\u60A8\u4E5F\u4E0D\u5F97\u5229\u7528\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u7684\u670D\u52A1\u8FDB\u884C\u4EFB\u4F55\u5F62\u5F0F\u7684\u8D4C\u535A\u3002         </p>         <p>3.14 \u82E5\u60A8\u5B58\u5728\u4EFB\u4F55\u8FDD\u6CD5\u6216\u8FDD\u53CD\u672C\u534F\u8BAE\u7EA6\u5B9A\u7684\u884C\u4E3A\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u89C6\u60A8\u7684\u8FDD\u6CD5\u6216\u8FDD\u89C4\u60C5\u51B5\u9002\u7528\u4EE5\u4E0B\u4E00\u9879\u6216\u591A\u9879\u5904\u7F5A\u63AA\u65BD\uFF1A</p>         <p>\uFF081\uFF09\u8D23\u4EE4\u60A8\u6539\u6B63\u8FDD\u6CD5\u6216\u8FDD\u89C4\u884C\u4E3A\uFF1B</p>         <p>\uFF082\uFF09\u4E2D\u6B62\u3001\u7EC8\u6B62\u90E8\u5206\u6216\u5168\u90E8\u670D\u52A1\uFF1B</p>         <p>\uFF083\uFF09\u53D6\u6D88\u7528\u6237\u593A\u5B9D\u7533\u8BF7\u5E76\u53D6\u6D88\u5B9D\u8D1D\u53D1\u653E\uFF08\u82E5\u7528\u6237\u5DF2\u593A\u5B9D\u6210\u529F\uFF09\uFF1B</p>         <p>\uFF084\uFF09\u51BB\u7ED3\u6216\u6CE8\u9500\u7528\u6237\u5E10\u53F7\u53CA\u5176\u5E10\u53F7\u4E2D\u7684\u593A\u5B9D\u5E01\uFF08\u5982\u6709\uFF09\uFF1B </p>         <p>\uFF085\uFF09\u5176\u4ED6\u767E\u5EA6\u8D34\u5427\u8BA4\u4E3A\u5408\u9002\u5728\u7B26\u5408\u6CD5\u5F8B\u6CD5\u89C4\u89C4\u5B9A\u7684\u60C5\u51B5\u4E0B\u7684\u5904\u7F5A\u63AA\u65BD\u3002</p>         <p>\u82E5\u60A8\u7684\u884C\u4E3A\u9020\u6210\u767E\u5EA6\u8D34\u5427\u53CA\u5176\u5173\u8054\u516C\u53F8\u635F\u5931\u7684\uFF0C\u60A8\u8FD8\u5E94\u627F\u62C5\u8D54\u507F\u8D23\u4EFB\u3002</p>         <p>3.15 \u60A8\u5728\u767E\u5EA6\u8D34\u5427\u5E73\u53F0\uFF08\u542B\u8D34\u5427\u593A\u5B9D\u6D3B\u52A8\uFF09\u53CA\u767E\u5EA6\u8D34\u5427APP\uFF08\u542B\u8D34\u5427\u593A\u5B9D\u6D3B\u52A8\uFF09\u5185\u7684\u884C\u4E3A\u548C\u53D1\u8A00\uFF0C\u4E0D\u5F97\u6709\u4EE5\u4E0B\u60C5\u5F62\uFF0C\u5426\u5219\u767E\u5EA6\u8D34\u5427\u6709\u6743\u505C\u6B62\u53D1\u5E03\u5E76\u5220\u9664\u8A00\u8BBA\u3001\u7981\u6B62\u60A8\u53D1\u8A00\u3001\u6CE8\u9500\u5E10\u53F7\u53CA\u5176\u5E10\u53F7\u4E2D\u7684\u593A\u5B9D\u5E01\uFF08\u5982\u6709\uFF09\u7B49\uFF1A</p>         <p>\uFF081\uFF09\u8FDD\u53CD\u5BAA\u6CD5\u6216\u6CD5\u5F8B\u6CD5\u89C4\u89C4\u5B9A\u7684\uFF1B</p>         <p>\uFF082\uFF09\u5371\u5BB3\u56FD\u5BB6\u5B89\u5168\uFF0C\u6CC4\u9732\u56FD\u5BB6\u79D8\u5BC6\uFF0C\u98A0\u8986\u56FD\u5BB6\u653F\u6743\uFF0C\u7834\u574F\u56FD\u5BB6\u7EDF\u4E00\u7684\uFF1B</p>         <p>\uFF083\uFF09\u635F\u5BB3\u56FD\u5BB6\u8363\u8A89\u548C\u5229\u76CA\u7684\uFF0C\u635F\u5BB3\u516C\u5171\u5229\u76CA\u7684\uFF1B</p>         <p>\uFF084\uFF09\u717D\u52A8\u6C11\u65CF\u4EC7\u6068\u3001\u6C11\u65CF\u6B67\u89C6\uFF0C\u7834\u574F\u6C11\u65CF\u56E2\u7ED3\u7684\uFF1B</p>         <p>\uFF085\uFF09\u7834\u574F\u56FD\u5BB6\u5B97\u6559\u653F\u7B56\uFF0C\u5BA3\u626C\u90AA\u6559\u548C\u5C01\u5EFA\u8FF7\u4FE1\u7684\uFF1B</p>         <p>\uFF086\uFF09\u6563\u5E03\u8C23\u8A00\uFF0C\u6270\u4E71\u793E\u4F1A\u79E9\u5E8F\uFF0C\u7834\u574F\u793E\u4F1A\u7A33\u5B9A\u7684\uFF1B</p>         <p>\uFF087\uFF09\u6563\u5E03\u6DEB\u79FD\u3001\u8272\u60C5\u3001\u8D4C\u535A\u3001\u66B4\u529B\u3001\u51F6\u6740\u3001\u6050\u6016\u6216\u8005\u6559\u5506\u72AF\u7F6A\u7684\uFF1B</p>         <p>\uFF088\uFF09\u4FAE\u8FB1\u6216\u8005\u8BFD\u8C24\u4ED6\u4EBA\uFF0C\u4FB5\u5BB3\u4ED6\u4EBA\u5408\u6CD5\u6743\u76CA\u7684\uFF1B</p>         <p>\uFF089\uFF09\u542B\u6709\u6CD5\u5F8B\u3001\u884C\u653F\u6CD5\u89C4\u7981\u6B62\u7684\u5176\u4ED6\u5185\u5BB9\u7684\u3002</p>         <p>3.16 \u5982\u679C\u4E0B\u5217\u60C5\u5F62\u53D1\u751F\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u53D6\u6D88\u60A8\u7684\u5E78\u8FD0\u53F7\u7801\uFF1A</p>         <p>\uFF081\uFF09 \u56E0\u4E0D\u53EF\u6297\u529B\u3001\u4E00\u5143\u593A\u5B9D\u7CFB\u7EDF\u53D1\u751F\u6545\u969C\u6216\u906D\u53D7\u7B2C\u4E09\u65B9\u653B\u51FB\uFF0C\u6216\u53D1\u751F\u5176\u4ED6\u767E\u5EA6\u8D34\u5427\u65E0\u6CD5\u63A7\u5236\u7684\u60C5\u5F62\uFF1B</p>         <p>\uFF082\uFF09 \u4F7F\u7528\u975E\u767E\u5EA6\u8D34\u5427\u63D0\u4F9B\u7684\u593A\u5B9D\u5E01\uFF0C\u5F97\u5230\u7684\u5E78\u8FD0\u53F7\u7801\u5C06\u4F5C\u5E9F\u3002</p>         <p>\uFF083\uFF09 \u56E0\u91CD\u5E86\u798F\u5F69\u5B98\u65B9\u53D1\u5E03\u7684\u65F6\u65F6\u5F69\u5F00\u5956\u53F7\u7801\u53D1\u751F\u9519\u8BEF\u5BFC\u81F4\u5F00\u51FA\u9519\u8BEF\u7684\u5E78\u8FD0\u53F7\u7801\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u5728\u5B98\u65B9\u66F4\u6B63\u65B0\u7684\u65F6\u65F6\u5F69\u53F7\u7801\u4E4B\u540E\u540C\u6B65\u66F4\u6B63\u51C6\u786E\u7684\u593A\u5B9D\u5E78\u8FD0\u53F7\u7801\uFF0C\u5E76\u540C\u65F6\u4F5C\u5E9F\u9519\u8BEF\u7684\u593A\u5B9D\u5E78\u8FD0\u53F7\u7801\u3002</p>         <p>\uFF084\uFF09 \u6839\u636E\u767E\u5EA6\u8D34\u5427\u5DF2\u7ECF\u53D1\u5E03\u7684\u6216\u5C06\u6765\u53EF\u80FD\u53D1\u5E03\u6216\u66F4\u65B0\u7684\u5404\u7C7B\u89C4\u5219\u3001\u516C\u544A\u7684\u89C4\u5B9A\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u53D6\u6D88\u7528\u6237\u5E78\u8FD0\u53F7\u7801\u7684\u60C5\u5F62\u3002</p>         <p class="header">\u56DB\u3001\u514D\u8D23\u58F0\u660E</p>         <p>4.1  \u767E\u5EA6\u8D34\u5427\u672A\u6388\u6743\u60A8\u4ECE\u4EFB\u4F55\u7B2C\u4E09\u65B9\uFF08\u5305\u62EC\u5176\u4ED6\u7528\u6237\uFF09\u901A\u8FC7\u8D2D\u4E70\u3001\u63A5\u53D7\u8D60\u4E0E\u6216\u8005\u5176\u4ED6\u7684\u65B9\u5F0F\u83B7\u5F97\u593A\u5B9D\u5E01\u7B49\uFF0C\u767E\u5EA6\u8D34\u5427\u4E0D\u5BF9\u7B2C\u4E09\u65B9\u4EA4\u6613\u7684\u884C\u4E3A\u8D1F\u8D23\uFF0C\u5E76\u4E14\u4E0D\u53D7\u7406\u56E0\u4EFB\u4F55\u7B2C\u4E09\u65B9\u4EA4\u6613\u53D1\u751F\u7EA0\u7EB7\u800C\u5E26\u6765\u7684\u7533\u8BC9\u3002</p>         <p>4.2 \u767E\u5EA6\u8D34\u5427\u5728\u6B64\u63D0\u793A\u60A8\uFF0C\u8BF7\u4E0D\u8981\u4E0E\u4ED6\u4EBA\u5171\u4EAB\u8D26\u53F7\u6216\u5C06\u8D26\u53F7\u4FE1\u606F\u63D0\u4F9B\u7ED9\u4ED6\u4EBA\uFF0C\u5426\u5219\u56E0\u6B64\u9020\u6210\u7684\u635F\u5931\u767E\u5EA6\u8D34\u5427\u4E0D\u4E88\u627F\u62C5\u3002</p>         <p>4.3 \u7531\u4E8E\u4E92\u8054\u7F51\u670D\u52A1\u7684\u7279\u6B8A\u6027\uFF0C\u767E\u5EA6\u8D34\u5427\u6709\u6743\u6839\u636E\u6CD5\u5F8B\u6CD5\u89C4\u7684\u89C4\u5B9A\u53CA\u76F8\u5173\u4E3B\u7BA1\u90E8\u95E8\u7684\u8981\u6C42\u3001\u7B2C\u4E09\u65B9\u6743\u5229\u4EBA\u7684\u6295\u8BC9\u4E3E\u62A5\u3001\u4E0E\u5408\u4F5C\u65B9\u7684\u5408\u4F5C\u60C5\u51B5\uFF0C\u4EE5\u53CA\u767E\u5EA6\u8D34\u5427\u4E1A\u52A1\u53D1\u5C55\u60C5\u51B5\uFF0C\u968F\u65F6\u53D8\u66F4\u3001\u4E2D\u65AD\u6216\u7EC8\u6B62\u672C\u670D\u52A1\u7684\u90E8\u5206\u6216\u5168\u90E8\u5185\u5BB9\u3002</p>          <p>4.4 \u60A8\u5E94\u5BF9\u4E00\u5143\u593A\u5B9D\u6D3B\u52A8\u4E2D\u7684\u5185\u5BB9\u81EA\u884C\u52A0\u4EE5\u5224\u65AD\uFF0C\u5E76\u627F\u62C5\u56E0\u53C2\u4E0E\u6B64\u6D3B\u52A8\u800C\u5F15\u8D77\u7684\u6240\u6709\u98CE\u9669\uFF0C\u5305\u62EC\u56E0\u5BF9\u6D3B\u52A8\u5185\u5BB9\u53CA\u5B9D\u8D1D\u7684\u6B63\u786E\u6027\u3001\u5B8C\u6574\u6027\u6216\u5B9E\u7528\u6027\u7684\u4F9D\u8D56\u800C\u4EA7\u751F\u7684\u98CE\u9669\u3002\u767E\u5EA6\u8D34\u5427\u65E0\u6CD5\u4E14\u4E0D\u4F1A\u5BF9\u56E0\u524D\u8FF0\u98CE\u9669\u800C\u5BFC\u81F4\u7684\u4EFB\u4F55\u635F\u5931\u6216\u635F\u5BB3\u627F\u62C5\u8D23\u4EFB\u3002</p>         <p class="header">\u4E94\u3001\u4E0D\u53EF\u6297\u529B</p>         <p>5.1  \u4E0D\u53EF\u6297\u529B\u662F\u6307\u4E0D\u80FD\u9884\u89C1\u3001\u4E0D\u80FD\u514B\u670D\u5E76\u4E0D\u80FD\u907F\u514D\u4E14\u5BF9\u4E00\u65B9\u6216\u53CC\u65B9\u9020\u6210\u91CD\u5927\u5F71\u54CD\u7684\u5BA2\u89C2\u4E8B\u4EF6\uFF0C\u8BE5\u4E8B\u4EF6\u4F7F\u4EFB\u4F55\u4E00\u65B9\u6839\u636E\u672C\u534F\u8BAE\u5C65\u884C\u5176\u5168\u90E8\u6216\u90E8\u5206\u4E49\u52A1\u5DF2\u4E0D\u53EF\u80FD\u3002\u8BE5\u4E8B\u4EF6\u5305\u62EC\u4F46\u4E0D\u9650\u4E8E\u653F\u5E9C\u884C\u4E3A\u3001\u653F\u7B56\u53D8\u5316\u3001\u5730\u9707\u3001\u53F0\u98CE\u3001\u6D2A\u6C34\u3001\u706B\u707E\u6216\u5176\u5B83\u5929\u707E\u3001\u6218\u4E89\u6216\u4EFB\u4F55\u5176\u5B83\u7C7B\u4F3C\u4E8B\u4EF6\u3002\u9274\u4E8E\u4E92\u8054\u7F51\u4E4B\u7279\u6B8A\u6027\u8D28\uFF0C\u4E0D\u53EF\u6297\u529B\u4EA6\u5305\u62EC\u4E0B\u5217\u5F71\u54CD\u4E92\u8054\u7F51\u6B63\u5E38\u8FD0\u884C\u4E4B\u60C5\u5F62:</p>         <p>\uFF081\uFF09 \u9ED1\u5BA2\u653B\u51FB\uFF1B</p>         <p>\uFF082\uFF09 \u7535\u4FE1\u90E8\u95E8\u6280\u672F\u8C03\u6574\u5BFC\u81F4\u4E4B\u91CD\u5927\u5F71\u54CD\uFF1B</p>         <p>\uFF083\uFF09 \u56E0\u653F\u5E9C\u7BA1\u5236\u800C\u9020\u6210\u4E4B\u6682\u65F6\u5173\u95ED\uFF1B</p>         <p>\uFF084\uFF09 \u75C5\u6BD2\u4FB5\u88AD\u3002</p>         <p>5.2 \u56E0\u4E0D\u53EF\u6297\u529B\u4E8B\u4EF6\u81F4\u4F7F\u672C\u534F\u8BAE\u90E8\u5206\u6216\u5168\u90E8\u4E0D\u80FD\u5C65\u884C\u6216\u5EF6\u8FDF\u5C65\u884C\uFF0C\u5219\u53CC\u65B9\u4E92\u4E0D\u627F\u62C5\u4EFB\u4F55\u8FDD\u7EA6\u8D23\u4EFB\u3002\u4F46\u51FA\u73B0\u4E0A\u8FF0\u60C5\u51B5\u65F6\uFF0C\u767E\u5EA6\u8D34\u5427\u5C06\u52AA\u529B\u5728\u7B2C\u4E00\u65F6\u95F4\u4E0E\u76F8\u5173\u5355\u4F4D\u914D\u5408\uFF0C\u53CA\u65F6\u8FDB\u884C\u5904\u7406\u3002</p>         <p class="header">\u516D\u3001\u7BA1\u8F96\u4E0E\u6CD5\u5F8B\u9002\u7528</p>         <p>6.1  \u672C\u534F\u8BAE\u7B7E\u8BA2\u5730\u4E3A\u4E2D\u534E\u4EBA\u6C11\u5171\u548C\u56FD\u5317\u4EAC\u5E02\u6D77\u6DC0\u533A\u3002</p>         <p>6.2 \u672C\u534F\u8BAE\u7684\u6210\u7ACB\u3001\u751F\u6548\u3001\u5C65\u884C\u3001\u89E3\u91CA\u53CA\u7EA0\u7EB7\u89E3\u51B3\uFF0C\u9002\u7528\u4E2D\u534E\u4EBA\u6C11\u5171\u548C\u56FD\u5927\u9646\u5730\u533A\u6CD5\u5F8B\u3002</p>         <p>6.3 \u82E5\u60A8\u548C\u767E\u5EA6\u8D34\u5427\u4E4B\u95F4\u56E0\u672C\u534F\u8BAE\u53D1\u751F\u4EFB\u4F55\u7EA0\u7EB7\u6216\u4E89\u8BAE\uFF0C\u9996\u5148\u5E94\u53CB\u597D\u534F\u5546\u89E3\u51B3\uFF1B\u534F\u5546\u4E0D\u6210\u7684\uFF0C\u60A8\u540C\u610F\u5C06\u7EA0\u7EB7\u6216\u4E89\u8BAE\u63D0\u4EA4\u81F3\u767E\u5EA6\u6240\u5728\u5730\u6CD5\u9662\u8D77\u8BC9\u89E3\u51B3\u3002</p>         <p class="header">\u4E03\u3001\u534F\u8BAE\u7684\u53D8\u66F4\u548C\u751F\u6548</p>         <p>7.1  \u60A8\u77E5\u6653\u5E76\u4E86\u89E3\uFF0C\u767E\u5EA6\u8D34\u5427\u4E0D\u65F6\u516C\u5E03\u6216\u4FEE\u6539\u7684\u4E0E\u672C\u534F\u8BAE\u6709\u5173\u7684\u5176\u4ED6\u89C4\u5219\u3001\u6761\u6B3E\u3001\u516C\u544A\u3001\u901A\u77E5\u7B49\u662F\u672C\u534F\u8BAE\u7684\u7EC4\u6210\u90E8\u5206\u3002\u767E\u5EA6\u8D34\u5427\u6709\u6743\u6839\u636E\u9700\u8981\u4E0D\u65F6\u4FEE\u8BA2\u672C\u534F\u8BAE\u3002\u4E0A\u8FF0\u5185\u5BB9\u4E00\u7ECF\u6B63\u5F0F\u516C\u5E03\u5373\u751F\u6548\u3002</p>         <p>7.2 \u672C\u534F\u8BAE\u6761\u6B3E\u53D8\u66F4\u540E\uFF0C\u5982\u679C\u60A8\u7EE7\u7EED\u4F7F\u7528\u767E\u5EA6\u8D34\u5427\u7684\u593A\u5B9D\u6D3B\u52A8\uFF0C\u5373\u89C6\u4E3A\u60A8\u5DF2\u63A5\u53D7\u53D8\u66F4\u540E\u7684\u534F\u8BAE\u3002\u5982\u679C\u60A8\u4E0D\u63A5\u53D7\u53D8\u66F4\u540E\u7684\u534F\u8BAE\uFF0C\u5E94\u5F53\u7ACB\u5373\u505C\u6B62\u53C2\u4E0E\u672C\u6D3B\u52A8\u3002</p>         <p>7.3 \u82E5\u60A8\u5BF9\u672C\u534F\u8BAE\u5185\u5BB9\u6709\u4EFB\u4F55\u7591\u95EE\uFF0C\u53EF\u901A\u8FC7<a target="_blank" href="//tieba.baidu.com/f?ie=utf-8&kw=%E8%B4%B4%E5%90%A7%E6%84%8F%E8%A7%81%E5%8F%8D%E9%A6%88&fr=search">\u6295\u8BC9\u53CD\u9988</a>\u8FDB\u884C\u53D1\u8D34\u53CD\u9988\u3002</p>     </div> </div>')(),show:!1,holderClassName:"treasure-rule-dialog",escable:!1,showTitle:!1,height:550,width:690}),p.$dialog=p.dialog.element,p.dialogCtrl=p.requireInstance("common/widget/show_dialog",{container:p.dialog,type:"top-pop"}),p.dialogCtrl.show()},addEvents:function(){var p=this;p.$dialog.on("click",".btn-close",function(){p.dialogCtrl.close()})}}});_.Module.define({path:"tbmall/widget/grab_treasure_ctrl",requires:["common/widget/payment_dialog_title","common/widget/show_dialog","common/widget/base_user_data","tbmall/widget/treasure_payment_dialog","tbmall/widget/treasure_rule_dialog","tbmall/widget/tbean_safe_ajax"],sub:{URL:{createOrder:"/diamondmall/order/treasure/create",changeOrder:"/tbmall/submit/open/pay"},payType:13,initial:function(a){var e=this;e.opts=a,e.onSuccess=a.onSuccess||$.noop,e.onError=a.onError||$.noop,e.baseUserData=e.requireInstance("common/widget/base_user_data"),e.userTreasureNum=e.baseUserData.getUserTreasure(),e.initDialog(),e.addTitle(),e.createOrder(function(){e.renderOrderView(),e.setDefaultView()}),e.addEvents()},initDialog:function(){var a=this;$(".grab-treasure-dialog").length&&$(".grab-treasure-dialog").remove(),a.dialog=new $.dialog({html:_.template('<div class="grab-treasure-dialog-container">     <section class="grab-treasure-dialog-container-title">     </section>     <section class="grab-treasure-dialog-container-loading">         <img src="<%=url%>" class="loading-img">         <p>\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </section> </div>')({url:"//tb2.bdstatic.com/tb/static-tbmall/widget/grab_treasure_ctrl/images/icon-loading_f0da091.gif"}),show:!1,holderClassName:"grab-treasure-dialog",escable:!1,showTitle:!1,height:550,width:710}),a.$dialog=a.dialog.element,a.dialogCtrl=a.requireInstance("common/widget/show_dialog",{container:a.dialog,type:"top-pop"}),a.dialogCtrl.show(),a.$dialogContainer=a.$dialog.find(".grab-treasure-dialog-container"),a.$dialogTitle=a.$dialog.find(".grab-treasure-dialog-container-title"),a.$loadingView=a.$dialog.find(".grab-treasure-dialog-container-loading")},addTitle:function(){var a=this,e={$container:a.$dialogTitle,title:"\u8D34\u5427\u593A\u5B9D",isNameShow:!0,isTreasureShow:!0,onClose:function(){a.dialogCtrl.close(),a.onError({no:1,msg:"dialog close"})}};a.requireInstance("common/widget/payment_dialog_title",e)},createOrder:function(a){var e=this,r=e.opts.threadId,t=e.opts.orderNum;if(!r||!t)return e.clearLoading(),e.onError({no:1,msg:"\u593A\u5B9D\u4FE1\u606F\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u9875\u9762~"}),void 0;var s={tbs:window.PageData.tbs,thread_id:r,treasure_count:t};$.post(e.URL.createOrder,s,function(r){0==r.no?(e.grabOrderData=r.data.order,e.trackCtrl("cashier-view","view"),a&&a()):(e.clearLoading(),e.dialogCtrl.close(),e.onError(r))})},renderOrderView:function(){var a=this,e=a.grabOrderData,r={goodImgUrl:e.goods.goods_pic,goodName:e.goods.goods_name,goodCount:e.goods_num,price:e.goods_amount*e.ratio,treasureNum:a.userTreasureNum||0,treasureCount:e.goods_amount},t=_.template('<%     var hasTreasure = \'\';     if (0 == treasureNum) {         hasTreasure = \'disbaled\';     } %> <section class="grab-treasure-dialog-container-order">     <table>         <tr>             <th class="title">\u5546\u54C1\u540D\u79F0</th>             <th class="num">\u53C2\u4E0E\u4EBA\u6B21</th>             <th class="total">\u5C0F\u8BA1</th>         </tr>         <tr>             <td>                 <img src="<%=goodImgUrl%>" class="good-img">                 <span class="good-name"><%=goodName%></span>             </td>             <td class="good-counts"><%=goodCount%></td>             <td class="treasure-counts"><%=treasureCount%>\u593A\u5B9D\u5E01</td>         </tr>     </table> </section> <section class="grab-treasure-dialog-container-tips">     <div class="grab-treasure-agreement">         <input id="read-real" class="check-box" type="checkbox">         <label for="read-real" class="check-box-label">             \u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F<a href="javascript:;" class="j-get-real">\u300A\u8D34\u5427\u593A\u5B9D\u7528\u6237\u534F\u8BAE\u300B</a>         </label>     </div>     <div class="grab-treasure-price">         <p>\u5E94\u4ED8\u91D1\u989D\uFF1A<span class="price-num">\uFFE5<%=price%>.00</span></p>     </div> </section> <section class="grab-treasure-dialog-container-pay-ctrl">     <div class="pay-with-rest <%=hasTreasure%>" data-treasure="<%=treasureNum%>">         <input id="pay-with-rest" class="check-box <%=hasTreasure%>" type="checkbox" <%if(0 != treasureNum){%>checked <%}else{%> disabled <%}%> >         <label for="pay-with-rest" class="check-box-label">             \u4F7F\u7528\u8D26\u6237\u4F59\u989D\u652F\u4ED8\uFF08\u8D26\u6237\u4F59\u989D\uFF1A<%=treasureNum%>\u593A\u5B9D\u5E01\uFF09\uFF1A             <span class="rest-treasure">-\uFFE5<span class="rest-treasure-num">0</span>.00</span>         </label>     </div>     <div class="pay-last <%=hasTreasure%>">         <p>\u8FD8\u9700\u652F\u4ED8\uFF1A<span class="last-num">\uFFE5<span class="last-treasure-num"></span>.00</span></p>     </div> </section> <section class="grab-treasure-dialog-container-btn">     <a href="javascript:;" class="j-grab-treasure-btn">\u53BB\u652F\u4ED8</a>     <a href="javascript:;" class="j-grab-treasure-btn">\u4E00\u952E\u593A\u5B9D</a>     <p class="pay-tips">\u652F\u4ED8\u6210\u529F\u5373\u53EF\u83B7\u5F97\u201C\u9EC4\u91D1\u9A91\u5175\u201D\u6210\u5C31</p> </section>')(r);a.$dialogContainer.append(t);var s=a.$dialog;a.$treasureBtn=s.find(".j-grab-treasure-btn"),a.$restTreasureNum=s.find(".rest-treasure-num"),a.$lastTreasureNum=s.find(".last-treasure-num"),a.$lastTreasureView=s.find(".pay-last"),a.$btnLast=s.find(".j-grab-treasure-btn"),a.$payTips=s.find(".pay-tips"),a.setTreasureLast(),a.clearLoading()},setTreasureLast:function(){var a=this,e=a.userTreasureNum||0,r=a.grabOrderData.goods_amount,t=a.grabOrderData.ratio;return 0===e?(a.$lastTreasureNum.html(r*t),void 0):(r>e?(a.$restTreasureNum.html(e*t),a.$lastTreasureNum.html((r-e)*t)):(a.$restTreasureNum.html(r*t),a.$lastTreasureNum.html(0)),a.lastNum=r,a.showBtn("pay"),void 0)},showBtn:function(a){var e=this.$btnLast;"pay"===a?(e.eq("1").hide(),e.eq("0").show(),this.$payTips.show()):(e.eq("0").hide(),e.eq("1").show(),this.$payTips.hide())},restTreasureCtrl:function(a){var e=this,r=e.userTreasureNum||0,t=e.grabOrderData.goods_amount,s=e.grabOrderData.ratio;a.is(":checked")?(t>r?(e.$lastTreasureNum.html((t-r)*s),e.showBtn("pay")):(e.$lastTreasureNum.html(0),e.showBtn("change")),e.isChecked=!0,e.lastNum=t>r?t-r:0):(e.$lastTreasureNum.html(t*s),e.showBtn("pay"),e.isChecked=!1,e.lastNum=t)},changeOrder:function(){var a=this,e=a.grabOrderData,r={tbs:window.PageData.tbs,open_id:e.open_id,order_id:e.third_order_id,scene_id:e.scene_id,pay_type:a.payType},t=a.requireInstance("tbmall/widget/tbean_safe_ajax");t.post(a.URL.changeOrder,r,function(e){0==e.no?a.requireInstance("tbmall/widget/treasure_payment_dialog",{onSuccess:function(e){a.paySuccess.call(a,e)},onError:function(e){a.payError.call(a,e)},grabOrderData:a.grabOrderData,isShowSuc:!0}):(a.errorTips(e.no),a.clearLoading())},"json")},paySuccess:function(a){this.dialogCtrl.close(),this.onSuccess(a)},payError:function(){var a=this;a.createOrder(function(){a.clearLoading()})},setDefaultView:function(){this.$dialog.find("#read-real").click(),this.restTreasureCtrl(this.$dialog.find("#pay-with-rest"))},payCtrl:function(){var a=this;a.isChecked&&0==a.lastNum?(a.changeOrder(),a.trackCtrl("cashier-exchange","click")):(a.trackCtrl("cashier-pay","click"),a.requireInstance("tbmall/widget/treasure_payment_dialog",{grabOrderData:a.grabOrderData,lastNum:a.lastNum,onSuccess:function(e){a.paySuccess.call(a,e)},onError:function(e){a.payError.call(a,e)}}))},errorTips:function(a){var e="\u7F51\u7EDC\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5~";switch(a){case"btnDisable":e="\u8BF7\u5148\u9605\u8BFB\u5E76\u540C\u610F\u300A\u670D\u52A1\u534F\u8BAE\u300B"}$.dialog.alert(e)},clearLoading:function(){this.$loadingView.hide()},setLoading:function(){this.$loadingView.show()},addEvents:function(){var a=this;a.$dialog.on("change","#read-real",function(e){var r=$(e.target);r.is(":checked")?a.$treasureBtn.removeClass("disabled"):a.$treasureBtn.addClass("disabled")}).on("change","#pay-with-rest",function(e){var r=$(e.target);r.hasClass("disabled")||a.restTreasureCtrl(r)}).on("click",".j-grab-treasure-btn",function(e){var r=$(e.target);return r.hasClass("disabled")?(a.errorTips("btnDisable"),void 0):(a.setLoading(),a.payCtrl(),void 0)}).on("click",".j-get-real",function(e){e.stopPropagation(),a.requireInstance("tbmall/widget/treasure_rule_dialog")})},trackCtrl:function(a,e){a=a||"",$.stats.track(a,"\u8D34\u5427\u593A\u5B9D","",e)}}});_.Module.define({path:"tbmall/widget/pb_grab_treasure",requires:["tbmall/widget/grab_treasure_ctrl"],sub:{initial:function(){this.$root=$("#j-grab-treasure-wrap"),this.buyMaxCount=0,this.initPostInfo(),this.showGuide(),this.bindEvent()},grabTreasureMainHtml:function(t){var a='<div class="treasure-top-bg"></div>  <div class="treasure-main-wrap">     <div class="treasure-main">                  <div class="clearfix issue-wrap">             <div class="pull-left issue">\u7B2C<%= post.issue %>\u671F             </div>             <a href="javascript:;" class="pull-right feedback j-feedback-btn">\u53CD\u9988</a>         </div>         <div class="clearfix goods-wrap">             <img class="pull-left goods-img" src="<%= goods.goods_pic %>" />             <div class="pull-left goods-detail">                 <div class="goods-name"><%= goods.goods_name %></div>                                 <!-- post_status: 1\u3001\u5DF2\u4E0A\u7EBF  2\u3001\u5F85\u5F00\u5956 3\u3001\u5DF2\u5F00\u5956 4\u3001\u593A\u5B9D\u5F02\u5E38 5\u3001 \u6682\u505C\u593A\u5B9D 8\u3001\u65F6\u65F6\u5F69\u5F02\u5E38-->                 <% if(post.post_status == 1){ %>                     <% if(post.post_total_count != post.post_current_count){ %>                     <div class="grab-status-online">                         <div class="total-count">\u603B\u9700\u53C2\u4E0E\u4EBA\u6B21\uFF1A<span class="color-orange"><%= post.post_total_count %></span></div>                         <div class="progress-wrap">                             <div class="progress-num" style="width:<%= Math.ceil(post.post_current_count/post.post_total_count*100) %>%"></div>                         </div>                         <div class="current-count">                             \u5DF2\u6709<span class="color-orange"><%= post.post_current_count %></span>\u4EBA\u6B21\u53C2\u4E0E\uFF0C\u8FD8\u9700<span class="color-orange"><%= post.post_total_count-post.post_current_count %></span>\u4EBA\u6B21\u5F00\u5956                         </div>                         <div class="clearfix change-num-wrap">                             <span class="pull-left">\u6211\u8981\u53C2\u4E0E\uFF1A</span>                             <div class="pull-left order-wrap">                                 <a class="reduce-btn j-reduce-btn" href="javascript:;">-</a>                                 <input class="order-num-input j-order-num-input" type="text" value="1" />                                 <a class="add-btn j-add-btn" href="javascript:;">+</a>                             </div>                         </div>                          <div class="grab-btn-wrap">                             <a class="btn grab-btn j-grab-btn" data-locate="\u7ACB\u5373\u593A\u5B9D\u6309\u94AE">\u7ACB\u5373\u593A\u5B9D</a>                         </div>                     </div>                     <% }else{ %>                         <div class="grab-status-error">                             <div class="err-tip">\u6B63\u5728\u8BA1\u7B97\u4E2D\uFF0C\u8BF7\u7A0D\u540E...</div>                         </div>                     <% } %>                 <% } %>                  <% if(post.post_status == 2){ %>                      <% if(post.countdown == 0){ %>                         <div class="grab-status-error">                             <div class="err-tip">\u5F00\u5956\u4E2D\uFF0C\u8BF7\u7A0D\u540E...</div>                         </div>                     <% } else { %>                     <div class="grab-status-wait">                         <div class="wait-title">\u5F00\u5956\u5012\u8BA1\u65F6</div>                         <div class="wait-time-wrap clearfix">                                                     </div>                     </div>                     <% } %>                 <% } %>                  <% if(post.post_status == 3){ %>                 <div class="grab-status-complete">                     <div class="lottery-num clearfix">                         <i></i><%= post.lottery_number %>                     </div>                     <div class="lottery-user">                         <a target="_blank" href="<%= post.reward_user.user_url %>">                             <img src="<%= post.reward_user.portrait %>" alt="user-name" />                         </a>                         <div class="lottery-user-info">                             <%                                 var userNameStr = $.tb.subByte(post.reward_user.user_name,15);                             %>                             <p>\u606D\u559C <a target="_blank" href="<%= post.reward_user.user_url %>"><%= userNameStr %></a> \u5728\u672C\u6B21\u593A\u5B9D\u4E2D\u80DC\u51FA</p>                             <p>\u53C2\u4E0E\u6B21\u6570\uFF1A<%= post.reward_user.total_times %>\u6B21</p>                             <p>\u63ED\u6653\u65F6\u95F4\uFF1A<%= post.reward_user.reward_time_format %></p>                         </div>                     </div>                 </div>                 <% } %>                  <% if(post.post_status == 4 || post.post_status == 5){ %>                 <div class="grab-status-error">                     <div class="err-tip">\u6B64\u5546\u54C1\u51FA\u73B0\u5F02\u5E38\uFF0C\u6B63\u5728\u5904\u7406\u4E2D...</div>                 </div>                 <% } %>                  <% if(post.post_status == 8){ %>                 <div class="grab-status-error">                     <div class="err-tip">\u83B7\u53D6\u65F6\u65F6\u5F69\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E...</div>                 </div>                 <% } %>                  <div class="goods-promise">                     \u627F\u8BFA\uFF1A                     <i class="just-icon"></i>\u516C\u6B63                     <i class="authentic-icon"></i>\u4EAC\u4E1C\u6B63\u54C1                      <a class="btn-list rule-btn j-rule-btn" href="javascript:;" data-locate="\u593A\u5B9D\u89C4\u5219btn">\u593A\u5B9D\u89C4\u5219</span></a>                     <a class="btn-list j-question-btn" href="javascript:;" data-locate="\u5E38\u89C1\u95EE\u9898btn">\u5E38\u89C1\u95EE\u9898</a>                  </div>              </div>         </div>          <% if(post.treasure_code && post.treasure_code.list){ %>         <div class="current-user-code">             \u60A8\u7684\u5F53\u671F\u53F7\u7801\u4E3A\uFF1A             <span class="num">             <%= post.treasure_code.list.join(\',\') %>             </span>             \u5171<%= post.treasure_code.total_times %>\u4E2A             <% if(post.treasure_code.total_times > 5) { %>             <a class="more-btn j-more-btn" href="javascript:;" data-num="<%= post.treasure_code.total_times %>">\u67E5\u770B\u66F4\u591A&gt;</a>             <% } %>         </div>         <% } %>          <% if(post.post_status == 2 || post.post_status == 3 || post.post_status == 8){ %>         <div class="calculation-wrap">             <div class="cal-wrap-tip">\u6BCF\u671F\u5F00\u5956\u53F7\u7801\u7684\u8BA1\u7B97\u89C4\u5219,\u4FDD\u8BC1\u516C\u5E73\u516C\u6B63\u516C\u5F00</div>             <div class="cal-wrap-rule clearfix">                 \u8BA1\u7B97\u516C\u5F0F\uFF1A                 <a class="link-btn j-calculation-btn" href="javascript:;">\u8BA1\u7B97\u89C4\u5219</a>             </div>             <div class="cal-detail clearfix">                 <div class="cal-detail-text cal-detail-lottery">                     <% if(post.post_status == 2 || post.post_status == 8){ %>                     <div class="num lottery-bg"></div>                     <% } %>                     <% if(post.post_status == 3){ %>                     <div class="num luck-num"><%= post.lottery_number %></div>                     <% } %>                     <div class="text">\u5E78\u8FD0\u53F7\u7801</div>                 </div>                 <div class="cal-detail-symbol cal-detail-equal">=</div>                 <div class="cal-detail-brace cal-detail-brace-left"></div>                 <div class="cal-detail-text cal-detail-sum cal-detail-hover-btn" data-type="time">                     <div class="num"><%= post.transform_code ? post.transform_code : \'?\' %></div>                     <div class="text">\u672B\u6B21\u593A\u5B9D\u65F6\u95F4</div>                 </div>                 <div class="cal-detail-symbol cal-detail-add">+</div>                 <div class="cal-detail-text cal-detail-ssc cal-detail-hover-btn" data-type="num" data-ssc-issue="<%= post.ssc_number == \'00000\' ? 0 : post[\'ssc_issue\'] %>">                     <div class="num"><%= post.ssc_number ? post.ssc_number : \'?\' %></div>                     <div class="text">\u201C\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u53F7\u7801</div>                 </div>                 <div class="cal-detail-brace cal-detail-brace-right"></div>                 <div class="cal-detail-symbol cal-detail-modulo" data-type="modulo">%</div>                  <div class="cal-detail-text">                     <div class="num"><%= post.post_total_count %></div>                     <div class="text">\u8BE5\u5546\u54C1\u603B\u9700\u4EBA\u6B21</div>                 </div>                 <div class="cal-detail-symbol cal-detail-add">+</div>                 <div class="cal-detail-text">                     <div class="num">11000001</div>                     <div class="text">\u539F\u59CB\u6570</div>                 </div>              </div>             <div class="cal-wrap-remarks">                 \u6CE8\uFF1A\u5982\u9047\u798F\u5F69\u4E2D\u5FC3\u901A\u8BAF\u6545\u969C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u5BF9\u5E94\u671F\u6B21\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\uFF0C\u4E1424\u5C0F\u65F6\u5185\u8BE5\u671F\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4ECD\u672A\u516C\u5E03\uFF0C\u5219\u9ED8\u8BA4\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4E3A00000             </div>         </div>         <% } %>          <% if(post.related_post.length > 0){ %>         <div class="more-treasure-wrap">             <a href="javascript:;" class="more-treasure-btn" data-locate="\u66F4\u591A\u593A\u5B9Dbtn">\u66F4\u591A\u593A\u5B9D\u6B63\u5728\u8FDB\u884C\u4E2D\uFF0C\u70B9\u51FB\u67E5\u770B&gt;</a>             <div class="more-treasure-main">                 <a href="javascript:;" class="grab-slideup-btn"></a>                 <div class="more-treasure-main-swiper">                     <a href="javascript:;" class="slide-btn grab-prev-btn"></a>                     <a href="javascript:;" class="slide-btn grab-next-btn"></a>                     <ul class="tbui_slideshow_list list-wrap clearfix">                         <%                          var relatedDataList = post.related_post;                         var relatedLimit = 3;                                                  for(var i=0; i<Math.ceil(relatedDataList.length/relatedLimit); i++){                          %>                         <li class="tbui_slideshow_slide list">                                                          <div class="item item-guide" data-locate="\u66F4\u591A\u593A\u5B9Dlist-guide<%=i+1%>">                                 <a target="_blank" href="/f?kw=%E8%B4%B4%E5%90%A7%E5%A4%BA%E5%AE%9D&ie=utf-8&tab=good&cid=1">                                     <img src="<%=moreTreasureImgUrl%>" >                                 </a>                             </div>                              <%                             for(var j=0; j<relatedLimit; j++){                                 var index = i*3 + j;                                 var relatedItemData = relatedDataList[index];                                 var relatedLastClass  = \'\';                                  if ( j == 2) {                                     var relatedLastClass  = \'item-last\';                                 }                                                                  if(!relatedItemData){                                     break;                                 }                             %>                             <div class="item <%=relatedLastClass%>" data-locate="\u66F4\u591A\u593A\u5B9Dlist-<%=index+1%>">                                 <a target="_blank" href="<%=relatedItemData[\'post_url\']%>">                                     <img src="<%=relatedItemData[\'goods_pic\']%>" >                                     <div class="name"><%=relatedItemData[\'goods_name\']%></div>                                 </a>                             </div>                             <% } %>                         </li>                         <% } %>                     </ul>                 </div>             </div>         </div>         <% } %>      </div>      <div class="treasure-tabs-wrap">         <div class="treasure-tabs-tab clearfix">             <div class="tab-item j-detail-tab <% if(post.post_status != 2 && post.post_status != 3){ %> active <% } %>" data-index="0">\u5546\u54C1\u8BE6\u60C5</div>             <div class="tab-item j-record-tab <% if(post.post_status == 2 || post.post_status == 3){ %> active <% } %>" data-index="1">\u53C2\u4E0E\u8BB0\u5F55</div>         </div>          <div class="treasure-tabs-panel">             <div class="panel-item detail-panel  j-detail-panel" <% if(post.post_status != 2 && post.post_status != 3){ %> style="display:block;" <% } %> >                 <% for(var i=0,len=goods.goods_desc_pic.length; i<len; i++){  %>                     <img src="<%= goods.goods_desc_pic[i] %>"  alt="goods_desc_pic" />                 <% } %>               </div>             <div class="panel-item record-panel j-record-panel" <% if(post.post_status == 2 || post.post_status == 3){ %> style="display:block;" <% } %> >                 <% if(post.post_status == 3){ %>                 <div class="record-panel-tip">                     \u5546\u54C1\u6700\u540E\u593A\u5B9D\u65F6\u95F4\u662F\u3010<%=post.member_lasttime_format%>\u3011\u5373\u4E3A<span><%= post.transform_code %></span>                 </div>                  <% } %>                  <div class="record-panel-main">                     <div class="j-record-panel-list"></div>                 </div>                 <div class="record-page j-record-page"></div>             </div>         </div>      </div>      <div class="treasure-bottom-bg"></div> </div>',s="//tb2.bdstatic.com/tb/static-tbmall/widget/pb_grab_treasure/img/more-treasure_e786ed9.png";t.moreTreasureImgUrl=s;var e=_.template(a)(t);return e},recordListHtml:function(t){var a=' <% if(total > 0){ %>       <div class="record-mark"></div>     <div class="record-title clearfix">         <span class="rt-time">\u593A\u5B9D\u65F6\u95F4</span>         <span>\u7528\u6237\u660E\u7EC6</span>     </div>      <div class="record-list">      <% for(var key in list){          var arr = list[key];      %>         <div class="date">             <%= key %>             <i class="date-dot"></i>         </div>          <ul>         <% for(var i=0,len=arr.length; i<len; i++){ %>             <li class="item">                 <i class="time-dot"></i>                 <span class="time"><%= arr[i].pay_time_format %></span>                 <i class="arrow">-></i>                 <span class="num"><%= arr[i].transform_code %></span>                 <a target="_blank" href="<%= arr[i].user_url %>" class="user">                     <img src="<%= arr[i].portrait %>"  alt="user" />                     <%= arr[i].user_name %>                 </a>             </li>         <% } %>         </ul>              <% } %>      </div>  <% } else { %>  <div class="record-list-empty">\u8FD8\u6CA1\u6709\u7528\u6237\u53C2\u4E0E\u593A\u5B9D\uFF0C\u5FEB\u6765\u6210\u4E3A\u593A\u5B9D\u7B2C\u4E00\u4EBA</div>  <% } %>',s=_.template(a)(t);return s},initPostInfo:function(){var t=this;t.$root.find(".grab-treasure-loading").show(),t.$root.find(".j-grab-treasure-main").empty(),$.ajax({url:"/diamondmall/post/getPostInfoDetail",data:{tbs:PageData.tbs,post_id:PageData.thread.thread_id}}).done(function(a){if(0===a.no){var s=t.grabTreasureMainHtml(a.data);t.$root.find(".grab-treasure-loading").hide(),t.$root.find(".j-grab-treasure-main").append(s),t.buyMaxCount=a.data.post.post_total_count-a.data.post.post_current_count,t.showRecordList(),t.initCountdown(a.data.post.countdown)}else t.commonTips("\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")})},commonTips:function(t,a){var s='<div class="grab-treasure-dialog-comtips"><div class="common-tips-msg">'+t+'</div><button class="btn-default btn-middle common-tips-btn" >\u786E\u5B9A</button></div>',e=new $.dialog({html:s,title:"\u63D0\u793A",width:430,height:140,closeable:!0});e.element.find(".common-tips-btn,.dialogJclose").on("click",function(){e.close(),a&&a()})},showRecordList:function(t){var a=this;$.ajax({url:"/diamondmall/post/getMemberList",data:{tbs:PageData.tbs,post_id:PageData.thread.thread_id,page:t||1,limit:40}}).done(function(t){if(0===t.no){var s=a.recordListHtml(t.data),e=a.$root.find(".j-record-panel-list");e.empty().append(s),a.recordListPage(t.data)}else a.commonTips("\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")})},recordListPage:function(t){var a=this;if(!(t.total_page<2)){var s=a.requireInstance("common/component/JsPager",{container:a.$root.find(".j-record-page"),current:t.page||1,amount:5,total:t.total_page});s.bind("pageChange",function(t,e){s.initial({current:e}),a.showRecordList(e)})}},bindEvent:function(){var t=this;t.$root.on("click",".j-feedback-btn",function(){return PageData.user.is_login?(t.feedBack(),void 0):(t.requireInstance("common/widget/LoginDialog"),void 0)}),t.$root.on("click",".j-rule-btn",function(){t.showRule()}),t.$root.on("click",".j-calculation-btn",function(){t.showCalculation()}),t.$root.on("click",".j-question-btn",function(){t.showQuestion()}),t.$root.on("click",".j-reduce-btn",function(){t.changeNum(-1)}),t.$root.on("click",".j-add-btn",function(){t.changeNum(1)}),t.$root.on("input propertychange",".j-order-num-input",function(){t.changeNum(0)});var a=!1;t.$root.on("click",".more-treasure-btn",function(){t.$root.find(".more-treasure-main").slideDown(),t.$root.find(".more-treasure-btn").slideUp(),a||(a=!0,t.slideShow())}),t.$root.on("click",".grab-slideup-btn",function(){t.$root.find(".more-treasure-main").slideUp(),t.$root.find(".more-treasure-btn").slideDown()}),t.$root.on("mouseenter",".cal-detail-hover-btn,.cal-detail-modulo",function(){var a=$(this),s=a.data("type"),e=a.data("ssc-issue")||0;t.buildCard(a,s,e)}),t.$root.on("mouseleave",".cal-detail-hover-btn,.cal-detail-modulo",function(){t.card&&(t.card.closeCard({type:"delayClose",time:100}),t.card=null)}),t.$root.on("click",".j-more-btn",function(){var a=$(this).data("num");t.showTreasureCode(a)}),t.$root.on("click","[data-locate]",function(){var t=$(this).data("locate");$.stats.track(t,"\u8D34\u5427\u593A\u5B9D")}),t.$root.on("click",".j-grab-btn",function(){if(!PageData.user.is_login)return t.requireInstance("common/widget/LoginDialog"),void 0;var a=PageData.thread.thread_id,s=t.changeNum(0);t.grabTreasure(a,s)}),t.tabSwitch()},grabTreasure:function(t,a){var s=this;t&&a&&this.requireInstance("tbmall/widget/grab_treasure_ctrl",{threadId:t,orderNum:a,onSuccess:function(){$.tb.location.reload()},onError:function(t){1!==t.no&&(0===t.no?$.tb.location.reload():350006===t.no?s.commonTips("\u60A8\u6240\u9009\u7684\u4EFD\u6570\u8D85\u8FC7\u73B0\u6709\u7684\u5E93\u5B58\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u540E\u91CD\u65B0\u8D2D\u4E70",function(){s.initPostInfo()}):s.commonTips("\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"))}})},feedBack:function(){var t=this,a='<% if(!success) { %>  <div class="dialog-feedback j-dialog-feedback">     <div class="title clearfix">         \u53CD\u9988\u5185\u5BB9\uFF1A         <span class="pull-right tips">\u6700\u591A\u53EF\u4EE5\u8F93\u5165200\u4E2A\u6587\u5B57</span>     </div>     <textarea class="form-control d-feedback-input feedback-content j-feedback-content" maxLength="200"></textarea>      <div class="title">\u624B\u673A\u53F7\u7801\uFF1A</div>     <input class="form-control d-feedback-input j-feedback-mobile" type="text" value="" />      <div class="btn-wrap">         <button class="btn-default btn-middle j-ok-btn" >\u63D0\u4EA4</button>      </div> </div> <% } %>  <% if(success) { %> <div class="dialog-feedback-success j-dislog-feedback-success">     <div class="success-content">\u611F\u8C22\u60A8\u7684\u652F\u6301\uFF0C</br>\u60A8\u7684\u5EFA\u8BAE\u5DF2\u4EA4\u7531\u76F8\u5173\u4EBA\u5458\u8FDB\u884C\u5904\u7406\uFF01</div>      <div class="btn-wrap">         <button class="btn-default btn-middle j-ok-btn" >\u786E\u5B9A</button>      </div> </div> <% } %>',s=_.template(a)({success:!1}),e=new $.dialog({html:s,title:"\u53CD\u9988",width:430,closeable:!0}),i=$(".j-dialog-feedback"),o=/^1[34578]\d{9}$/;i.find(".j-ok-btn").on("click",function(){var a=$.trim(i.find(".j-feedback-content").val()),s=$.trim(i.find(".j-feedback-mobile").val());return a?a.length>200?(t.commonTips("\u6700\u591A\u53EF\u4EE5\u8F93\u5165200\u4E2A\u6587\u5B57\uFF01"),void 0):s?o.test(s)?($.ajax({url:"/diamondmall/feedback/add",data:{tbs:PageData.tbs,content:a,user_mobile:s}}).done(function(a){e.close(),0===a.no?t.feedBackSucc():3150004===a.no?t.commonTips("\u6BCF\u5929\u53EA\u80FD\u53CD\u9988\u4E09\u6B21\u54E6\uFF5E"):t.commonTips("\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}),void 0):(t.commonTips("\u60A8\u7684\u53F7\u7801\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u8BF7\u60A8\u6838\u5BF9\u540E\u5728\u63D0\u4EA4\uFF01"),void 0):(t.commonTips("\u8BF7\u586B\u5199\u60A8\u7684\u7535\u8BDD\u53F7\u7801\uFF0C\u65B9\u4FBF\u6211\u4EEC\u4E0E\u60A8\u53D6\u5F97\u8054\u7CFB\uFF01"),void 0):(t.commonTips("\u8BF7\u8F93\u5165\u53CD\u9988\u5185\u5BB9\uFF01"),void 0)})},feedBackSucc:function(){var t='<% if(!success) { %>  <div class="dialog-feedback j-dialog-feedback">     <div class="title clearfix">         \u53CD\u9988\u5185\u5BB9\uFF1A         <span class="pull-right tips">\u6700\u591A\u53EF\u4EE5\u8F93\u5165200\u4E2A\u6587\u5B57</span>     </div>     <textarea class="form-control d-feedback-input feedback-content j-feedback-content" maxLength="200"></textarea>      <div class="title">\u624B\u673A\u53F7\u7801\uFF1A</div>     <input class="form-control d-feedback-input j-feedback-mobile" type="text" value="" />      <div class="btn-wrap">         <button class="btn-default btn-middle j-ok-btn" >\u63D0\u4EA4</button>      </div> </div> <% } %>  <% if(success) { %> <div class="dialog-feedback-success j-dislog-feedback-success">     <div class="success-content">\u611F\u8C22\u60A8\u7684\u652F\u6301\uFF0C</br>\u60A8\u7684\u5EFA\u8BAE\u5DF2\u4EA4\u7531\u76F8\u5173\u4EBA\u5458\u8FDB\u884C\u5904\u7406\uFF01</div>      <div class="btn-wrap">         <button class="btn-default btn-middle j-ok-btn" >\u786E\u5B9A</button>      </div> </div> <% } %>',a=_.template(t)({success:!0}),s=new $.dialog({html:a,title:"\u53CD\u9988\u6210\u529F",width:430,closeable:!0});s.element.find(".j-ok-btn").on("click",function(){s.close()})},showRule:function(){var t='<div class="grab-treasure-dialog-rule j-grab-treasure-dialog-rule">     <div class="title clearfix">         <em>1</em>\u4EC0\u4E48\u662F\u8D34\u5427\u593A\u5B9D\uFF1F     </div>     <div class="description">         <p>\u201C\u8D34\u5427\u593A\u5B9D\u201D\u6307\u7528\u6237\u652F\u4ED81\u5143\u5373\u53EF\u83B7\u5F97\u201C\u9EC4\u91D1\u9A91\u5175\u201D\u6210\u5C31\u5FBD\u7AE0\uFF0C\u540C\u65F6\u8D60\u90011\u6B21\u593A\u5B9D\u673A\u4F1A\u3002</p>         <p>\u6BCF\u4EF6\u5B9D\u8D1D\u7684\u53F7\u7801\u88AB\u5168\u90E8\u5206\u914D\u5B8C\u6BD5\u540E\uFF0C\u8D34\u5427\u593A\u5B9D\u6839\u636E\u593A\u5B9D\u89C4\u5219\u8BA1\u7B97\u51FA\u7684\u4E00\u4E2A\u53F7\u7801\u3002\u6301\u6709\u8BE5\u5E78\u8FD0\u53F7\u7801\u7684\u7528\u6237\u53EF\u76F4\u63A5\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u3002\u5B9D\u8D1D\u7EDF\u4E00\u7531\u4EAC\u4E1C\u53D1\u8D27\u5E76\u5B8C\u6210\u552E\u540E\u3002</p>         <strong>\u6E29\u99A8\u63D0\u793A\uFF1A\u4E3A\u4FDD\u8BC1\u4E2D\u5956\u540E\uFF0C\u7B2C\u4E00\u65F6\u95F4\u8054\u7CFB\u5230\u60A8\uFF0C\u8BF7\u5728\u593A\u5B9D\u540E\u586B\u5199\u4F60\u7684\u6709\u6548\u8054\u7CFB\u65B9\u5F0F\u3002</strong>     </div>     <div class="title clearfix">         <em>2</em>\u5982\u4F55\u5FEB\u901F\u593A\u5B9D\uFF1F     </div>     <div class="description">         <div class="dialog-rule-c"></div>     </div>     <div class="title clearfix">         <em>3</em>\u5982\u4F55\u8BA1\u7B97\u4E2D\u5956\u53F7\u7801\uFF1F     </div>     <div class="description">         <p>\u6D3B\u52A8\u4F9D\u636E\u4E25\u8C28\u516C\u6B63\u7684\u8BA1\u7B97\u516C\u5F0F\u6765\u8BA1\u7B97\u51FA\u6700\u7EC8\u83B7\u5956\u7684\u5E78\u8FD0\u7801\u5E76\u516C\u5E03\u5728\u672C\u9875\u9762\u3002</p>     </div>     <div class="title clearfix">         <em>4</em>\u5E78\u8FD0\u7801\u4E2D\u5956\u7684\u8BA1\u7B97\u65B9\u6CD5     </div>     <div class="description">         <div class="dialog-rule-d"></div>         <p>a.\u5B9D\u8D1D\u603B\u9700\u4EBA\u6B21\uFF08\u5F97\u51FA\u6570\u503CA\uFF09</p>         <p>b.\u5B9D\u8D1D\u7684\u6700\u540E\u4E00\u4E2A\u53F7\u7801\u5206\u914D\u5B8C\u6BD5\u65F6\u7684\u65F6\u95F4\uFF0C\u8BE5\u65F6\u95F4\u6309\u65F6\u3001\u5206\u3001\u79D2\u3001\u6BEB\u79D2\u7684\u987A\u5E8F\u7EC4\u5408\uFF08\u5F97\u51FA\u6570\u503CB\uFF0C\u598215:08:23.144\u5219\u4E3A150823144\uFF09</p>         <p>c.\u4E3A\u4FDD\u8BC1\u516C\u5E73\u516C\u6B63\u516C\u5F00\uFF0C\u6700\u540E\u4E00\u4F4D\u7528\u6237\u593A\u5B9D\u65F6\u95F4\uFF0C\u7CFB\u7EDF\u8FD8\u4F1A\u7B49\u5F85\u4E00\u5C0F\u6BB5\u65F6\u95F4\uFF0C\u53D6\u6700\u8FD1\u4E0B\u4E00\u671F\u4E2D\u56FD\u798F\u5229\u5F69\u7968\u91CD\u5E86\u5F69\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u7684\u5F00\u5956\u7ED3\u679C\u7684\u4E94\u4F4D\u6570\u503C\uFF08\u5F97\u51FA\u6570\u503CC\uFF09</p>         <p>d. \uFF08\u6570\u503CB+\u6570\u503CC\uFF09\uFF05A + \u539F\u59CB\u6570 11000001\uFF0C\u5F97\u5230\u6700\u7EC8\u5E78\u8FD0\u53F7\u7801\uFF0C\u62E5\u6709\u8BE5\u5E78\u8FD0\u53F7\u7801\u8005\uFF0C\u76F4\u63A5\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u3002</p>         <p>\u5F00\u5956\u987B\u77E5\uFF1A</p>         <p>\u2460\u5982\u5F53\u65E5\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5DF2\u7ECF\u7ED3\u675F\uFF0C\u5219\u53D6\u7B2C\u4E8C\u5929\u65E9\u4E0A\u7B2C\u4E00\u671F\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u53F7\u7801\u3002</p>         <p>\u2461\u91CD\u5E86\u65F6\u65F6\u5F69\u9500\u552E\u65F6\u95F4\uFF1A\u767D\u592910:00-22:00\u4E4B\u95F4\u5F00\u595672\u6B21\uFF0C\u6BCF10\u5206\u949F\u5F001\u6B21\u5956\u3002</p>         <p>\u2462\u591C\u95F422:00-02:00\u4E4B\u95F4\u5F00\u595648\u6B21\uFF0C\u6BCF5\u5206\u949F\u5F001\u6B21\u5956\u3002\uFF08\u5176\u4ED6\u65F6\u6BB5\uFF0C\u8D34\u5427\u593A\u5B9D\u540C\u6837\u4E0D\u4F1A\u8FDB\u884C\u5F00\u5956\uFF0C\u8BF7\u5E7F\u5927\u5427\u53CB\u5408\u7406\u5B89\u6392\u597D\u81EA\u5DF1\u7684\u65F6\u95F4\uFF09</p>         <p>\u2463\u5982\u9047\u798F\u5F69\u4E2D\u5FC3\u901A\u8BAF\u6545\u969C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u5BF9\u5E94\u671F\u6B21\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\uFF0C\u4E1424\u5C0F\u65F6\u5185\u8BE5\u671F\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4ECD\u672A\u516C\u5E03\uFF0C\u5219\u9ED8\u8BA4\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4E3A00000\u3002</p>         <p>\u2464\u5982\u51FA\u73B0\u8FDD\u89C4\u4F5C\u5F0A\u884C\u4E3A\uFF0C\u4E00\u7ECF\u67E5\u5904\uFF0C\u53D6\u6D88\u53C2\u52A0\u6D3B\u52A8\u4EE5\u53CA\u4E2D\u5956\u8D44\u683C\u3002</p>     </div>     <div class="title clearfix">         <em>5</em>\u4E2D\u5956\u540E\u53D1\u8D34\u6652\u5355\u53EF\u4EE5\u83B7\u5F97\u4EC0\u4E48\uFF1F     </div>     <div class="description">         <p>\u5F53\u60A8\u6210\u4E3A\u5E78\u8FD0\u513F\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u540E\uFF0C\u901A\u8FC7\u201C\u6652\u5355\u5206\u4EAB\u201D\u529F\u80FD\u53D1\u8D34\u5230\u5176\u4ED6\u5427\u5185\u8FDB\u884C\u6652\u5355\uFF0C\u6652\u5355\u6210\u529F\u540E\u4F1A\u67091-10\u5143\u4E0D\u7B49\u7684\u593A\u5B9D\u5E01\u8FD4\u8FD8\uFF0C\u8BA9\u60A8\u4E0D\u865A\u6B64\u884C\u3002</p>         <p>\u7279\u522B\u8BF4\u660E\uFF1A\u7528\u6237\u901A\u8FC7\u593A\u5B9D\u6D3B\u52A8\u83B7\u5F97\u5B9D\u8D1D\u540E\uFF0C\u9700\u572810\u65E5\u5185\u767B\u5F55\u767E\u5EA6\u8D34\u5427\u63D0\u4EA4\u6216\u786E\u8BA4\u6536\u8D27\u4FE1\u606F\uFF0C\u5426\u5219\u5C06\u89C6\u4E3A\u653E\u5F03\u8BE5\u5B9D\u8D1D\uFF0C\u6536\u8D27\u4FE1\u606F\u4E00\u65E6\u786E\u8BA4\u540E\u4E0D\u53EF\u4FEE\u6539\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\u3002\u767E\u5EA6\u8D34\u5427\u5C06\u5728\u7528\u6237\u83B7\u5F97\u5B9D\u8D1D\u540E15\u4E2A\u5DE5\u4F5C\u65E5\u5185\u5B89\u6392\u914D\u9001\uFF0C\u7528\u6237\u7B7E\u6536\u5B9D\u8D1D7\u5929\u540E\uFF0C\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u5C06\u8BE5\u5B9D\u8D1D\u8FDB\u884C\u201C\u786E\u5B9A\u6536\u8D27\u201D\u64CD\u4F5C\u3002\u8D34\u5427\u593A\u5B9D\u4E2D\u7684\u5B9D\u8D1D\u7EDF\u4E00\u7531\u4EAC\u4E1C\u81EA\u8425\u4F9B\u8D27\u53CA\u914D\u9001\uFF0C\u975E\u5B9D\u8D1D\u672C\u8EAB\u8D28\u91CF\u95EE\u9898\uFF0C\u4E0D\u7ED9\u4E88\u9000\u6362\u8D27\u3002\u6700\u7EC8\u89E3\u91CA\u6743\u5F52\u767E\u5EA6\u8D34\u5427\u6240\u6709\u3002</p>         <p>\u4E3A\u4E86\u4FDD\u969C\u60A8\u7B2C\u4E00\u65F6\u95F4\u5185\u83B7\u53D6\u5230\u6700\u65B0\u7684\u593A\u5B9D\u8D44\u8BAF\uFF0C\u60A8\u5728\u53C2\u4E0E\u593A\u5B9D\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u5E2E\u60A8\u5173\u6CE8\u8D34\u5427\u593A\u5B9D\u5427\uFF0C\u4EE5\u4FBF\u60A8\u5FEB\u901F\u7684\u83B7\u5F97\u6700\u65B0\u593A\u5B9D\u8D44\u8BAF\u3002</p>     </div> </div> ',a=_.template(t)();new $.dialog({html:a,title:"\u593A\u5B9D\u89C4\u5219",width:880,closeable:!0})},showCalculation:function(){var t='<div class="dialog-calculation j-dialog-calculation">     <p>1\u3001\u5B9D\u8D1D\u603B\u9700\u4EBA\u6B21\uFF08\u5F97\u51FA\u6570\u503CA\uFF09     </p>     <p>2\u3001\u5B9D\u8D1D\u7684\u6700\u540E\u4E00\u4E2A\u53F7\u7801\u5206\u914D\u5B8C\u6BD5\u65F6\u7684\u65F6\u95F4\uFF0C\u8BE5\u65F6\u95F4\u6309\u65F6\u3001\u5206\u3001\u79D2\u3001\u6BEB\u79D2\u7684\u987A\u5E8F\u7EC4\u5408\uFF08\u5F97\u51FA\u6570\u503CB\uFF0C\u598215:08:23.144\u5219\u4E3A150823144\uFF09</p>     <p>3\u3001\u4E3A\u4FDD\u8BC1\u516C\u5E73\u516C\u6B63\u516C\u5F00\uFF0C\u6700\u540E\u4E00\u4F4D\u7528\u6237\u593A\u5B9D\u65F6\u95F4\uFF0C\u7CFB\u7EDF\u8FD8\u4F1A\u7B49\u5F85\u4E00\u5C0F\u6BB5\u65F6\u95F4\uFF0C\u53D6\u6700\u8FD1\u4E0B\u4E00\u671F\u4E2D\u56FD\u798F\u5229\u5F69\u7968\u91CD\u5E86\u5F69\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u7684\u5F00\u5956\u7ED3\u679C\u7684\u4E94\u4F4D\u6570\u503C\uFF08\u5F97\u51FA\u6570\u503CC\uFF09     </p>     <p>4\u3001\uFF08\u6570\u503CB+\u6570\u503CC\uFF09\uFF05A + \u539F\u59CB\u6570 11000001\uFF0C\u5F97\u5230\u6700\u7EC8\u5E78\u8FD0\u53F7\u7801\uFF0C\u62E5\u6709\u8BE5\u5E78\u8FD0\u53F7\u7801\u8005\uFF0C\u76F4\u63A5\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u3002     </p>     <p>\u6CE8\uFF1A%\u4E3A\u53D6\u4F59\u7B26\u53F7\uFF0C\u5373\u5F53A\u9664\u4EE5B\uFF0C\u5E76\u4E14B\u4E0D\u80FD\u88ABA\u6574\u9664\u65F6\uFF0C\u4F59\u4E0B\u90E8\u5206\u5373\u4E3A\u4F59\u503C\u3002</p> </div> ',a=_.template(t)();new $.dialog({html:a,title:"\u8BA1\u7B97\u89C4\u5219",width:430,closeable:!0})},showQuestion:function(){var t='<div class="grab-treasure-dialog-rule j-grab-treasure-dialog-rule">     <div class="title clearfix">         <em>1</em>\u5982\u4F55\u53C2\u52A0\u8D34\u5427\u593A\u5B9D\uFF1F     </div>     <div class="description">         <p>\u9009\u62E9\u597D\u6211\u8981\u53C2\u4E0E\u7684\u593A\u5B9D\u6B21\u6570\uFF0C\u652F\u4ED81\u5143\u94B1\u5373\u53EF\u8D2D\u4E70\u201C\u9EC4\u91D1\u9A91\u5175\u201D\u6210\u5C31\u5FBD\u7AE0\uFF0C\u540C\u65F6\u83B7\u5F97\u76F8\u5E94\u7684\u593A\u5B9D\u5E01\uFF0C\u5373\u53EF\u53C2\u4E0E\u8D34\u5427\u593A\u5B9D\u3002</p>     </div>     <div class="title clearfix">         <em>2</em>\u5982\u4F55\u8BA1\u7B97\u4E2D\u5956\u53F7\u7801\uFF1F     </div>     <div class="description">         <p>a.\u5546\u54C1\u603B\u9700\u4EBA\u6B21\uFF08\u5F97\u51FA\u6570\u503CA\uFF09</p>         <p>b.\u5B9D\u8D1D\u7684\u6700\u540E\u4E00\u4E2A\u53F7\u7801\u5206\u914D\u5B8C\u6BD5\u65F6\u7684\u65F6\u95F4\uFF0C\u8BE5\u65F6\u95F4\u6309\u65F6\u3001\u5206\u3001\u79D2\u3001\u6BEB\u79D2\u7684\u987A\u5E8F\u7EC4\u5408\uFF08\u5F97\u51FA\u6570\u503CB\uFF0C\u598215:08:23.144\u5219\u4E3A150823144\uFF09</p>         <p>c.\u4E3A\u4FDD\u8BC1\u516C\u5E73\u516C\u6B63\u516C\u5F00\uFF0C\u6700\u540E\u4E00\u4F4D\u7528\u6237\u593A\u5B9D\u65F6\u95F4\uFF0C\u7CFB\u7EDF\u8FD8\u4F1A\u7B49\u5F85\u4E00\u5C0F\u6BB5\u65F6\u95F4\uFF0C\u53D6\u6700\u8FD1\u4E0B\u4E00\u671F\u4E2D\u56FD\u798F\u5229\u5F69\u7968\u91CD\u5E86\u5F69\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u7684\u5F00\u5956\u7ED3\u679C\u7684\u4E94\u4F4D\u6570\u503C\uFF08\u5F97\u51FA\u6570\u503CC\uFF09</p>         <p>d. \uFF08\u6570\u503CB+\u6570\u503CC\uFF09\uFF05A + \u539F\u59CB\u6570 11000001\uFF0C\u5F97\u5230\u6700\u7EC8\u5E78\u8FD0\u53F7\u7801\uFF0C\u62E5\u6709\u8BE5\u5E78\u8FD0\u53F7\u7801\u8005\uFF0C\u76F4\u63A5\u83B7\u5F97\u8BE5\u5B9D\u8D1D\u3002</p>         <p>\u5F00\u5956\u987B\u77E5\uFF1A</p>         <p>\u2460\u5982\u5F53\u65E5\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5DF2\u7ECF\u7ED3\u675F\uFF0C\u5219\u53D6\u7B2C\u4E8C\u5929\u65E9\u4E0A\u7B2C\u4E00\u671F\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u53F7\u7801\u3002</p>         <p>\u2461\u91CD\u5E86\u65F6\u65F6\u5F69\u9500\u552E\u65F6\u95F4\uFF1A\u767D\u592910:00-22:00\u4E4B\u95F4\u5F00\u595672\u6B21\uFF0C\u6BCF10\u5206\u949F\u5F001\u6B21\u5956\u3002</p>         <p>\u2462\u591C\u95F422:00-02:00\u4E4B\u95F4\u5F00\u595648\u6B21\uFF0C\u6BCF5\u5206\u949F\u5F001\u6B21\u5956\u3002\uFF08\u5176\u4ED6\u65F6\u6BB5\uFF0C\u8D34\u5427\u593A\u5B9D\u540C\u6837\u4E0D\u4F1A\u8FDB\u884C\u5F00\u5956\uFF0C\u8BF7\u5E7F\u5927\u5427\u53CB\u5408\u7406\u5B89\u6392\u597D\u81EA\u5DF1\u7684\u65F6\u95F4\uFF09</p>         <p>\u2463\u5982\u9047\u798F\u5F69\u4E2D\u5FC3\u901A\u8BAF\u6545\u969C\uFF0C\u65E0\u6CD5\u83B7\u53D6\u5BF9\u5E94\u671F\u6B21\u7684\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\uFF0C\u4E1424\u5C0F\u65F6\u5185\u8BE5\u671F\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4ECD\u672A\u516C\u5E03\uFF0C\u5219\u9ED8\u8BA4\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4E3A00000\u3002</p>     </div>     <div class="title clearfix">         <em>3</em>\u4E2D\u5956\u53F7\u7801\u8BA1\u7B97\u7ED3\u679C\u662F\u5426\u53EF\u4FE1\uFF1F     </div>     <div class="description">         <p>\u7531\u4E8E\u4F7F\u7528\u4E86\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4F5C\u4E3A\u53C2\u6570\uFF0C\u56E0\u6B64\u5E78\u8FD0\u53F7\u7801\u662F\u672A\u77E5\u7684\uFF0C\u4EE5\u786E\u4FDD\u7EDD\u5BF9\u7684\u516C\u5E73\u4E0E\u516C\u6B63\u3002</p>     </div>     <div class="title clearfix">         <em>4</em>\u600E\u6837\u67E5\u770B\u662F\u5426\u4E2D\u5956\uFF1F\u5982\u4F55\u9886\u5956\uFF1F     </div>     <div class="description">         <p>\u767B\u9646\u767E\u5EA6\u8D34\u5427\uFF0C\u8FDB\u5165\u201C\u4E2A\u4EBA\u4E2D\u5FC3\u201D\u540E\uFF0C\u4E8E\u53F3\u4FA7\u4F4D\u7F6E\u70B9\u51FB\u201C\u6211\u7684\u593A\u5B9D\u201D\u6A21\u5757\u5185\u94FE\u63A5\u5373\u53EF\u67E5\u770B\u60A8\u7684\u593A\u5B9D\u8BB0\u5F55\uFF0C\u70B9\u51FB\u5BF9\u5E94\u7684\u8BB0\u5F55\uFF0C\u5373\u53EF\u4E86\u89E3\u5404\u5B9D\u8D1D\u7684\u593A\u5B9D\u8BE6\u60C5\u3002         </p>         <p>\u5982\u679C\u60A8\u83B7\u5956\u7684\u540C\u65F6\u5E76\u9A8C\u8BC1\u4E86\u624B\u673A\u53F7\u7801\uFF0C\u4F1A\u6709\u77ED\u4FE1\u901A\u77E5\u3002\u8BF7\u6CE8\u610F\u67E5\u6536\uFF01</p>         <p>\u6536\u5230\u901A\u77E5\u540E\uFF0C\u8FDB\u5165\u201C\u6211\u7684\u593A\u5B9D\u201D\uFF0C\u70B9\u51FB\u201C\u4E2D\u5956\u8BB0\u5F55\u201D\uFF0C\u5728\u8BE5\u76EE\u5F55\u4E0B\u9700\u586B\u5199\u771F\u5B9E\u7684\u6536\u8D27\u5730\u5740\uFF0C\u5E76\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F\uFF0C\u4EE5\u4FBF\u4E3A\u60A8\u5B89\u6392\u914D\u9001\u3002</p>     </div>     <div class="title clearfix">         <em>5</em>\u5B9D\u8D1D\u662F\u6B63\u54C1\u5417\uFF1F\u600E\u4E48\u4FDD\u8BC1\uFF1F     </div>     <div class="description">         <p>\u767E\u5EA6\u8D34\u5427\u627F\u8BFA\u6240\u6709\u5B9D\u8D1D\u5747100%\u91C7\u8D2D\u4E8E\u4EAC\u4E1C\u81EA\u8425\uFF0C\u5728\u4FDD\u8BC1\u6B63\u54C1\u7684\u540C\u65F6\u8FD8\u53EF\u4EAB\u53D7\u5382\u5BB6\u6240\u63D0\u4F9B\u7684\u5168\u56FD\u8054\u4FDD\u670D\u52A1\u3002</p>     </div>     <div class="title clearfix">         <em>6</em>\u957F\u65F6\u95F4\u672A\u6536\u5230\u8D27\u600E\u4E48\u529E\uFF1F     </div>     <div class="description">         <p>\u5F53\u60A8\u7684\u5B9D\u8D1D\u5728\u6D3E\u53D1\u65F6\uFF0C\u53EF\u80FD\u4E34\u65F6\u51FA\u73B0\u7F3A\u8D27\u7B49\u60C5\u51B5\uFF0C\u82E5\u51FA\u73B0\u8FD9\u79CD\u60C5\u51B5\uFF0C\u6211\u4EEC\u4F1A\u5728\u8D34\u5427\u7B2C\u4E00\u65F6\u95F4\u516C\u544A\u7528\u6237\uFF0C\u8865\u8D27\u540E\u7ACB\u5373\u6D3E\u53D1\u3002\u82E5\u6709\u95EE\u9898\u53EF\u4EE5\u968F\u65F6\u901A\u8FC7\u593A\u5B9D\u8D34\u5185\u7684\u201C\u53CD\u9988\u201D\u529F\u80FD\u63D0\u4EA4\u60A8\u7684\u95EE\u9898\u3002         </p>         <strong>\u6E29\u99A8\u63D0\u793A\uFF1A\u786E\u4FDD\u6536\u8D27\u5730\u5740\u3001\u90AE\u7F16\u3001\u7535\u8BDD\u3001Email\u3001\u5730\u5740\u7B49\u5404\u9879\u4FE1\u606F\u7684\u51C6\u786E\u6027\uFF0C\u914D\u9001\u8FC7\u7A0B\u4E2D\u8054\u7CFB\u65B9\u5F0F\u7545\u987A\u65E0\u963B\uFF0C\u82E5\u56E0\u60A8\u7684\u5730\u5740\u586B\u5199\u9519\u8BEF\u3001\u8054\u7CFB\u65B9\u5F0F\u586B\u5199\u6709\u8BEF\u7B49\u60C5\u51B5\u9020\u6210\u5B9D\u8D1D\u65E0\u6CD5\u5B8C\u6210\u6295\u9012\u6216\u88AB\u9000\u56DE\uFF0C\u6240\u4EA7\u751F\u7684\u989D\u5916\u8D39\u7528\u53CA\u540E\u679C\u5C06\u7531\u7528\u6237\u81EA\u5DF1\u627F\u62C5\u3002</strong>     </div>     <div class="title clearfix">         <em>7</em>\u6536\u5230\u7684\u5B9D\u8D1D\u662F\u5426\u53EF\u4EE5\u9000\u8D27\uFF1F     </div>     <div class="description">         <p>\u975E\u8D28\u91CF\u95EE\u9898\uFF0C\u4E0D\u5728\u4E09\u5305\u8303\u56F4\u5185\uFF0C\u4E0D\u7ED9\u4E88\u9000\u6362\u8D27\uFF1B\u8BF7\u5C3D\u91CF\u4EB2\u81EA\u7B7E\u6536\u5E76\u5F53\u9762\u62C6\u7BB1\u9A8C\u8D27\uFF0C\u5982\u679C\u53D1\u73B0\u8FD0\u8F93\u9014\u4E2D\u9020\u6210\u4E86\u5B9D\u8D1D\u7684\u635F\u574F\uFF0C\u8BF7\u4E0D\u8981\u7B7E\u6536\uFF0C\u53EF\u4EE5\u62D2\u7B7E\u9000\u56DE\u3002         </p>     </div>     <div class="title clearfix">         <em>8</em>\u4EC0\u4E48\u662F\u593A\u5B9D\u5E01\uFF1F     </div>     <div class="description">         <p>\u593A\u5B9D\u5E01\u662F\u8D34\u5427\u593A\u5B9D\u4E2D\u7684\u4EE3\u5E01\uFF0C\u7528\u6237\u6BCF\u82B1\u8D391\u5143\u8D2D\u4E70\u9650\u91CF\u7248\u6210\u5C31\u5373\u53EF\u514D\u8D39\u83B7\u5F971\u4E2A\u593A\u5B9D\u5E01\uFF1B 1\u4E2A\u593A\u5B9D\u5E01\u53EF\u4EE5\u76F4\u63A5\u8FDB\u884C1\u6B21\u593A\u5B9D\u3002</p>         <p>\u593A\u5B9D\u5E01\u65E0\u6CD5\u63D0\u73B0\u3002</p>     </div>      <div class="title clearfix">         <em>9</em>\u593A\u5B9D\u5E01\u662F\u5426\u53EF\u4EE5\u8FDB\u884C\u63D0\u73B0\uFF1F     </div>     <div class="description">         <p>\u593A\u5B9D\u5E01\u65E0\u6CD5\u63D0\u73B0\u3002</p>     </div>      <div class="title clearfix">         <em>10</em>\u5EFA\u8BAE\u53CD\u9988     </div>     <div class="description">         <p>\u5982\u679C\u60A8\u6709\u4EFB\u4F55\u610F\u89C1\u6216\u5EFA\u8BAE\uFF0C\u60A8\u53EF\u4EE5\u901A\u8FC7\u593A\u5B9D\u8D34\u5185\u7684\u201C\u53CD\u9988\u201D\u529F\u80FD\u63D0\u4EA4\u60A8\u7684\u60F3\u6CD5\uFF0C\u6216\u8005\u76F4\u63A5\u901A\u8FC7\u201C\u8D34\u5427\u610F\u89C1\u53CD\u9988\u201D\u5427\u5185\u53D1\u8D34\u8FDB\u884C\u7EBF\u4E0A\u7684\u53CD\u9988\u3002\u6216\u8005\u52A0\u5165Q\u7FA4\uFF1A340469055\u53CD\u9988\u7ED9\u5427\u4E3B\u8FDB\u884C\u5904\u7406\u3002</p>         <p>\u8D34\u5427\u610F\u89C1\u53CD\u9988\u5730\u5740\uFF1A             <a target="_blank" href="//tieba.baidu.com/f?ie=utf-8&kw=%E8%B4%B4%E5%90%A7%E6%84%8F%E8%A7%81%E5%8F%8D%E9%A6%88&fr=search">                 http://tieba.baidu.com/f?ie=utf-8&kw=%E8%B4%B4%E5%90%A7%E6%84%8F%E8%A7%81%E5%8F%8D%E9%A6%88&fr=search             </a>         </p>     </div> </div> ',a=_.template(t)();new $.dialog({html:a,title:"\u5E38\u89C1\u95EE\u9898",width:880,closeable:!0})},showGuide:function(){setTimeout(function(){if(!$(".dialogJ.dialogJfix").size()&&!$.tb.Storage.get("tieba_grab_treasure_guide")){$.tb.Storage.set("tieba_grab_treasure_guide",!0);var t='<div class="grab-treasure-dialog-guide-main j-grab-treasure-dialog-guide-main">     <div class="guide-bg"></div>     <a class="guide-btn j-guide-btn" href="javascript:;">\u9A6C\u4E0A\u593A\u5B9D</a>     <a class="guide-close-btn j-guide-close-btn" href="javascript:;"></a> </div>  ',a=_.template(t)(),s=new $.dialog({html:a,width:550,closeable:!0,showShadow:!1,showTitle:!1,holderClassName:"grab-treasure-dialog-guide"});s.element.find(".j-guide-btn,.j-guide-close-btn").click(function(){s.close()})}},500)},changeNum:function(t){var a=this,s=t||0,e=a.$root.find(".j-order-num-input"),i=parseInt(e.val(),10)||0,o=i+s;return 1>o&&(o=1),o>a.buyMaxCount&&(o=a.buyMaxCount),e.val(o),o},getCountDownTpl:function(t){var a=this,s=t,e=Math.floor(s/3600),i=Math.floor(s%3600/60),o=s%60,r={h0:a.formatTimesTamp(e)[0],h1:a.formatTimesTamp(e)[1],m0:a.formatTimesTamp(i)[0],m1:a.formatTimesTamp(i)[1],s0:a.formatTimesTamp(o)[0],s1:a.formatTimesTamp(o)[1]},d='<span class="day-0">'+r.h0+"</span><span>"+r.h1+"</span><i></i><span>"+r.m0+"</span><span>"+r.m1+"</span><i></i><span>"+r.s0+'</span><span class="last">'+r.s1+"</span>";return d},initCountdown:function(t){if(t&&!(0>t))var a=this,s=t,e=a.$root.find(".wait-time-wrap"),i=setInterval(function(){s--,0>=s&&(clearInterval(i),a.initPostInfo());var t=a.getCountDownTpl(s);e.empty().html(t)},1e3)},formatTimesTamp:function(t){var a=t.toString();return a.length<2&&(a="0"+a),a},buildCard:function(t,a,s){var e=this,i="",o=320;"time"===a?(i='<div class="treasure-card-text">\u5546\u54C1\u7684\u6700\u540E\u4E00\u4E2A\u53F7\u7801\u5206\u914D\u5B8C\u65F6\u7684\u65F6\u95F4\u3002</div>',o=230):"modulo"===a?(i='<div class="treasure-card-text">\u5F53A\u9664\u4EE5B\uFF0C\u5E76\u4E14B\u4E0D\u80FD\u88ABA\u6574\u9664\u65F6\uFF0C\u4F59\u4E0B\u90E8\u5206\u5373\u4E3A\u4F59\u503C\u3002</div>',o=230):i=Number(s)?'<div class="treasure-card-text">\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D \u7B2C'+s+'\u671F\u7684\u5F00\u5956\u7ED3\u679C\u3002<a href="http://www.cqcp.net/game/ssc/" target="_blank">\u5F00\u5956\u67E5\u8BE2&gt;&gt;</a></div>':'<div class="treasure-card-text">24\u5C0F\u65F6\u5185\u672A\u83B7\u53D6\u8BE5\u671F\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\uFF0C\u9ED8\u8BA4\u201C\u91CD\u5E86\u65F6\u65F6\u5F69\u201D\u5F00\u5956\u7ED3\u679C\u4E3A00000</div>',e.card=this.requireInstance("common/component/Card",{content:i,event_target:t,auto_positon:!0,card_css:{width:o}}),e.card.showCard()},showTreasureCode:function(t){var a=this,s='<div class="dialog-treasure-code j-dialog-code">     <h3 class="total">\u60A8\u672C\u671F\u5171\u53C2\u52A0\u4E86<span><%= num %></span>\u4EBA\u6B21</h3>     <div class="code-wrap">         <div class="treasure-loading"></div>     </div>     <a class="code-list-btn j-code-list-btn" href="javascript:;">\u52A0\u8F7D\u66F4\u591A&gt;&gt;</a> </div>  ',e=_.template(s)({num:t}),i=1,o=new $.dialog({html:e,title:"\u593A\u5B9D\u53F7\u7801",width:430,closeable:!0});a.getTreasureCodeData(i),o.element.on("click",".j-code-list-btn",function(){i++,a.getTreasureCodeData(i)})},getTreasureCodeData:function(t){var a=this;$.ajax({url:"/diamondmall/post/getTreasureCodeList",data:{tbs:PageData.tbs,post_id:PageData.thread.thread_id,page:t||1,limit:50}}).done(function(s){if(0===s.no){var e='<% for(var key in list){      var itemData = list[key]; %> <div class="code-item">     <div class="title"><%= key %></div>     <ul class="clearfix">         <% for(var i=0,len=itemData.length; i<len; i++){  %>         <li><%= itemData[i] %></li>         <% } %>     </ul> </div> <% } %>',i=_.template(e)(s.data),o=$(".j-dialog-code").find(".j-code-list-btn");$(".j-dialog-code").find(".treasure-loading").remove(),$(".j-dialog-code .code-wrap").append(i),t>=s.data.total_page?o.remove():o.addClass("show")}else a.commonTips("\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")})},tabSwitch:function(){var t=this;t.$root.on("click",".treasure-tabs-tab .tab-item",function(){$(".treasure-tabs-tab .tab-item").removeClass("active"),$(this).addClass("active");var t=$(this).data("index");$(".treasure-tabs-panel .panel-item").hide().eq(t).show()})},slideShow:function(){var t=this.$root.find(".tbui_slideshow_slide").size();this.requireInstance("common/component/SlideShow",{target:".more-treasure-main-swiper",slide:{speed:1e3},next:".grab-next-btn",prev:".grab-prev-btn",interval:3e3,height:168,total:t})}}});_.Module.define({path:"common/widget/ScrollPanel",sub:{dom:null,$content:null,$scrollBar:null,$scrollButton:null,_hasScroll:!1,_scrollStep:50,_scrollTop:0,_maxHeight:0,initial:function(t){this._buildUI(t),this._bindEvents(t),$(t.container).append(this.dom),this.setHeight(t.height||100),t.content&&this.setContent(t.content),t.scrollBarShow&&this.bind("onScrollBarShow",t.scrollBarShow),t.scrollBarHide&&this.bind("onScrollBarHide",t.scrollBarHide)},_buildUI:function(t){this.dom=$('<div class="tbui_scroll_panel"></div>'),this.dom.html(['<div class="tbui_panel_content j_panel_content clearfix"><ul></ul></div>','<div class="tbui_scroll_bar j_scroll_bar">','<div class="tbui_scroll_button j_scroll_button">&nbsp;</div>',"</div>"].join("")),this.$content=this.dom.find(".j_panel_content:first"),this.$scrollBar=this.dom.find(".j_scroll_bar:first"),this.$scrollButton=this.dom.find(".j_scroll_button:first"),t.padding&&this.$content.css("padding",t.padding)},_bindEvents:function(){var t=this,o=t.$content.get(0);this.$scrollButton.on("drag",function(i,l){if(l){var s=l.position;o.scrollTop=s.top/t.$content.height()*o.scrollHeight}}),this.$content.mousewheel(function(o,i){o.preventDefault(),o.stopPropagation(),t._hasScroll&&t.scrollTopTo(t._scrollTop-i*t._scrollStep)})},scrollTopTo:function(t){var o=this,i=o.$content.get(0),t=Math.max(Math.min(t,i.scrollHeight-o.$content.height()),0);t!=o._scrollTop&&(o._scrollTop=t,o.$content.stop(),o.$content.scrollTop(o._scrollTop),o._resizeScroll())},setHeight:function(t){this._maxHeight=t,this._resizeHeight(),this._resizeScroll(),this.$scrollButton.draggable({containment:"parent"})},setContent:function(t){this.$content.html(t),this.$content.get(0).scrollTop=this._scrollTop=0,this._resizeHeight(),this._resizeScroll()},appendContent:function(t){this.$content.append(t),this._resizeHeight(),this.scrollTopTo(2e4)},clearContent:function(){this.setContent("")},_resizeHeight:function(){this.$content.css("height","");var t=this.$content.get(0),o=t.scrollHeight,i=Math.min(o,this._maxHeight);this.$content.css("height",i)},_resizeScroll:function(){var t=this.$content.get(0),o=t.scrollHeight,i=t.scrollTop,l=this.$content.innerHeight();l>=o?(this.$scrollBar.hide(),this.dom.addClass("tbui_no_scroll_bar"),this.trigger("onScrollBarHide"),this._hasScroll=!1):(this.$scrollBar.show(),this.$scrollBar.height(l),this.$scrollButton.height(l/o*l),this.$scrollButton.css("top",i/o*l),this.trigger("onScrollBarShow"),this._hasScroll=!0)}}});_.Module.define({path:"comforum/widget/promoter_post_opts",requires:["common/widget/LoginDialog","common/widget/ScrollPanel"],sub:{initial:function(t){if(this.args=t||{},this.args=$.extend(this.args,{tbs:PageData.tbs,forumId:PageData.forum.forum_id,forumName:PageData.forum.forum_name,threadId:PageData.thread.thread_id,threadTitle:PageData.thread.title,threadContent:PageData.thread.thread_id,userId:PageData.user.user_id,userLevel:PageData.user.level_id,userIsLogin:PageData.user.is_login}),this.tbs=this.args.tbs,this.pn=this.args.pn,this.forumId=this.args.forumId,this.forumName=this.args.forumName,this.threadId=this.args.threadId,this.threadTitle=this.args.threadTitle,this.threadContent=this.args.threadContentthreadContent,this.threadMasterTitle=this.args.promoterMasterTitle,this.userId=this.args.userId,this.userLevel=this.args.userLevel,this.userIsLogin=this.args.userIsLogin,this.userPostPid="",this.promoterSource=this.args.promoterAttr.source||{},this.promoterSourceType=this.promoterSource.type,this.promoterSourceForumId=this.promoterSource.forum_id,this.promoterSourcePosition=this.promoterSource.position,this.promoterSourceUserId=this.promoterSource.user_id,this.promoterSourceTime=this.promoterSource.time,this.promoterSourceString=[this.promoterSourceType,this.promoterSourceForumId,this.promoterSourcePosition,this.promoterSourceUserId,this.promoterSourceTime].join(","),this.promoterVideo=this.args.promoterAttr.video||{},this.promoterVideoImageUrl=this.promoterVideo.img_url,this.promoterVideoLinkUrl=this.promoterVideo.link_url,this.promoterUserIds=this.args.promoterUserIds,this.defaultThreadContent="\u6311\u6218\u5BA3\u8A00",this.repostPostId="",this.$postList=$(".j_l_post"),this.$titleOpt=$(".j_promoter_title_opt"),"0"==this.promoterSourceType)this.getPbZan();else{if(!(this.promoterSourceType>"0"&&"1"==this.pn))return;this.getPbUserZan()}this.bindEvents()},bindEvents:function(){this.$postList.on("click",".j_opt_btn_zan",$.proxy(this.doZan,this)),this.$postList.on("click",".j_opt_btn_challenge",$.proxy(this.doChallenge,this)),this.$postList.on("click",".j_opt_btn_repost",$.proxy(this.getRepostToForumList,this)),window.Page.checkLoadedModules("forumList")||this.$titleOpt.on("click",$.proxy(this.onTitleOptClick,this))},getPromoterDialogContent:function(t){t||(t={},t.tips=["\u7F51\u7EDC\u5F02\u5E38\uFF0C\u8FD8\u8BF7\u91CD\u8BD5\u4E0B"],t.opts=[{type:"close",color:"sub",text:"\u5173\u95ED"}]);var o=this,e=t.title?'<div class="promoter_dialog_title">'+t.title+"</div>":"",s="";t.tips&&$(t.tips).each(function(t,o){s+="<p>"+o+"</p>"});var r="";t.opts&&$(t.opts).each(function(t,e){switch(e.type){case"close":r+='<button class="btn btn-'+(e.color||"default")+' btn-middle j_toClose"'+(e.stats?' data-locate="'+e.stats.locate+'"':"")+">"+(e.text||"\u53D6\u6D88")+"</button>";break;case"my_floor":r+='<button class="btn btn-'+(e.color||"default")+' btn-middle j_toMyFloor">'+(e.text||"\u6211\u7684\u697C\u5C42")+"</button>";break;case"repost":r+='<button class="btn btn-'+(e.color||"default")+' btn-middle j_toRepost">'+(e.text||"\u8F6C\u53D1")+"</button>";break;case"redirect":r+='<a href="'+o.promoterVideoLinkUrl+'" target="_blank" class="btn btn-'+(e.color||"default")+' btn-middle j_toRedirect"'+(e.stats?' data-locate="'+e.stats.locate+'"':"")+">"+(e.text||"\u901B\u540E\u5BAB")+"</a>"}});var i=t.repost?['<div class="promoter_dialog_head">\u8F6C\u53D1\u6218\u4E66</div>','<div class="promoter_dialog_repost">',t.repost.info?'<div class="info">'+t.repost.info+"</div>":"",'<div class="post_form'+(0==o.promoterSourceType?"":" post_form_readonly")+'">','<div class="video_image"><div class="img"><img src="',o.promoterVideoImageUrl,'" alt=""></div></div>','<div class="post_form_input post_form_input_title">',0==o.promoterSourceType?'<input type="text" class="j_promoter_repost_title" placeholder="\u6311\u6218\u6807\u9898" value="">':'<span class="label">\u6807\u9898\uFF1A</span>'+o.threadTitle,"</div>",'<div class="post_form_input post_form_input_content">',0==o.promoterSourceType?'<textarea class="j_promoter_repost_content" placeholder="'+o.defaultThreadContent+'"></textarea>':'<span class="label">\u5185\u5BB9\uFF1A</span>'+o.threadContent,"</div>","</div>",'<div class="post_to">','<div class="h4">\u8F6C\u53D1\u5230\uFF1A</div>','<div class="post_forum_list clearfix j_post_forum_list">',"</div>","</div>","</div>"].join(""):"",a=['<div class="promoter_dialog_body">',e,i,'<div class="promoter_dialog_tip">',s,"</div>",'<div class="promoter_dialog_opts">',r,"</div>","</div>"].join("");return a},bindDialogEvent:function(t){var o=this;t.element.on("click",".j_toClose",function(e){var s=$(e.currentTarget),r=s.tbattr("data-locate");$.stats.track(r,"\u63A8\u5E7F\u5458\u7CFB\u7EDF","","click",{obj_type:o.promoterSourceType}),t.close()}),t.element.on("click",".j_toRedirect",function(t){var e=$(t.currentTarget),s=e.tbattr("data-locate");$.stats.track(s,"\u63A8\u5E7F\u5458\u7CFB\u7EDF","","click",{obj_type:o.promoterSourceType})}),t.element.on("click",".j_toMyFloor",function(){t.close(),o.jumpToMyFloor()}),t.element.on("click",".j_toRepost",function(){o.doRepost(t)}),t.element.on("click",".j_toRepostForum",function(t){o.setRepostToForum(t)})},doZan:function(t){if(!this.userIsLogin)return this.requireInstance("common/widget/LoginDialog"),void 0;if(!this.doingZan){var o=this,e=$(t.currentTarget).closest(".j_l_post"),s=e.get(0)&&e.getData(),r=s&&s.content&&s.content.post_id||"";this.doingZan=!0,$.ajax({url:"/minigame/caster/zan",type:"POST",dataType:"json",data:{post_id:r,tbs:o.tbs}}).done(function(e){o.doZanCallback(e),0==e.no&&o.doZanAnimate(t),o.doingZan=null})}},doZanCallback:function(t){t=t||{};var o=[];o[0]={title:"\u70B9\u8D5E\u6210\u529F\uFF01",tips:["\u60A8\u73B0\u5728\u53EF\u4EE5\u53BB\u901B"+this.threadMasterTitle+"\u5927\u5E1D\u7684\u540E\u5BAB\u5566\uFF01"],opts:[{type:"close",color:"sub",stats:{locate:"\u70B9\u8D5E\u6210\u529F-\u5173\u95ED\u6309\u94AE"}},{type:"redirect",stats:{locate:"\u70B9\u8D5E\u6210\u529F-\u901B\u540E\u5BAB\u6309\u94AE"}}]},o[65535]={tips:["\u6BCF\u5929\u53EA\u80FD\u70B9\u4E00\u6B21\u8D5E\uFF0C\u4ECA\u5929\u60A8\u7684\u8D5E\u5DF2\u7ECF\u70B9\u8FC7\u4E86\uFF0C","\u8BF7\u660E\u5929\u518D\u6765\u70B9\u8D5E\u5427\uFF01"],opts:[{type:"close",color:"sub",stats:{locate:"\u5DF2\u7ECF\u70B9\u8D5E-\u5173\u95ED\u6309\u94AE"}},{type:"redirect",stats:{locate:"\u5DF2\u7ECF\u70B9\u8D5E-\u901B\u540E\u5BAB\u6309\u94AE"}}]},o[65534]={title:"\u4ECA\u5929\u7684\u8D5E\u5DF2\u7ECF\u7528\u5B8C\u4E86",tips:["\u60A8\u53EF\u4EE5\u53BB\u9759\u6001\u5927\u5E1D\u7684\u540E\u5BAB\u901B\u901B\uFF5E"],opts:[{type:"close",color:"sub",stats:{locate:"\u8D5E\u7528\u5B8C\u4E86-\u5173\u95ED\u6309\u94AE"}},{type:"redirect",stats:{locate:"\u8D5E\u7528\u5B8C\u4E86-\u901B\u540E\u5BAB\u6309\u94AE"}}]};var e=this.getPromoterDialogContent(o[t.no]),s=new $.dialog({showShadow:!1,fixed:!1,html:e,holderClassName:"promoter_dialog",width:430});this.bindDialogEvent(s)},doZanAnimate:function(t){var o=$(t.currentTarget),e=o.find(".opt_icon"),s=$('<div class="plus">+1</div>');e.append(s),s.animate({"margin-bottom":"10px"}).animate({opacity:"0"},function(){s.remove()});var r=o.find(".j_zan_count"),i=r.find("span").text()||"0";this.setCount(r,+i+1)},setCount:function(t,o){t.html("<span>"+o+"</span>\u4EBA")},doChallenge:function(){if(!this.userIsLogin)return this.requireInstance("common/widget/LoginDialog"),void 0;if(!this.doingChallenge){$.stats.track("\u6311\u6218","\u63A8\u5E7F\u5458\u7CFB\u7EDF","","click");var t=this;if(t.userLevel<6)return t.doChallengeCallback({err_code:2540001}),void 0;if(t.userPostPid)return t.doChallengeCallback({err_code:2210002}),void 0;if(t.userId&&t.promoterSourceUserId==t.userId)return t.doChallengeCallback({err_code:"a3"}),void 0;this.doingChallenge=!0,$.ajax({url:"/f/commit/post/caster/add",type:"POST",dataType:"json",data:{caster_post_type:0,tid:t.threadId,content:" ",fid:t.forumId,fname:t.forumName,kw:t.forumName,tbs:t.tbs}}).done(function(o){t.doChallengeCallback(o),t.doingChallenge=null})}},doChallengeCallback:function(t){t=t||{};var o=[];o[0]={tips:["\u6311\u6218\u6210\u529F\uFF01\u53EF\u4EE5\u8F6C\u53D1\u5230\u8D34\u5427\u8BF7\u5C0F\u4F19\u4F34\u5E2E\u52A9\u54E6\uFF01"],opts:[{type:"my_floor",text:"\u6211\u7684\u697C\u5C42"}]},o.a3={tips:["\u4EB2\u771F\u987D\u76AE\uFF0C\u4E0D\u80FD\u81EA\u5DF1\u6311\u6218\u81EA\u5DF1\u5594~"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]},o[2540001]={tips:["\u5F88\u62B1\u6B49\uFF0C\u53EA\u6709\u672C\u54276\u7EA7\u4EE5\u4E0A\u4F1A\u5458\u624D\u80FD\u53D1\u8D77\u6311\u6218"],opts:[{type:"close",color:"sub",text:"\u77E5\u9053\u4E86",stats:{locate:"\u975E6\u7EA7\u4EE5\u4E0A\u6311\u6218-\u5173\u95ED\u6309\u94AE"}},{type:"redirect",text:"\u6C42\u5B89\u6170",stats:{locate:"\u975E6\u7EA7\u4EE5\u4E0A\u6311\u6218-\u6C42\u5B89\u6170\u6309\u94AE"}}]},o[2270017]={tips:["\u5F88\u62B1\u6B49\uFF0C\u672C\u8D34\u5DF2\u8FC7\u671F\uFF0C\u4E0D\u652F\u6301\u6311\u6218\uFF5E"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]},o[2210002]={tips:["\u60A8\u4ECA\u513F\u5DF2\u7ECF\u53D1\u8D77\u8FC7\u6311\u6218\u5566\uFF0C\u660E\u513F\u518D\u6765\uFF5E"],opts:[{type:"my_floor",text:"\u6211\u7684\u697C\u5C42"}]},2210002!=t.err_code||this.userPostPid||(o[2210002]={tips:["\u5F88\u62B1\u6B49\uFF0C\u53EA\u80FD\u5728\u4E00\u4E2A\u5DE5\u4F1A\u53D1\u8D77\u6311\u6218"],opts:[{type:"close",color:"sub",text:"\u77E5\u9053\u4E86"}]});var e=this.getPromoterDialogContent(o[t.err_code]),s=new $.dialog({showShadow:!1,fixed:!1,html:e,holderClassName:"promoter_dialog",width:430});0==t.err_code&&(this.userPostPid=t.data.post_id,this.updateTitleDisplay()),this.bindDialogEvent(s)},getRepostToForumList:function(t){if(!this.gettingRepostToForumList){var o=this,e=$(t.currentTarget).closest(".j_l_post"),s=e.getData(),r=s.content&&s.content.post_id||"",i=s.content&&s.content.content||"";if(this.repostPostId=r,this.threadContent=i,o.repostToForumListReceived)return o.showRepostForm(),void 0;this.gettingRepostToForumList=!0,$.ajax({url:"/minigame/caster/favorforum",type:"GET",dataType:"json"}).done(function(t){0==t.no?(o.repostToForumListReceived=!0,o.repostToForumList=t.data,o.showRepostForm()):o.doRepostCallback(),o.gettingRepostToForumList=null})}},showRepostForm:function(){if(this.repostToForumListReceived&&(!this.repostToForumList||!this.repostToForumList.length))return this.doRepostCallback({err_code:2540001}),void 0;var t={repost:{info:0==this.promoterSourceType?"\u6BCF\u5929\u53EA\u80FD\u8F6C\u53D1\u4E00\u6B21\uFF0C\u8BF7\u73CD\u60DC\u8FD9\u6B21\u673A\u4F1A\u54E6~":""},opts:[{type:"close",color:"sub"},{type:"repost",text:"\u8F6C\u53D1"}]},o=this.getPromoterDialogContent(t),e=new $.dialog({showShadow:!1,fixed:!1,html:o,holderClassName:"promoter_dialog",width:520});this.buildRepostToForumListContent(e),this.repostToForumId="",this.repostToForumName="",this.bindDialogEvent(e)},buildRepostToForumListContent:function(t){for(var o="",e=0,s=this.repostToForumList.length;s>e;e++){var r=this.repostToForumList[e];o+='<a href="javascript:" class="post_forum j_toRepostForum" data-fid="'+r.forum_id+'" data-fname="'+r.forum_name+'">'+r.forum_name+'<span class="forum_level lv'+r.level_id+'"></span></a>'}this.requireInstance("common/widget/ScrollPanel",{container:t.element.find(".j_post_forum_list"),height:135,content:o})},setRepostToForum:function(t){var o=$(t.currentTarget),e=o.tbattr("data-fid"),s=o.tbattr("data-fname");this.repostToForumId=e,this.repostToForumName=s,o.siblings().removeClass("post_forum_selected"),o.addClass("post_forum_selected")},doRepost:function(t){if(!this.doingRepost){var o=this;if(!o.repostToForumId)return o.doRepostCallback({err_code:"a1"}),void 0;if(!$.trim($(".j_promoter_repost_title").val())&&0==o.promoterSourceType)return o.doRepostCallback({err_code:"needTitle"}),void 0;this.doingRepost=!0,$.ajax({url:"/f/commit/thread/caster/add",type:"POST",dataType:"json",data:{caster_post_type:+o.promoterSourceType+1,caster_post_id:this.repostPostId,title:0==o.promoterSourceType?$(".j_promoter_repost_title").val()||"":o.threadTitle,content:0==o.promoterSourceType?$(".j_promoter_repost_content").val()||"":o.threadContent,fid:o.repostToForumId,fname:o.repostToForumName,kw:o.repostToForumName,tbs:o.tbs}}).done(function(e){o.doRepostCallback(e),0==e.err_code&&t.close(),o.doingRepost=null})}},doRepostCallback:function(t){t=t||{};var o=[];o[0]={tips:["\u8F6C\u53D1\u6210\u529F\uFF01"]},o.a1={tips:["\u8FD8\u6CA1\u9009\u62E9\u8F6C\u53D1\u5230\u7684\u5427"],opts:[{type:"close",color:"sub",text:"\u77E5\u9053\u4E86"}]},o.needTitle={tips:["\u6311\u6218\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"],opts:[{type:"close",color:"sub",text:"\u77E5\u9053\u4E86"}]},o[2540001]={tips:["\u5F88\u62B1\u6B49\uFF0C\u6311\u6218\u8D34\u53EA\u80FD\u8F6C\u53D1\u52306\u7EA7\u4EE5\u4E0A\u5427\u4E2D\uFF01","\u60A8\u8FD8\u6CA1\u6709\u5230\u8FBE6\u7EA7\u7684\u5427"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]},o[2270017]={tips:["\u5F88\u62B1\u6B49\uFF0C\u672C\u8D34\u5DF2\u8FC7\u671F\uFF0C\u4E0D\u652F\u6301\u8F6C\u53D1\uFF5E"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]},o[65535]={tips:["\u5F88\u62B1\u6B49\uFF0C\u4ECA\u5929\u7684\u8F6C\u53D1\u673A\u4F1A\u7528\u5B8C\u4E86\uFF01","\u60A8\u53EF\u4EE5\u5728\u6211\u7684\u8D34\u5B50\u4E2D\u67E5\u770B\u5DF2\u8F6C\u53D1\u8D34\u5B50"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]},o[65533]={tips:["\u5F88\u62B1\u6B49\uFF0C\u8BE5\u5427\u8F6C\u53D1\u6B21\u6570\u53D7\u5230\u9650\u5236\uFF01"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]},o[65534]={tips:["\u5F88\u62B1\u6B49\uFF0C\u8F6C\u53D1\u592A\u9891\u7E41\u5566\uFF0C\u4F11\u606F\u4E0B\u5427"],opts:[{type:"close",text:"\u77E5\u9053\u4E86"}]};var e=this.getPromoterDialogContent(o[t.err_code]),s=new $.dialog({showShadow:!1,fixed:!1,html:e,holderClassName:"promoter_dialog",width:430});0==t.err_code&&setTimeout(function(){s.close()},2e3),this.bindDialogEvent(s)},jumpToMyFloor:function(){if(this.userPostPid){var t="/p/"+this.threadId+"?pid="+this.userPostPid+"#"+this.userPostPid;$.tb.location.setHref(t)}},getPbZan:function(){var t=this;$.ajax({url:"/minigame/caster/pb",type:"GET",dataType:"json",data:{caster_attr:t.promoterSourceString,thread_id:t.threadId,user_ids:t.promoterUserIds.join(",")}}).done(function(o){t.getPbZanCallback(o),t.updateTitleDisplay()})},getPbUserZan:function(){var t=this;$.ajax({url:"/minigame/caster/userzan",type:"GET",dataType:"json",data:{caster_attr:t.promoterSourceString}}).done(function(o){0==o.no&&t.setCount($(t.$postList.get(0)).find(".j_opt_btn_zan .j_zan_count"),o.data[t.promoterSourceUserId]||0)})},getPostFloor:function(t){var o;return $(this.$postList).each(function(e,s){var r=$(s).getData(),i=r&&r.author&&r.author.user_id||"";return i==t?(o=$(s),!1):void 0}),o},getPbZanCallback:function(t){var o=this;if(0===t.no){var e=t.data;o.userPostPid=e.my_post,$(e.user_zan).each(function(t,e){var s=o.getPostFloor(e.user_id);s&&s.get(0)&&o.setCount(s.find(".j_opt_btn_zan .j_zan_count"),e.score||0)}),o.setCount($(o.$postList.get(0)).find(".j_opt_btn_challenge .j_challenge_count"),e.participants||0)}},onTitleOptClick:function(){this.userPostPid?this.jumpToMyFloor():(this.doChallenge(),$.stats.track("\u6311\u6218-\u8D34\u5B50\u6807\u9898\u53F3\u4FA7","\u63A8\u5E7F\u5458\u7CFB\u7EDF","","click"))},updateTitleDisplay:function(){var t="\u6211\u8981\u6311\u6218";this.userPostPid&&(t="\u6211\u7684\u697C\u5C42"),this.$titleOpt.text(t)}}});_.Module.define({path:"comforum/widget/promoter_post_body",requires:["comforum/widget/promoterPostOpts"],sub:{TPL:['<div class="promoter_privilege_preview_box">','<div class="promoter_privilege_preview_video j_promoter_video"></div>',"</div>"].join(""),initial:function(e){this.args=e||{},this.requireInstance("comforum/widget/promoterPostOpts",[e]),this.promoterSource=this.args.promoterAttr.source,this.promoterVideo=this.args.promoterAttr.video,this.pn=this.args.pn,this.promoterVideo&&1==this.pn&&(0==this.promoterSource.type?this.preview():this.initVideo())},preview:function(){this.$previewBox=$(this.TPL);var e=$("#j_p_postlist");e.prepend(this.$previewBox),this.initPreview()},initPreview:function(){var e=this.$previewBox.find(".j_promoter_video");new $.swf("//tb2.bdstatic.com/tb/static-comforum/widget/promoter_post_body/img/video_645ce54.swf",{id:"promoter_privilege_preview_video_swf",container:e,width:520,height:320,params:{allowFullScreen:!0,swLiveConnect:!0,wMode:"transparent",quality:"high",allowScriptAccess:"always",menu:!1}});var i=this;setTimeout(function(){i.removePreview()},6e3)},removePreview:function(){this.$previewBox.remove(),this.initVideo()},initVideo:function(){var e=this.promoterVideo.flash;e&&new $.swf(e,{id:"promoter_master_video_swf",container:$(".j_l_post:first").find(".j_master_video"),width:400,height:300,params:{allowFullScreen:!0,swLiveConnect:!0,wMode:"transparent",quality:"high",allowScriptAccess:"always",menu:!1}})}}});!function(t){function a(a){if(PageData.user.is_login){t.stats.sendRequest("fr=tb0_forum&st_mod=idisk&st_type=download");var e=t(a);return t.post("/data/filepost?method=update_file_statistic",{fs_id:e.data("fsId"),thread_id:PageData.thread.thread_id,forum_id:PageData.forum.forum_id,stat_kind:0,tbs:PageData.tbs}),!0}return TbCom.process("User","buildLoginFrame"),!1}function e(a){if(PageData.user.is_login){t.stats.sendRequest("fr=tb0_forum&st_mod=idisk&st_type=forward");var e={31061:"\u6587\u4EF6\u5DF2\u5B58\u5728",31112:"\u767E\u5EA6\u4E91\u7A7A\u95F4\u4E0D\u8DB3&nbsp;<a href='http://pan.baidu.com' target='_blank'>\u6574\u7406\u7F51\u76D8</a> "},d=t(a);t.post("/data/filepost",{method:"archiveFile",src_uk:d.data("uk"),src_path:d.data("filePath"),dst_path:"/"+d.data("fileName"),tbs:PageData.tbs},function(a){var i;return a.status&&"-3"==a.status?(t.dialog.alert("<div style='padding: 20px 30px; text-align: center;'>\u64CD\u4F5C\u5931\u8D25\u4E86\uFF0C\u5237\u65B0\u4E00\u4E0B\u8BD5\u8BD5</div>",{width:300}),void 0):(a.error_code?(i=e[a.error_code],i||(i="\u8F6C\u5B58\u5931\u8D25"),t.dialog.alert("<div style='padding: 20px 30px; text-align: center;'>"+i+"</div>",{width:300})):d.hide().after("<a class='file_link' target='_blank' href='http://pan.baidu.com'>\u5DF2\u8F6C\u5B58</a>"),void 0)},"json"),t.post("/data/filepost?method=update_file_statistic",{fs_id:d.data("fsId"),thread_id:PageData.thread.thread_id,forum_id:PageData.forum.forum_id,stat_kind:1,tbs:PageData.tbs})}else TbCom.process("User","buildLoginFrame");return!1}window.diskmanager={};var d=window.diskmanager;d.onClickDownload=a,d.onClickSaveToMine=e}(jQuery);_.Module.define({path:"encourage/widget/paypost_guide",sub:{_options:{},initial:function(i){this._guideClassName="paypost_guide_"+i.position,this._guideStorageName="pg-"+i.position,this._payType=i.payType,this._options=i,this._render(),"link"==i.position?this._linkGuide():this._showGuide()},_render:function(){$.tb.Storage.get(this._guideStorageName)||this._options.$root.addClass(this._guideClassName)},_showGuide:function(){$.tb.Storage.set(this._guideStorageName,1)},_linkGuide:function(){var i=this;this._options.$root.on("click",function(){$.tb.Storage.set(i._guideStorageName,1),window.open("//tieba.baidu.com/p/3702205481")})}}});_.Module.define({path:"pb/widget/paypost",requires:["tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay"],sub:{$root:null,isRefresh:!1,API:{genOrder:"/diamond/submit/paypost/pay",appraise:"/diamond/submit/paypost/appraise",getThreadInfo:"/diamond/paypost/getThreadInfo"},initial:function(a){try{this.$root=a.$root,this.thread_id=a.thread_id,this.postHidden=a.postHidden,this._loadData(),this._bindEvents()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/paypost/paypost.js",method:"",ln:24}),t}},_loadData:function(){var a=this;$.get(this.API.getThreadInfo,{tbs:PageData.tbs,thread_id:this.thread_id,t:(new Date).getTime()},function(t){0==t.errno?a._show(t.data):a.$root.hide()})},_show:function(a){this._renderBuyer(a.evaluation.buyers),this.postHidden&&this._renderHiddenTip(a.score),this._renderEvaluation(a)},_render:function(a,t,o){var e=baidu.template(t,o);this.isRefresh?a.html(e):a.append(e)},_renderBuyer:function(a){var t="<p>\u5DF2\u6709<b><%=buyers%></b>\u4EBA\u67E5\u770B</p>";this._render(this.$root.find(".j_paypost_buyer"),t,{buyers:a})},_renderHiddenTip:function(a){var t='<div class="col2_left">   \u672C\u8D34\u5305\u542B\u9690\u85CF\u5185\u5BB9\uFF0C<br/>   \u5411\u697C\u4E3B\u652F\u4ED8<i class="icon_tdou"></i><span class="orange_text"><%=score%></span>\u5373\u53EF\u67E5\u770B\u3002 </div> <div class="col2_right">   <a href="javascript:;" class="ui_btn ui_btn_m j_paypost_pay">     <span><em>\u67E5 \u770B</em></span>   </a> </div>';this._render(this.$root.find(".j_paypost_hidden_tip"),t,{score:a})},_renderEvaluation:function(a){var t='<span class="e_evaluation_tip">\u8BC4\u4EF7\uFF1A</span> <% if (evaluation.support > 0 || evaluation.oppose > 0 || typeof opinion!= \'undefined\') { %> <span class="e_support"><%=evaluation.support%>\u4EBA</span> <span class="e_oppose"><%=evaluation.oppose%>\u4EBA</span> <span class="e_support_desc">\u7B26\u5408\u63CF\u8FF0</span> <span class="e_oppose_desc">\u4E0D\u7B26\u5408\u63CF\u8FF0</span> <%if (evaluation.support > 0) {%> <span class="e_support_tra"></span> <% } %> <%if (evaluation.oppose > 0) {%> <span class="e_oppose_tra"></span> <% } %> <div class="paypost_evaluation_color <% if (evaluation.oppose != 0 || evaluation.support != 0) { %>paypost_evaluation_color_disabled<% } %>">   <div class="support" style="width: <%= (evaluation.oppose + evaluation.support === 0) ? 50 : 100 * evaluation.support/(evaluation.oppose + evaluation.support)%>%"></div><div class="oppose" style="width: <%=(evaluation.oppose + evaluation.support === 0) ? 50 : 100 * evaluation.oppose/(evaluation.oppose + evaluation.support)%>%"></div> </div> <% } else { %> <div class="paypost_evaluation_empty"><i class="icon_evaluation_empty"></i></div> <% } %> <% if (typeof opinion!= \'undefined\') { %> <a href="javascript:;" class="j_paypost_appraise icon_appraise_1 <% if (opinion == 1) {%>icon_appraise_1_active<% } if (opinion > 0) {%> icon_appraise_disabled<% } %>" data-opinion="1"></a> <a href="javascript:;" class="j_paypost_appraise icon_appraise_2 <% if (opinion == 2) {%>icon_appraise_2_active<% } if (opinion > 0) {%> icon_appraise_disabled<% } %>"" data-opinion="2"></a> <% } %>';this._render(this.$root.find(".j_paypost_evaluation"),t,a)},_bindEvents:function(){var a=this;this.$root.on("click",".j_paypost_pay",function(){try{a._checkLogin()&&a._genOrder(a._tdouPay)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/paypost/paypost.js",method:"",ln:71}),t}}),this.$root.on("click",".j_paypost_appraise",function(){try{if(a._checkLogin()){var t=this,o=$(t).data("opinion");$.post(a.API.appraise,{tbs:PageData.tbs,thread_id:a.thread_id,opinion:o},function(e){0==e.errno&&($(t).addClass("icon_appraise_"+o+"_active"),a.isRefresh=!0,a._show(e.data),a._showAnimation(o))})}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/paypost/paypost.js",method:"",ln:92}),e}})},_showAnimation:function(a){var t,o={1:{desc:"support",txt:"+1"},2:{desc:"oppose",txt:"-1"}},e=this.$root.find(".icon_appraise_"+a).offset();t=$('<div class="paypost_animate_'+o[a].desc+'" />').text(o[a].txt).appendTo($("body")).css({top:e.top-10,left:e.left}).animate({top:e.top-40,left:e.left,opacity:0},function(){t.remove()})},_checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)},_genOrder:function(a){var t=this.requireInstance("tbmall/widget/TbeanSafeAjax"),o=this;t.post(this.API.genOrder,{tbs:PageData.tbs,thread_id:o.thread_id},function(t){0==t.errno&&a.call(o,t.data)})},_tdouPay:function(a){var t=this,o=t.requireInstance("common/widget/Tdou/TdouViewPay",function(a){a.data.no||$.tb.location.reload()});o.createMain(a)}}});_.Module.define({path:"pb/widget/content_recommend",requires:[],sub:{initial:function(e){try{var t=this;t.opts=e,t.bindEvents()}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/content_recommend/content_recommend.js",method:"",ln:14}),n}},getOptionsDom:function(){var e=this,t="";return e.opts.category.forEach(function(e){t+='<label class="content-recommend-label" for="'+e.tag_id+'"><input class="content-recommend-radio" type="radio" name="tagid" id="'+e.tag_id+'" value="'+e.tag_id+'"/>'+e.name+"</label>"}),t+='<a href="javascript:;" class="btn-default btn-middle content-recommend-btn j-content-recommend-send">\u63D0\u4EA4</a>'},sendAjax:function(){var e=this,t=$("input[name='tagid']:checked").val();t?$.post("/encourage/post/reco/recommend",{source_id:e.opts.source_id,tid:e.opts.tid,tag_id:t,tbs:window.PageData.tbs},function(t){0===+t.no?(e.RecommendDialog.close(),$.dialog.assert("\u63D0\u4EA4\u6210\u529F~")):$.dialog.assert("\u63D0\u4EA4\u5931\u8D25~")}):$.dialog.assert("\u8BF7\u9009\u62E9\u7C7B\u578B")},bindEvents:function(){var e=this;$(".j-content-recommend").on("click",function(){try{e.RecommendDialog=new $.dialog({holderClassName:"content-recommend",html:e.getOptionsDom(),title:e.opts.name,draggable:!1})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/content_recommend/content_recommend.js",method:"",ln:57}),t}}),$("body").on("click",".j-content-recommend-send",function(){try{e.sendAjax()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/content_recommend/content_recommend.js",method:"",ln:60}),t}})}}});_.Module.define({path:"tbmall/widget/gift_page_ctrl",sub:{giftMap:[],emptyListTpl:"<p>\u8BE5\u7C7B\u76EE\u4E0B\u8FD8\u6CA1\u6709\u793C\u7269\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u7C7B\u76EE~</p>",initial:function(t){this.giftList=t.giftList,this.$container=t.$container,this.rendTpl(),$.isEmptyObject(t.giftList)?this.emptyList():(this.formateData(),this.rendList(),this.rendPoint(),this.updateCursor(),this.updateView(),this.addEvents())},emptyList:function(){var t=this.emptyListTpl;this.$container.html(t)},pointTpl:function(t){var i=0,e="";for(i;t>i;i++)e+='<a href="javascript:;" class="btn-point j-gift-page" id="btn-point-'+i+'" data-page="'+i+'"><i></i></a>';return e},formateData:function(){var t=this,i=0;$.each(t.giftList,function(e,a){i++;var s=i%10,r=Math.floor(i/10);if(0==s&&r--,t.giftMap[r]||(t.giftMap[r]=[]),1==a.activity_type){var n=a.begin_time,p=a.end_time,c=Math.round((new Date).getTime()/1e3);a.is_time_limit=n>c?1:c>p?2:0}t.giftMap[r].push(a)});var e=t.giftMap[t.giftMap.length-1],a=e.length,s=5-a%5;if(5!=s)for(s;s>0;s--)e.push({})},rendTpl:function(){var t=_.template('<div class="gift-center-page">     <div class="gift-center-page-list"></div> </div> <a href="javascript:;" class="gift-center-box-cursor left j-gift-page" data-page="left"></a> <a href="javascript:;" class="gift-center-box-cursor right j-gift-page" data-page="right"></a> <div class="gift-center-box-point"></div>')();this.$container.html(t),this.$pageList=this.$container.find(".gift-center-page-list"),this.$pageCursor=this.$container.find(".j-gift-page")},rendList:function(){var t=_.template("<% for (var itemList in list) {     var len = list[itemList].length;     var type = len/5;     var height = type * 126;     %> <ul class=\"gift-center-list\" id=\"gift-center-list-<%=itemList%>\" style=\"height:<%=height%>px\">     <% for (var i in list[itemList]) {          var item = list[itemList][i];         var type = '';         var timeLimit = 0;         switch (Number(item['activity_type'])) {             case 1 : {                 type = 'time';                 break;             }             case 2 : {                 type = 'num';                 break;             }             case 3 : {                 type = 'sale';                 break;             }             case 4 : {                 type = 'member';                 break;             }             case 5 : {                 type = 'free';                 break;             }         }         if (type == 'time') {             if (item['is_time_limit'] != 0) {                 type = 'time-limit';                 timeLimit = item['is_time_limit'];             }         }         if (item['large_thumbnail_url']) {             var category_id = item['category_id']['category_id'] || item['category_id'];             var tdouNum = 0;             if (item['activity_type'] == 3) {                 tdouNum = item['discount'];             } else {                 tdouNum = item['price'];             }     %>     <li class=\"gift-center-list-item\">         <a href=\"javascript:;\" class=\"gift-center-list-item-link\" id=\"gift-center-list-item-<%=item['gift_id']%>\" data-gift={\"gift_id\":\"<%=item['gift_id']%>\",\"category_id\":\"<%=category_id%>\",\"tdou\":\"<%=tdouNum%>\",\"active\":\"<%=item['activity_type']%>\",\"timeLimit\":\"<%=timeLimit%>\"}>             <img class=\"gift-center-list-item-link-img\" alt=\"<%=item['gift_desc']%>\" src=\"<%=item['large_thumbnail_url']%>\">             <p class=\"gift-center-list-item-link-name\"><%=item['gift_name']%></p>             <div class=\"gift-center-list-item-link-detail\">                 <p class=\"text-overflow\">\u5BF9\u65B9\u83B7\u5F97<%=item['gift_name']%></p>                 <p class=\"text-overflow\">                     <i class=\"icon-tbean\"></i>                     <% if (item['activity_type'] == 3) {%>                     <span class=\"del\"><%=item['price']%></span><span><%=item['discount']%></span>                     <% } else { %>                     <span><%=item['price']%></span>                     <% } %>                 </p>             </div>             <i class=\"icon-select\"></i>             <i class=\"icon-type <%=type%>\"></i>         </a>     </li>     <%} else {%>     <li class=\"gift-center-list-item empty\"></li>     <% } %>     <% } %> </ul> <% } %>")({list:this.giftMap});this.$pageList.html(t),this.setAnimation(),this.page=0},rendPoint:function(){var t=this.giftMap.length;this.total=t-1;var i=this.pointTpl(t);this.$container.find(".gift-center-box-point").html(i),this.$pageList.css({width:631*t})},updateCursor:function(){var t=this.giftMap.length;1==t?this.$pageCursor.remove():this.$pageCursor.eq(0).hide()},updateView:function(){var t=this.page;this.$container.find(".btn-point.active").removeClass("active"),this.$container.find(".btn-point").eq(t).addClass("active"),0==this.page?(this.$pageCursor.eq(0).hide(),this.$pageCursor.eq(1).show()):this.page==this.total?(this.$pageCursor.eq(1).hide(),this.$pageCursor.eq(0).show()):this.$pageCursor.show()},moveToPage:function(){var t=this.page;this.$pageList.animate({"margin-left":631*t*-1})},pagerCtrl:function(t){var i=this;switch(t){case"left":if(0==i.page)return;i.page--,i.updateView(),i.moveToPage();break;case"right":if(i.page==i.total)return;i.page++,i.updateView(),i.moveToPage();break;default:var e=Number(t);if(e>=0){if(e==i.page)return;i.page=e,i.updateView(),i.moveToPage()}}},setAnimation:function(){var t=this.$container.find(".gift-center-list-item"),i=100;$.each(t,function(t,e){i+=50,setTimeout(function(){$(e).addClass("show")},i)})},addEvents:function(){var t=this;t.$container.on("click",".j-gift-page",function(i){var e=$(i.currentTarget),a=e.data("page");t.pagerCtrl(a)})}}});_.Module.define({path:"tbmall/widget/gift_loading_css",sub:{initial:function(){},getTpl:function(){return _.template('<div class="gift-loading">     <div class="object object_one"></div>     <div class="object object_two"></div>     <div class="object object_three"></div>     <div class="object object_four"></div> </div>')()}}});_.Module.define({path:"tbmall/widget/send_gift_dialog",requires:["tbmall/widget/gift_page_ctrl","user/widget/userApi","common/widget/TchargeDialog","common/widget/tdou/tdouViewPay","common/widget/baseUserData","tbmall/widget/gift_loading_css"],sub:{URL:{getGiftTab:"/present/show/getGiftList",getGiftForTab:"/present/show/getGiftListByCategoryId",getFreeGift:"/present/show/getUserFreeChance",sendGift:"/present/pay/placeOrder"},dialogHeight:560,giftMap:{},initial:function(t){return this.toUser=t.userId,this.toUserName=t.userName,this.scene_from=t.scene_from,this.threadId=t.threadId||null,this.postId=t.postId||null,this.fromUser=window.PageData.user.id,this.canSendToSelf=t.canSendToSelf,this.onFail=t.onFail||function(){},this.onSucess=t.onSucess||function(){},this.getUserTdou(),this.$loadingTpl=this.requireInstance("tbmall/widget/gift_loading_css").getTpl(),this.userLevel=this.requireInstance("user/widget/userApi").checkSuperMemberShipOf(PageData.user),this.fromUser?t.toUser!=this.fromUser||this.canSendToSelf?(this.initDialog(),void 0):(this.onFail({no:1,msg:"\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u9001\u793C\u7269\u54E6~"}),void 0):(this.onFail({no:210009,msg:"\u8BF7\u767B\u5F55~"}),void 0)},getUserTdou:function(t){this.baseUserData||(this.baseUserData=this.requireInstance("common/widget/baseUserData")),this.baseUserData.getTdou(function(i){this.userTdou=i.data.Parr_scores.scores_total,t&&t()},this)},getDialogTpl:function(){var t=this,i=_.template('<div class="gift-center-dialog-container">     <div class="gift-center-title">         <h4>\u9001\u7ED9<%=name%></h4>         <a href="javascript:;" class="dialogJclose j-gift-center-title-close"></a>     </div>     <div class="gift-center-box">         <div class="gift-center-box-tab">         </div>         <div class="gift-center-box-list">             <div class="gift-loading"><span></span></div>         </div>     </div> </div> <div class="gift-center-dialog-cashier">     <div class="gift-tr gift-center-dialog-cashier-num">         <p>\u9009\u62E9\u6570\u91CF\uFF1A</p>         <div class="gift-cashier-num-item">             <a href="javascript:;" class="j-gift-num" data-num="1">1</a>             <a href="javascript:;" class="j-gift-num" data-num="99">99</a>             <a href="javascript:;" class="j-gift-num" data-num="520">520</a>             <a href="javascript:;" class="j-gift-num" data-num="999">999</a>             <a href="javascript:;" class="j-gift-num" data-num="1314">1314</a>             <a href="javascript:;" class="j-gift-num gift-num-input" data-num="0">                 <input type="text" class="j-gift-num-input" maxlength="4" placeholder="\u81EA\u5B9A\u4E49" />             </a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-price">         <p>\u6240\u9700T\u8C46\uFF1A</p>         <div class="gift-center-price">             <i class="icon-tbean"></i>             <span class="gift-center-price-tbean j-gift-price">0</span>             <span class="gift-center-price-detail">\uFF08\u5BF9\u65B9\u83B7\u5F97<i class="icon_tbean"></i><span>0</span>\uFF09</span>             <a href="/f?ie=utf-8&kw=\u84DD\u94BB&fr=gift" target="_blank" class="gift-center-price-tips">\u84DD\u94BB\u7528\u9014</a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-btn">         <a href="javascript:;" class="btn-gift-send disabled">\u8D60\u9001</a>         <span class="error-tips"></span>         <span class="txt-tips"></span>     </div> </div> <div class="gift-center-dialog-alert">     <div class="mask"></div>     <div class="loading">         <span></span>         <p>\u5151\u6362\u793C\u7269\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>     </div>     <div class="alert update-tdou">         <p>\u8D2D\u4E70T\u8C46\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u3002</p>         <a href="javascript:;" class="j-update-tdou">\u5237\u65B0</a>         <a href="javascript:;" class="j-close-alert">\u5173\u95ED</a>     </div>     <div class="alert toast toast-error">         <i></i>         <span>\u8D60\u9001\u5931\u8D25\uFF01</span>     </div>     <div class="alert toast toast-suc">         <i></i>         <span>\u8D60\u9001\u6210\u529F\uFF01</span>     </div> </div>')({name:t.toUserName});return i},initDialog:function(){var t=this,i=t.getDialogTpl(),e={modal:!0,fixed:!0,width:690,height:t.dialogHeight,hideOnclose:!1,holderClassName:"gift-center-dialog",draggable:!1,html:i,closeable:!1,showTitle:!1};t._gift_dialog=new $.dialog(e),t.$_gift_dialog=t._gift_dialog.element,t.$inputCtrl=t.$_gift_dialog.find(".j-gift-num-input"),t.$numCtrl=t.$_gift_dialog.find(".j-gift-num"),t.$btnCtrl=t.$_gift_dialog.find(".btn-gift-send"),t.$tdouView=t.$_gift_dialog.find(".j-gift-price"),t.$blueView=t.$_gift_dialog.find(".gift-center-price-detail span"),t.$blueIcon=t.$_gift_dialog.find(".gift-center-price-detail i"),t.$errorTips=t.$_gift_dialog.find(".error-tips"),t.$txtTips=t.$_gift_dialog.find(".txt-tips"),t.$alertCenter=t.$_gift_dialog.find(".gift-center-dialog-alert"),t.$blueTips=t.$_gift_dialog.find(".gift-center-price-tips"),t.showDialog(function(){t.getGiftList(function(){t.setDefaultGift()})}),t.bindEvent()},setDefaultGift:function(){var t=this;setTimeout(function(){t.$_gift_dialog.find(".gift-center-box-list .gift-center-list-item-link").eq(0).click(),t.$_gift_dialog.find(".j-gift-num").eq(0).click()},1e3)},showDialog:function(t){var i=this;i.top||(i.top=Number(i.$_gift_dialog.css("top").replace("px",""))),i.$_gift_dialog.css({height:0,top:(i.top+i.dialogHeight)/2}).animate({height:i.dialogHeight,top:i.top,display:"block"},function(){i.$_gift_list||(i.$_gift_list=i.$_gift_dialog.find(".gift-center-dialog-container")),t&&t()})},closeDialog:function(t){var i=this;i.$_gift_dialog.animate({height:0,top:(i.top+i.dialogHeight)/2,display:"none"},function(){t&&t()})},getGiftList:function(t){var i=this;$.ajax({url:i.URL.getGiftTab,data:{scene_from:i.scene_from},type:"GET",dataType:"json",success:function(e){0==e.no?(i.rendGiftTpl(e.data),i.addFreeUrl=e.data.addfree_url,i.currency=e.data.currency,t&&t()):i.errorTips()},error:function(){i.errorTips()}})},errorTips:function(t){var i=this;switch(t){case"member":i.$txtTips.html('\u53EA\u6709\u4F1A\u5458\u624D\u53EF\u4EE5\u8D2D\u4E70<a href="javascript:;" class="j-get-member">\u8D2D\u4E70\u4F1A\u5458</a>');break;case"timeLimit":1==i.timeLimit?i.$errorTips.html("* \u9650\u65F6\u793C\u7269\u8FD8\u672A\u4E0A\u67B6"):2==i.timeLimit&&i.$errorTips.html("* \u9650\u65F6\u793C\u7269\u5DF2\u4E0B\u67B6");break;case"tdou":i.$txtTips.html('\u60A8\u7684T\u8C46\u4E0D\u8DB3<a href="javascript:;" class="j-get-tdou">\u83B7\u53D6T\u8C46</a>');break;case"timeIn":var e=i.curGift.end_time,a=Math.round((new Date).getTime()/1e3),s=e-a,r=Math.floor(s/86400),n=Math.floor(s%86400/3600),d=Math.floor(s%86400%3600/60);i.$txtTips.html("\u9650\u65F6\u9500\u552E\uFF1A\u8FD8\u6709"+r+"\u5929"+n+"\u5C0F\u65F6"+d+"\u5206\u949F\u7ED3\u675F");break;case"free":$.ajax({url:i.URL.getFreeGift,data:{scene_from:i.scene_from},type:"GET",success:function(t){0==t.no?(i.limitNum=t.data.free_chance,i.freeCtrl(),i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">'+t.data.free_chance+'</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')):i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">0</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')},error:function(){i.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">0</i>\u4E2A<a href="'+i.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>')}});break;case"num":var o=i.curGift.gift_count;i.$txtTips.html('\u8BE5\u793C\u7269\u9650\u91CF<i class="num">'+o+"</i>\u4E2A")}},rendGiftTpl:function(t){var i=t.list,e=t.list[0].category_id,a=t.gift_list;this.rendTab(i),this.setTab(e),this.giftListRend(e,a)},setTab:function(t){this.$tabList.removeClass("current"),$("#gift-center-tab-"+t).addClass("current")},giftListRend:function(t,i){this.setData(t,i),this.requireInstance("tbmall/widget/gift_page_ctrl",{giftList:i,$container:$(".gift-center-box-list")})},setData:function(t,i){this.categoryId=t,this.giftMap[t]||(this.giftMap[t]={}),this.giftMap[t]=this.formateList(i)},formateList:function(t){var i={};return $.each(t,function(t,e){i[e.gift_id]=e}),i},rendTab:function(t){var i=this,e=_.template('<ul class="gift-center-tab-list">     <% var len = list.length;         var width = (630 - len) / len;         for (var i in list) {         var item = list[i];     %>     <li class="gift-center-tab-item-tr"></li>     <li class="gift-center-tab-item" style="width:<%=width%>px">         <a href="javascript:;" id ="gift-center-tab-<%=item.category_id%>" data-tab={"id":"<%=item.category_id%>"}>             <%=item.category_name%>         </a>     </li>     <%}%> </ul>')({list:t});i.$_gift_dialog.find(".gift-center-box-tab").html(e),i.$tabList=i.$_gift_dialog.find(".gift-center-box-tab").find(".gift-center-tab-item a")},selectGift:function(){var t=this;t.updateGift()},updateGift:function(){$(".gift-center-list-item-link").removeClass("select"),$("#gift-center-list-item-"+this.curGiftId).addClass("select")},setLoading:function(){this.$_gift_dialog.find(".gift-center-box-list").html(this.$loadingTpl)},changeTab:function(t){var i=this;i.setLoading(),i.giftMap&&i.giftMap[t]?(i.setTab(t),i.giftListRend(t,i.giftMap[t])):$.ajax({url:i.URL.getGiftForTab,data:{category_id:t},type:"GET",dataType:"json",success:function(e){if(0==e.no){var a=e.data.gift_list||{};i.setTab(t),i.giftListRend(t,a),i.giftMap[t]=i.formateList(a)}else i.errorTips()},error:function(){i.errorTips()}})},inputCtrl:function(t){var i=parseInt(t,10)||0;0==i?this.$inputCtrl.val(""):t!=i&&this.$inputCtrl.val(i),this.orderNum=i,this.updateBtn()},updateBtn:function(){return this.$txtTips.html(""),this.$errorTips.html(""),this.curGiftId&&this.curCategoryId?this.orderNum?(this.checkOrder()?this.$btnCtrl.removeClass("disabled"):this.$btnCtrl.addClass("disabled"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0)},setNum:function(t){this.$tdouView.html(t);var i=this.curGift,e=Math.floor((t-(i.tbkey_price||0))*(100-i.proportion)/100);this.$blueView.html(e),0==this.currency?(this.$blueIcon.removeClass().addClass("icon_tbean"),this.$blueTips.hide()):(this.$blueIcon.removeClass().addClass("icon-blue"),this.$blueTips.show())},checkOrder:function(){var t=Number(this.curTdouNum)*Number(this.orderNum);return this.setNum(t),4!=this.activeId||this.userLevel?1!=this.activeId||this.timeLimitCtrl()?t>this.userTdou?(this.tdouNotEnough(),!1):(2==this.activeId&&this.numLimitCtrl(),3==this.activeId&&this.saleCtrl(),5==this.activeId&&this.errorTips("free"),!0):!1:(this.notMember(),!1)},freeCtrl:function(){var t=this.limitNum,i=this.orderNum;i>t&&this.$btnCtrl.addClass("disabled")},notMember:function(){this.errorTips("member")},timeLimitCtrl:function(){return 0!=this.timeLimit?(this.errorTips("timeLimit"),!1):(this.errorTips("timeIn"),!0)},numLimitCtrl:function(){var t=this.curGift,i=t.gift_count;return this.errorTips("num"),i<this.orderNum?!1:!0},saleCtrl:function(){var t=this.curGift.price*Number(this.orderNum),i=Number(this.curTdouNum)*Number(this.orderNum);return this.$txtTips.html('\u6298\u6263\u4FC3\u9500\uFF1A\u539F\u4EF7<i class="del">'+t+'</i>T\u8C46\uFF0C\u73B0\u4EF7<i class="num">'+i+"</i>T\u8C46"),!0},tdouNotEnough:function(){this.errorTips("tdou")},sendGifterror:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-error").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-error").hide()},1e3)},sendGiftSuc:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-suc").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-suc").hide()},1e3)},getOrder:function(){var t=this;t.$btnCtrl.addClass("disabled"),t.$alertCenter.show().find(".loading").show(),$.ajax({url:t.URL.sendGift,data:{scene_from:t.scene_from,gift_id:t.curGiftId,num:t.orderNum,benefit_userid:t.toUser,benefit_username:t.toUserName,thread_id:t.threadId,post_id:t.postId},type:"POST",dataType:"json",success:function(i){if(0==i.no)if(5==t.activeId)t.sendGiftSuc(),t.limitNum=i.data.free_chance,t.freeCtrl(),t.$txtTips.html('\u60A8\u6700\u591A\u53EF\u4EE5\u514D\u8D39\u8D60\u9001<i class="num">'+i.data.free_chance+'</i>\u4E2A<a href="'+t.addFreeUrl+'" class="j-get-free-gift">\u83B7\u53D6\u673A\u4F1A</a>'),t.$btnCtrl.removeClass("disabled");else{var e=i.data;$.extend(e,{chargeType:"platform",notShowSucTips:!0});var a=t.requireInstance("common/widget/tdou/tdouViewPay",function(e){if("encourage_dialog_closed"==e.command?t.$alertCenter.hide().find(".loading").hide():"encourage_paid"==e.command?0==e.data.no?t.sendGiftSuc():t.sendGifterror():t.sendGifterror(),2==t.activeId){var a=i.data.gift_count;t.curGift.gift_count=a,t.numLimitCtrl()?t.$btnCtrl.removeClass("disabled"):t.$btnCtrl.addClass("disabled")}else t.$btnCtrl.removeClass("disabled")});a.createMain(e)}else t.$btnCtrl.removeClass("disabled"),t.sendGifterror()},error:function(){t.$btnCtrl.removeClass("disabled"),t.sendGifterror()}})},updateTdou:function(){var t=this.orderNum*this.curTdouNum-this.userTdou,i={consumption_path:"send-gift",fr:"send-gift",current_need_tdou:t,is_direct_cashier:!0};this.requireInstance("common/widget/TchargeDialog",i),setTimeout(function(){this.$alertCenter.show().find(".update-tdou").show()},1e3)},bindEvent:function(){var t=this;t.$_gift_dialog.on("click",".j-gift-center-title-close",function(){t.closeDialog(function(){t._gift_dialog.close()})}).on("click",".gift-center-list-item-link",function(i){var e=$(i.currentTarget),a=e.data("gift");t.curGiftId=a.gift_id,t.curCategoryId=a.category_id,t.curTdouNum=a.tdou,t.activeId=a.active,t.timeLimit=a.timeLimit,t.curGift=t.giftMap[t.curCategoryId][t.curGiftId],t.selectGift(),t.updateBtn()}).on("click",".gift-center-tab-item a",function(i){var e=$(i.currentTarget),a=e.data("tab"),s=a.id;t.changeTab(s),t.curCategoryId=null,t.curGiftId=null,t.curTdouNum=null,t.activeId=null,t.timeLimit=null,t.updateBtn()}).on("input",".j-gift-num-input",function(i){var e=$(i.currentTarget),a=e.val();t.inputCtrl(a)}).on("click",".j-gift-num",function(i){var e=$(i.currentTarget);t.$numCtrl.removeClass("select"),e.addClass("select");var a=Number(e.data("num"))||0;t.orderNum=a,0==a?(t.$inputCtrl.focus(),t.inputCtrl(t.$inputCtrl.val())):(t.$inputCtrl.val(""),t.updateBtn())}).on("click",".btn-gift-send",function(i){var e=$(i.target);e.hasClass("disabled")||t.getOrder()}).on("click",".j-get-tdou",function(){t.updateTdou()}).on("click",".j-close-alert",function(){t.$alertCenter.hide().find(".alert").hide()}).on("click",".j-update-tdou",function(){t.getUserTdou(function(){t.checkOrder(),t.$alertCenter.hide().find(".alert").hide()})})}}});_.Module.define({path:"tbmall/widget/pb_post_foot_send_gift",requires:["tbmall/widget/send_gift_dialog","tbmall/widget/gift_loading_css"],sub:{URL:{getPbGiftList:"/present/pb/getList"},giftData:{},emptyObject:{},$emptyTpl:'<li class="tips"><p>\u8BE5\u8D34\u5B50\u8FD8\u6CA1\u6709\u88AB\u8D60\u9001\u793C\u7269</p></li>',$errorTpl:'<li class="tips"><p>\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u540E\u518D\u8BD5~</p></li>',initial:function(t){this.$loadingTpl=this.requireInstance("tbmall/widget/gift_loading_css").getTpl(),this.$container=$(t.container),this.$box=$(t.box),this.authorId=t.authorId,this.postId=t.postId,this.$listBox=this.$container.find(".post-foot-send-gift-list"),this.$pager=this.$container.find(".post-foot-send-gift-pager"),this.presentNum=t.presentNum,this.bindEvent()},getGiftListHeight:function(){var t=this.$listBox.find(".gift-item"),i=Math.ceil(t.length/3),e=74*i;return e},toggleShow:function(t){var i=this,e=i.$box;t?(e.removeClass("less").addClass("more"),i.$listBox.animate({height:0}),i.$pager&&i.$pager.animate({height:0})):(e.removeClass("more").addClass("less"),i.$listBox.animate({height:i.getGiftListHeight()},function(){i.$listBox.removeClass("loading")}),i.$pager&&i.$pager.animate({height:32}))},setLoading:function(){this.$listBox.addClass("loading").html(this.getLoadingTpl())},getLoadingTpl:function(){return'<li class="gift-item-loading">'+this.$loadingTpl+"</li>"},initGiftListPager:function(t){var i=this,e=t.page;e.total_pn>1?i.pager=i.requireInstance("common/component/JsPager",{container:i.$pager,current:e.pn,amount:6,total:e.total_pn}):(i.$pager.remove(),i.$pager=null)},formatData:function(t){var i=t.length;return i%3===1&&(t.push(this.emptyObject),t.push(this.emptyObject)),i%3===2&&t.push(this.emptyObject),t},rendList:function(t){var i=this,e=_.template('<% for (var i in list) {      var item = list[i];     if (item[\'large_thumbnail_url\']) { %> <li class="gift-item">     <a target="_blank" href="/home/main?id=<%=item[\'pay_portrait\']%>&fr=home" class="gift-item-avatar">         <img class="gift-item-avatar-img" alt="<%=item[\'pay_username\']%>" src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/<%=item[\'pay_portrait\']%>"/>     </a>     <div class="gift-item-detail">         <p class="gift-item-detail-title" title="<%=item[\'pay_username\']%>"><%=item[\'pay_username\']%></p>         <p class="gift-item-detail-info">\u8D60\u9001             <img class="gift-item-detail-info-icon" title="<%=item[\'gift_name\']%>" alt="<%=item[\'gift_name\']%>" src="<%=item[\'large_thumbnail_url\']%>">             <span class="gift-item-detail-info-num">x <%=item[\'num\']%></span>         </p>     </div> </li> <% } else { %> <li class="gift-item empty-item"></li> <% } %> <% } %>')({list:i.formatData(t)});i.$listBox.html(e),i.setAnimation()},setAnimation:function(){var t=this,i=t.$listBox.find(".gift-item"),e=100;$.each(i,function(t,i){e+=50,setTimeout(function(){$(i).addClass("show")},e)}),t.toggleShow()},initGiftList:function(){var t=this;t.setLoading(),this.setGiftList(0,function(i){t.initGiftListPager(i),t.pager&&t.pager.bind("pageChange",function(i,e){t.pager.initial({current:e}),t.setLoading(),t.setGiftList(e-1)})})},setGiftList:function(t,i){var e=this;if(e.giftData&&e.giftData[t]){var s=e.giftData[t];e.rendList(s.gift_list),i&&i(s)}else $.ajax({url:e.URL.getPbGiftList,data:{pn:t,ps:15,user_id:e.authorId,post_id:e.postId},type:"GET",dataType:"json",success:function(s){if(0==s.no)if($.isEmptyObject(s.data.gift_list))e.errorTips("empty");else{var a=s.data;e.giftData[t]=a,e.rendList(a.gift_list),i&&i(a)}else e.errorTips("error")},error:function(){e.errorTips("error")}})},errorTips:function(t){var i="empty"===t?this.$emptyTpl:this.$errorTpl;this.$listBox.html(i)},toggleList:function(t){t||0!=this.$listBox.find(".gift-item").length?this.toggleShow(t):this.initGiftList()},bindEvent:function(){var t=this;t.presentNum>0&&t.$container.on("click",".j-show-gift-list",function(i){i.stopPropagation();var e=t.$box.hasClass("less");t.toggleList(e)}),$(".j-post-send-gift").on("click",function(i){var e=$(i.target),s=e.data("gift");t.requireInstance("tbmall/widget/send_gift_dialog",{userId:s.userId,userName:s.userName,threadId:s.threadId,postId:s.postId,scene_from:"pc_pb",onSuccess:function(){$.tb.location.reload()}})})}}});_.Module.define({path:"props/component/PropsApi",requires:["common/component/JsPager"],sub:{initial:function(t){this.dataObj=t,this.initOptions(),this.bindEvents()},initOptions:function(){this.titleMap={"1070001_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070001_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070002_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D","1070002_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D"},this.urlMap={0:"/tbmall/getUserAppraise",1:"/tbmall/getPostAppraise"}},bindEvents:function(){var t=this,s=t.dataObj;$(".props_item_tail").live("click",function(){return t.propsData={props_id:$(this).data("propsid"),props_type:s.props_type},"0"==s.props_type&&(t.propsData.user_id=$(this).data("userid"),t.propsData.user_sex=$(this).data("usersex")),"1"==s.props_type&&(t.propsData.post_id=$(this).data("postid")),t.initPager=!0,t.showDialog(),!1})},getAttrsHtml:function(t){for(var s=null,i=[],a="",p=["user_id","user_sex","post_id","props_id"],e=0;e<p.length;e++)s=p[e],t[s]&&(a="data-"+s.replace(/_/,"")+'="'+t[s]+'"',i.push(a));return i.join(" ")},showUIHtml:function(t){for(var s=[],i=t.props||{},a=null,p=0,e=["1070001","1070002"],r=0;r<e.length;r++)t.props_id=e[r],a=i[e[r]],a&&(s.push('<li class="props_item_split"><span class="userinfo_split"></span></li>'),s.push('<li class="props_item props_item_'+e[r]+'">'),s.push('<a href="#" '+this.getAttrsHtml(t)+' class="props_item_tail">'),s.push('<span class="props_item_icon"></span>'),s.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),s.push('<span class="props_item_num">'+a.num+"</span></li>"),s.push("</a>"),p++);return 0>p?"":s.join("")},showUI:function(t){var s=this.showUIHtml(t);s&&t.wrap.html(s)},showDialog:function(){this.initDialogData(),this.initDialogUI(),this.showOrUpdateList()},initDialogData:function(){var t=this.propsData,s=t.props_id+"_"+t.props_type,i=this.titleMap[s];if(t.user_id!==PageData.user.id){var a=t.user_sex;i=i.replace(/\u6211/,a)}this.dialogTitle=i,this.dataurl=this.urlMap[t.props_type],this.pn=0,this.pageSize=10,this.pageCount=8},initDialogUI:function(){var t=this;this.$wrap=$('<div class="props_userlist_wrap"></div>'),this.$userlist=$('<div class="props_userlist_main"></div>'),this.$wrap.append(this.$userlist),this.dialog=new $.dialog({title:t.dialogTitle,width:554,height:340,show:!1,html:this.$wrap})},showOrUpdateList:function(){var t=this,s=t.propsData,i={props_id:s.props_id,look_user_id:s.user_id||"",post_id:s.post_id||"",pn:t.pn,c:t.pageSize};$.tb.get(t.dataurl,i,function(s){s&&0==s.no?(t.list=s.data.list,t.updateList(),t.initPager&&s.data.total>1&&(t.initPager=!1,t.total=Math.ceil(s.data.total/t.pageSize),t.buildPager()),t.dialog.show()):t.showErrorDialog()})},showErrorDialog:function(){new $.dialog({title:"\u63D0\u793A",width:300,height:50,html:'<p style="text-align:center;font-size:14px;line-height:40px;">\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5</p>'})},buildPager:function(){var t=$('<div class="props_userlist_pager"></div>');this.$wrap.append(t);var s=this,i=this.use("common/component/JsPager",{container:t,current:1,amount:s.pageCount,total:s.total});i.bind("pageChange",function(t,a){i.initial({current:a}),s.pn=a,s.showOrUpdateList()}),this.pager=i},updateList:function(){var t=this.list,s=[],i=null;s.push('<ul class="props_userlist">');for(var a=0;a<t.length;a++)i=t[a],s.push('<li class="userlist_item">'),s.push('<a class="userlist_head" href="/home/main?id='+i.portrait+'&fr=props" target="_blank"><img src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/'+i.portrait+'"/></a>'),s.push('<a class="userlist_name" href="/home/main?id='+i.portrait+'&fr=props" target="_blank">'+i.user_name+"</a>"),s.push('<p class="userlist_time">'+this.getShowtime(i.create_time)+"</p>"),s.push("</li>");s.push("</ul>"),this.$userlist.html(s.join(""))},getShowtime:function(t){t*=1e3;var s=new Date($.dateFormat(new Date(Env.server_time),"yyyy-MM-dd 00:00:00")).getTime();return t=t>s?$.dateFormat(new Date(t),"HH:mm"):$.dateFormat(new Date(t),"yyyy-MM-dd")}}});_.Module.define({path:"pb/widget/complientThread",requires:[],sub:{initial:function(){try{if(Page.checkLoadedModules("hot_thread_zhaohanyu"))return;var t=this;t.bindEvents()}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/complient_thread/complient_thread.js",method:"",ln:15}),n}},bindEvents:function(){var t=this;t.bindZan()},bindZan:function(){var t=this;$("#j_p_postlist").on("click",".j_niceThread",function(n){try{n=n||window.event;var e=n.target||n.srcElement,a=t.bindThreadData(e);$(e).hasClass("not_complient_thread")?t.sendThreadZan(e,a):$(e).hasClass("complient_thread")?t.sendCancelZan(e,a):alert("error")}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/complient_thread/complient_thread.js",method:"",ln:37}),n}})},sendThreadZan:function(t,n){var e=this,a=n.forum_id,i=n.thread_id,s=n.post_id,o=1==$(t).parent().hasClass("hot_complient_container")?2:n.post_no,r=n.user_id,d=n.user_name,l=n.content;$.ajax({url:"/godthread/likePost",data:{forum_id:a,thread_id:i,post_id:s,post_no:o,dstuid:r,dstuname:d,content:l,tbs:PageData.tbs},async:!1,type:"post",datatype:"json",success:function(n){0==n.no?e.changeTextAndClass(t,"add","not_complient_thread","complient_thread"):2==n.no||1==n.no?e.confirmAlert("\u77ED\u65F6\u95F4\u5185\u591A\u6B21\u63D0\u4EA4\uFF0C\u70B9\u8D5E\u65E0\u6548","\u8D34\u5427\u63D0\u793A"):110001==n.no?e.confirmAlert("\u767B\u9646\u540E\u624D\u53EF\u4EE5\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):3==n.no?e.confirmAlert("\u5F53\u524D\u8D26\u53F7\u6CA1\u6709\u70B9\u8D5E\u6743\u9650","\u8D34\u5427\u63D0\u793A"):161001==n.no?e.confirmAlert("\u4E0D\u80FD\u91CD\u590D\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):e.confirmAlert("\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")},error:function(){e.confirmAlert("\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")}})},sendCancelZan:function(t,n){var e=this,a=n.thread_id,i=n.post_id,s=n.user_id,o=n.user_name,r=n.content;$.ajax({url:"/godthread/unlikePost",data:{thread_id:a,post_id:i,dstuid:s,dstuname:o,content:r,tbs:PageData.tbs},type:"post",async:!1,datatype:"json",success:function(n){0==n.no?e.changeTextAndClass(t,"minus","complient_thread","not_complient_thread"):2==n.no||1==n.no?e.confirmAlert("\u77ED\u65F6\u95F4\u5185\u591A\u6B21\u63D0\u4EA4\uFF0C\u70B9\u8D5E\u65E0\u6548","\u8D34\u5427\u63D0\u793A"):110001==n.no?e.confirmAlert("\u767B\u9646\u540E\u624D\u53EF\u4EE5\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):3==n.no?e.confirmAlert("\u5F53\u524D\u8D26\u53F7\u6CA1\u6709\u70B9\u8D5E\u6743\u9650","\u8D34\u5427\u63D0\u793A"):161001==n.no?e.confirmAlert("\u4E0D\u80FD\u91CD\u590D\u53D6\u6D88\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):e.confirmAlert("\u53D6\u6D88\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")},error:function(){e.confirmAlert("\u53D6\u6D88\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")}})},bindThreadData:function(t){return $(t).parent().getData()},changeTextAndClass:function(t,n,e,a){var i=this,s=$(t).siblings(".j_complient_number"),o=s.tbattr("title");"add"==n?(o=parseInt(o)+1,s.tbattr("title",o),$("#j_p_postlist").off("click",".j_niceThread"),1==o?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".j_zan_word").css("display","none").siblings(".total_count_number").text(o).css("display","inline-block"):o>=1e3?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(parseInt(o/1e3)+"k"):$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(o),i.bindZan()):"minus"==n&&(o=parseInt(o)-1,s.tbattr("title",o),$("#j_p_postlist").off("click",".j_niceThread"),0==o?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").css("display","none").siblings(".j_zan_word").css("display","inline-block"):o>=1e3?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(parseInt(o/1e3)+"k"):$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(o),i.bindZan())},confirmAlert:function(t,n){$.dialog.alert(t,{title:n,acceptValue:"\u786E\u5B9A"})}}});_.Module.define({path:"pb/widget/sub_list/postTail",requires:["props/component/PropsApi"],sub:{thread:{},power:{},initial:function(a){try{this.tailList=a.tailList,this.thread=PageData.thread,this.power=PageData.power,this.user=PageData.user,this.tailList=a.tailList,this.isLocal58=a.isLocal58,this.propsapi=this.use("props/component/PropsApi",{props_type:"1"})}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/sub_list/post_tail.js",method:"",ln:21}),s}},getPostTailTpl:function(a,s){var t='<div class="core_reply_tail '+(a.is_saveface?"save_card_reply_tail":"")+(a.is_reward?" reward_reply_tail ":"")+'">';return this.isLocal58||(t+=1==a.post_no?'<ul class="p_reply"><li><a href="#" class="p_reply_first">\u56DE\u590D</a></li></ul>':["<div class=\"j_lzl_r p_reply\" data-field=\"{'pid':'"+a.post_id+"','total_num':'"+a.comment_num+"'}\">",'<a href="#" class="lzl_link_unfold" style="display:'+(a.comment_num>0?"none":"")+';">\u56DE\u590D',a.comment_num>0?"("+a.comment_num+")":"","</a>",'<span class="lzl_link_fold" style="display:'+(a.comment_num>0?"":"none")+'">\u6536\u8D77\u56DE\u590D</span>',"</div>"].join("")),t+='<ul class="p_tail">'+this.showFloorNumAndDate(a)+"</ul>",t+=this.isLocal58?'<ul class="p_58cp"><li><a class="j_58_cp" href="#" onclick="return false;">\u6295\u8BC9</a></li></ul>':['<ul class="p_mtail">',this.isTpoint(a.pb_tpoint)?this.getUninterest(a.pb_tpoint.template_id):this.getJubaoHtml(a,s,1),this.showTail(a),this.loadAdmin(a,s),"</ul>"].join(""),this.power.can_op_as_4thmgr&&(t+='<ul class="p_print_flower"><li data-uid="'+s.user_id+'" data-pid="'+a.post_id+'" class="print_reward j_print_reward">\u5370\u82B1\u5956\u52B1 <span class="print_seperator">|</span></li></ul>'),t+='<ul class="p_props_tail props_appraise_wrap">',t+=this.propsapi.showUIHtml({props:a.props||{},post_id:a.post_id}),t+="</ul>",t+=this.showMallTail(a),t+="</div>"},showFloorNumAndDate:function(a){var s=a.post_no+"\u697C",t="";return t+="1"==this.thread.thread_type?'<li class="lzl_time">'+s+"</li>":"<li><span>"+s+"</span></li>",t+="<li><span>"+a.date+"</span></li>"},getJubaoHtml:function(a,s){var t="",i=this.thread,l=this.power,e=this.user;if(!(1==i.thread_type&&1==a.post_no||(l.can_mask_delete||l.lz_del)&&1!=a.post_no)){var p=l.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5";if(e.user_id!=s.user_id||a.is_anonym){var n="window.open('//tieba.baidu.com/complaint/info?type={type}&cid=0&tid="+i.thread_id+"&pid="+a.post_id+"','newwindow', 'height=900, width=800, toolbar =no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no');return false;";t='<li class="j_jb_ele"><a href="#" onclick="'+n.replace("{type}",0)+'" class="complaint complaint-opened" data-checkun="un">'+p+'</a>&nbsp;|<span class="super_jubao" style="display:none"><a href="#" onclick="'+n.replace("{type}",1)+'">\u4FB5\u6743\u4E3E\u62A5</a><a href="#" onclick="'+n.replace("{type}",2)+'">\u6709\u5BB3\u4FE1\u606F\u4E3E\u62A5</a></span></li>'}else{var _="{'delete_mine':'1','index':'2','user_name':'"+s.user_name+"'}";p="\u5220\u9664",t='<li class="j_jb_ele"><a href="#" data-field='+_+' class="jb_in p_post_del_my post_del_href" data-checkun="un">'+p+"</a>&nbsp;|</li>"}}return t},getUninterest:function(a){var s="{'template_id': "+a+"}",t='<li><span class="j-pb-tpoint" data-field="'+s+'" style="cursor: pointer">\u4E0D\u611F\u5174\u8DA3\u5E76\u9690\u85CF</span>&nbsp;|</li>';return t},showTail:function(a){var s=a.open_id,t=a.open_type,i=this.tailList,l={1:"1",4:"1",5:"1",6:"1",youliao:"1"};"wap"!==s||l.openType||"sharexc"==t||"webipad"==t||(t="phone");var e=s+"_"+t,p=i[e]?i[e]:[],n=p[0],_=p[1],o=p[2],r="";return n&&(r="xiangce"===t?'<li><span class="p_tail_txt">\u901A\u8FC7</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+'</a><span class="p_tail_txt">\u4E0A\u4F20</span></li>':"shenqi"===t?'<li><span class="p_tail_txt">\u901A\u8FC7</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+'</a><span class="p_tail_txt">\u4E0A\u4F20</span></li>':_&&o?'<li><span class="p_tail_txt">\u6765\u81EA</span><span class="tip_bubble_con"></span><a data-tip="'+o+'" class="p_tail_wap" href="'+_+'" target="_blank">'+n+"</a></li>":_?'<li><span class="p_tail_txt">\u6765\u81EA</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+"</a></li>":o?'<li><span class="p_tail_txt"></span><span class="tip_bubble_con"></span><a data-tip="'+o+'" class="p_tail_font"  >\u672C\u697C\u542B\u6709'+n+"</a></li>":'<li><span class="p_tail_txt">\u6765\u81EA</span>'+n+"</li>"),r},loadAdmin:function(a,s){var t=this.power,i=this.user,l="",e="&nbsp;|",t=this.power,i=this.user;return(t.can_type2_audit_post||t.lz_del)&&this.isTpoint(a.pb_tpoint)?"":(a.is_anonym?t.can_filter_ip&&(l+='<li><a class="p_post_ban_anonym" href="#">\u5C01</a>'+e+"</li>"):t.can_filter_id&&(l+='<li><a class="p_post_ban" href="#">\u5C01</a>'+e+"</li>"),1!=a.post_no&&(t.can_mask_delete||t.lz_del&&!i.forbidden.isForbid&&!i.is_black)&&(l+='<li><a class="p_post_del" href="#">\u5220\u9664</a>'+e+"</li>"),t.can_super&&!a.is_anonym&&(l+='<li><a class="p_tieba_manage" href="/f?ct=503316480&cm=6000&tn=bdUserManager&un='+encodeURIComponent(s.user_name)+'" target="_blank">\u8D34\u5427\u7BA1\u7406</a>&nbsp;|</li>'),l)},showMallTail:function(a){var s="",t={1019001:"1",1019002:"1",1019003:"1",1049001:"1",1049002:"1",1049003:"1"};return(a.is_bub||a.ptype&&7==a.ptype.length&&!t[a.ptype])&&(s='<a href="/tbmall/home" class="p_mall_tail" target="_blank"></a>'),s},isTpoint:function(a){return a&&1===a.is_tpoint}}});
;_.Module.define({path:"pb/widget/postList/Lzl",requires:["pb/widget/Admin","user/widget/Icons"],sub:{editor_entry:null,_reach_limit:!1,_new_reply_num:0,initial:function(t){try{if(Page.checkLoadedModules("lzlHasLoad"))return;this.postJdom=t,this.wapperDOM=$("#j_p_postlist"),this.icons=this.use("user/widget/Icons"),this._admin=this.use("pb/widget/Admin"),this._init()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:29}),e}},_init:function(){this._showJubao(),this._bindEditorEntry(),this._bindFoldClick(),this._bindClick()},_showLzlJubao:function(t){if(!PageData.power.can_mask_delete&&!PageData.power.lz_del){var e,e=(PageData.power.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5",t.find("li.j_lzl_s_p"));e.each(function(){var t=$(this).find("a").filter(function(){return $(this).tbattr("username")}).tbattr("username"),e="";if(PageData.user.user_name==t)var i="\u5220\u9664",e="{'delete_mine': 1, 'user_name' : '"+t+"'}",l='<a href="#" class="lzl_jb_in" data-field="'+e+'">'+i+"</a>&nbsp;|&nbsp;";else{var o=$(this).data("field");if(o)var i=PageData.power.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5",a="",l='<a href="#" class="lzl_jb_in" onclick="'+a.replace("{type}",0)+'">'+i+"</a>&nbsp;|&nbsp;";else l=""}$(this).find(".lzl_jb").html(l)})}},_bindFoldClick:function(){var t=this;this.wapperDOM.delegate(".lzl_link_unfold","click",function(e){try{var i=e.srcElement||e.target;return PageData.user.is_login?(t._loadLzlContent($(i)),t._unfoldLzl($(i))):TbCom.process("User","buildLoginFrame",null,null,null,"lzl_reply"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:84}),e}}).delegate(".lzl_link_fold","click",function(e){try{var i=e.srcElement||e.target;t._foldLzl($(i))}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:87}),e}})},_loadLzlContent:function(t){var e=t.parents(".j_l_post");LzlEditor.cur_optdom.postJdom=e;e.find(".j_lazy_lzl");LzlEditor.cur_optdom.jdom=e.find(".j_lzl_wrapper"),LzlEditor.cur_optdom.mainDom=LzlEditor.cur_optdom.jdom.find("div.j_lzl_container"),LzlEditor.cur_optdom.tailDom=LzlEditor.cur_optdom.jdom.find("div.j_lzl_r"),LzlEditor.cur_optdom.mainData=LzlEditor.cur_optdom.mainDom.getData(),LzlEditor.cur_optdom.tailData=LzlEditor.cur_optdom.tailDom.getData(),AntiAnswerLzl=new CaptchaReqCom({forumName:PageData.forum.name_url,forumId:PageData.forum.forum_id,tid:PageData.thread.thread_id,postType:"reply"})},_updateReplyNum:function(t){var e=0;if(t)e=t;else{this._new_reply_num++;var e=1*this.mainData.total_num+this._new_reply_num}this.tailDom.find("a.lzl_link_unfold").html("\u56DE\u590D("+e+")")},_foldLzl:function(t){var e=t.parents(".j_l_post").find(".j_lzl_container");if(LzlEditor.cur_sec){var i=LzlEditor.cur_sec;i.find("span.close").click(),LzlEditor._s_p._ie6RelativeHack()}e.slideUp("normal",function(){t.hide(),t.parent().find("a.lzl_link_unfold").show(),$(document).trigger("sub_list_reply_toggled")})},_unfoldLzl:function(t){var e=this;if(e.target=t,t.hide(),t.parent().find("span.lzl_link_fold").show(),LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid){var i="";LzlEditor._s_p._se&&(i=LzlEditor._s_p._se.getContent()),LzlEditor._lzl=null,LzlEditor._hide(),LzlEditor.cur_sec.empty(),LzlEditor.init(e),LzlEditor._s_p._se&&LzlEditor._s_p._se.ready(function(){LzlEditor._s_p._se.execCommand("inserthtml",i)}),LzlEditor._s_p._ie6RelativeHack(),CaptchaLzl&&!CaptchaLzl.needUpdate&&CaptchaLzl.reload(),LzlEditor.cur_sec.parent().show(),e.mainDom.slideDown("normal",function(){LzlEditor._s_p._ie6RelativeRecover(),$(document).trigger("sub_list_reply_toggled")})}else LzlEditor.init(e),LzlEditor._s_p._ie6RelativeHack(),LzlEditor.cur_sec.parent().show(),e.mainDom.slideDown("normal",function(){LzlEditor._s_p._ie6RelativeRecover(),$(document).trigger("sub_list_reply_toggled")});LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),$.stats.sendRequest("fr=tb0_forum&st_type=lzl_unfold")},_showJubao:function(){this.wapperDOM.delegate(".j_lzl_s_p","mouseover",function(){$(this).find(".lzl_jb").show()}).delegate(".j_lzl_s_p","mouseout",function(){$(this).find(".lzl_jb").hide()})},asyncImage:function(t,e){var i=t.find("img."+e);return 0==i.length?!1:($.each(i,function(t,e){e.src=e.getAttribute("data-passive")||e.getAttribute("src")}),void 0)},_bindClick:function(){var t=this;this.wapperDOM.delegate(".j_lzl_m","click",function(){try{if(PageData.user.is_login){var e=$(this).parents(".j_lzl_m_w");return t.asyncImage($("#"+$(this).tbattr("lzlid")),"forasync"),e.find(".lzl_post_hidden").slideDown("normal",function(){$(document).trigger("sub_list_reply_toggled")}),e.find(".j_pager").show(),e.find(".lzl_more").hide(),$.stats.sendRequest("fr=tb0_forum&st_type=lzl_more"),!1}return _.Module.use("common/component/force_login",["","userbar","dialog","pb_lzl_more"]),!1}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:232}),i}}).delegate(".lzl_s_r","click",function(e){try{var i=e.target||e.srcElement;return PageData.user.is_login?(t._loadLzlContent($(i)),t._fastReply($(i)),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus()):TbCom.process("User","buildLoginFrame",null,null,null,"lzl_interact"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:246}),e}}).delegate(".j_pager","click",function(e){try{if("A"==e.target.tagName){window.global&&"function"==typeof window.global.shieldPost&&window.global.shieldPost();var i=$(e.target),l=$.tb.unescapeHTML(i.tbattr("index"));if(!l){var o=$.tb.unescapeHTML(i.tbattr("href")).split("#");l=parseInt(o[1])}return t.mainDom=i.parents(".j_lzl_container"),t.mainData=t.mainDom.getData(),t.postJdom=i.parents(".j_l_post"),t._turnPage(t,l,i.parents(".core_reply_content")),!1}}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:263}),a}})},_bindEditorEntry:function(){var t=this;t.wapperDOM.delegate(".j_lzl_p","click",function(){try{return t.editor_entry=$(this),PageData.user.is_login?(LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid&&"none"!=LzlEditor.cur_sec.css("display")?LzlEditor._s_p._getHtml()?LzlEditor._s_p._se.setContent(""):LzlEditor._hide():(t._loadLzlContent($(this)),LzlEditor.init(t)),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),!1):(TbCom.process("User","buildLoginFrame",null,null,null,"too_reply"),!1)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:294}),e}})},_fastReply:function(t){var e=t.parents(".j_lzl_s_p"),i=e.getData(),l="\u56DE\u590D&nbsp;"+i.user_name+"&nbsp;:";LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid?LzlEditor._s_p._se&&(LzlEditor._s_p._se.$body.html(""),LzlEditor._show(),LzlEditor._s_p._se.execCommand("inserthtml",l)):(LzlEditor.init(this),LzlEditor._s_p._se&&LzlEditor._s_p._se.execCommand("inserthtml",l)),LzlEditor._s_p._setData(i)},_turnPage:function(t,e,i){var l=new Date;l=l.getTime(),$.ajax({url:"/p/comment",data:{tid:PageData.thread.thread_id,pid:t.mainData.pid,pn:e,t:l},dataType:"html",success:function(e){t._ajaxSucc(e,i),$.tb.location.setHash("noExistHash"),$.tb.location.setHash(t.mainData.pid+"l")},error:function(e){t._ajaxErr(e)}})},_ajaxSucc:function(t,e){var i=this;if(t&&t.length>200){var l=$(t);l.find(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)}),l.find(".voice_player_desc").remove(),this.mainDom.find("ul.j_lzl_m_w").html(l),i._showLzlJubao(e),this._admin.loadLzlAdmin(e),l.find(".lzl_cnt").each(function(){var t=$(this),e=t.getData().iconArr,l=t.getData().free_flag,o=e?i.icons.getPreIconHtml(e,l):"";t.prepend(o)}),$.browser.msie&&$.browser.version<=7&&this.postJdom.tbattr("class",$.tb.unescapeHTML(this.postJdom.tbattr("class")))}else{var o='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="//tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u670D\u52A1\u5668\u5F88\u5FD9</td></tr></tbody></table>\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u7A0D\u540E\u518D\u8BD5</div>',a=$.dialog.alert(o,{width:410,height:95,title:"\u9519\u8BEF\u63D0\u793A"});a.bind("onclose",function(){return!0})}},_ajaxErr:function(){var t='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="//tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u670D\u52A1\u5668\u5F88\u5FD9</td></tr></tbody></table>\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u7A0D\u540E\u518D\u8BD5</div>',e=$.dialog.alert(t,{width:410,height:95,title:"\u9519\u8BEF\u63D0\u793A"});e.bind("onclose",function(){return!0})}}});
;var LzlEditor={_lzl:null,default_options:{autoFocus:!0,autoEnable:!0,height:"40px",width:"527px",maxHeight:"40",wrapperClassName:"lzl_simple_wrapper",enableRefer:!0},options:{},cur_sec:null,cur_optdom:{},_s_p:null,init:function(i,l){LzlEditor.options={},$.extend(LzlEditor.options,LzlEditor.default_options),l&&$.extend(LzlEditor.options,l),LzlEditor._buildEditor(i)},_buildEditor:function(i){if(LzlEditor._lzl){if(LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid)return LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),LzlEditor.cur_sec.show(),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),!1;var l=LzlEditor.cur_sec;l.find("span.close").click();var t=l.find(".tb-editor-editarea");t[0]&&t.html().length>0&&l.bindData({txt:t.html()}),LzlEditor._hide(),LzlEditor.cur_sec.empty(),LzlEditor._s_p=null;var o=LzlEditor._lzl.mainDom.find("li.j_lzl_s_p");0==o.length&&(LzlEditor._lzl.tailDom.find(".lzl_link_fold").hide(),LzlEditor._lzl.tailDom.find(".lzl_link_unfold").show(),LzlEditor._lzl.mainDom.hide())}LzlEditor._lzl=i,$.extend(LzlEditor._lzl,LzlEditor.cur_optdom);var l=i.jdom.find("div.j_lzl_e_c"),e=PageData.thread.topic;LzlEditor.cur_sec=l;var r=$.extend({container:l[0],uid:PageData.user.user_id},LzlEditor.options);LzlEditor._lzl._reach_limit=LzlEditor._limitCheck()||LzlEditor._lzl._reach_limit?!0:!1;var d={_can_post:PageData.power.can_post,_forum_type:PageData.forum_type,_no_un:PageData.user.no_un,_is_block:PageData.user.forbidden.isForbid?!0:!1,_reach_limit:LzlEditor._lzl._reach_limit,_login:PageData.user.is_login,_thread_topic_type:e.is_topic?"1":"0",_thread_topic_subtype:e.is_topic&&"2"==e.topic_type?"3":"0",data:LzlEditor._lzl.mainData,tpl_id:"j_simpleeditor_tpl"};_.Module.use("common/widget/SimplePoster",{op:d,edOp:r},function(i){i.bind("toTop",function(){$(window).scrollTop(0)},!0),i.bind("onsuccess",function(){LzlPostor._appendNew()},!0),i.bind("onclose",function(){LzlEditor._lzl._updateReplyNum(2e4),LzlEditor._lzl._reach_limit=!0,LzlEditor.init(LzlEditor._lzl)},!0),i.bind("hide",function(){LzlEditor._hide()},!0),LzlEditor._s_p=i});var n=l.getData();if(null!=n){var t=l.find(".tb-editor-editarea");t.html(n.txt)}LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),l.show(),l.parent().find("input.j_lzl_e_f_h").show().focus().hide()},_limitCheck:function(){var i=!1,l=LzlEditor._lzl.jdom.find("li.j_lzl_l_p");if(0==l.length)return i;var t=l.getData();return t.total_num>=2e4&&(i=!0),i},_hide:function(){LzlEditor.cur_sec&&(LzlEditor.cur_sec.find("span.close").click(),LzlEditor.cur_sec.hide()),LzlEditor._lzl&&LzlEditor._lzl.editor_entry&&LzlEditor._lzl.editor_entry.show()},_show:function(){LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),LzlEditor.cur_sec&&LzlEditor.cur_sec.show()}};
;var LzlPostor={_appendNew:function(){var e=LzlEditor._lzl.jdom.find("ul.j_lzl_m_w");if(0==e.length){var a=LzlEditor._lzl.jdom.find("div.j_lzl_c_b_a");a.prepend($('<div class="lzl_big_splitline"></div>')),e=$('<ul class="j_lzl_m_w"></ul>'),a.prepend(e)}e.show();var t=$('<li class="lzl_single_post j_lzl_s_p"></li>');t.bindData({user_name:PageData.user.user_name});var s=$.tb.dataField({un:PageData.user.user_name}),l=' username="'+PageData.user.user_name+'"'+s,i="/home/main/?un="+encodeURIComponent(PageData.user.user_name)+"&fr=pb&ie=utf-8",r="https:"===$.tb.location.getProtocol()?"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/":"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/",n="";n+='<div class="lzl_p_p">',n+='  <a class="j_user_card" href="'+i+'" '+l+'><img src="'+r+PageData.user.portrait+'" style="visibility:hidden;" onload="Page.resizePic(this, 32, 32, true);"/></a>',n+="</div>",n+='<div class="lzl_cnt">',_.Module.use("user/widget/Icons",null,function(e){n+=e.getPreIconHtml(window.PageData.user.mParr_props,window.PageData.user)}),n+='  <a class="at j_user_card" href="'+i+'" '+l+">"+(PageData.user.profession_manager_nick_name||("1"==PageData.user.is_verify?PageData.user.user_nickname:PageData.user.user_name))+"</a>",n+="1"==PageData.user.is_verify||0!==PageData.user.user_type?'<img style="vertical-align: middle;margin-top: -3px;" src="//tb2.bdstatic.com/tb/img/itieba_vip.gif" title="\u8D34\u5427\u5B98\u65B9\u8BA4\u8BC1" width="11" height="18" class="verified_icon">':"",n+='   :<span class="lzl_content_main">',n+=LzlEditor._s_p._getHtml(),n+="    </span>",n+='  <div class="lzl_content_reply">',n+='    <span class="lzl_time">'+LzlPostor.getCurrentTime()+"</span>",n+='    <a href="#" class="lzl_s_r">\u56DE\u590D</a>',n+="  </div>",n+="</div>",t.html(n),t.insertBefore(e.find("li.j_lzl_l_p")),LzlEditor._lzl._updateReplyNum()},getCurrentTime:function(){function e(e){return 10>1*e?"0"+e:e}var a=new Date,t="";return t+=a.getFullYear()+"-",t+=a.getMonth()+1+"-",t+=a.getDate()+"&nbsp;",t+=e(a.getHours())+":",t+=e(a.getMinutes())}},AntiAnswerLzl,CaptchaLzl;
;_.Module.define({path:"pb/widget/sub_list/subListTotal",requires:["user/widget/pbUserBase","user/widget/Icons","common/component/JsPager","props/component/PropsApi"],sub:{initial:function(e){try{this._searchCid=e.searchCid,this._commentList=e.commentData.comment_list,this._userList=e.commentData.user_list,this._icons=this.requireInstance("user/widget/Icons"),this._user=this.requireInstance("user/widget/pbUserBase"),this.propsapi=this.requireInstance("props/component/PropsApi",[{props_type:"1"}])}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/sub_list/sub_list_total.js",method:"",ln:26}),t}},showLzlPost:function(e){var t=this,s=$(e),a=s.closest(".j_l_post").getData().content;0==a.comment_num&&s.hide(),s.bindData({pid:a.post_id,floor_num:a.post_no,total_num:a.comment_num}).html(t._getSubContent(a)).css("minHeight",0);var n=a,i=this.propsapi.showUIHtml({props:n.props||{},post_id:n.post_id});s.closest(".j_lzl_wrapper").find(".props_appraise_wrap").html(i),s.closest(".j_lzl_wrapper").find(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)})},_getSubContent:function(e){var t=e.comment_num>0?"":"none";e.page={total_page:Math.floor((e.comment_num-1)/10)+1,cur_page:1};var s=['<div class="core_reply_border_top"></div>','<div class="j_lzl_c_b_a core_reply_content">','<ul class="j_lzl_m_w" style="display:'+t+'">',this._getSubPostList(e),"</ul>",'<div class="lzl_editor_container j_lzl_e_c lzl_editor_container_s" style="display:none;"></div>','<input type="text" class="j_lzl_e_f_h" style="display:none;" />',"</div>",'<div class="core_reply_border_bottom"></div>'].join("");return s},_getSubPostList:function(e){for(var t,s,a="",n=this._commentList[e.post_id],i="",l="",_=n&&n.comment_info?n.comment_info:[],r=0;r<_.length;r++)t=_[r],s=this._userList[t.user_id]||{},5==r&&(l="lzl_hidden_"+e.post_index,i+='<ul class="lzl_post_hidden" id="'+l+'">',a=!0),s.nickname=s.is_verify||s.is_official?s.nickname:s.user_name,t.content=this._analyTopic(t.content),i+=['<li class="lzl_single_post j_lzl_s_p '+(0==r?"first_no_border":"")+"\" data-field=\"{'pid':'"+e.post_id+"','spid':'"+t.comment_id+"','user_name':'"+s.user_name+"','portrait':'"+s.portrait+"'}\" >",this._user.face_link(s),'<div class="lzl_cnt">',this._icons.getPreIconHtml(s.mParr_props,s),this._user.name_link(s),"1"==s.is_verify||"1"==s.is_official||0!==s.user_type?'<img style="vertical-align: middle;margin-top: -3px;" src="//tb2.bdstatic.com/tb/img/itieba_vip.gif" title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" width="11" height="18" class="verified_icon" />':"",':&nbsp;<span class="lzl_content_main">',this._searchCid==t.comment_id?"<b>"+t.content+"</b>":t.content,this._getVoiceHtml(t),"</span>",this._getReplyHtml(t,s),"</div>","</li>"].join("");return i+=a?"</ul>":"",i+=this._getLzlPager(e,l),delete this._commentList[e.post_id],i},_getLzlPager:function(e,t){var s='<li class="lzl_li_pager j_lzl_l_p lzl_li_pager_s" data-field="{total_num:'+e.comment_num+",total_page:"+e.page.total_page+'}" >';return s+='<a class="j_lzl_p btn-sub btn-small pull-right" href="##"><i class="icon-reply"></i>\u6211\u4E5F\u8BF4\u4E00\u53E5</a>',e.comment_num>5?(s+='<p class="lzl_more">',s+="<span>\u8FD8\u6709"+(e.comment_num-5)+"\u6761\u56DE\u590D\uFF0C</span>",s+='<a href="#" class="j_lzl_m" lzlid="'+(t?t:"")+'">\u70B9\u51FB\u67E5\u770B</a>',s+="</p>",s+='<p class="j_pager l_pager pager_theme_2 lzl_pager" style="display:none">',e.comment_num>10?(this._pager=this.requireInstance("common/component/JsPager",[{current:1,total:e.page.total_page,mode:1,url:"#",isHtml:!0,classname:{current:"tP"}}]),s+=this._pager._render()):s+="&nbsp",s+="</p>"):s+="<p>&nbsp;</p>",s+="</li>"},_getForbiddenTip:function(e){var t="";return e.exist_forbidden_tip&&(t='<p class="lzl_thread_forbidden_tip j_lzl_thread_forbidden_tip" >\u672C\u697C\u5305\u542B\u90E8\u5206\u5E7F\u544A\u7B49\u8FDD\u89C4\u5185\u5BB9\u7684\u56DE\u590D\uFF0C\u5DF2\u7ECF\u88AB\u5C4F\u853D\uFF0C\u6682\u4E0D\u53EF\u89C1\u3002<span class="lzl_forbidden_tip_close j_lzl_forbidden_tip_close">x</span></p>'),t},_getVoiceHtml:function(e){var t,s,a="";return e.ptype&&(t=e.during_time?Math.floor(e.during_time/60):"0",s=e.during_time?e.during_time%60:"0",a=['<br/><div class="voice_player voice_player_mini voice_player_lzl">','<a href="#" class="voice_player_inner">','<span class="before">&nbsp;</span><span class="middle"><span class="speaker speaker_animate">&nbsp;</span>','<span class="time">',t>0?'<span class="minute">'+t+"</span>&#039;":"",s>0||t>0?'<span class="second">'+s+"</span>&quot;":"","</span>","</span>",'<span class="after">&nbsp;</span>',"</a>","</div>"].join("")),a},_getReplyHtml:function(e,t){var s="",a=PageData.power,n=PageData.user;return s+='<div class="lzl_content_reply"><span class="lzl_jb"  style="display:none">',a.can_mask_delete||a.lz_del||(s+=t.user_name==n.user_name?"<a href=\"#\" data-field=\"{'delete_mine':'1','user_name':'"+t.user_name+'\'}" class="lzl_jb_in" >\u5220\u9664</a>&nbsp;|':"<a href=\"#\" data-field=\"{'delete_mine':'0','user_name':'"+t.user_name+'\'}" class="lzl_jb_in" >'+(a.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5")+"</a>&nbsp;|&nbsp;"),s+='</span><span class="lzl_op_list j_lzl_o_l">',s+=this._loadLzlAdmin(t,a,n),s+='</span><span class="lzl_time">'+this._getTime(e.now_time)+'</span><a href="#" class="lzl_s_r">\u56DE\u590D</a>',s+="</div>"},_loadLzlAdmin:function(e,t,s){var a="",n="&nbsp;|&nbsp;";return(t.can_filter_ip||t.can_filter_id)&&(a+='<a href="#" class="j_lzl_ban">\u5C01</a>'+n),0===e.is_mute?(a+='<a href="#" class="lzl-cancel-forbid-speech" style="display:none;">\u89E3\u7981</a>',a+='<a href="#" class="lzl-forbid-speech">\u7981\u8A00</a>'+n):1===e.is_mute&&(a+='<a href="#" class="lzl-cancel-forbid-speech">\u89E3\u7981</a>',a+='<a href="#" class="lzl-forbid-speech" style="display:none;">\u7981\u8A00</a>'+n),(t.can_mask_delete||t.lz_del&&!s.forbidden.isForbid&&!s.is_black)&&(a+='<a href="#" class="j_lzl_del">\u5220\u9664</a>'+n),t.can_super&&(a+='<a href="/f?ct=503316480&cm=6000&tn=bdUserManager&un="'+e.user_name+' class="j_lzl_manage p_tieba_manage" target="_blank">\u8D34\u5427\u7BA1\u7406</a>'+n),a},_getTime:function(e){function t(e){return 10>1*e?"0"+e:e}var s;s=void 0==e?new Date:new Date(1e3*e);var a="";return a+=s.getFullYear()+"-",a+=s.getMonth()+1+"-",a+=s.getDate()+"&nbsp;",a+=t(s.getHours())+":",a+=t(s.getMinutes())},_analyTopic:function(e){var t=this;return e=e.replace(/&#039;/g,"'"),e=e.replace(/&#39;/g,"'"),e=e.replace(/&nbsp;/g," "),e=e.replace(/#([^#]+)#/g,function(e,s){if(t._matchTag(s)||s.length>30)return e;s=s.replace(/\'/g,"&#039;");var a=encodeURIComponent(s),n='<a class="topic-tag" target="_blank" href="/hottopic/browse/hottopic?topic_name='+a+'">'+e+"</a>";return n})},_matchTag:function(e){return/<a|<div|<span|<img|\[url/.test(e)}}});_.Module.define({path:"encourage/widget/forbid_speech_banner",sub:{initial:function(){}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"user/widget/icon_tip",requires:["common/widget/Tdou/TdouViewPay","common/widget/Card"],sub:{_icon_tip:null,_icon_tip_ajax:null,_dialog:null,_iconData:{},_option:{width:300},initial:function(t){this.pageType=t.pageType,this.myIcons=t.myIcons,this.bindEvents()},bindEvents:function(){var t=this,i=$("body");i.find(".j_icon_slot").on("mouseenter",function(){t._icon_tip&&t._icon_tip.closeCard(),t.buildCard($(this))}).on("mouseleave",function(){t._icon_tip&&t._icon_tip.closeCard({type:"delayClose",time:200}),t._icon_tip=null}),i.on("click",".j_buy_icon_btn",function(i){i.preventDefault(),t.getOneIcon(t._iconData)}).on("click",".j_manage_icon_btn",function(i){i.preventDefault(),t.jumpToIhome()})},buildCard:function(t){var i=this;i._icon_tip&&(i._icon_tip.closeCard(),i._icon_tip=null);var n=t.getData();this._iconData=n;var e,a,o,r,c,l,_=_||1,s=50,p="//tb1.bdstatic.com/tb/cms/com/icon/";if(n.sprite){if(e=n.sprite[n.value],!e)for(var u in n.sprite)if(n.sprite[u]&&(0!=n.value||"meizhi_level"==n.name)){e=n.sprite[u];break}a=e.split(","),o=a[0],r=a[1],l=p+n.category_id+"_36.png?stamp="+o,c='style="background: url('+l+") no-repeat -"+r*s+"px  -"+(_-1)*s+'px;"'}else c=t.css("background");var d=this.getIconTipHtml(n);if(!d)return!1;null==n.title&&(n.title=t.tbattr("title"));var g=['<div class="icon_tip_wrapper">','<div class="icon_tip_img" '+c+" />",'<div class="icon_tip_info">','<div class="icon_tip_title">'+n.title+(d.expired?d.expired:"")+"</div>",'<div class="icon_tip_intro">'+d.intro+"</div>",'<div class="icon_tip_btns">',d.btn,"</div>","</div>","</div>"].join(""),f={content:g,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:t,attr:"id='icon_tip'",wrap:$("body")};i._icon_tip=i.requireInstance("common/widget/Card",f),i._icon_tip.showCard({type:"delayShow",time:200})},redirect:function(t,i,n){t=t||{},t.from=i,t.chargeType="platform";var e=this;e.payment=e.requireInstance("common/widget/Tdou/TdouViewPay",function(t){"encourage_paid"===t.command&&"success"===$.getPageData("data.error","error",t)&&n(t)}),e.payment.createMain(t)},getOneIcon:function(t){var i=this,n=t.name;if(n){var e=$.dialog.confirm("\u786E\u5B9A\u8D2D\u4E70\u3010"+t.title+"\u3011\u5370\u8BB0\u561B\uFF1F\u5C06\u6D88\u8017\u60A8"+t.price+"T\u8C46",{title:"\u8D2D\u4E70\u5370\u8BB0\u63D0\u793A",acceptValue:"\u786E\u5B9A",cancelValue:"\u53D6\u6D88"});e.bind("onaccept",function(t){t.stopImmediatePropagation();var e={ie:"utf-8"};e.tbs=PageData.tbs,e.icon_name=n,e.level=1,i._icon_tip_ajax&&i._icon_tip_ajax.abort(),i._icon_tip_ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:e,dataType:"json"}).then(function(t){t&&0===t.no?i.redirect(t.data,"\u5370\u8BB0\u4E2D\u5FC3TIP",function(){i.showDialog("\u8D2D\u4E70\u6210\u529F"),$.tb.location.reload()}):t&&2270028===t.no?i.showDialog("T\u8C46\u4E0D\u8DB3"):i.showDialog("\u8D2D\u4E70\u51FA\u9519\uFF0C\u6CA1\u6709\u8D2D\u4E70\u6210\u529F")},function(){i.showDialog("\u7F51\u7EDC\u9519\u8BEF, \u8BF7\u7A0D\u5019\u518D\u8BD5")})})}},getIconTipHtml:function(t){if(null==t.intro||null==t.intro_url)return!1;if(this.whetherIHaveTheIcon(t,this.myIcons))return{intro:"<p>"+t.intro+' <a target="_blank" href="'+t.intro_url+'">\u8BE6\u60C5\u300B</a></p>',btn:'<a class="btn_default btn_small j_manage_icon_btn " href="" target="_blank" >\u7BA1\u7406\u5370\u8BB0</a>'};if(null!=t.price&&0!=t.price){var i='<p>\u4EF7\u683C:<i class="icon_tbean" style="vertical-align:middle;"></i><span class="orange_text " >'+t.price+'</span> <a target="_blank" href="'+t.intro_url+'">\u8BE6\u60C5\u300B</a></p>';return{intro:i,btn:'<a class="btn_default btn_small j_buy_icon_btn"  >\u8D2D\u4E70\u5370\u8BB0</a>'}}return{intro:"<p>"+t.intro+' <a target="_blank" href="'+t.intro_url+'">\u8BE6\u60C5\u300B</a></p>',btn:'<a class="btn_default btn_small" target="_blank" href="'+t.intro_url+'" >\u83B7\u53D6\u5370\u8BB0</a>'}},jumpToIhome:function(){var t=$(".userinfo_honor"),i=t.find(".j_icon_slot");$.tb.location.getHref().match("/home/")&&t&&i?i.first().trigger("click"):window.open("/home/main?id="+PageData.user.portrait+"&fr=icon_tip#manage_icon")},whetherIHaveTheIcon:function(t,i){var n,e;for(e in i)if(n=i[e],t.name==n)return!0;return!1},showDialog:function(t){this._dialog&&this._dialog.close(),this._dialog=null,this._dialog=new $.dialog({title:"\u5370\u8BB0\u63D0\u793A",html:t})},formateDate:function(t){var i=new Date(1e3*parseInt(t));return i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"common/widget/tbcopy/ZeroClipboard",sub:{get:function(){return this.ZeroClipboard},getClient:function(e){return new this.ZeroClipboard(e)},initial:function(){var e=this;!function(t,n){"use strict";var r,a=t,i=a.document,o=a.navigator,l=a.setTimeout,s=a.Number.parseInt||a.parseInt,u=a.Number.parseFloat||a.parseFloat,c=a.Number.isNaN||a.isNaN,f=a.encodeURIComponent,p=a.Math,d=a.Date,h=a.ActiveXObject,y=a.Array.prototype.slice,v=a.Object.keys,g=a.Object.prototype.hasOwnProperty,m=function(){return"function"==typeof a.Object.defineProperty&&function(){try{var e={};return a.Object.defineProperty(e,"y",{value:"z"}),"z"===e.y}catch(t){return!1}}()?a.Object.defineProperty:void 0}(),b=function(e){return y.call(e,0)},w=function(e,t,n){if("function"==typeof t.indexOf)return t.indexOf(e,n);var r,a=t.length;for("undefined"==typeof n?n=0:0>n&&(n=a+n),r=n;a>r;r++)if(g.call(t,r)&&t[r]===e)return r;return-1},C=function(){var e,t,r,a,i,o,l=b(arguments),s=l[0]||{};for(e=1,t=l.length;t>e;e++)if(null!=(r=l[e]))for(a in r)if(g.call(r,a)){if(i=s[a],o=r[a],s===o)continue;o!==n&&(s[a]=o)}return s},x=function(e){var t,n,r,a;if("object"!=typeof e||null==e)t=e;else if("number"==typeof e.length)for(t=[],n=0,r=e.length;r>n;n++)g.call(e,n)&&(t[n]=x(e[n]));else{t={};for(a in e)g.call(e,a)&&(t[a]=x(e[a]))}return t},E=function(e,t){for(var n={},r=0,a=t.length;a>r;r++)t[r]in e&&(n[t[r]]=e[t[r]]);return n},T=function(e,t){var n={};for(var r in e)-1===w(r,t)&&(n[r]=e[r]);return n},j=function(e){if(null==e)return[];if(v)return v(e);var t=[];for(var n in e)g.call(e,n)&&t.push(n);return t},D=function(e){if(e)for(var t in e)g.call(e,t)&&delete e[t];return e},I=function(e,t){t in e&&"function"==typeof m&&m(e,t,{value:e[t],writable:!1,configurable:!0,enumerable:!0})},k=function(e){return function(){var t;return t=e.now?e.now():(new e).getTime()}}(d),O={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,deactivated:null,overdue:null,ready:null},N="11.0.0",L={},z={},_=null,S={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}},F=(function(){var e,t,n,r,a="ZeroClipboard.swf";if(!i.currentScript||!(r=i.currentScript.src)){var o=i.getElementsByTagName("script");if("readyState"in o[0])for(e=o.length;e--&&("interactive"!==o[e].readyState||!(r=o[e].src)););else if("loading"===i.readyState)r=o[o.length-1].src;else{for(e=o.length;e--;){if(n=o[e].src,!n){t=null;break}if(n=n.split("#")[0].split("?")[0],n=n.slice(0,n.lastIndexOf("/")+1),null==t)t=n;else if(t!==n){t=null;break}}null!==t&&(r=t)}}return r&&(r=r.split("#")[0].split("?")[0],a=r.slice(0,r.lastIndexOf("/")+1)+a),a}(),{swfPath:"//tb2.bdstatic.com/tb/static-common/widget/tbcopy/ZCB_8fd7d9f.swf",trustedDomains:t.location.host?[t.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999}),X=function(e){if("object"==typeof e&&null!==e)for(var t in e)if(g.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))F[t]=e[t];else if(null==O.bridge)if("containerId"===t||"swfObjectId"===t){if(!G(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");F[t]=e[t]}else F[t]=e[t];{if("string"!=typeof e||!e)return x(F);if(g.call(F,e))return F[e]}},A=function(){return{browser:E(o,["userAgent","platform","appName"]),flash:T(O,["bridge"]),zeroclipboard:{version:jt.version,config:jt.config()}}},Y=function(){return!!(O.disabled||O.outdated||O.unavailable||O.deactivated)},$=function(e,t){var n,r,a,i={};if("string"==typeof e&&e)a=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&jt.on(n,e[n]);if(a&&a.length){for(n=0,r=a.length;r>n;n++)e=a[n].replace(/^on/,""),i[e]=!0,L[e]||(L[e]=[]),L[e].push(t);if(i.ready&&O.ready&&jt.emit({type:"ready"}),i.error){var o=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=o.length;r>n;n++)if(O[o[n]]===!0){jt.emit({type:"error",name:"flash-"+o[n]});break}}}return jt},B=function(e,t){var n,r,a,i,o;if(0===arguments.length)i=j(L);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&jt.off(n,e[n]);if(i&&i.length)for(n=0,r=i.length;r>n;n++)if(e=i[n].toLowerCase().replace(/^on/,""),o=L[e],o&&o.length)if(t)for(a=w(t,o);-1!==a;)o.splice(a,1),a=w(t,o,a);else o.length=0;return jt},M=function(e){var t;return t="string"==typeof e&&e?x(L[e])||null:x(L)},H=function(e){var t,n,r;return e=J(e),e&&!nt(e)?"ready"===e.type&&O.overdue===!0?jt.emit({type:"error",name:"flash-overdue"}):(t=C({},e),tt.call(this,t),"copy"===e.type&&(r=st(z),n=r.data,_=r.formatMap),n):void 0},P=function(){if("boolean"!=typeof O.ready&&(O.ready=!1),!jt.isFlashUnusable()&&null===O.bridge){var e=F.flashLoadTimeout;"number"==typeof e&&e>=0&&l(function(){"boolean"!=typeof O.deactivated&&(O.deactivated=!0),O.deactivated===!0&&jt.emit({type:"error",name:"flash-deactivated"})},e),O.overdue=!1,ot()}},Z=function(){jt.clearData(),jt.deactivate(),jt.emit("destroy"),lt(),jt.off()},R=function(e,t){var n;if("object"==typeof e&&e&&"undefined"==typeof t)n=e,jt.clearData();else{if("string"!=typeof e||!e)return;n={},n[e]=t}for(var r in n)"string"==typeof r&&r&&g.call(n,r)&&"string"==typeof n[r]&&n[r]&&(z[r]=n[r])},V=function(e){"undefined"==typeof e?(D(z),_=null):"string"==typeof e&&g.call(z,e)&&delete z[e]},K=function(e){if(e&&1===e.nodeType){r&&(vt(r,F.activeClass),r!==e&&vt(r,F.hoverClass)),r=e,yt(e,F.hoverClass);var t=e.getAttribute("title")||F.title;if("string"==typeof t&&t){var n=it(O.bridge);n&&n.setAttribute("title",t)}var a=F.forceHandCursor===!0||"pointer"===mt(e,"cursor");xt(a),Ct()}},U=function(){var e=it(O.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.top="1px"),r&&(vt(r,F.hoverClass),vt(r,F.activeClass),r=null)},G=function(e){return"string"==typeof e&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},J=function(e){var t;if("string"==typeof e&&e?(t=e,e={}):"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(t=e.type),t){C(e,{type:t.toLowerCase(),target:e.target||r||null,relatedTarget:e.relatedTarget||null,currentTarget:O&&O.bridge||null,timeStamp:e.timeStamp||k()||null});var n=S[e.type];return"error"===e.type&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),"ready"===e.type&&C(e,{target:null,version:O.version}),"error"===e.type&&(/^flash-(disabled|outdated|unavailable|deactivated|overdue)$/.test(e.name)&&C(e,{target:null,minimumVersion:N}),/^flash-(outdated|unavailable|deactivated|overdue)$/.test(e.name)&&C(e,{version:O.version})),"copy"===e.type&&(e.clipboardData={setData:jt.setData,clearData:jt.clearData}),"aftercopy"===e.type&&(e=ut(e,_)),e.target&&!e.relatedTarget&&(e.relatedTarget=W(e.target)),e=q(e)}},W=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?i.getElementById(t):null},q=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var t=e.target,r="_mouseover"===e.type&&e.relatedTarget?e.relatedTarget:n,o="_mouseout"===e.type&&e.relatedTarget?e.relatedTarget:n,l=wt(t),s=a.screenLeft||a.screenX||0,u=a.screenTop||a.screenY||0,c=i.body.scrollLeft+i.documentElement.scrollLeft,f=i.body.scrollTop+i.documentElement.scrollTop,p=l.left+("number"==typeof e._stageX?e._stageX:0),d=l.top+("number"==typeof e._stageY?e._stageY:0),h=p-c,y=d-f,v=s+h,g=u+y,m="number"==typeof e.movementX?e.movementX:0,b="number"==typeof e.movementY?e.movementY:0;delete e._stageX,delete e._stageY,C(e,{srcElement:t,fromElement:r,toElement:o,screenX:v,screenY:g,pageX:p,pageY:d,clientX:h,clientY:y,x:h,y:y,movementX:m,movementY:b,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},Q=function(e){var t=e&&"string"==typeof e.type&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},et=function(e,t,n,r){r?l(function(){e.apply(t,n)},0):e.apply(t,n)},tt=function(e){if("object"==typeof e&&e&&e.type){var t=Q(e),n=L["*"]||[],r=L[e.type]||[],i=n.concat(r);if(i&&i.length){var o,l,s,u,c,f=this;for(o=0,l=i.length;l>o;o++)s=i[o],u=f,"string"==typeof s&&"function"==typeof a[s]&&(s=a[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(u=s,s=s.handleEvent),"function"==typeof s&&(c=C({},e),et(s,u,[c],t))}return this}},nt=function(e){var t=e.target||r||null,n="swf"===e._source;switch(delete e._source,e.type){case"error":w(e.name,["flash-disabled","flash-outdated","flash-deactivated","flash-overdue"])&&C(O,{disabled:"flash-disabled"===e.name,outdated:"flash-outdated"===e.name,unavailable:"flash-unavailable"===e.name,deactivated:"flash-deactivated"===e.name,overdue:"flash-overdue"===e.name,ready:!1});break;case"ready":var a=O.deactivated===!0;C(O,{disabled:!1,outdated:!1,unavailable:!1,deactivated:!1,overdue:a,ready:!a});break;case"copy":var i,o,l=e.relatedTarget;!z["text/html"]&&!z["text/plain"]&&l&&(o=l.value||l.outerHTML||l.innerHTML)&&(i=l.value||l.textContent||l.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",i),o!==i&&e.clipboardData.setData("text/html",o)):!z["text/plain"]&&e.target&&(i=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",i));break;case"aftercopy":jt.clearData(),t&&t!==ht()&&t.focus&&t.focus();break;case"_mouseover":jt.activate(t),F.bubbleEvents===!0&&n&&(rt(C({},e,{type:"mouseover"})),rt(C({},e,{type:"mouseenter",bubbles:!1})));break;case"_mouseout":jt.deactivate(),F.bubbleEvents===!0&&n&&(rt(C({},e,{type:"mouseout"})),rt(C({},e,{type:"mouseleave",bubbles:!1})));break;case"_mousedown":yt(t,F.activeClass),F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}));break;case"_mouseup":vt(t,F.activeClass),F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}));break;case"_click":case"_mousemove":F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)?!0:void 0},rt=function(e){if(e&&"string"==typeof e.type&&e){var t,n=e.target||e.srcElement||null,r=n&&n.ownerDocument||i,o={view:r.defaultView||a,canBubble:!0,cancelable:!0,detail:"click"===e.type?1:0,button:"number"==typeof e.which?e.which-1:"number"==typeof e.button?e.button:r.createEvent?0:1},l=C(o,e);n&&(r.createEvent&&n.dispatchEvent?(l=[l.type,l.canBubble,l.cancelable,l.view,l.detail,l.screenX,l.screenY,l.clientX,l.clientY,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.button,l.relatedTarget],t=r.createEvent("MouseEvents"),t.initMouseEvent&&(t.initMouseEvent.apply(t,l),n.dispatchEvent(t))):r.createEventObject&&n.fireEvent&&(t=r.createEventObject(l),n.fireEvent("on"+l.type,t)))}},at=function(){var e=i.createElement("div");return e.id=F.containerId,e.className=F.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+Et(F.zIndex),e},it=function(e){for(var t=e&&e.parentNode;t&&"OBJECT"===t.nodeName&&t.parentNode;)t=t.parentNode;return t||null},ot=function(){var e,t=O.bridge,n=it(t);if(!t){var r=dt(a.location.host,F),o="never"===r?"none":"all",l=ft(F),s=F.swfPath+ct(F.swfPath,F);n=at();var u=i.createElement("div");n.appendChild(u),i.body.appendChild(n);var c=i.createElement("div"),f="activex"===O.pluginType;c.innerHTML='<object id="'+F.swfObjectId+'" name="'+F.swfObjectId+'" width="100%" height="100%" '+(f?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+s+'"')+">"+(f?'<param name="movie" value="'+s+'"/>':"")+'<param name="allowScriptAccess" value="'+r+'"/><param name="allowNetworking" value="'+o+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+l+'"/></object>',t=c.firstChild,c=null,t.ZeroClipboard=jt,n.replaceChild(t,u)}return t||(t=i[F.swfObjectId],t&&(e=t.length)&&(t=t[e-1]),!t&&n&&(t=n.firstChild)),O.bridge=t||null,t},lt=function(){var e=O.bridge;if(e){var t=it(e);t&&("activex"===O.pluginType&&"readyState"in e?(e.style.display="none",function n(){if(4===e.readyState){for(var r in e)"function"==typeof e[r]&&(e[r]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else l(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),O.ready=null,O.bridge=null,O.deactivated=null}},st=function(e){var t={},n={};if("object"==typeof e&&e){for(var r in e)if(r&&g.call(e,r)&&"string"==typeof e[r]&&e[r])switch(r.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[r],n.text=r;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[r],n.html=r;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[r],n.rtf=r}return{data:t,formatMap:n}}},ut=function(e,t){if("object"!=typeof e||!e||"object"!=typeof t||!t)return e;var n={};for(var r in e)if(g.call(e,r)){if("success"!==r&&"data"!==r){n[r]=e[r];continue}n[r]={};var a=e[r];for(var i in a)i&&g.call(a,i)&&g.call(t,i)&&(n[r][t[i]]=a[i])}return n},ct=function(e,t){var n=null==t||t&&t.cacheBust===!0;return n?(-1===e.indexOf("?")?"?":"&")+"noCache="+k():""},ft=function(e){var t,n,r,i,o="",l=[];if(e.trustedDomains&&("string"==typeof e.trustedDomains?i=[e.trustedDomains]:"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(i=e.trustedDomains)),i&&i.length)for(t=0,n=i.length;n>t;t++)if(g.call(i,t)&&i[t]&&"string"==typeof i[t]){if(r=pt(i[t]),!r)continue;if("*"===r){l=[r];break}l.push.apply(l,[r,"//"+r,a.location.protocol+"//"+r])}return l.length&&(o+="trustedOrigins="+f(l.join(","))),e.forceEnhancedClipboard===!0&&(o+=(o?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof e.swfObjectId&&e.swfObjectId&&(o+=(o?"&":"")+"swfObjectId="+f(e.swfObjectId)),o},pt=function(e){if(null==e||""===e)return null;if(e=e.replace(/^\s+|\s+$/g,""),""===e)return null;var t=e.indexOf("//");e=-1===t?e:e.slice(t+2);var n=e.indexOf("/");return e=-1===n?e:-1===t||0===n?null:e.slice(0,n),e&&".swf"===e.slice(-4).toLowerCase()?null:e||null},dt=function(){var e=function(e,t){var n,r,a;if(null!=e&&"*"!==t[0]&&("string"==typeof e&&(e=[e]),"object"==typeof e&&"number"==typeof e.length))for(n=0,r=e.length;r>n;n++)if(g.call(e,n)&&(a=pt(e[n]))){if("*"===a){t.length=0,t.push("*");break}-1===w(a,t)&&t.push(a)}};return function(t,n){var r=pt(n.swfPath);null===r&&(r=t);var a=[];e(n.trustedOrigins,a),e(n.trustedDomains,a);var i=a.length;if(i>0){if(1===i&&"*"===a[0])return"always";if(-1!==w(t,a))return 1===i&&t===r?"sameDomain":"always"}return"never"}}(),ht=function(){try{return i.activeElement}catch(e){return null}},yt=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&"string"==typeof t){var n=(t||"").split(/\s+/);if(1===e.nodeType)if(e.className){for(var r=" "+e.className+" ",a=e.className,i=0,o=n.length;o>i;i++)r.indexOf(" "+n[i]+" ")<0&&(a+=" "+n[i]);e.className=a.replace(/^\s+|\s+$/g,"")}else e.className=t}return e},vt=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if("string"==typeof t&&t){var n=t.split(/\s+/);if(1===e.nodeType&&e.className){for(var r=(" "+e.className+" ").replace(/[\n\t]/g," "),a=0,i=n.length;i>a;a++)r=r.replace(" "+n[a]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}}return e},gt=function(){var e=/\-([a-z])/g,t=function(e,t){return t.toUpperCase()};return function(n){return n.replace(e,t)}}(),mt=function(e,t){var n,r,i;return a.getComputedStyle?n=a.getComputedStyle(e,null).getPropertyValue(t):(r=gt(t),n=e.currentStyle?e.currentStyle[r]:e.style[r]),"cursor"!==t||n&&"auto"!==n||(i=e.tagName.toLowerCase(),"a"!==i)?n:"pointer"},bt=function(){var e,t,n,r=1;return"function"==typeof i.body.getBoundingClientRect&&(e=i.body.getBoundingClientRect(),t=e.right-e.left,n=i.body.offsetWidth,r=p.round(t/n*100)/100),r},wt=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var n,r,o,l=e.getBoundingClientRect();"pageXOffset"in a&&"pageYOffset"in a?(n=a.pageXOffset,r=a.pageYOffset):(o=bt(),n=p.round(i.documentElement.scrollLeft/o),r=p.round(i.documentElement.scrollTop/o));var s=i.documentElement.clientLeft||0,u=i.documentElement.clientTop||0;t.left=l.left+n-s,t.top=l.top+r-u,t.width="width"in l?l.width:l.right-l.left,t.height="height"in l?l.height:l.bottom-l.top}return t},Ct=function(){var e;if(r&&(e=it(O.bridge))){var t=wt(r);C(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+Et(F.zIndex)})}},xt=function(e){O.ready===!0&&(O.bridge&&"function"==typeof O.bridge.setHandCursor?O.bridge.setHandCursor(e):O.ready=!1)},Et=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return"number"!=typeof e||c(e)?"string"==typeof e&&(t=Et(s(e,10))):t=e,"number"==typeof t?t:"auto"},Tt=function(e){function t(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function n(e){return!!e&&(e=e.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||"chrome.plugin"===e.slice(-13))}function r(e){e&&(s=!0,e.version&&(p=t(e.version)),!p&&e.description&&(p=t(e.description)),e.filename&&(f=n(e.filename)))}var a,i,l,s=!1,c=!1,f=!1,p="";if(o.plugins&&o.plugins.length)a=o.plugins["Shockwave Flash"],r(a),o.plugins["Shockwave Flash 2.0"]&&(s=!0,p="2.0.0.11");else if(o.mimeTypes&&o.mimeTypes.length)l=o.mimeTypes["application/x-shockwave-flash"],a=l&&l.enabledPlugin,r(a);else if("undefined"!=typeof e){c=!0;try{i=new e("ShockwaveFlash.ShockwaveFlash.7"),s=!0,p=t(i.GetVariable("$version"))}catch(d){try{i=new e("ShockwaveFlash.ShockwaveFlash.6"),s=!0,p="6.0.21"}catch(h){try{i=new e("ShockwaveFlash.ShockwaveFlash"),s=!0,p=t(i.GetVariable("$version"))}catch(y){c=!1}}}}O.disabled=s!==!0,O.outdated=p&&u(p)<u(N),O.version=p||"0.0.0",O.pluginType=f?"pepper":c?"activex":s?"netscape":"unknown"};Tt(h);var jt=function(){return this instanceof jt?("function"==typeof jt._createClient&&jt._createClient.apply(this,b(arguments)),void 0):new jt};jt.version="2.0.0",I(jt,"version"),jt.config=function(){return X.apply(this,b(arguments))},jt.state=function(){return A.apply(this,b(arguments))},jt.isFlashUnusable=function(){return Y.apply(this,b(arguments))},jt.on=function(){return $.apply(this,b(arguments))},jt.off=function(){return B.apply(this,b(arguments))},jt.handlers=function(){return M.apply(this,b(arguments))},jt.emit=function(){return H.apply(this,b(arguments))},jt.create=function(){return P.apply(this,b(arguments))},jt.destroy=function(){return Z.apply(this,b(arguments))},jt.setData=function(){return R.apply(this,b(arguments))},jt.clearData=function(){return V.apply(this,b(arguments))},jt.activate=function(){return K.apply(this,b(arguments))},jt.deactivate=function(){return U.apply(this,b(arguments))};var Dt=0,It={},kt=0,Ot={},Nt={};C(F,{autoActivate:!0});var Lt=function(e){var t=this;t.id=""+Dt++,It[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),jt.on("*",function(e){return t.emit(e)}),jt.on("destroy",function(){t.destroy()}),jt.create()},zt=function(e,t){var n,r,a,i={},o=It[this.id]&&It[this.id].handlers;if("string"==typeof e&&e)a=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.on(n,e[n]);if(a&&a.length){for(n=0,r=a.length;r>n;n++)e=a[n].replace(/^on/,""),i[e]=!0,o[e]||(o[e]=[]),o[e].push(t);if(i.ready&&O.ready&&this.emit({type:"ready",client:this}),i.error){var l=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=l.length;r>n;n++)if(O[l[n]]){this.emit({type:"error",name:"flash-"+l[n],client:this});break}}}return this},_t=function(e,t){var n,r,a,i,o,l=It[this.id]&&It[this.id].handlers;if(0===arguments.length)i=j(l);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.off(n,e[n]);if(i&&i.length)for(n=0,r=i.length;r>n;n++)if(e=i[n].toLowerCase().replace(/^on/,""),o=l[e],o&&o.length)if(t)for(a=w(t,o);-1!==a;)o.splice(a,1),a=w(t,o,a);else o.length=0;return this},St=function(e){var t=null,n=It[this.id]&&It[this.id].handlers;return n&&(t="string"==typeof e&&e?n[e]?n[e].slice(0):[]:x(n)),t},Ft=function(e){if(Bt.call(this,e)){"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(e=C({},e));var t=C({},J(e),{client:this});Mt.call(this,t)}return this},Xt=function(e){e=Ht(e);for(var t=0;t<e.length;t++)if(g.call(e,t)&&e[t]&&1===e[t].nodeType){e[t].zcClippingId?-1===w(this.id,Ot[e[t].zcClippingId])&&Ot[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+kt++,Ot[e[t].zcClippingId]=[this.id],F.autoActivate===!0&&Rt(e[t]));var n=It[this.id]&&It[this.id].elements;-1===w(e[t],n)&&n.push(e[t])}return this},At=function(e){var t=It[this.id];if(!t)return this;var n,r=t.elements;e="undefined"==typeof e?r.slice(0):Ht(e);for(var a=e.length;a--;)if(g.call(e,a)&&e[a]&&1===e[a].nodeType){for(n=0;-1!==(n=w(e[a],r,n));)r.splice(n,1);var i=Ot[e[a].zcClippingId];if(i){for(n=0;-1!==(n=w(this.id,i,n));)i.splice(n,1);0===i.length&&(F.autoActivate===!0&&Vt(e[a]),delete e[a].zcClippingId)}}return this},Yt=function(){var e=It[this.id];return e&&e.elements?e.elements.slice(0):[]},$t=function(){this.unclip(),this.off(),delete It[this.id]},Bt=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=It[this.id]&&It[this.id].elements,n=!!t&&t.length>0,r=!e.target||n&&-1!==w(e.target,t),a=e.relatedTarget&&n&&-1!==w(e.relatedTarget,t),i=e.client&&e.client===this;return r||a||i?!0:!1},Mt=function(e){if("object"==typeof e&&e&&e.type){var t=Q(e),n=It[this.id]&&It[this.id].handlers["*"]||[],r=It[this.id]&&It[this.id].handlers[e.type]||[],i=n.concat(r);if(i&&i.length){var o,l,s,u,c,f=this;for(o=0,l=i.length;l>o;o++)s=i[o],u=f,"string"==typeof s&&"function"==typeof a[s]&&(s=a[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(u=s,s=s.handleEvent),"function"==typeof s&&(c=C({},e),et(s,u,[c],t))}return this}},Ht=function(e){return"string"==typeof e&&(e=[]),"number"!=typeof e.length?[e]:e},Pt=function(e,t,n){return e&&1===e.nodeType?(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),e):e},Zt=function(e,t,n){return e&&1===e.nodeType?(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n),e):e},Rt=function(e){if(e&&1===e.nodeType){var t=function(t){(t||a.event)&&jt.activate(e)};Pt(e,"mouseover",t),Nt[e.zcClippingId]={mouseover:t}}},Vt=function(e){if(e&&1===e.nodeType){var t=Nt[e.zcClippingId];"object"==typeof t&&t&&("function"==typeof t.mouseover&&Zt(e,"mouseover",t.mouseover),delete Nt[e.zcClippingId])}};jt._createClient=function(){Lt.apply(this,b(arguments))},jt.prototype.on=function(){return zt.apply(this,b(arguments))},jt.prototype.off=function(){return _t.apply(this,b(arguments))},jt.prototype.handlers=function(){return St.apply(this,b(arguments))},jt.prototype.emit=function(){return Ft.apply(this,b(arguments))},jt.prototype.clip=function(){return Xt.apply(this,b(arguments))},jt.prototype.unclip=function(){return At.apply(this,b(arguments))},jt.prototype.elements=function(){return Yt.apply(this,b(arguments))},jt.prototype.destroy=function(){return $t.apply(this,b(arguments))},jt.prototype.setText=function(e){return jt.setData("text/plain",e),this},jt.prototype.setHtml=function(e){return jt.setData("text/html",e),this},jt.prototype.setRichText=function(e){return jt.setData("application/rtf",e),this},jt.prototype.setData=function(){return jt.setData.apply(this,b(arguments)),this},jt.prototype.clearData=function(){return jt.clearData.apply(this,b(arguments)),this},jt.prototype.getFlashState=function(){return O},"function"==typeof define&&define.amd?define(function(){return jt}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=jt:e.ZeroClipboard=jt}(function(){return this}())}}});
;_.Module.define({path:"common/widget/tbcopy",requires:["common/widget/tbcopy/ZeroClipboard"],sub:{text:"",initial:function(t){var e=$(t.ele),i=t.text,n=this.requireInstance("common/widget/tbcopy/ZeroClipboard"),c=n.get();this.clip=new c(e),this.setText(i)},add:function(t){var e=$(t);return e.length?(this.clip.clip(e),this):!1},remove:function(t){var e=$(t);return"undefined"==typeof t||e.length?(this.clip.unclip(t),this):!1},elements:function(){return $(this.clip.elements())},setText:function(t){var e=this;return this.clip.off("copy"),this.clip.on("copy",function(i){if("function"==typeof t)e.text=t(i);else{if("string"!=typeof t)return!1;e.text=t}i.clipboardData.setData("text/plain",e.text),e.successCallback?e.successCallback():$.dialog.alert("\u590D\u5236\u6210\u529F\uFF01")}),!0},getText:function(){return this.text},getFlashElement:function(){var t=this.clip.getFlashState();return t.bridge},setSuccessCallback:function(t){return this.successCallback=t,!0}}});_.Module.define({path:"common/widget/tbshare",requires:["common/widget/tbshare/tbshare_share","common/widget/tbshare/tbshare_more","common/widget/tbshare/tbshare_all"],sub:{initial:function(e,n){this._addShareComponent(e,n)},_addShareComponent:function(e,n){this.shareInstance=this.requireInstance("common/widget/tbshare/tbshare_share",[n]),this._initMoreInstance(n.moreConfig,n.shareContent);var t=n.moreConfig&&n.moreConfig.position;this._addAllInstanceToContainer(e,t)},_initMoreInstance:function(e,n){e&&(this.moreInstance=this.requireInstance("common/widget/tbshare/tbshare_more",[e]),this.moreInstance.setShareContent(n))},_addMoreInstanceToShareInstance:function(e){if(!this.moreInstance)return!1;if(e){var n=["before","after"],t=$.inArray(e,n);if(0==t)this.shareInstance.$dom.before(this.moreInstance.$dom);else{if(1!=t)throw new Error("moreInstance position error,should be in ["+n.join(",")+"]");this.shareInstance.$dom.after(this.moreInstance.$dom)}}else this.shareInstance.$dom.after(this.moreInstance.$dom)},_addAllInstanceToContainer:function(e,n){var t=$('<div class="tbshare clearfix"></div>');this.shareInstance.$dom.appendTo(t),this._addMoreInstanceToShareInstance(n),t.appendTo(e)},setShareContent:function(e){return this.shareInstance&&this.shareInstance.setShareContent(e),this.moreInstance&&this.moreInstance.setShareContent(e),this},share:function(e){return this.shareInstance?this.shareInstance.share(e):this.moreInstance&&this.moreInstance.shareInstance.share(e),this},showMore:function(){return this.moreInstance?this.moreInstance.showMore():!1},showAll:function(){return this.moreInstance?this.moreInstance.showAll():!1}}});
;var QRCode;!function(){function t(t){this.mode=u.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;r>e;e++){var o=[],n=this.data.charCodeAt(e);n>65536?(o[0]=240|(1835008&n)>>>18,o[1]=128|(258048&n)>>>12,o[2]=128|(4032&n)>>>6,o[3]=128|63&n):n>2048?(o[0]=224|(61440&n)>>>12,o[1]=128|(4032&n)>>>6,o[2]=128|63&n):n>128?(o[0]=192|(1984&n)>>>6,o[1]=128|63&n):o[0]=n,this.parsedData.push(o)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var o=0;o<t.length-r;o++)this.num[o]=t[o+r]}function o(t,e){this.totalCount=t,this.dataCount=e}function n(){this.buffer=[],this.length=0}function i(){return"undefined"!=typeof CanvasRenderingContext2D}function a(){var t=!1,e=navigator.userAgent;return/android/i.test(e)&&(t=!0,aMat=e.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(t=parseFloat(aMat[1]))),t}function s(t,e){for(var r=1,o=h(t),n=0,i=p.length;i>=n;n++){var a=0;switch(e){case l.L:a=p[n][0];break;case l.M:a=p[n][1];break;case l.Q:a=p[n][2];break;case l.H:a=p[n][3]}if(a>=o)break;r++}if(r>p.length)throw new Error("Too long data");return r}function h(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}t.prototype={getLength:function(){return this.parsedData.length},write:function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var r=new t(e);this.dataList.push(r),this.dataCache=null},isDark:function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++){this.modules[o]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[o][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var o=-1;7>=o;o++)-1>=e+o||this.moduleCount<=e+o||(this.modules[t+r][e+o]=r>=0&&6>=r&&(0==o||6==o)||o>=0&&6>=o&&(0==r||6==r)||r>=2&&4>=r&&o>=2&&4>=o?!0:!1)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;8>r;r++){this.makeImpl(!0,r);var o=f.getLostPoint(this);(0==r||t>o)&&(t=o,e=r)}return e},createMovieClip:function(t,e,r){var o=t.createEmptyMovieClip(e,r),n=1;this.make();for(var i=0;i<this.modules.length;i++)for(var a=i*n,s=0;s<this.modules[i].length;s++){var h=s*n,u=this.modules[i][s];u&&(o.beginFill(0,100),o.moveTo(h,a),o.lineTo(h+n,a),o.lineTo(h+n,a+n),o.lineTo(h,a+n),o.endFill())}return o},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=f.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var o=t[e],n=t[r];if(null==this.modules[o][n])for(var i=-2;2>=i;i++)for(var a=-2;2>=a;a++)this.modules[o+i][n+a]=-2==i||2==i||-2==a||2==a||0==i&&0==a?!0:!1}},setupTypeNumber:function(t){for(var e=f.getBCHTypeNumber(this.typeNumber),r=0;18>r;r++){var o=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=o}for(var r=0;18>r;r++){var o=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=o}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,o=f.getBCHTypeInfo(r),n=0;15>n;n++){var i=!t&&1==(o>>n&1);6>n?this.modules[n][8]=i:8>n?this.modules[n+1][8]=i:this.modules[this.moduleCount-15+n][8]=i}for(var n=0;15>n;n++){var i=!t&&1==(o>>n&1);8>n?this.modules[8][this.moduleCount-n-1]=i:9>n?this.modules[8][15-n-1+1]=i:this.modules[8][15-n-1]=i}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=-1,o=this.moduleCount-1,n=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[o][a-s]){var h=!1;i<t.length&&(h=1==(t[i]>>>n&1));var u=f.getMask(e,o,a-s);u&&(h=!h),this.modules[o][a-s]=h,n--,-1==n&&(i++,n=7)}if(o+=r,0>o||this.moduleCount<=o){o-=r,r=-r;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,r,i){for(var a=o.getRSBlocks(t,r),s=new n,h=0;h<i.length;h++){var u=i[h];s.put(u.mode,4),s.put(u.getLength(),f.getLengthInBits(u.mode,t)),u.write(s)}for(var l=0,h=0;h<a.length;h++)l+=a[h].dataCount;if(s.getLengthInBits()>8*l)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*l+")");for(s.getLengthInBits()+4<=8*l&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;;){if(s.getLengthInBits()>=8*l)break;if(s.put(e.PAD0,8),s.getLengthInBits()>=8*l)break;s.put(e.PAD1,8)}return e.createBytes(s,a)},e.createBytes=function(t,e){for(var o=0,n=0,i=0,a=new Array(e.length),s=new Array(e.length),h=0;h<e.length;h++){var u=e[h].dataCount,l=e[h].totalCount-u;n=Math.max(n,u),i=Math.max(i,l),a[h]=new Array(u);for(var g=0;g<a[h].length;g++)a[h][g]=255&t.buffer[g+o];o+=u;var d=f.getErrorCorrectPolynomial(l),c=new r(a[h],d.getLength()-1),p=c.mod(d);s[h]=new Array(d.getLength()-1);for(var g=0;g<s[h].length;g++){var m=g+p.getLength()-s[h].length;s[h][g]=m>=0?p.get(m):0}}for(var v=0,g=0;g<e.length;g++)v+=e[g].totalCount;for(var _=new Array(v),C=0,g=0;n>g;g++)for(var h=0;h<e.length;h++)g<a[h].length&&(_[C++]=a[h][g]);for(var g=0;i>g;g++)for(var h=0;h<e.length;h++)g<s[h].length&&(_[C++]=s[h][g]);return _};for(var u={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},g={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;f.getBCHDigit(e)-f.getBCHDigit(f.G15)>=0;)e^=f.G15<<f.getBCHDigit(e)-f.getBCHDigit(f.G15);return(t<<10|e)^f.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;f.getBCHDigit(e)-f.getBCHDigit(f.G18)>=0;)e^=f.G18<<f.getBCHDigit(e)-f.getBCHDigit(f.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return f.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case g.PATTERN000:return(e+r)%2==0;case g.PATTERN001:return e%2==0;case g.PATTERN010:return r%3==0;case g.PATTERN011:return(e+r)%3==0;case g.PATTERN100:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case g.PATTERN101:return e*r%2+e*r%3==0;case g.PATTERN110:return(e*r%2+e*r%3)%2==0;case g.PATTERN111:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new r([1],0),o=0;t>o;o++)e=e.multiply(new r([1,d.gexp(o)],0));return e},getLengthInBits:function(t,e){if(e>=1&&10>e)switch(t){case u.MODE_NUMBER:return 10;case u.MODE_ALPHA_NUM:return 9;case u.MODE_8BIT_BYTE:return 8;case u.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case u.MODE_NUMBER:return 12;case u.MODE_ALPHA_NUM:return 11;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case u.MODE_NUMBER:return 14;case u.MODE_ALPHA_NUM:return 13;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,o=0;e>o;o++)for(var n=0;e>n;n++){for(var i=0,a=t.isDark(o,n),s=-1;1>=s;s++)if(!(0>o+s||o+s>=e))for(var h=-1;1>=h;h++)0>n+h||n+h>=e||(0!=s||0!=h)&&a==t.isDark(o+s,n+h)&&i++;i>5&&(r+=3+i-5)}for(var o=0;e-1>o;o++)for(var n=0;e-1>n;n++){var u=0;t.isDark(o,n)&&u++,t.isDark(o+1,n)&&u++,t.isDark(o,n+1)&&u++,t.isDark(o+1,n+1)&&u++,(0==u||4==u)&&(r+=3)}for(var o=0;e>o;o++)for(var n=0;e-6>n;n++)t.isDark(o,n)&&!t.isDark(o,n+1)&&t.isDark(o,n+2)&&t.isDark(o,n+3)&&t.isDark(o,n+4)&&!t.isDark(o,n+5)&&t.isDark(o,n+6)&&(r+=40);for(var n=0;e>n;n++)for(var o=0;e-6>o;o++)t.isDark(o,n)&&!t.isDark(o+1,n)&&t.isDark(o+2,n)&&t.isDark(o+3,n)&&t.isDark(o+4,n)&&!t.isDark(o+5,n)&&t.isDark(o+6,n)&&(r+=40);for(var l=0,n=0;e>n;n++)for(var o=0;e>o;o++)t.isDark(o,n)&&l++;var g=Math.abs(100*l/e/e-50)/5;return r+=10*g}},d={glog:function(t){if(1>t)throw new Error("glog("+t+")");return d.LOG_TABLE[t]},gexp:function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return d.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},c=0;8>c;c++)d.EXP_TABLE[c]=1<<c;for(var c=8;256>c;c++)d.EXP_TABLE[c]=d.EXP_TABLE[c-4]^d.EXP_TABLE[c-5]^d.EXP_TABLE[c-6]^d.EXP_TABLE[c-8];for(var c=0;255>c;c++)d.LOG_TABLE[d.EXP_TABLE[c]]=c;r.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),o=0;o<this.getLength();o++)for(var n=0;n<t.getLength();n++)e[o+n]^=d.gexp(d.glog(this.get(o))+d.glog(t.get(n)));return new r(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=d.glog(this.get(0))-d.glog(t.get(0)),o=new Array(this.getLength()),n=0;n<this.getLength();n++)o[n]=this.get(n);for(var n=0;n<t.getLength();n++)o[n]^=d.gexp(d.glog(t.get(n))+e);return new r(o,0).mod(t)}},o.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],o.getRSBlocks=function(t,e){var r=o.getRsBlockTable(t,e);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=r.length/3,i=[],a=0;n>a;a++)for(var s=r[3*a+0],h=r[3*a+1],u=r[3*a+2],l=0;s>l;l++)i.push(new o(h,u));return i},o.getRsBlockTable=function(t,e){switch(e){case l.L:return o.RS_BLOCK_TABLE[4*(t-1)+0];case l.M:return o.RS_BLOCK_TABLE[4*(t-1)+1];case l.Q:return o.RS_BLOCK_TABLE[4*(t-1)+2];case l.H:return o.RS_BLOCK_TABLE[4*(t-1)+3];default:return void 0}},n.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var r=0;e>r;r++)this.putBit(1==(t>>>e-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var p=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],m=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){function e(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(var o in e)e.hasOwnProperty(o)&&r.setAttribute(o,e[o]);return r}{var r=this._htOption,o=this._el,n=t.getModuleCount();Math.floor(r.width/n),Math.floor(r.height/n)}this.clear();var i=e("svg",{viewBox:"0 0 "+String(n)+" "+String(n),width:"100%",height:"100%",fill:r.colorLight});i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.appendChild(i),i.appendChild(e("rect",{fill:r.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;n>a;a++)for(var s=0;n>s;s++)if(t.isDark(a,s)){var h=e("use",{x:String(a),y:String(s)});h.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),i.appendChild(h)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),v="svg"===document.documentElement.tagName.toLowerCase(),_=v?m:i()?function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function e(t,e){var r=this;if(r._fFail=e,r._fSuccess=t,null===r._bSupportDataURI){var o=document.createElement("img"),n=function(){r._bSupportDataURI=!1,r._fFail&&_fFail.call(r)},i=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)};return o.onabort=n,o.onerror=n,o.onload=i,o.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}r._bSupportDataURI===!0&&r._fSuccess?r._fSuccess.call(r):r._bSupportDataURI===!1&&r._fFail&&r._fFail.call(r)}if(this._android&&this._android<=2.1){var r=1/window.devicePixelRatio,o=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,e,n,i,a,s,h,u){if("nodeName"in t&&/img/i.test(t.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*r;else"undefined"==typeof u&&(arguments[1]*=r,arguments[2]*=r,arguments[3]*=r,arguments[4]*=r);o.apply(this,arguments)}}var n=function(t,e){this._bIsPainted=!1,this._android=a(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return n.prototype.draw=function(t){var e=this._elImage,r=this._oContext,o=this._htOption,n=t.getModuleCount(),i=o.width/n,a=o.height/n,s=Math.round(i),h=Math.round(a);e.style.display="none",this.clear();for(var u=0;n>u;u++)for(var l=0;n>l;l++){var g=t.isDark(u,l),f=l*i,d=u*a;r.strokeStyle=g?o.colorDark:o.colorLight,r.lineWidth=1,r.fillStyle=g?o.colorDark:o.colorLight,r.fillRect(f,d,i,a),r.strokeRect(Math.floor(f)+.5,Math.floor(d)+.5,s,h),r.strokeRect(Math.ceil(f)-.5,Math.ceil(d)-.5,s,h)}this._bIsPainted=!0},n.prototype.makeImage=function(){this._bIsPainted&&e.call(this,t)},n.prototype.isPainted=function(){return this._bIsPainted},n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},n.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},n}():function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,r=this._el,o=t.getModuleCount(),n=Math.floor(e.width/o),i=Math.floor(e.height/o),a=['<table style="border:0;border-collapse:collapse;">'],s=0;o>s;s++){a.push("<tr>");for(var h=0;o>h;h++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+n+"px;height:"+i+"px;background-color:"+(t.isDark(s,h)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),r.innerHTML=a.join("");var u=r.childNodes[0],l=(e.width-u.offsetWidth)/2,g=(e.height-u.offsetHeight)/2;l>0&&g>0&&(u.style.margin=g+"px "+l+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}();QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof e&&(e={text:e}),e)for(var r in e)this._htOption[r]=e[r];"string"==typeof t&&(t=document.getElementById(t)),this._android=a(),this._el=t,this._oQRCode=null,this._oDrawing=new _(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(t){this._oQRCode=new e(s(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();
;_.Module.define({path:"common/widget/tbshare/tbshare_share",requires:["common/widget/tbcopy"],sub:{_baseConfig:{Parnter:{qqzone:{title:"QQ\u7A7A\u95F4",urlTmp:["http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?","url=#{url}&title=#{text}&desc=#{desc}","&summary=#{summary}&site=#{site}&pics=#{pics}"].join("")},tsina:{title:"\u65B0\u6D6A\u5FAE\u535A",urlTmp:["http://service.weibo.com/share/share.php?","url=#{url}&title=#{text}","&pic=#{pics}"].join("")},renren:{title:"\u4EBA\u4EBA\u7F51",urlTmp:["http://widget.renren.com/dialog/share?","resourceUrl=#{url}&srcUrl=#{url}&title=#{text}&description=","&pic=#{pics}"].join("")},tieba:{title:"\u767E\u5EA6\u8D34\u5427",urlTmp:["//tieba.baidu.com/f/commit/share/openShareApi?","url=#{url}&title=#{text}&desc=#{desc}","&comment=#{summary}&pic=#{pics}"].join("")},weixin:{title:"\u5FAE\u4FE1",urlTmp:[].join("")},copy:{title:"\u590D\u5236\u94FE\u63A5",urlTmp:[].join(""),attr:'onclick="return false;"'},douban:{title:"\u8C46\u74E3",urlTmp:["http://www.douban.com/share/service?","href=#{url}&name=#{text}&text=#{desc}","&image=#{pics}"].join("")},tsohu:{title:"\u641C\u72D0\u5FAE\u535A",urlTmp:["http://t.sohu.com/third/post.jsp?","url=#{url}&title=#{text}","&pic=#{pics}"].join("")}},tmp:{base:['<ul class="">#{share_btns}</ul>'].join(""),btn:['<div class="tbshare_#{short_name} tbshare_icon" #{attr} title="#{title}" data-share="#{short_name}">',"#{text}",'<div class="tbshare_title_box">#{title}</div>',"</div>"].join(""),qrcode:['<div class="tbshare_qrcode_mask">','<div class="tbshare_qrcode_outer">','<div class="tbshare_qrcode_wrapper">',"<h6>\u626B\u4E00\u626B\u5206\u4EAB\u5230\u5FAE\u4FE1</h6>",'<div class="tbshare_qrcode_content"></div>','<div class="tbshare_qrcode_instruction">',"<p>\u6253\u5F00\u5FAE\u4FE1\uFF0C\u70B9\u51FB\u5E95\u90E8\u7684\u201C\u53D1\u73B0\u201D\uFF0C<br/>\u4F7F\u7528\u201C\u626B\u4E00\u626B\u201D\u5373\u53EF\u5C06\u7F51\u9875\u5206\u4EAB\u81F3\u670B\u53CB\u5708\u3002</p>","</div>",'<div class="tbshare_qrcode_close">&#215;</div>',"</div>","</div>",'<div class="tbshare_qrcode_triangle"></div>',"</div>"].join("")},common:{text:document.title,desc:document.title,url:$.tb.location.getHref(),pics:""}},qrcodeSize:90,classList:{normal:"tbshare_wrapper",coco:"tbshare_wrapper_theme_coco"},typeClassList:{normal:"",vertical:"vertical"},initial:function(t){if(t=$.extend({theme:"normal",type:"normal",initialQrcode:!0},t),this.className=this.classList[t.theme],this.typeClass=this.typeClassList[t.type],!t)throw new Error("no tbShare args provided");this.shareContent=$.extend({},this._baseConfig.common,t.shareContent),this.$dom=this._createShareComponent(t.targets),t.initialQrcode&&(this.$qrcode=this._createQrcodeWrapper(),this.$qrcode.appendTo(this.$dom)),this._bindEvents()},getQrcode:function(){return this.$qrcode||(this.$qrcode=this._createQrcodeWrapper(),this.$qrcode.appendTo(this.$dom)),this.$qrcode},share:function(t){var e=this.shareContent||this._baseConfig.common;if("weixin"==t)return this.getQrcode().show(),!1;if("copy"==t)return prompt("\u8BF7\u6309\u4E0B Ctrl+C \u590D\u5236\u94FE\u63A5\u5230\u9ECF\u8D34\u677F",e.url),!1;var r=this._baseConfig.Parnter[t];e=$.extend({},e),e.url+=-1!==e.url.indexOf("?")?"&sharefrom="+t:"?sharefrom="+t,e=this._dataEncodeURI(e),e=$.extend({},e);var i=$.tb.format(r.urlTmp,e);return window.open(i),!1},_createShareComponent:function(t){for(var e="",r="",i="",o=0,s=t.length;s>o;o++)"[object Array]"==Object.prototype.toString.call(t[o])?(r=t[o][0],i=t[o][1]):(r=t[o],i=""),this._baseConfig.Parnter[r]&&(e+=["<li>",$.tb.format(this._baseConfig.tmp.btn,{short_name:r,text:i,title:this._baseConfig.Parnter[r].title,attr:this._baseConfig.Parnter[r].attr||""}),"</li>"].join(""));var n=$.tb.format(this._baseConfig.tmp.base,{share_btns:e}),a=$("<div></div>").addClass(this.className).addClass(this.typeClass).append(n);return a},_createQrcodeWrapper:function(){var t=$(this._baseConfig.tmp.qrcode),e=this.shareContent.url,r=this.qrcodeSize;return $.JsLoadManager.use("//tb1.bdstatic.com/tb/_/qrcode_f84ab06.js",function(){new window.QRCode(t.find(".tbshare_qrcode_content")[0],{text:e||"//tieba.baidu.com",width:r,height:r})}),t.on("click",".tbshare_qrcode_mask",function(){t.hide()}),t.on("click",".tbshare_qrcode_close",function(){t.hide()}),t},setQrcodeContent:function(t){var e=this.getQrcode().find(".tbshare_qrcode_content"),r=this.qrcodeSize,i=e.find("img"),o=this;i.length?(i.remove(),e.find("canvas").remove(),new window.QRCode(e[0],{text:t,width:r,height:r})):setTimeout(function(t){o.setQrcodeContent(t)},500,t)},_dataEncodeURI:function(t){var e={};for(var r in t)e[r]=encodeURIComponent(t[r]);return e},_bindEvents:function(){var t=this;this.$dom.on("click",".tbshare_icon",function(){var e=$(this).data("share");return e=e||"tieba",t.share(e)})},_lazyAddTbcopyOnce:function(t){this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:t,text:$.tb.location.getHref()})},_AddTbcopyOnce:function(){var t=this.$dom.find(".tbshare_copy");this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:t,text:$.tb.location.getHref()}),this.copyElement=this.tbcopy.getFlashElement()},_getPageImgSrc:function(t){var e=[];return $("img").each(function(r){t>r&&e.push($(this).tbattr("src"))}),e},setShareContent:function(t){return"[object Object]"==Object.prototype.toString.call(t)&&$.extend(this.shareContent,t),t&&t.url!=this.shareContent.url&&this.setQrcodeContent(this.shareContent.url),this.shareContent},hideQrcode:function(){this.getQrcode().hide()}}});
;_.Module.define({path:"common/widget/tbshare/tbshare_more",requires:["common/widget/tbshare/tbshare_share","common/widget/tbshare/tbshare_all"],sub:{_tmp:['<div class="tbshare_more_wrapper">','<a class="tbshare_more_enter" href="#" title="\u66F4\u591A">#{text}</a>','<div class="tbshare_float_wrapper tbshare_more_right"></div>','<div class="tbshare_slide_main">','<div class="tbshare_more_main">','<div class="tbshare_header">',"<h6>\u5206\u4EAB\u5230</h6>","</div>",'<div class="tbshare_main clearfix">',"</div>",'<div class="tbshare_footer"></div>',"</div>","</div>",'<div class="tbshare_float_wrapper tbshare_more_left"></div>',"</div>"].join(""),moreColumnWidth:[120,218],_args:{targets:[["qqzone","QQ\u7A7A\u95F4"],["tieba","\u767E\u5EA6\u8D34\u5427"],["renren","\u4EBA\u4EBA\u7F51"],["tsina","\u65B0\u6D6A\u5FAE\u535A"],["weixin","\u5FAE\u4FE1"],["douban","\u8C46\u74E3"],["tsohu","\u641C\u72D0\u5FAE\u535A"],["copy","\u590D\u5236"]]},initial:function(t){if(!t)throw new Error("no tbMore args provided");this.args=$.extend({text:"",columnNum:2,$container:null,show:!0,noAll:!1},t),this.$dom=this._createBaseDom(this.args.text),this.$moreWrapper=this._createBaseMoreWrapper(this.args.shareContent,this.args.targets),this.columnNum=this.args.columnNum,this.initMoreWrapperWidth(this.args.columnNum),this.args.slide&&-1!=$.inArray(this.args.slide.type,["left","right"])?(this.slide=this.args.slide,this._initSlide()):(this.args.noAll||(this.allInstance=this.requireInstance("common/widget/tbshare/tbshare_all",[]),this.allInstance.setShareContent(this.args.shareContent)),this._bindNormalEvents()),this._addToContainer()},_createBaseDom:function(t){t=t||"";var e=$.tb.format(this._tmp,{text:t});return $(e)},_createBaseMoreWrapper:function(t,e){return this._args.shareContent=t||{},"undefined"!=typeof e&&(this._args.targets=e),this.shareInstance=this.requireInstance("common/widget/tbshare/tbshare_share",[this._args]),this.shareInstance.$dom.appendTo(this.$dom.find(".tbshare_main")),this.$dom.find(".tbshare_more_main")},_bindNormalEvents:function(){var t=this;this.$dom.on("mouseenter",".tbshare_more_enter",function(){t.showMoreInNicePosition()}).on("click",".tbshare_more_enter",function(){return t.showAll()}).mouseleave(function(e){return $(e.relatedTarget)[0]?(t.hideMore(),void 0):!1})},_initSlide:function(){this.slideStatus="hide",this.$slideMain=this.$dom.find(".tbshare_slide_main"),this._setSlideStyle(),this._bindSlideEvents()},_setSlideStyle:function(){var t=this.slide.type,e=this.slide.position||"fixed";if(this.$slideBtn=this.$dom.find(".tbshare_more_"+t),this.$slideBtn.show(),this.showMore(),this.$slideMain.css({width:0}),this.$moreWrapper.css({position:"static"}),this.$dom.addClass("tbshare_slide_wrapper"),this.$dom.find(".tbshare_more_enter").hide(),"right"==t?this.$dom.css({right:0}):this.$dom.css({left:0}),!$.inArray(e,["absolute","fixed"]))throw new Error("The position setting not be supported");this.$dom.css({position:e})},_bindSlideEvents:function(){var t=this;this.$slideBtn.mouseenter(function(){"show"!=t.slideStatus&&(t.slideStatus="show",t.slideShowMore(t.slide.type))}),this.$dom.mouseleave(function(e){return $(e.relatedTarget)[0]?(t.slideStatus="hide",t.slideHideMore(t.slide.type),void 0):!1})},_addToContainer:function(){this.args.$container&&this.$dom.appendTo(this.args.$container),this.args.show&&this.show()},show:function(){this.$dom.show()},hide:function(){this.$dom.hide()},showMore:function(t,e){return"undefined"!=typeof t&&"undefined"!=typeof e&&this.$moreWrapper.css({left:t,top:e}),this.$moreWrapper.show(),this.$moreWrapper},showMoreInNicePosition:function(){var t=$(document).scrollTop()+$(window).height(),e=$(document).scrollLeft()+$(window).width(),i={top:this.$dom.offset().top,left:this.$dom.offset().left,width:this.$moreWrapper.width(),height:this.$moreWrapper.height()},s=0,r=0;i.top+i.height>t?r=-i.height:s+=16,i.left+i.width>e&&(s=-i.width,r+=20),this.showMore(s,r)},initMoreWrapperWidth:function(t){if(t&&t>0&&t<=this.moreColumnWidth.length+1){this.columnNum=t;var e=this.moreColumnWidth[this.columnNum-1];this.$moreWrapper.css({width:e})}},slideShowMore:function(t,e){var i=parseInt(this.$moreWrapper.css("width"));if("left"==t);else if("right"!=t)return!1;e&&this.$moreWrapper.css({top:e}),this.columnNum&&(i=this.moreColumnWidth[this.columnNum-1]+2,this.$slideMain.animate({width:i},100,"linear"))},slideHideMore:function(){this.$slideMain.animate({width:0},100,"linear")},hideMore:function(){this.$moreWrapper.hide()},showAll:function(){return this.allInstance&&this.allInstance.showAll(),!1},setShareContent:function(t){return this.shareInstance.setShareContent(t),this.allInstance&&this.allInstance.setShareContent(t),this}}});
;_.Module.define({path:"common/widget/tbshare/tbshare_popup",requires:["common/widget/tbshare/tbshare_share"],sub:{_tmp:['<div class="tbshare_popup_wrapper">','<div class="tbshare_popup_enter"></div>','<div class="tbshare_popup_main clearfix"></div>',"</div>"].join(""),_sharebase_args:{theme:"coco",targets:["tieba","weixin","tsina","qqzone","copy"],initialQrcode:!1},_popup_args:{$container:null,type:"cross",itemIconPosition:"origin"},initial:function(e){if(!e)throw new Error("no tbMore args provided");this._popup_args=$.extend(this._popup_args,{$container:e.$container,type:e.type,itemIconPosition:e.itemIconPosition}),this._sharebase_args=$.extend(this._sharebase_args,{shareContent:e.shareContent||{},targets:e.targets,type:e.type}),this.$dom=this._createBaseDom(),this.$popupWrapper=this._createBaseMoreWrapper(),this._bindEvents(),this._popup_args.$container.append(this.$dom)},_createBaseDom:function(e){e=e||"";var t=this._tmp,s=$(t);return"vertical"==this._popup_args.type&&s.addClass("popup_vertical"),"left"==this._popup_args.itemIconPosition&&s.addClass("popup_icon_left"),s},_createBaseMoreWrapper:function(){return this.shareInstance=this.requireInstance("common/widget/tbshare/tbshare_share",[this._sharebase_args]),this.shareInstance.$dom.appendTo(this.$dom.find(".tbshare_popup_main")),this.$dom.find(".tbshare_popup_main")},_qrcodeShow:function(){this.shareInstance.getQrcode().show(),this.shareInstance.$dom.find(".tbshare_weixin").addClass("hover_on_qrcode")},_qrcodeHide:function(){this.shareInstance.getQrcode().hide(),this.shareInstance.$dom.find(".tbshare_weixin").removeClass("hover_on_qrcode")},_bindEvents:function(){var e=this;this.$dom.on("mouseenter",".tbshare_popup_main li",function(){$(this).find(".tbshare_weixin").length?e._qrcodeShow():e._qrcodeHide()}),this.$dom.on("mouseenter",function(t){$(this).find($(t.relatedTarget)).length||!$(t.relatedTarget).parent().length,e._qrcodeHide(),e.$popupWrapper.show()}),this.mouseenterInFlash=!1,this.$dom.on("mouseleave",function(t){var s=t.relatedTarget;if(s){if(s==e.shareInstance.copyElement)return e.mouseenterInFlash=!0,void 0}else if(e.mouseenterInFlash)return;e.$popupWrapper.hide(),e._reinitialCopy()});var t=$(this.shareInstance.copyElement);t.parent().on("mouseleave",function(t){var s=t.relatedTarget;e.args.$container.removeClass("copy_mouse_hover"),e.$dom.find($(s))||(e.mouseenterInFlash=!1)}),t.parent().on("mouseenter",function(){e.args.$container.addClass("copy_mouse_hover")})},_reinitialCopy:function(){this.$dom.find(".tbshare_copy .tbshare_title_box").removeClass("copy_done"),this.$dom.find(".tbshare_copy .tbshare_title_box").html("\u590D\u5236\u94FE\u63A5")},_setCopyCallback:function(){var e=this;e.shareInstance.tbcopy.setSuccessCallback(function(){e.$dom.find(".tbshare_copy .tbshare_title_box").addClass("copy_done"),e.$dom.find(".tbshare_copy .tbshare_title_box").html("\u5DF2\u590D\u5236\u94FE\u63A5")})},show:function(){this.$dom.show()},hide:function(){this.$dom.hide()},showMore:function(e,t){return"undefined"!=typeof e&&"undefined"!=typeof t&&this.$moreWrapper.css({left:e,top:t}),this.$moreWrapper.show(),this.$moreWrapper},hideMore:function(){this.$moreWrapper.hide()},setShareContent:function(e){return this.shareInstance.setShareContent(e),this}}});
;_.Module.define({path:"common/widget/tbshare/tbshare_all",requires:["common/widget/tbshare/tbshare_share"],sub:{_tmp:['<div class="tbshare_all_wrapper">',"<h5>\u5206\u4EAB\u5230",'<p class="j_tbshare_all_close"></p>',"</h5>",'<div class="tbshare_all_main"></div>','<div class="tbshare_all_footer"></div>',"</div>"].join(""),_args:{targets:[["qqzone","QQ\u7A7A\u95F4"],["tieba","\u767E\u5EA6\u8D34\u5427"],["renren","\u4EBA\u4EBA\u7F51"],["tsina","\u65B0\u6D6A\u5FAE\u535A"],["weixin","\u5FAE\u4FE1"],["douban","\u8C46\u74E3"],["tsohu","\u641C\u72D0\u5FAE\u535A"],["copy","\u590D\u5236"]]},initial:function(t){t=t||{},this.args=$.extend({show:!1,$container:$("body")},t),this.$container=this.args.$container,this._createElement(),this._bindEvents(),this._addToContainer()},_createElement:function(){this.$dom=$(this._tmp),this.$share_all_main=this.$dom.find(".tbshare_all_main"),this.share=this.requireInstance("common/widget/tbshare/tbshare_share",[this._args]),this.share.$dom.appendTo(this.$share_all_main)},_bindEvents:function(){var t=this;this.$dom.on("click",".j_tbshare_all_close",function(){t.hideAll()})},_addToContainer:function(){this.$container&&this.$container.append(this.$dom),this.args.show&&this.showAll()},setShareContent:function(t){return this.share.setShareContent(t),this},showAll:function(){return this.$dom.show(),this},hideAll:function(){return this.$dom.hide(),this}}});_.Module.define({path:"pb/widget/bindHover",requires:[],sub:{initial:function(){try{var e=this;e.bindZanHover()}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/bind_hover/bind_hover.js",method:"",ln:12}),n}},bindZanHover:function(){$(".j_niceThread").hover(function(){0==$(this).siblings(".j_complient_number").tbattr("title")&&$(this).siblings(".j_complient_number").find(".zan_word").removeClass("zan_word").addClass("changeColor")},function(e){0==$(e.target).siblings(".j_complient_number").tbattr("title")&&$(e.target).siblings(".j_complient_number").find(".changeColor").removeClass("changeColor").addClass("zan_word")})}}});_.Module.define({path:"common/component/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="ui_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});