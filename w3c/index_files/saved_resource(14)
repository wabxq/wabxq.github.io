_.Module.define({path:"liveshow/widget/frs_aside_slide",requires:["common/component/SlideShow"],sub:{_slideConfig:{nav:".live_show_aside .page_turn",target:".live_show_aside .tbui_slideshow_container",activeClass:"turn_icon_cur",interval:2e3,auto:!0,effect:"fade"},initial:function(e){var a=this;$(".live_show_aside").delegate(".hover","mouseenter",function(){$(this).find(".zhe2").show()}).delegate(".hover","mouseleave",function(){$(this).find(".zhe2").hide()}),$(".live_show_aside").delegate(".j_aside_title, .j_photo_aside, .j_user_name, .j_tag","click",function(){$.stats.track("frs-aside-xiu8","\u79C0\u5427aside_"+e.product,e.product,"click")}),$.stats.track("\u53F3\u4FA7","\u79C0\u5427\u6A21\u5757\u5C55\u793A","","view"),a._bindEvents()},_tpl:["<dl>",'<dt class="cur">','   <a target="_blank" href="#{url}" class="j_photo_aside">','       <img src="#{pic}">',"   </a>",'   <em class="people"><i></i> #{chat_weight}</em>',"   #{is_live}","</dt>",'<dd class="name_dd j_user_name">','   <a class="name_link" target="_blank" href="#{url}" title="#{user_name}">','       <em class="name">#{user_name}</em></a>','   <em class="area"><i></i>#{address}</em>','   <a class="j_tag" target="_blank" href="#{url}">','       <em class="dashu">#{tag}</em>',"   </a>","</dd>","</dl>",'<a target="_blank" href="#{url}" class="zhe2 j_photo_aside" style="display: none;"><em></em></a>'].join(""),_buildPerTpl:function(e){for(var a="",i=0,t=5;t>i;i++){var s=e[i],l=user.myTieba,r=l.forum,_=l.product,n=s.is_live?'<em class="live">\u76F4\u64AD</em>':"",d="http://spread.xiu8.com/spreed!baiduGo.jspa?pid=1072&sid="+("frs"===_?"4":"6")+"&t=2&roomId=",o=d+s.room_id+"&fr="+_+"&fr_fname="+r.forum_name+"&ie=utf-8&fr_fid="+r.forum_id+"&ie=utf-8",c=s.chat_weight;c>1e4&&(c=Math.ceil(c/1e4)+"\u4E07"),a+=['<li class="hover">',$.tb.format(this._tpl,$.extend({},e[i],{is_live:n,url:o,chat_weight:c})),"</li>"].join("")}return a},_bindEvents:function(){var e=this;$(".j_aside_change").on("click",function(a){a.preventDefault(),$.ajax({type:"get",url:"/tbliveact/data/getLiveList?t="+1*new Date,dataType:"json"}).success(function(a){if(a&&0===a.no){var i=a.data.xiu8_live_list;$(".live_show_list").html(e._buildPerTpl(i))}})})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"comforum/widget/duokuServersDialog",requires:["common/widget/tbcopy"],sub:{_dialog_tmp:{fail_html:['<div class="comforum_duoku_servers_dialog">','<!--div class="fail_img"></div-->','<div class="duoku_servers_qrcode_wrapper">','<div class="qrcode_content"></div>',"<p>\u626B\u63CF\u4E8C\u7EF4\u7801\u4E0B\u8F7D\u6E38\u620F</p>","</div>",'<div class="qrcode_right_area">',"<p>\u5DF2\u88AB#{code_label}\u5149\u4E86\uFF0C\u4F46\u53EF\u4EE5\u7EE7\u7EED\u4E0B\u8F7D\u54E6~</p>",'<div class="btns">','<a href="#{button_url}" class="j_duoku_download ui_btn ui_btn_m" target="_blank">',"<span><em>\u7ACB\u5373\u4E0B\u8F7D</em></span>","</a>","</div>","</div>","</div>"].join(""),cong_html:['<div class="comforum_duoku_servers_dialog">','<div class="duoku_servers_qrcode_wrapper">','<div class="qrcode_content"></div>',"<p>\u626B\u63CF\u4E8C\u7EF4\u7801\u4E0B\u8F7D\u6E38\u620F</p>","</div>",'<div class="qrcode_right_area">',"<p>\u60A8\u5DF2\u7ECF#{code_label}\uFF0C\u8D76\u7D27\u4E0B\u8F7D\u6E38\u620F\u5F00\u59CB\u5427</p>",'<p class="duoku_code j_duoku_code">#{code_title}\uFF1A<span class="j_duoku_code_value duoku_code_value">#{game_code}</span></p>','<div class="btns">','<button class="j_duoku_copy duoku_copy ui_btn ui_btn_m"><span><em>\u590D\u5236#{code_title}</em></span></button>','<a href="#{button_url}" class="j_duoku_download ui_btn ui_btn_m" target="_blank">',"<span><em>\u7ACB\u5373\u4E0B\u8F7D</em></span>","</a>","</div>","</div>","</div>"].join(""),hadcode_html:['<div class="comforum_duoku_servers_dialog">','<div class="duoku_servers_qrcode_wrapper">','<div class="qrcode_content"></div>',"<p>\u626B\u63CF\u4E8C\u7EF4\u7801\u4E0B\u8F7D\u6E38\u620F</p>","</div>",'<div class="qrcode_right_area">',"<p>\u60A8\u5DF2\u7ECF#{code_label}\uFF0C\u8D76\u5FEB\u4E0B\u8F7D\u5427\u3002</p>",'<p class="duoku_code j_duoku_code">#{code_title}\uFF1A<span class="j_duoku_code_value duoku_code_value">#{game_code}</span></p>','<div class="btns">','<button class="j_duoku_copy duoku_copy ui_btn ui_btn_m"><span><em>\u590D\u5236#{code_title}</em></span></button>','<a href="#{button_url}" class="j_duoku_download ui_btn ui_btn_m" target="_blank">',"<span><em>\u7ACB\u5373\u4E0B\u8F7D</em></span>","</a>","</div>","</div>","</div>"].join("")},initial:function(){},showDialog:function(o){this.game=o.game,this.postTrack=o.postTrack,this.src=o.src,this.tbs=o.tbs,this._getCode()},_getCode:function(){var o=this,e="/game/duoku/applyToPlay",d=this.game,t=d.game_id,a=d.game_name,_=d.kaifu_id;this.postTrack("\u83B7\u53D6\u8D44\u683C",d),d&&$.post(e,{game_id:t,kaifu_id:_,game_name:a,tbs:this.tbs,src:this.src},function(e){var t=e.data&&(e.data.game_code||e.data.gift_code),a=e.no;d.applied&&(a=2),d.code_title=d.check_code?"\u6D4B\u8BD5\u7801":d.gift_code?"\u793C\u5305\u7801":"\u6D4B\u8BD5\u7801",d.code_label=d.check_code?"\u62A2\u5230\u4E86\u6D4B\u8BD5\u8D44\u683C":d.gift_code?"\u9886\u53D6\u4E86\u6E38\u620F\u793C\u5305":"\u62A2\u5230\u4E86\u6D4B\u8BD5\u8D44\u683C",0==a?(o.postTrack("\u62A2\u53F7\u6210\u529F\u6D6E\u5C42\u5C55\u793A",d,{},"view"),o._showDialog("cong_html","\u606D\u559C\u60A8",d,t)):1==a?(d.code_label=d.gift_code?"\u9886":"\u62A2",o.postTrack("\u5931\u8D25\u6D6E\u5C42\u5C55\u793A",d,{},"view"),o._showDialog("fail_html","\u5F88\u9057\u61BE... ...",d,t)):2==a?(o.postTrack("\u5DF2\u62A2\u8FC7\u53F7\u6D6E\u5C42\u5C55\u793A",d,{},"view"),o._showDialog("hadcode_html","\u60A8\u5DF2\u7ECF\u62A2\u8FC7\u55BD~",d,t)):4==a?o.requireInstanceAsync("common/widget/LoginDialog",["","userBar"]):alert("\u670D\u52A1\u5668\u62BD\u98CE")})},_showDialog:function(o,e,d,t){var a=new $.dialog({html:$.tb.format(this._dialog_tmp[o],{button_url:d.button_url,game_name:d.game_name,game_code:t,code_label:d.code_label,code_title:d.code_title}),title:e,width:436,height:156,draggable:!1,closeable:!0});$.JsLoadManager.use("//tb1.bdstatic.com/tb/static-comforum/qrcode_f84ab06.js",function(){new window.QRCode($(".comforum_duoku_servers_dialog .qrcode_content")[0],{text:d.download_url,width:128,height:128})}),t&&(a.element.find(".j_duoku_copy, .j_duoku_code").show(),this.tbcopy?this.tbcopy.add(a.element.find(".j_duoku_copy")):this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:a.element.find(".j_duoku_copy")}),this.tbcopy.setText($(".comforum_duoku_servers_dialog .j_duoku_code_value").text()));var _=this;a.element.on("click",".j_duoku_download",function(){_.postTrack("",d,"","download")}),a.element.on("click",".j_duoku_copy",function(o){_.postTrack("\u590D\u5236\u6309\u94AE",d),o.preventDefault()})}}});_.Module.define({path:"common/widget/duoku_servers_list",requires:["common/widget/tbcopy","comforum/widget/duokuServersDialog"],sub:{_btn_list_tmp:{get_code:['<li class="j_dsh_game" data-index="#{index}">','<a href="#{thread_url}" target="_blank"><img src="#{icon_url}"></a>','<span class="game_title"><a href="#{thread_url}" target="_blank">#{game_name}</a></span>','<a href="#{get_code_action}" target="_blank" class="get_code_btn">','<div class="#{platform_class} get_code_icon"></div>',"<span>#{apply_text}</span>","</a>","</li>"].join("")},locateMap:{frs:"p0117",pb:"p0118"},initial:function(e){this.redirectUrl=e.redirectUrl,this.$wrapper=$("#duoku_servers_list");var t=this;this._loader().done(function(e){t._render(e.data),t.dialog=t.requireInstance("comforum/widget/duokuServersDialog")}),this._bindEvents()},_loader:function(){var e="/game/duoku/getHotGames?timestamp="+(new Date).getTime(),t=$.getJSON(e);return t},_formatRedirectUrl:function(e,t){for(var a=e.split("?"),r=a[0],o=a[1].split("&"),i={},n=[],d=0,_=o.length;_>d;d++){var l=o[d],s=l.split("=")[0],c=l.split("=")[1];i[s]=c}i._t=+new Date,t&&(delete i.client_type,delete i.refer,delete i.url,delete i.url,delete i.fid,delete i.fname,delete i.page,delete i.type,delete i.ie);for(var p in i)i.hasOwnProperty(p)&&i[p]&&n.push(p+"="+i[p]);return["http://",$.tb.location.getHost(),r,"?",n.join("&")].join("")},getRedirectUrl:function(e,t,a,r,o,i){var n=[this._formatRedirectUrl(this.redirectUrl,i),"location=p0012","obj_ref=3000601","obj_id="+o,"obj_name="+encodeURIComponent(r),"type="+a,"tbjump="+encodeURIComponent(e),"loc_param="+t].join("&");return n},_render:function(e){e=e||[],this.games=e,0==this.games.length&&this.$wrapper.hide();var t=this.$wrapper.find(".servers_list_wrapper"),a="",r=e.length;r=r>7?7:r;for(var o,i=0;r>i;i++){var n=e[i];n.qrcode_url=this.getRedirectUrl(n.redirect_url,"qr_code","download",n.game_name,n.game_id,!0),n.button_url=this.getRedirectUrl(n.redirect_url,"button","click",n.game_name,n.game_id),o="android"==n.supported_os.toLowerCase()?"get_code_android":"get_code_iphone",a+=$.tb.format(this._btn_list_tmp.get_code,{game_name:n.game_name,thread_url:n.thread_url,icon_url:n.icon_url,platform_class:o,apply_text:n.applied?"\u5DF2\u9886\u53D6":n.not_available?"\u5E93\u5B58\u544A\u6025":n.check_code?"\u83B7\u53D6\u8D44\u683C":n.gift_code?"\u9886\u53D6\u793C\u5305":"-1"==n.download_url?"\u4E86\u89E3\u8BE6\u60C5":"\u7ACB\u5373\u4E0B\u8F7D",get_code_action:n.applied||n.not_available||n.check_code||n.gift_code?"javascript:;":"-1"==n.download_url?n.thread_url:n.download_url,index:i})}t.html(a)},_bindEvents:function(){var e=this;this.$wrapper.on("click",".get_code_btn",function(t){if("javascript:;"==$(t.currentTarget).tbattr("href"))e._getGameCode(t),t.preventDefault();else{var a=$(t.currentTarget).closest(".j_dsh_game").tbattr("data-index"),r=e.games[a];e._postTrack("",r,"","download")}}),this.$wrapper.on("click",".servers_detail_link",function(){e._postTrack("\u66F4\u591A\u94FE\u63A5")})},_getGameCode:function(e){var t=this,a=$(e.currentTarget).closest(".j_dsh_game").tbattr("data-index"),r=this.games[a];return t.dialog.showDialog({tbs:PageData.tbs,game:r,postTrack:$.proxy(t._postTrack,t),src:"list"}),!1},_postTrack:function(e,t,a,r){e||(e=this.locateMap[PageData.product]),"undefined"==typeof r&&(r="click"),a=a||{},a=$.extend({obj_ref:3000603},a),t&&(a=$.extend({obj_name:t.game_name,obj_game_id:t.game_id},a)),$.stats.track(e,"mg_pioneerba","",r,a)}}});_.Module.define({path:"common/widget/informManagerVerifyPhone",requires:["common/widget/verifyManagerPhone"],sub:{initial:function(e,n,i){var o=this;o._forceMode=i,e&&(n?o._commitRemindTime(function(){o._informManager()},null):o._informManager())},_commitRemindTime:function(e,n){$.ajax({url:"/bawu2/checkphone/commitRemindTime",dataType:"json",success:function(i){0===i.errno?"function"==typeof e&&e():"function"==typeof n&&n()},error:n})},_informManager:function(){var e=this;this.requireInstance("common/widget/verifyManagerPhone",[e._forceMode])}}});_.Module.define({path:"comforum/widget/GameSwapWords",requires:["common/widget/Card"],sub:{initial:function(){var a=this;this.wrapper=$("#j_p_postlist"),this.game_swap_card=null,this.trackClick(),this.wrapper.on("mouseenter",".comforum-swap-words",function(e){a._handlerAjax(e.target)}).on("mouseleave",".comforum-swap-words",function(){a._closeSwapCard()})},_closeSwapCard:function(){var a=this;return a.game_swap_card&&a.game_swap_card.closeCard({type:"delayClose",time:100}),a.game_swap_card=null,!1},_handlerAjax:function(a){var e=this;null!=e.game_swap_card&&e._closeSwapCard();var r="/game/markConf?id="+parseInt($(a).data("swapword"));$.get(r).done(function(r){var r=$.json.parseJSON(r);0==r.errno&&null!=r.data&&e._showCard(a,r.data)}).fail(function(){})},_renderScore:function(a){for(var a=a||0,e=[],r="//tb1.",s="bdstatic.com/tb/zt/tengfei/copper.png",t="bdstatic.com/tb/zt/tengfei/gold.png",o="bdstatic.com/tb/zt/tengfei/silver.png",n={copper:r+s,gold:r+t,silver:r+o},i=0;5>i;i++)e.push('<img src="'+n.copper+'">');for(var c=a/2,i=0,l=e.length;l>i;i++)i<parseInt(c)&&(e.splice(i,1,'<img src="'+n.gold+'">'),parseInt(c)!=c&&e.splice(parseInt(c),1,'<img src="'+n.silver+'">'));return e.push("<span>"+a+"</span>"),e.join("")},_showCard:function(a,e){var r=this;null!=r.game_swap_card&&r._closeSwapCard();var s=e,t=['<div class="swap-card-main clearfix">','<a href="'+s.link+'&gfr=game_swap_words" target="_blank"><img class="game-logo" src="'+s.icon+'" /></a>','<ul class="game-info">','<li class="first-line"><a href="'+s.link+'&gfr=game_swap_words" target="_blank">'+s.name+"</a></li>",'<li class="score-wrap">'+r._renderScore(s.star)+"</li>",'<li class="clearfix game-huaci-btn"><p class="ui_btn ui_btn_s"><a href="'+s.link+'&gfr=game_swap_words" target="_blank"><span><em>\u9A6C\u4E0A\u53BB\u73A9</em></span></a></p></li>',"</ul>","</div>",'<div class="swap-card-footer">',"<p>"+s.desc+"</p>","</div>"].join(""),o=$(a),n=o.offset().left,i=o.offset().top+28,c={content:t,arrow_dir:"up",event_target:o,card_css:{width:260,height:160,top:i,left:n,zIndex:99999},arrow_pos:{left:20},attr:"id='game_swap_card'",wrap:$("body")};r.game_swap_card=r.use("common/widget/Card",c),r.game_swap_card.showCard({type:"delayShow",time:200}),$.stats.track("pb\u9875","\u6E38\u620F\u6ED1\u8BCD",null,"show",{obj_type:"\u6E38\u620F"})},trackClick:function(){$("body").on("click",".first-line, .game-logo, .game-huaci-btn",function(){$.stats.track("pb\u9875","\u6E38\u620F\u6ED1\u8BCD",null,"click",{obj_type:"\u6E38\u620F"})})}}});_.Module.define({path:"common/widget/ParamsXssHandler",requires:[],sub:{_escapeKeyArray:["title","prefix","kw","word"],initial:function(e){e&&e.escapeKeyArray&&e.escapeKeyArray.length>0&&(this._escapeKeyArray=e.escapeKeyArray)},xssFilter:function(e){var r=$.extend({},e),a=$.tb.escapeHTML,s=this._escapeKeyArray;return $.each(s,function(i){var t=s[i],n=e[t];void 0!==n&&(r[t]=a(n))}),r}}});var FORUM_POST_PREFIX="/f/commit/",FORUM_POST_URL={threadAdd:FORUM_POST_PREFIX+"thread/add",postAdd:FORUM_POST_PREFIX+"post/add",threadVoteAdd:FORUM_POST_PREFIX+"vote/add ",forumCreate:FORUM_POST_PREFIX+"forum/create",threadDelete:FORUM_POST_PREFIX+"thread/delete",postDelete:FORUM_POST_PREFIX+"post/delete",goodAdd:FORUM_POST_PREFIX+"thread/good/add",goodCancel:FORUM_POST_PREFIX+"thread/good/cancel",threadTopAdd:FORUM_POST_PREFIX+"thread/top/add",threadTopCancel:FORUM_POST_PREFIX+"thread/top/cancel",threadTopicAdd:"/zhibo/commit/add",threadTopicCancel:"/zhibo/commit/set",get_tbs:"/dc/common/tbs"},FORUM_ERROR_INFO={24:"\u767B\u5F55\u9519\u8BEF\uFF0C\u53EF\u80FD\u8F93\u5165\u7684\u7528\u6237\u540D\u548C\u53E3\u4EE4\u4E0D\u6B63\u786E\uFF0C\u8BF7\u5355\u51FB\u786E\u5B9A\u91CD\u8BD5",102:"\u6CE8\u518C\u7528\u6237email\u975E\u6CD5",103:"\u6CE8\u518C\u7528\u6237\u4E2A\u4EBA\u4FE1\u606F\u975E\u6CD5",107:"\u7528\u6237\u540D\u6216\u81EA\u6211\u4ECB\u7ECD\u7684\u6587\u5B57\u4E2D\u542B\u6709\u4E00\u4E9B\u4E0D\u6070\u5F53\u7684\u8BCD\u6C47\uFF0C\u8BF7\u60A8\u91CD\u65B0\u63D0\u4EA4\u6CE8\u518C\u4FE1\u606F",108:"\u7528\u6237\u540D\u4E3A\u7A7A",266:"\u6DFB\u52A0\u597D\u53CB\u91CD\u590D",205:"\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u6CA1\u6709\u6B64\u4FEE\u6539\u6743\u9650\uFF0C\u8BF7\u5230\u60A8\u6CE8\u518C\u7684\u7CFB\u7EDF\u4E2D\u4FEE\u6539\u4FE1\u606F",305:"\u6DFB\u52A0\u8BCD\u8BED\u5230\u8FBE\u6700\u5927\u503C",306:"\u6DFB\u52A0\u8BCD\u8BED\u5230\u8FBE\u6700\u5927\u503C",309:"\u6DFB\u52A0\u8BCD\u8BED\u5230\u8FBE\u6700\u5927\u503C",260:"\u8BA8\u8BBA\u533A\u5DF2\u6EE1\u4E09\u4E2A\u5427\u4E3B",261:"\u8BE5\u7528\u6237\u5DF2\u7ECF\u662F\u8BE5\u5427\u7684\u5427\u4E3B",262:"\u8BE5\u7528\u6237\u5DF2\u7ECF\u662F\u4E09\u4E2A\u8D34\u5427\u7684\u5427\u4E3B",263:"\u7528\u6237\u6307\u5B9A\u597D\u53CB\u540D\u4E0D\u5B58\u5728",264:"\u7528\u6237\u597D\u53CB\u6570\u5230\u8FBE\u6700\u5927",265:"\u7528\u6237\u672A\u767B\u9646",267:"\u6DFB\u52A0\u6536\u85CF\u5939\u5230\u6700\u5927\u503C",300:"\u8FBE\u5230\u7CFB\u7EDF\u6700\u5927\u8FC7\u6EE4\u7528\u6237\u5BB9\u91CF",301:"\u8FBE\u5230\u7CFB\u7EDF\u6700\u5927\u8FC7\u6EE4IP\u5BB9\u91CF",302:"\u7BA1\u7406\u5458\u6307\u5B9A\u7684\u5173\u952E\u5B57\u4E0D\u5B58\u5728\u8D34\u5427",303:"\u7BA1\u7406\u5458\u6307\u5B9A\u7684\u7528\u6237\u540D\u4E0D\u5B58\u5728",304:"\u7BA1\u7406\u5458\u6307\u5B9A\u7684IP\u6709\u8BEF",316:"\u64CD\u4F5C\u5931\u8D25\uFF01\u8BE5IP\u5730\u5740\u4E3A\u624B\u673A\u4E0A\u7F51\u4F7F\u7528\uFF0C\u65E0\u6CD5\u76F4\u63A5\u5C01\u7981\u3002",401:"\u6839\u636Eforum_id \u4E0D\u80FD\u5F97\u5230\u8BA8\u8BBA\u540D",402:"\u5F97\u5230\u7684\u8D34\u5427\u540D\u592A\u957F",870:"\u697C\u9AD8\u4EBA\u591A\uFF0C\u8BF7\u52FF\u63A8\u5012",871:"\u697C\u9AD8\u614E\u63A8\uFF0C\u51B7\u9759\u4F1A\u513F\u5427",872:"\u7CBE\u54C1\u6765\u7684\u4E0D\u6613\uFF0C\u8BF7\u52FF\u64C5\u81EA\u5220\u9664",874:"\u5427\u520A\u6765\u5F97\u4E0D\u6613\uFF0C\u8BF7\u52FF\u64C5\u81EA\u5220\u9664"};
;var Thread_add_result={resultNo:0,fid:"",tid:"",vid:"",sign:"",bdauditreason:0,bdQueryWordEnc:"",autoMsg:"",is_login:0,init:function(e){if(Thread_add_result&&e.data&&"object"==typeof e.data)for(var a in e.data)Thread_add_result[a]=e.data[a];_.Module.use("ueglibs/widget/Ban",[],function(e){Thread_add_result.BanLib=e}),Thread_add_result.resultNo=e.no},isNeedWaitForCheck:function(){var e=!1;switch(this.resultNo){case 9:case 20:case 23:e=!0}return e},isNeedBindPhone:function(){return 4010==this.resultNo},Action_FocusTitle:"focusTitle",Action_FocusContent:"focusContent",Action_ClearYZM:"clearYZM",Action_FocusUrl:"focusUrl",Action_GoToHead:"goToHead",Action_FlushAndGoToHead:"flushAndGoToHead",getActionType:function(){var e="";switch(this.resultNo){case 10:case 14:case 501:case 15:case 36:case 41:case 42:case 43:case 46:case 9001:case 10010:case 10011:case 10012:case 10013:case 220012:case 220015:case 220035:case 2130001:case 2130007:case 2130008:case 2130009:case 2130011:case 2130012:case 2130014:case 2130005:e=this.Action_FocusContent;break;case 11:case 20:e=this.Action_FocusTitle;break;case 17:case 0:e=this.Action_FlushAndGoToHead;break;case 22:case 9:case 23:case 119:case 44:case 100:case 703:case 704:case 705:e=this.Action_GoToHead;break;case 38:case 39:case 40:e=this.Action_ClearYZM;break;case 1120:case 1121:e=this.Action_FocusUrl}return e},getMessage:function(){var e="",a=null;if(this.resultNo>=901&&this.resultNo<=950)return Thread_add_result.autoMsg;switch(null==a&&(a=PageData.forum?PageData.forum.id:null),null==a&&(a=PageData.forum_id),null==a&&(a=PageData.forumID),this.resultNo){case 10:e="\u8D34\u5B50\u5185\u5BB9\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57";break;case 11:e="\u8D34\u5B50\u6807\u9898\u548C\u5185\u5BB9\u592A\u957F";break;case 12:e=null!=a?this.BanLib.render("oldPosterDialog"):"\u64CD\u4F5C\u5931\u8D25";break;case 13:e=null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01<br/><a href='/upc/userinfo?fid="+a+'\' target="_blank">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>':"\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01 ";break;case 14:e="\u60A8\u53D1\u5E03\u7684\u8D34\u5B50\u5DF2\u7ECF\u5B58\u5728";break;case 501:case 15:e="\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34";break;case 16:e="\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u6240\u8F93\u5165\u7684\u8D34\u5427\u4E0D\u5B58\u5728\u3002\u7531\u4E8E\u7CFB\u7EDF\u5347\u7EA7\u7EF4\u62A4\uFF0C\u65B0\u5EFA\u8D34\u5427\u529F\u80FD\u6682\u505C\uFF0C\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\uFF01";break;case 19:case 200:case 201:case 202:e="\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868";break;case 20:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u7684\u6807\u9898\u6216\u6B63\u6587\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u53D1\u8868";break;case 17:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 18:case 21:e="\u5176\u4ED6\u672A\u77E5\u539F\u56E0";break;case 22:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u7531\u4E8E\u7279\u6B8A\u539F\u56E0\u6211\u4EEC\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u6211\u4EEC\u4F1A\u572810\u5206\u949F\u5185\u786E\u8BA4\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85\uFF01";break;case 9:e=this.getCheckMessage(this.bdauditreason);break;case 33:e=1==Thread_add_result.is_login?"\u60A8\u53D1\u8D34\u592A\u5FEB\u4E86:) \u8BF7\u7A0D\u540E\u518D\u53D1":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 34:e=1==Thread_add_result.is_login?"\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 220034:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898";break;case 220035:e="\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~";break;case 35:e=1==Thread_add_result.is_login?"\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 36:e="\u8BF7\u4E0D\u8981\u53D1\u5E7F\u544A\u8D34\uFF01";break;case 37:e="\u60A8\u5DF2\u5C1D\u8BD5\u63D0\u4EA4\u591A\u6B21\u4E86\uFF0C\u8BF7\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 38:e="\u9A8C\u8BC1\u7801\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";break;case 39:e="\u7531\u4E8E\u60A8\u591A\u6B21\u8F93\u9519\u9A8C\u8BC1\u7801\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 40:e="\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u91CD\u65B0\u8F93\u5165";break;case 41:e="\u60A8\u7684\u8D34\u5B50\u53EF\u80FD\u5305\u542B\u4E0D\u5408\u9002\u7684\u5185\u5BB9\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u63D0\u4EA4";break;case 42:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u88AB\u7CFB\u7EDF\u8BA4\u4E3A\u6709\u53D1\u5E7F\u544A\u5ACC\u7591\uFF0C\u8BF7\u60A8\u7A0D\u540E\u518D\u53D1";break;case 43:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u6216\u8D34\u5B50\u5185\u5BB9\u6709\u5E7F\u544A\u6216\u4E0D\u5408\u9002\u7684\u7279\u5F81\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u53D1\u9001";break;case 23:e="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u9700\u8981\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u5EFA\u7ACB\u8D34\u5427";break;case 119:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u4E3B\u9898\u7684\u56DE\u590D\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF0C\u6B22\u8FCE\u60A8\u6D4F\u89C8\u672C\u5427\u7684\u5176\u5B83\u4E3B\u9898";break;case 1120:e="\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u3001\u89C6\u9891\u94FE\u63A5\u5730\u5740\u9519\u8BEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB<a href='//www.baidu.com/search/post_img.html' target='_blank'>\u67E5\u770B\u76F8\u5173\u5E2E\u52A9</a>\u6216\u8FD4\u56DE\u4FEE\u6539";break;case 1121:e="\u62B1\u6B49\uFF0C\u89C6\u9891\u670D\u52A1\u5347\u7EA7\u4E2D\uFF0C\u60A8\u6682\u65F6\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u89C6\u9891\u7684\u8D34\u5B50\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u8BF7\u539F\u8C05";break;case 44:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8868\u4E3B\u9898\u8D34\u5B50\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u6216\u56DE\u590D\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 100:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u4F7F\u7528\u5B8C\u6574\u7684\u8D34\u5427\u529F\u80FD\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 701:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u4E0D\u5141\u8BB8\u672A\u767B\u5F55\u7528\u6237\u53D1\u8D34\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 702:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 703:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u4F1A\u5458\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F\u3002<a href='/f?kw="+this.bdQueryWordEnc+"#1' target=_blank>\u70B9\u6B64\u7533\u8BF7\u52A0\u5165</a>\u672C\u5427\u4F1A\u5458";break;case 704:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u7BA1\u7406\u56E2\u961F\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 705:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 706:e="\u62B1\u6B49\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 45:e="\u62B1\u6B49\uFF0C\u60A8\u63D0\u4EA4\u7684\u8D34\u5427\u540D\u79F0\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u76EE\u524D\u65E0\u6CD5\u521B\u5EFA\uFF0C\u63A8\u8350\u60A8\u4F7F\u7528\u6C49\u5B57\u3001\u5B57\u6BCD\u6216\u6570\u5B57\u4F5C\u4E3A\u8D34\u5427\u540D\u79F0";break;case 46:e="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8FC7\u957F\uFF0C\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u3002\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u91CD\u65B0\u63D0\u4EA4\uFF0C\u8C22\u8C22!";break;case 800:break;case 801:break;case 802:break;case 803:break;case 804:break;case 805:break;case 806:break;case 807:break;case 808:break;case 809:break;case 814:break;case 815:e="\u62B1\u6B49\uFF0C\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u6216\u672A\u8D2D\u4E70\u97F3\u4E50\u9053\u5177\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5";break;case 900:e="\u4E3A\u62B5\u5FA1\u6316\u575F\u5371\u5BB3\uFF0C\u672C\u5427\u5427\u4E3B\u5DF2\u653E\u51FA\u8D34\u5427\u795E\u517D--\u8D85\u7EA7\u9759\u6B62\u86D9\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 961:e="\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u5730\u5740\u6709\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u66F4\u6B63\u540E\u518D\u6B21\u53D1\u5E03\uFF1A\uFF09";break;case 9001:e="\u7531\u4E8E\u533F\u540D\u72B6\u6001\u6216\u672C\u5427\u8BBE\u7F6E\uFF0C\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u56FE\u7247\u7684\u4E3B\u9898\u3002";break;case 2100:e="\u5185\u5BB9\u542B\u6709\u9AD8\u7EA7\u5B57\u4F53\u6548\u679C\uFF0C\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5C31\u80FD\u4F7F\u7528\u54E6~~";break;case 4010:e="\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u5B89\u5168\u98CE\u9669\u6682\u4E0D\u80FD\u53D1\u8D34\uFF0C\u8BF7\u5148\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u540E\u518D\u53D1\u8D34\u5427\u3002";break;case 9e3:e="\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148\u586B\u5199\u7528\u6237\u540D\u3002";break;case 10010:e="\u60A8\u7684\u6027\u522B\u65E0\u6CD5\u8FDB\u884C\u59B9\u7EB8\u8BA4\u8BC1</br><a style = 'font-size:12px;' href = '/i/sys/jump?un="+encodeURIComponent(PageData.user.name)+"&type=profile#sexm' target ='_blank'>\u53BB\u4FEE\u6539\u6211\u7684\u6027\u522B>><a>";break;case 10012:e="\u8BF7\u4E0A\u4F20\u81F3\u5C11\u4E00\u5F20\u56FE\u7247\u3002";break;case 10013:e="\u60A8\u53D1\u5F80\u7684\u5427\u672A\u5F00\u901A\u59B9\u7EB8\u8BA4\u8BC1\u529F\u80FD\u3002";break;case 2130001:e="\u8BF7\u4E0D\u8981\u7ED9\u975E\u59B9\u7EB8\u7528\u6237\u6295\u7968\u3002";break;case 2130007:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2130008:e="\u60A8\u5DF2\u7ECF\u7ED9\u8BE5\u7528\u6237\u6295\u8FC7\u7968\u3002";break;case 2130009:e="\u6295\u7968\u5931\u8D25\u3002";break;case 2130005:e="\u60A8\u5DF2\u7ECF\u53D1\u8D77\u8FC7\u59B9\u7EB8\u8BA4\u8BC1\u8D34</br><a href='/p/"+Thread_add_result.thread_id+"' target = '_blank' >//tieba.baidu.com/p/"+Thread_add_result.thread_id+"</a>";break;case 2130011:e="\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E4B\u95F4\u4E0D\u80FD\u76F8\u4E92\u6295\u7968\u3002";break;case 220012:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 220013:e="\u60A8\u7684IP\u5DF2\u88AB\u5C01\u7981\u3002";break;case 225001:e="\u60A8\u7684\u8D26\u53F7\u7981\u6B62\u8D34\u6761\u3002";break;case 220015:e="\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u542B\u6709\u654F\u611F\u4FE1\u606F\u3002";break;case 219e4:e="<p>\u62B1\u6B49\u60A8\u6CA1\u6709\u8D34\u6761\u9053\u5177\u4E86\u4E0D\u80FD\u53D1\u5E03\u8D34\u6761\u4FE1\u606F\u3002</p><p>PS\uFF1A\u53D1\u8D34,\u56DE\u8D34,\u53C2\u52A0\u6D3B\u52A8\u90FD\u6709\u673A\u4F1A\u83B7\u5F97\u8D34\u6761\u9053\u5177\u3002</p>";break;case 2130012:e="\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u6295\u7968\u3002";break;case 2130014:e="\u4E0D\u80FD\u7ED9\u7537\u6027\u7528\u6237\u6295\u7968";break;case 2190001:e='<p style="margin-top:-8px">\u8D34\u6761\u6CA1\u6709\u53D1\u5E03\u6210\u529F\u8BF7\u7A0D\u540E\u5728\u8BD5\u3002</p><p>PS\uFF1A\u53D1\u5E03\u8D34\u6761\u670910\u79D2\u7684CD\u65F6\u95F4\u3002</p>';break;case 2190002:e="\u62B1\u6B49\uFF0C\u6BCF\u5C0F\u65F6\u53EA\u80FD\u62A2\u4E00\u6B21\u8D34\u6761\u3002";break;case 2190003:e="<p>\u771F\u9057\u61BE~\u60A8\u6CA1\u6709\u62A2\u5230\u8D34\u6761\u9053\u5177\u3002</p><p>PS\uFF1A\u7B49\u7EA7\u8D8A\u9AD8\u83B7\u5F97\u9053\u5177\u51E0\u7387\u8D8A\u9AD8\u54E6\uFF01</p>";break;case 2190004:e="\u670D\u52A1\u5668\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5";break;case 2190005:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2190006:e="\u8D34\u6761\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u3002";break;case 2190007:e="\u8D34\u6761\u5185\u5BB9\u8FC7\u957F\u3002";break;case 2190008:e="\u62B1\u6B49\uFF0C\u4E00\u5929\u6700\u591A\u53EA\u80FD\u83B7\u5F9710\u4E2A\u9053\u5177";break;default:e="\u672A\u77E5\u9519\u8BEF\u3002"}return e},getCheckMessage:function(e){var a="";switch(e){case-61:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u6240\u53D1\u7684\u8D34\u5B50\u5F85\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-62:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u8D34\u56FE\u7684\u8D34\u5B50\u9700\u8981\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-74:case-75:case-60:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-70:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u63A7\u5236\u5E7F\u544A\u8D34\uFF0C\u9700\u8981\u901A\u8FC7\u5BA1\u6838\u540E\u624D\u80FD\u53D1\u5E03\u3002\u767B\u9646\u7F72\u540D\u53D1\u8D34\u4E0D\u53D7\u6B64\u9650\u5236\u3002";break;case-71:a="\u60A8\u53D1\u8868\u7684\u5E16\u5B50\u592A\u957F\u4E86\u3002\u4E3A\u4E86\u9632\u6B62\u704C\u6C34\uFF0C\u9700\u7CFB\u7EDF\u5BA1\u6838\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u7A0D\u540E\u67E5\u770B";break;default:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85"}return a}};
;var SignNameApply={fillPanelId:"signNamePanel",getUrl:"/f/user/sign_list?t="+(new Date).getTime().toString(36),isFirst:!0,isUsed:0,data:{},template:function(){var e='<div id="signNameWrapper">';if(e+='<input type="checkbox" id="useSignName" name="useSignName"><label for="useSignName">\u4F7F\u7528\u7B7E\u540D\u6863</label>&nbsp;',e+='<span id="signNameShow"'+(0==this.isUsed?'style="display:none;"':"")+">",this.data.signs.length>0){e+='<select id="sign_id" name="sign_id">';for(var s=0,i=this.data.signs.length;i>s;s++){var t=this.data.signs[s];e+='<option value="'+t.id+'"'+(t.id==this.data.used_id?"selected=selected":"")+">"+t.name+"</option>"}e+="</select>",e+='&nbsp;<a style="color:#0449BE" target="_blank" href="/i/sys/jump?type=signsetting">\u67E5\u770B\u5168\u90E8</a>'}else e+='\uFF08\u60A8\u76EE\u524D\u6CA1\u6709\u53EF\u4F7F\u7528\u7684\u7B7E\u540D\u6863\uFF0C&nbsp;<a style="color:#0449BE" target="_blank" href="/i/sys/jump?type=signsetting">\u67E5\u770B\u5168\u90E8</a>)';return e+="</span>",e+="</div>"},active:function(){if(this.isFirst){this.isFirst=!1;var e=this.getUrl;this.postProcess(e,null,this.build)}},postProcess:function(e,s,i){var t=this;null==s?$.get(e,function(e){var s=$.json.decode(e);0==s.no&&"function"==typeof i&&i(t,s)}):$.post(e,SignNameApply._convertToQueryString(s),function(e){var s=$.json.decode(e);0==s.no&&"function"==typeof i&&i(t,s)})},_convertToQueryString:function(e){var s=[];for(var i in e)s.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return s.join("&")},build:function(e,s){e.data=s.data,e.isUsed=s.data.need,e.fillToPage()},fillToPage:function(){$("#"+this.fillPanelId).html(this.template()),this.initPage()},showList:function(){1==this.isUsed?$("#signNameShow").css("display",""):$("#signNameShow").css("display","none")},initPage:function(){1==this.isUsed?$("#useSignName").tbattr("checked",!0):$("#useSignName").tbattr("checked",!1),this.showList(),this.handlerEven()},setisUsed:function(e){this.isUsed=e?1:0,this.showList(),this.postProcess("/f/user/cm/sign_setneed",{need:this.isUsed,tbs:PageData.tbs},null)},handlerEven:function(){var e=this;$("#useSignName").click(function(){e.setisUsed(this.checked)})}};
;var PostHandler={post:function(e,o,t){$.ajax({type:"post",async:!1,dataType:"json",url:e,data:o,success:function(e){t&&t(e)}})},execute:function(e,o,t){var a=FORUM_POST_URL[e],n=["threadDelete","postDelete","goodAdd","goodCancel","threadTopAdd","threadTopCancel"];if($.inArray(e,n)>-1){var d=_.Module;d.use("common/widget/detectManagerBlock",[],function(e){e.doOnNotBlocked(function(){PostHandler.post(a,o,t)})})}else PostHandler.post(a,o,t)}};
;if(!UTSTART)var UTSTART=(new Date).getTime();if(!MOUSEPWD_CLICK)var MOUSEPWD_CLICK=0;var MousePwd=function(){function t(t){if(!t)var t=window.event;var e=0,n=0;return t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft,n=t.clientY+document.body.scrollTop),[e,n]}function e(t){return t.offsetParent?t.offsetLeft+e(t.offsetParent):t.offsetLeft}function n(t){return t.offsetParent?t.offsetTop+n(t.offsetParent):t.offsetTop}function o(o){o.stopPropagation();var i=t(o),r=c[this.id];if(r)r.hover||(r.hover=!0,r.count++);else{var u=e(this),f=n(this),s=u+this.offsetWidth,a=f+this.offsetHeight;r=c[this.id]={hover:!0,count:1,left:u,top:f,right:s,buttom:a}}r["mouse"+r.count]||(r["mouse"+r.count]=[],r["time"+r.count]={start:(new Date).getTime()},c.ma.push(r["mouse"+r.count])),r["mouse"+r.count].push(i),p.push("1")}function i(e){e.stopPropagation();var n=t(e),o=c[this.className];if(o&&o.hover){if(n[0]&&n[0]>o.left&&n[0]<o.right&&n[1]&&n[1]>o.top&&n[1]<o.buttom)return;o["time"+o.count].end=(new Date).getTime(),o.hover=!1}p.push("0")}function r(){var t=c.ma.length;if(t>0){var e=c.ma[t-1];return e[e.length-1]}}function u(){var t="",e=p.length;return e>10&&(p=p.slice(e-10)),t=p.join(",")}function f(){if(m)return h;var t=[r(),u(),(new Date).getTime()-UTSTART,[screen.width,screen.height].join(",")].join("	");return h.c=s(t)+","+g+MOUSEPWD_CLICK,m=!0,h}function s(t){for(var e=[],n={},o=g%100,i=0,r=t.length;r>i;i++){var u=t.charCodeAt(i)^o;e.push(u),n[u]||(n[u]=[]),n[u].push(i)}return e}function a(t){this.elements=t,$.each(t,function(t,e){$("."+e.toString()).bind("mouseover",o),$("."+e.toString()).bind("mouseout",i),v[e.toString()]=t}),$("body").bind("click",function(){MOUSEPWD_CLICK=1})}var c={ea:[],ma:[]},h={},m=!1,g=(new Date).getTime(),v={},p=[];return{start:a,report:f,time:g}}();_.Module.define({path:"common/component/ScrollPanel",sub:{dom:null,$content:null,$scrollBar:null,$scrollButton:null,_hasScroll:!1,_scrollStep:50,_scrollTop:0,_maxHeight:0,initial:function(t){this._buildUI(t),this._bindEvents(t),$(t.container).append(this.dom),this.setHeight(t.height||100),t.content&&this.setContent(t.content),t.scrollBarShow&&this.bind("onScrollBarShow",t.scrollBarShow),t.scrollBarHide&&this.bind("onScrollBarHide",t.scrollBarHide)},_buildUI:function(t){this.dom=$('<div class="tbui_scroll_panel"></div>'),this.dom.html(['<div class="tbui_panel_content j_panel_content clearfix"><ul></ul></div>','<div class="tbui_scroll_bar j_scroll_bar">','<div class="tbui_scroll_button j_scroll_button">&nbsp;</div>',"</div>"].join("")),this.$content=this.dom.find(".j_panel_content:first"),this.$scrollBar=this.dom.find(".j_scroll_bar:first"),this.$scrollButton=this.dom.find(".j_scroll_button:first"),t.padding&&this.$content.css("padding",t.padding)},_bindEvents:function(){var t=this,o=t.$content.get(0);this.$scrollButton.on("drag",function(l,i){if(i){var n=i.position;o.scrollTop=n.top/t.$content.height()*o.scrollHeight}}),this.$content.mousewheel(function(o,l){o.preventDefault(),o.stopPropagation(),t._hasScroll&&t.scrollTopTo(t._scrollTop-l*t._scrollStep)})},scrollTopTo:function(t){var o=this,l=o.$content.get(0),t=Math.max(Math.min(t,l.scrollHeight-o.$content.height()),0);t!=o._scrollTop&&(o._scrollTop=t,o.$content.stop(),o.$content.scrollTop(o._scrollTop),o._resizeScroll())},setHeight:function(t){this._maxHeight=t,this._resizeHeight(),this._resizeScroll(),this.$scrollButton.draggable({containment:"parent"})},setContent:function(t){this.$content.html(t),this.$content.get(0).scrollTop=this._scrollTop=0,this._resizeHeight(),this._resizeScroll()},appendContent:function(t){this.$content.append(t),this._resizeHeight(),this.scrollTopTo(2e4)},clearContent:function(){this.setContent("")},_resizeHeight:function(){this.$content.css("height","");var t=this.$content.get(0),o=t.scrollHeight,l=Math.min(o,this._maxHeight);this.$content.css("height",l)},_resizeScroll:function(){var t=this.$content.get(0),o=t.scrollHeight,l=t.scrollTop,i=this.$content.innerHeight();i>=o?(this.$scrollBar.hide(),this.dom.addClass("tbui_no_scroll_bar"),this.trigger("onScrollBarHide"),this._hasScroll=!1):(this.$scrollBar.show(),this.$scrollBar.height(i),this.$scrollButton.height(i/o*i),this.$scrollButton.css("top",l/o*i),this.trigger("onScrollBarShow"),this._hasScroll=!0)}}});_.Module.define({path:"common/component/CustomEmotion",requires:[],sub:{ORIGINAL_PIC_URL_PREFIX:"https://imgsa.baidu.com/forum/pic/item/",THUMBNAIL_PIC_URL_PREFIX:"https://imgsa.baidu.com/forum/abpic/item/",_template:["<table class='t_emotion_add'>","<tr>","<th>\u63CF\u8FF0</th>","<td><input type='text' name='title' class='ui_textfield j_title'></td>","</tr>","<tr>","<th>\u8868\u60C5\u56FE\u7247</th>","<td><div style='position: relative'><button type='button' class='j_fake_button'>\u4E0A\u4F20</button><div class='upload_button_container j_upload_button'></div><span class='file_name j_file_name'></span></div><div class='j_preview'></div></td>","</tr>","<tr>","<th></th>",'<td><a href="#" class="ui_btn ui_btn_s j_ok"><span><em>\u786E\u5B9A</em></span></a> ','<a href="#" class="ui_btn ui_btn_s j_cancel"><span><em>\u53D6\u6D88</em></span></a></td>',"</tr>","</table>"],initial:function(){},openDialog:function(t){var e=this;this.$root=$(this._template.join("")),e.$previewContainer=e.$root.find(".j_preview");var i=e.$root.find(".j_fake_button");if(t.url){var o=t.url,n=o.substring(o.lastIndexOf("/")+1,o.lastIndexOf("."));e.updatePictureId(n),e.$previewContainer.prev().hide()}this.$root.find(".j_ok").click(function(t){t.preventDefault(),t.stopPropagation();var i=e.$root.find(".j_title").val();null!=e.original&&null!=e.thumbnail?(e.addCustomEmotion({title:i,url:e.original,thumbnail:e.thumbnail}),e.trigger("ok"),a.close()):alert("\u8BF7\u6DFB\u52A0\u56FE\u7247\u4F5C\u4E3A\u81EA\u5B9A\u4E49\u8868\u60C5\uFF01")}),this.$root.find(".j_cancel").click(function(t){t.preventDefault(),t.stopPropagation(),a.close()});var a=new $.dialog({title:"\u6DFB\u52A0\u81EA\u5B9A\u4E49\u8868\u60C5",width:350,html:this.$root});a.show();var s=this.$root.find(".j_upload_button"),r=i.outerWidth(),u=i.outerHeight();s.css({width:r,height:u}),_.Module.use("common/widget/image_uploader_manager",{container:s,width:r,height:u,queueLen:1,maxParallel:1,fid:t.forumId},function(t){t.bind("onFileSelected",function(i,o){var n=o.imageList[0];n&&(s.next().html(n.name),e.$previewContainer.html("\u6B63\u5728\u4E0A\u4F20\uFF0C\u8BF7\u7A0D\u5019..."),t.startUpload())}),t.bind("onComplete",function(t,i){var o=i.imageList[0];if(o&&o.response){var n=o.response;0==n.error_code&&e.updatePictureId(n.info.pic_id_encode)}})})},updatePictureId:function(t){this.thumbnail=this.THUMBNAIL_PIC_URL_PREFIX+t+".jpg",this.original=this.ORIGINAL_PIC_URL_PREFIX+t+".jpg",this.$previewContainer.html("<img src='"+this.thumbnail+"' />")},getCustomEmotions:function(){var t=$.tb.Storage.get("customEmotion");return t?$.json.decode(t):[]},addCustomEmotion:function(t){var e,i=$.tb.Storage.get("customEmotion");i?(e=$.json.decode(i),e.push(t)):e=[t],this.saveCustomEmotion(e)},removeCustomEmotion:function(t){var e=$.tb.Storage.get("customEmotion");if(e){for(var i,o=$.json.decode(e),n=null,a=0;i=o[a];a++)if(t===i.url){n=a;break}null!==n&&o.splice(n,1),this.saveCustomEmotion(o)}},saveCustomEmotion:function(t){var e=new Date;e.setFullYear(e.getFullYear()+1),$.tb.Storage.set("customEmotion",$.json.encode(t),e)}}});_.Module.define({path:"common/component/UeditorEmotion",requires:["common/component/ScrollPanel","common/component/CustomEmotion"],sub:{$container:null,_template:{inner:['<div class="s_layer_content j_content ueditor_emotion_content"></div>','<div  class="s_layer_tab j_tab ueditor_emotion_tab"></div>','<div class="emotion_preview j_emotion_preview"></div>'].join(""),tab:'<div class="s_prev"></div><div class="s_tab_con_wrapper"><ul class="s_tab_content">#{content}</ul></div><div class="s_next"></div>',tabItem:'<li class="s_tab_btn #{isSelected}" data-index="#{index}" data-type="#{type}"><span class="s_tab_btnbg">#{name}</span></li>',table:'<table class="s_layer_table" cellpadding="1" cellspacing="1" align="center" style="border-collapse:collapse;" border="1" bordercolor="#e3e3e3">#{content}</table>',tr:"<tr>#{content}</tr>",td:'<td class="#{tdClassName} j_emotion" border="1" width="#{tdWidth}" height="#{tdHeight}" style="border-collapse:collapse;" data-value="#{index}" data-sname="#{groupName}" data-type="normal" data-class="#{tdClassName}" align="center"  bgcolor="#FFFFFF" data-stype="#{configType}" title="#{tip}" data-surl="#{url}" data-posflag="#{posflag}">#{content}</td>',tdEmpty:'<td width="#{edWidth}" height="#{tdHeight}" bgcolor="#FFFFFF"></td>',a:'<a class="img" href="javascript:void(0)" style="display:block;color:#000;font-size:14px;text-decoration:none;background-position:left #{offset}px;" >#{content}</a>'},path:"//tb2.bdstatic.com/tb/editor/images/",defaultGroup:"face",sequence:["custom","face","ySmile","bearchildren","tiexing","ali","luoluobu","qpx","xyj","lt","bfmn","zxh","tsj","wdj","lxs","baodong","baodong_d","bobo","shadow","ldw","10th"],tableWidth:540,count:0,colsNum:3,emotionConfig:{custom:{folder:"",name:"\u81EA\u5B9A\u4E49",css:{cols:10,"class":"s_custom"},type:"custom",power:0},face:{tip:["\u5475\u5475","\u54C8\u54C8","\u5410\u820C","\u554A","\u9177","\u6012","\u5F00\u5FC3","\u6C57","\u6CEA","\u9ED1\u7EBF","\u9119\u89C6","\u4E0D\u9AD8\u5174","\u771F\u68D2","\u94B1","\u7591\u95EE","\u9634\u9669","\u5410","\u54A6","\u59D4\u5C48","\u82B1\u5FC3","\u547C~","\u7B11\u773C","\u51B7","\u592A\u5F00\u5FC3","\u6ED1\u7A3D","\u52C9\u5F3A","\u72C2\u6C57","\u4E56","\u7761\u89C9","\u60CA\u54ED","\u5347\u8D77","\u60CA\u8BB6","\u55B7","\u7231\u5FC3","\u5FC3\u788E","\u73AB\u7470","\u793C\u7269","\u5F69\u8679","\u661F\u661F\u6708\u4EAE","\u592A\u9633","\u94B1\u5E01","\u706F\u6CE1","\u8336\u676F","\u86CB\u7CD5","\u97F3\u4E50","haha","\u80DC\u5229","\u5927\u62C7\u6307","\u5F31","OK","\u4F24\u5FC3","\u52A0\u6CB9","\u5FC5\u80DC","\u671F\u5F85","\u725B\u903C","\u80DC\u5229","\u8DDF\u4E2B\u6B7B\u78D5","\u8E22\u7403","\u9762\u58C1","\u9876","\u5DF4\u897F\u6012","\u4F34\u821E","\u5954\u8DD1","\u70B9\u8D5E\u624B","\u52A0\u6CB9","\u54ED\u6CE3","\u4EAE\u7EA2\u724C","\u7403\u8FF7","\u8036","\u8F6C\u5C41\u80A1"],num:70,prev:"i_f",folder:"face/",suffix:"png",name:"\u9ED8\u8BA4",css:{cols:10,"class":"s_face",width:35,offset:30},type:"img",power:1},yxj:{tip:["\u5B64\u72EC\u5BC2\u5BDE\u51B7","\u5149\u68CD\u5403\u6839\u6CB9\u6761","\u53EF\u601C\u6CA1\u4EBA\u7231","\u53BBtmd\u5149\u68CD\u8282","\u6765\u6361\u80A5\u7682\u554A","\u7ED9\u8DEA\u4E86","\u60CA\u5446\u4E86","\u62FF\u53BB\u64B8","\u54E6\u5973\u795E","\u697C\u4E3B\u597D\u4EBA"],num:10,prev:"yxj_0",folder:"yxj/",name:"\u75D2\u5C0F\u8D31",suffix:"gif",css:{cols:10,"class":"s_yxj",width:30,offset:30},type:"img",power:1},"10th":{tip:["\u8E66\u8E66\u8DF3\u8DF3","\u6643\u60A0","\u6447\u6447\u6446\u6446","\u5927\u6492\u82B1","\u9AD8\u9AD8\u5174\u5174","\u5F39\u5409\u4ED6","\u9B54\u6CD5\u68D2","\u625B\u5927\u65D7","\u70B9\u8721\u70DB","\u5927\u79E7\u6B4C","\u8D34\u5427\u5341\u5468\u5E74","\u5341\u5468\u5E74"],num:12,prev:"10th_0",folder:"10th/",name:"\u5341\u5468\u5E74",css:{cols:10,"class":"s_tyears",width:42,offset:42},type:"img",power:1},ldw:{tip:["\u4E00\u697C\u5582\u718A","\u4FEF\u5367\u6491","\u6253\u9171\u6CB9","\u56E7","\u5927\u7B11","\u7011\u5E03\u6C57~","\u60CA\u8BB6","\u81ED\u7F8E","\u50BB\u7B11","\u629B\u5A9A\u773C","\u53D1\u6012","\u6211\u9519\u4E86","money","\u6C14\u6124","\u6311\u9017","\u543B","\u6012","\u80DC\u5229","\u59D4\u5C48","\u53D7\u4F24","\u8BF4\u5565\u5462\uFF1F","\u95ED\u5634","\u4E0D","\u9017\u4F60\u73A9\u513F","\u98DE\u543B","\u7729\u6655","\u9B54\u6CD5","\u6211\u6765\u4E86","\u7761\u4E86","\u6211\u6253","\u95ED\u5634","\u6253","\u6253\u6655\u4E86","\u5237\u7259","\u7206\u63CD","\u70B8\u5F39","\u5012\u7ACB","\u522E\u80E1\u5B50","\u90AA\u6076\u7684\u7B11","\u4E0D\u8981\u4E0D\u8981","\u7231\u604B\u4E2D","\u653E\u5927\u4ED4\u7EC6\u770B","\u5077\u7AA5","\u8D85\u9AD8\u5174","\u6655","\u677E\u53E3\u6C14","\u6211\u8DD1","\u4EAB\u53D7","\u4FEE\u517B","\u54ED","\u6C57","\u554A~","\u70ED\u70C8\u6B22\u8FCE"],num:53,prev:"w_00",folder:"ldw/",suffix:"gif",name:"\u7EFF\u8C46\u86D9",css:{cols:10,"class":"s_ldw",width:40,offset:40},type:"img",power:1},lxs:{tip:["lxs\u4E0D\u60F3\u52A8","lxs\u5403\u60CA","lxs\u5439\u53E3\u54E8","lxs\u6253\u6C14","lxs\u6253\u5750","lxs\u7B49\u5F85","lxs\u6124\u6012","lxs\u5E7B\u8C61","lxs\u60CA\u559C","lxs\u5F00\u5FC3","lxs\u54ED\u557C","lxs\u54ED\u7740\u8DD1","lxs\u6CA1\u94B1","lxs\u6015\u9B3C","lxs\u629B\u5A9A\u773C","lxs\u4E03\u5915","lxs\u9A91\u9A6C\u821E","lxs\u5347\u5929","lxs\u77F3\u5316","lxs\u6570\u94B1","lxs\u5077\u5403","lxs\u5077\u7B11","lxs\u4E07\u5723\u8282","lxs\u65E0\u804A","lxs\u65E0\u5948","lxs\u65E0\u8BED","lxs\u59A9\u5A9A","lxs\u6349\u6025","lxs\u8F6C\u6655","lxs\u649E\u8C46\u8150","lxs\u8D58\u8089"],num:31,prev:"lxs_0",folder:"lxs/",suffix:"gif",name:"\u51B7\u5148\u68EE",css:{cols:10,"class":"s_lxs",width:42,offset:42},type:"img",power:1},xyj:{tip:["\u75AF\u5566","\u62B1\u5934\u8DD1","\u4E0D\u60F3\u7761","\u4E0D\u8981\u5440","\u82CD\u8747","\u8E6D\u75D2","\u5230\u7897\u91CC\u6765","\u961F\u957F","\u53D1\u8D22\u5566","\u975E\u6D32\u821E","\u9F13\u638C","\u5E7F\u573A\u821E","\u6EDA\u7B52","\u6A2A\u884C","\u6325\u624B","\u706B\u821E\u9E21","\u5BC2\u5BDE\u5440","\u52A0\u6CB9","\u6C5F\u5357style","\u5A07\u7F9E","\u60CA\u614C\u5931\u63AA","\u7EA0\u7ED3","\u5F00\u996D\u5566","\u96F7\u795E","\u6CEA\u5954","\u804AQQ","\u9EA6\u9738","\u732B\u5973","\u9B54\u5492","\u5C3F\u6025","\u626D\u5C41\u80A1","\u7011\u5E03\u6C57","\u6C42\u9976","\u6492\u5A07","\u5C11\u5973","\u6C34\u51B0\u9E21","\u5929\u7136\u5446","\u5410\u8840","\u73A9\u624B\u673A","\u5A01\u6B66","\u4E94\u9053\u6760","\u821E\u52A8","\u6D17\u6D17","\u54B8\u86CB\u9E21","\u5411\u65E5\u8475","\u9E2D\u5B50\u821E","\u6E38\u6CF3","\u62DB\u8D22\u9E21","\u7167\u955C\u5B50","\u8718\u86DB\u9E21"],num:50,prev:"xyj_0",folder:"xyj/",suffix:"gif",name:"\u5C0F\u5E7A\u9E21",css:{cols:10,"class":"s_xyj",width:42,offset:42},type:"img",power:1},ySmile:{tip:["^_^","(-__-)b","\u2299\uFE4F\u2299\u2016","\u2299\u25BD\u2299"," \u2267\u03B5 \u2266","\u2533\uFF3F\u2533","(\u256C\u25BC\u76BF\u25BC\uFF09","\\(&quot;\u2594\u25A1\u2594)/","\u2196(\uFFE3\u25BD\uFFE3&quot;) ","(\u3065\uFFE33\uFFE3)\u3065 ","(*\uFFE3\u25BD\uFFE3)y ","o(\u2267\u53E3\u2266)o ","(\uFFE3\u03B5\uFFE3*)","/(\u3112o\u3112)/~~ ","(\uFFE3\u03B5\uFFE3*)","&lt;(\uFFE3\uFE36\uFFE3)&gt; ","o(\u2267v\u2266)o","\u256E(\u256F3\u2570)\u256D "," \uFF61\u25D5\u203F\u25D5\uFF61"," \u7F52\u03C9\u7F52","(\u25D5\u03C9\uFF1C)\u2606 ","(\u273F\u272A\u203F\u272A\uFF61)\uFF89 ","\uFF08\u25D5(\uFF6A)\u25D5\uFF09","(\u25CF&#039;\u25E1&#039;\u25CF)\uFF89\u2665","\u03A3(\u3063 °\u0414 °;)\u3063","\u311F( \u2594, \u2594 )\u310F","\u51F8(\u8279\u76BF\u8279 ) ","m(_ _)m","(\u2299x\u2299;)","( =\u2229\u03C9\u2229= )"," \u256E(\u256F\u25BD\u2570)\u256D","(\u22673\u2266)/ ","(\uFF20_\uFF20;)?"," o(*\uFFE3\u25BD\uFFE3*)\u30D6","(o\u309C\u25BD\u309C)o\u2606","&quot;o((&gt;\u03C9&lt; ))o&quot; "],num:36,prev:"",folder:"",name:"\u989C\u8868\u60C5",css:{cols:6,"class":"s_ySmile"},type:"text",power:1},wdj:{tip:[],num:24,prev:"wdj_",suffix:"png",folder:"wdj/",name:"\u8C4C\u8C46\u835A",css:{cols:10,"class":"s_wdj",width:30,offset:30},type:"img",power:1},ali:{tip:["\u8D56\u76AE","\u611F\u52A8","\u60CA\u8BB6","\u6012\u6C14","\u54ED\u6CE3","\u5403\u60CA","\u5632\u5F04","\u98D8\u8FC7","\u8F6C\u5708\u54ED","\u795E\u7ECF\u75C5","\u63EA\u8033\u6735","\u60CA\u6C57","\u9690\u8EAB","\u4E0D\u8981","\u9041","\u4E0D\u516C\u5E73","\u722C\u6765\u4E86","\u86CB\u82B1\u54ED","\u6E29\u6696","\u70B9\u5934","\u6492\u94B1","\u732E\u82B1","\u5BD2","\u50BB\u7B11","\u626D\u626D","\u75AF","\u6293\u72C2","\u6293","\u8737","\u6320\u5899","\u72C2\u7B11","\u62B1\u6795","\u543C\u53EB","\u56B7","\u5520\u53E8","\u634F\u8138","\u72C2\u7B11","\u90C1\u95F7","\u6F5C\u6C34","\u5F00\u5FC3","\u51B7\u7B11\u8BDD","\u9876","\u6F5C","\u753B\u5708\u5708","\u73A9\u7535\u8111","\u5410","\u54ED\u7740\u8DD1","\u963F\u72F8\u4FA0","\u51B7\u6B7B\u4E86","\u60C6\u6005~","\u6478\u5934","\u8E6D","\u6253\u6EDA","\u53E9\u62DC","\u6478","\u6570\u94B1","\u62D6\u8D70","\u70ED","\u52A01","\u538B\u529B","\u8868\u903C\u6211","\u4EBA\u5462","\u6447\u6643","\u6253\u5730\u9F20","\u8FD9\u4E2A\u5C4C","\u6050\u614C","\u6655\u4E4E\u4E4E","\u6D6E\u4E91","\u7ED9\u529B","\u676F\u5177\u4E86"],num:70,prev:"ali_0",folder:"ali/",name:"\u963F\u72F8",css:{cols:10,"class":"s_ali",width:42,offset:42},type:"img",power:1},luoluobu:{tip:["hold\u4F4F","\u963F\u95E8","\u54CE\u54DF","\u5509\uFF5E","\u4E0D\u597D\u610F\u601D","\u4E0D\u8981\u561B\uFF01","\u5531\u6B4C","\u626F\u809A\u76AE","\u626F\u8138","\u6413\u8138","\u6413\u624B","\u6253\u706F\u7B3C","\u6253\u8D77\u7CBE\u795E","\u70B9\u5934","\u70B9\u59342","\u52A8\u52A8\u811A","\u52A8\u52A8\u811A2","\u6296\u811A","\u6296\u811A2","\u55EF\uFF5E","\u53D1\u5446","\u9F13\u638C","\u6EDA\u684C\u5B50","\u597D\u95F2\u963F\uFF5E","\u559D\u8336\u53D1\u5446","\u54FC\uFF01","\u6643","\u54ED","\u56F0\u4E86","\u6269\u80F8\u8FD0\u52A8","\u6765\u6765\u6765","\u6765\u561B\uFF5E","\u51B7\u9759\u51B7\u9759","\u7F57\u7238\u7238\u626D\u626D","\u7F57\u5988\u5988\u626D\u626D","\u9E8B\u9E7F\u7F57\u7F57\u5E03","\u626Dpp","\u626Dpp2","\u626D\u626D","\u6B27\u4E5F","\u8DB4\u7740","\u5207\uFF01","\u53BB\u53BB","\u6492\u82B1","\u4E0AWC","\u5723\u8BDE\u8001\u4EBA","\u5929\u4F7F\u7F57\u7F57\u5E03","\u8DF3\u5440\u8DF3","\u8DF3\u5440\u8DF32","\u73A9\u4E2A\u7403","\u6211\u6765\u4E86","\u563B\u563B","\u5411\u524D\u8FDB","\u4E9A\u514B\u897F","\u6447\u554A\u6447","\u4E00\u8FB9\u5446\u7740\u53BB\uFF01","\u4E00\u8D77\u626D","\u6709\u793C\u4E86","\u8FD9\u53A2\u6709\u793C\u4E86","\u8D70\u5440\u8D70"],num:60,prev:"llb_0",folder:"luoluobu/",name:"\u7F57\u7F57\u5E03",css:{cols:10,"class":"s_luoluobu",width:42,offset:42},type:"img",power:1},qpx:{tip:["\u5FAE\u7B11","\u5E05\u54E5","\u7F8E\u5973","\u8001\u5927","\u54C8\u54C8\u54C8","\u5978\u7B11","\u50BB\u4E50","\u98DE\u543B","\u5BB3\u7F9E","\u82B1\u75F4","\u61A7\u61AC","\u4F60\u725B","\u9F13\u638C","\u53EF\u7231","\u59D4\u5C48","\u5927\u54ED","\u6CEA\u5954","\u5BFB\u6B7B","\u60CA\u8BB6","\u7591\u95EE","\u9119\u89C6","\u5927\u9A82","\u72C2\u6012","\u56E7","\u6655","\u5455\u5410","\u8D22\u8FF7","\u7761\u4E86","\u601D\u8003","\u6C57","\u65E0\u8BED","\u62DC","\u97A0\u8EAC","\u7D2F\u4E86","\u75C5\u4E86","\u5899\u89D2","\u8D85\u4EBA","\u6233","\u8DF3\u821E","\u9B3C\u8138","\u65E0\u804A","\u649E\u5899","\u9876","HI","\u996D","\u86CB\u7CD5","\u793C\u7269","\u5FC3","\u5FC3\u788E","\u73AB\u7470","\u70B8\u5F39","\u96C6\u4F53\u821E","\u6253\u4EBA","\u62CD\u62CD","\u4EB2\u4EB2","\u63E1\u624B","\u5B89\u6170","\u77F3\u5934","\u526A\u5B50","\u5E03","\u606D\u559C\u5566","\u5575\u5575"],num:62,prev:"b",folder:"qpx_n/",name:"\u6C14\u6CE1\u718A",css:{cols:10,"class":"s_qpx",width:35,offset:35},type:"img",power:1},zxh:{tip:["+1","\u54C0\u4F24","\u9971","\u6FD2\u6B7B","\u75C5","\u5403\u8D27","\u4E0D\u6EE1","\u5446","\u5012\u540A","\u70B9\u5B50","\u9876","\u9F13\u638C","\u5BB3\u7F9E","\u6C57","\u5475\u5475\u5475","\u52A0\u6CB9","\u5978\u7B11","\u5978\u8BC8","\u60CA\u8BB6","\u56E7","\u770B","\u62A0\u9F3B\u5B50","\u54ED","\u56F0","\u4E50","\u6E9C\u8D70","\u8DEF\u8FC7","\u4E70\u4F60\u59B9\u7684\u623F\u7EB8","\u6572\u9523","\u4EB2\u543B","\u53BB\u4F60\u59B9\u7684\u5DE5\u4F5C","\u6247\u98CE","\u5931\u843D","\u5237\u7259","\u9003\u547D","\u8DF3\u821E","\u542C\u97F3\u4E50","\u5077\u7B11","\u5410","\u65E0\u8BED","\u559C","\u7B11","\u5174\u594B","\u9E2D\u5B50\u8DF3","\u54AC","\u54AC","\u793C\u7269","\u8D5E","\u9707\u60CA","\u8FFD\u94B1","\u505A\u9B3C\u8138"],num:50,prev:"zxh_0",folder:"pczxh/",name:"\u5F20\u5C0F\u76D2",css:{cols:10,"class":"s_zxh",width:42,offset:42},type:"img",power:1},tsj:{tip:["Kiss","Love","Yeah","\u554A\uFF01","\u80CC\u626D","\u9876","\u6296\u80F8","88","\u6C57","\u778C\u7761","\u9C81\u62C9","\u62CD\u7816","\u63C9\u8138","\u751F\u65E5\u5FEB\u4E50","\u644A\u624B","\u7761\u89C9","\u762B\u5750","\u65E0\u804A","\u661F\u661F\u95EA","\u65CB\u8F6C","\u4E5F\u4E0D\u884C","\u90C1\u95F7","\u6B63Music","\u6293\u5899","\u649E\u5899\u81F3\u6B7B","\u6B6A\u5934","\u6233\u773C","\u98D8\u8FC7","\u4E92\u76F8\u62CD\u7816","\u780D\u6B7B\u4F60","\u6254\u684C\u5B50","\u5C11\u6797\u5BFA","\u4EC0\u4E48\uFF1F","\u8F6C\u5934","\u6211\u7231\u725B\u5976","\u6211\u8E22","\u6447\u6643","\u6655\u53A5","\u5728\u7B3C\u5B50\u91CC","\u9707\u8361"],num:40,prev:"t_00",folder:"tsj/",name:"\u5154\u65AF\u57FA",css:{cols:10,"class":"s_tsj",width:35,offset:35},type:"img",power:1},baodong:{tip:["\u5FC3\u7167\u4E0D\u5BA3","\u84DD\u8138","\u56F0\u60D1","\u591F\u62FD","\u77AA\u773C","\u85D0\u89C6","\u601D\u8003","\u5475\u5475","\u60F3\u8981\u59B9\u5B50","\u5E7B\u60F3","\u65E0\u5948\u7684\u7B11","\u4E3A\u4EC0\u4E48","\u9ED1\u4EBA\u6B6A\u5634","\u6B6A\u5634\u7B11","\u82E6\u903C","\u9762\u762B","\u54AF\u54AF\u54AF","\u751F\u6C14","\u9AD8\u5174","\u559C\u6781\u800C\u6CE3","\u544A\u8BC9\u6211","\u6709\u4E86","\u597D\u5427","\u5B64\u72EC\u4E00\u751F","\u560E\u560E","\u66B4\u8E81","\u7D2B\u6B6A\u5634","\u7EA2\u6B6A\u5634","\u8FD9\u4E0D\u79D1\u5B66","\u7B11\u800C\u4E0D\u8BED","\u56F4\u89C2","\u725B\u4ED4\u6B6A\u5634","\u65B9\u8098\u5B50","\u9707\u60CA","\u60CA\u8BB6","\u98A0\u8986\u4E09\u89C2","\u5C3C\u7F8E\u85D0\u89C6","\u5C3C\u7F8E\u5475\u5475","\u5C3C\u7F8E\u53D1\u5446","\u5C3C\u7F8E\u6709\u4E86","\u732B\u5634\u7B11","\u601D\u6625","\u5C3C\u7F8E\u82E6\u903C","\u7B11\u5C3F","\u5C3C\u7F8E\u54AF\u54AF","\u5C3C\u7F8E\u6B6A\u5634","\u5C3C\u7F8E\u59DA","\u66B4\u8D70\u5C3C\u7F8E","\u5A07\u7F9E","\u5C3C\u7F8E\u9707\u60CA","\u5B64\u72EC\u5C3C\u7F8E","\u5C3C\u7F8E\u5927\u54ED","\u5C3C\u7F8E\u6124\u6012","\u5C3C\u7F8E\u560E\u560E","\u5C3C\u7F8E\u6124\u61D1","\u5C3C\u7F8E\u4E0D\u89E3"],num:56,prev:"b_00",folder:"baodong/",name:"\u66B4\u6F2B\u9759\u6001",css:{cols:10,"class":"s_baodong",width:35,offset:35},type:"img",power:1},baodong_d:{tip:["\u574F\u6DEB","\u6293\u72C2","\u60B2\u621A","\u75DB\u54ED","\u72AF\u8D31","\u5978\u7B11","\u5C4C\u4E1D","\u9AD8\u547C","\u611F\u53F9","\u611F\u52A8","\u618B\u5C48","\u8212\u723D","\u574F\u7B11","\u5C41\u98A0","\u77B3\u672F","\u6742\u800D","\u59DA\u8138","\u5B64\u72EC","\u66B4\u8D70","\u6F47\u6D12","\u5931\u671B","\u540C\u684C","\u53D8\u8138","\u5F97\u745F","\u8179\u9ED1\u7537","\u8179\u9ED1\u5973","\u591F\u62FD","\u767D\u9886","\u55B5\u5C3C\u739B","\u6C6A\u5C3C\u739B","\u563F\u563F\u5C3C\u739B","\u52FE\u5F15","\u53D1\u6CC4","\u64CD\u64CD\u64CD"],num:34,prev:"bd_00",folder:"baodong_d/",name:"\u66B4\u6F2B\u52A8\u6001",css:{cols:10,"class":"s_baodong_d",width:35,offset:35},type:"img",power:1},bobo:{tip:["HI","KISS","\u4E0D\u8BF4","\u4E0D\u8981","\u626F\u82B1","\u5927\u5FC3","\u9876","\u5927\u60CA","\u98DE\u543B","\u9B3C\u8138","\u5BB3\u7F9E","\u53E3\u6C34","\u72C2\u54ED","\u6765","\u6CEA\u773C","\u6D41\u6CEA","\u751F\u6C14","\u5410\u820C","\u559C\u6B22","\u65CB\u8F6C","\u518D\u89C1","\u6293\u72C2","\u6C57","\u9119\u89C6","\u62DC","\u5410\u8840","\u5618","\u6253\u4EBA","\u8E66\u8DF3","\u53D8\u8138","\u626F\u8089","\u5403To","\u5403\u82B1","\u5439\u6CE1\u6CE1\u7CD6","\u5927\u53D8\u8EAB","\u98DE\u5929\u821E","\u56DE\u7738","\u53EF\u601C","\u731B\u62BD","\u6CE1\u6CE1","\u82F9\u679C","\u4EB2","","\u9A9A\u821E","\u70E7\u9999","\u7761","\u5957\u5A03\u5A03","\u6345\u6345","\u821E\u5012","\u897F\u7EA2\u67FF","\u7231\u6155","\u6447","\u6447\u6446","\u6742\u800D","\u62DB\u8D22","\u88AB\u6BB4","\u88AB\u7403\u95F7","\u5927\u60CA","\u7406\u60F3","\u6B27\u6253","\u5455\u5410","\u788E","\u5410\u75F0"],num:63,prev:"B_00",folder:"bobo/",name:"\u6CE2\u6CE2",css:{cols:10,"class":"s_bobo",width:35,offset:35},type:"img",power:1},shadow:{tip:["\u7126\u7CD6\u821E","\u7FFB\u6EDA","\u62CD\u5C41\u80A1\u505A\u9B3C\u8138","\u4E0D","\u6CB3\u87F9\u6389\u5566","\u54E6\u8036","\u6211\u5012","\u6295\u964D","\u542C\u97F3\u4E50","\u88AB\u7838","\u5410\u820C\u5934","\u592A\u597D\u5566","\u8D22\u6E90\u6EDA\u6EDA","\u4EBA\u5462","\u6325\u624B\u5E15","\u5077\u7B11","\u5377\u88AB","\u770B\u697C\u4E0A","\u6211\u62BD","\u6709\u6728\u6709","\u54ED","\u6B22\u547C","\u50BB\u516E\u516E","\u6247\u6247\u5B50","\u62CD\u624B","\u7D27\u5F20","\u6D17\u6FA1","\u8036","\u5403\u897F\u74DC","\u7EB3\u5C3C","\u6CA1\u6709\u94B1","\u62FF\u73A9\u5076","\u6765\u770B\u770B","\u54C7\u54C7\u53EB","\u62DB\u8D22\u732B","\u653E\u5C41","\u9686\u91CD\u4ECB\u7ECD","\u6C42\u4F60\u4E86","\u649E\u73BB\u7483","\u773A\u671B","\u6492\u82B1","\u73A9\u94C3\u94DB","\u601D\u8003\u8005","\u62BD\u98CE","\u5403\u82F9\u679C","\u5149\u68CD"],num:46,prev:"yz_0",folder:"shadow/",name:"\u5F71\u5B50",css:{cols:10,"class":"s_shadow",width:42,offset:42},type:"img",power:1},lt:{tip:["\u4E2D\u7BAD","LS\u53BB\u6B7B","LS\u53BB\u6B7B\u5B50\u5F39","LS\u53BB\u6B7B\u589E\u5F3A","LS\u53BB\u6B7B\u70AE\u5F39","\u677F\u51F3","\u4E0D\u723D","\u4E0D\u8981","\u8D85\u4EBA","\u5403\u96F6\u98DF","\u62BD\u70DF","\u4E32","\u6253\u72D7","\u6253\u9171\u6CB9","\u6253\u4F60","\u6234\u58A8\u955C","\u86CB","\u8361\u6F3E","\u9876\u7834\u697C\u4E0A","\u53D1\u61F5","\u653E\u5C41","\u8D1F\u5206\u6EDA\u7C97","\u559D\u5927\u4E86","\u547C\u5566\u5708\u513F","\u62A4","\u6ED1\u51B0","\u753B\u5708\u5708","\u706B\u94B3\u5218","\u8D31\u8D31\u7684","\u60CA\u5413","\u62A0\u811A","lt\u54ED","\u62C9\u7C91\u7C91","\u64B8","\u6320PP","\u95F9","\u6392\u7403","\u524D\u6392","\u6572\u624B\u9F13","\u6C99\u53D1","\u5254\u7259","\u5154\u5B50\u8E66\u8D77\u6765","\u6316\u9F3B\u5C4E","\u65E0\u8BED","\u778E\u4E86","\u79C0\u808C\u8089","\u6447\u6EDA","\u610F\u5916\u60CA\u559C","\u9707\u60CA","\u6B63\u6B65"],num:50,prev:"ltn_0",folder:"lt/",name:"\u51B7\u5154",css:{cols:10,"class":"s_lt",width:42,offset:42},type:"img",power:1},bfmn:{tip:["\u7231\u4F60","\u50B2\u5A07","\u6253\u4F60","\u5E26\u56DE\u53BB\u538B\u5BE8","\u7ED9\u8138\u4E0D\u8981\u8138","\u6EDA\uFF08\u767E\u5EA6\u72EC\u5BB6\uFF09","\u6EDA","\u597D\u559C\u6B22","\u6CEA\u5954","\u5973\u5C4C\u4E1D","\u6DF1\u4E95\u51B0","\u7B97\u4F60\u72E0","\u6211\u7F8E","\u867E\u7C73","\u4E0D\u8981","\u597D\u5D07\u62DC","\u6CEA\u5954","\u4F60\u59B9\u554A","\u4F60\u9020\u4E48","\u6C42\u4EA4\u5F80","\u9A9A\u5E74","\u571F\u8C6A\u505A\u670B\u53CB\uFF08\u767E\u5EA6\u72EC\u5BB6\uFF09","\u56F4\u89C2","\u65E0\u836F\u53EF\u533B","\u518D\u89C1","\u5728\u4E48","call-me","no-zuo-no-die"],num:28,prev:"bfmn_0",folder:"bfmn/",name:"\u767D\u53D1\u9B54\u5973",css:{cols:10,"class":"s_bfmn",width:40,offset:41},type:"img",power:1},bearchildren:{tip:["88","HI","\u4EBA\u8270\u4E0D\u62C6","\u5565","\u5927\u54ED","\u5931\u843D","\u6012\u8D5E","\u60CA\u5446\u4E86","\u674E\u83CA\u798F","\u6765\u4FE1\u780D","\u6B22\u8FCE\u5165\u7FA4","\u725B\u95EA\u95EA","\u751F\u65E5\u5FEB\u4E50","\u77F3\u5316","\u7F9E\u7F9E\u54D2","\u80A5\u7682\u5FC5\u6740","\u8C22\u8C22\u4F60","\u8DF3\u821E","\u9739\u96F3\u821E","\u9F13\u638C","\u5077\u5185\u88E4","\u54E6\u8036","\u54ED","\u559C\u6B22","\u597D\u68D2","\u6454","\u6C42\u7B7E\u540D","\u83CA\u82B1","\u5C41","\u54ED","\u9876","+1","biu","\u4EB2\u4EB2","\u97AD\u5211","\u80E1\u5B50","\u50F5\u5C38","\u6349\u6025","\u626D\u626D","\u63D2\u697C\u4E0A","\u559C\u6B22","\u8DEA\u6C42","\u7F9E\u7F9E","\u62A0\u9F3B\u5B50","\u4F11\u606F\u4E00\u4E0B","\u5DF2\u6B7B","\u5FD9\u7740\u5462","\u6C57","\u6DA8\u59FF\u52BF","\u7CCA\u4F60\u718A\u8138","\u8C1C\u56E2","\u98DE\u543B","love","\u54E6\u8036","\u54ED","\u5D29\u6E83","\u561A\u745F","\u65AD\u7F51","\u6D17\u6FA1","\u8D2D\u7269"],num:60,prev:"bearchildren_",folder:"bearchildren/",name:"\u718A\u5B69\u5B50",css:{cols:10,"class":"s_bearchildren",width:40,offset:40},type:"img",power:1},tiexing:{tip:["ILOVEU","\u4E0A\u73ED\u4E2D","\u4E0D\u8981\u561B","\u4E2D\u7BAD","\u4EF0\u5367\u8D77\u5750","\u4F53\u64CD","\u54C8\u54C8","\u54ED","\u597D\u57FA\u53CB","\u5BC2\u5BDE","\u561A\u745F","\u60CA\u5446\u4E86","\u6311\u8845","\u6413\u6FA1","\u649E\u5934","\u65E0\u804A","\u6D17\u6FA1","\u6D17\u8863\u670D","\u70B9\u624B\u6307","\u725B\u903C","\u73A9\u6C34\u679C","\u751F\u75C5","\u76AE\u97AD\u4F3A\u5019","\u7761\u89C9","\u793A\u7231","\u7ED9\u8DEA\u4E86","\u80DC\u5229","\u8BA8\u538C","\u8DDF\u4E2B\u6B7B\u78D5","\u8E22\u7403","\u8EBA\u67AA","\u9001\u7EB8","\u9003\u8DD1","\u9876","\u9A6C\u8428\u5409","\u4E0D\u670D","\u4EB2\u543B","\u4F24\u5FC3","\u5207\u514B\u95F9","\u52A0\u6CB9","\u52FE\u5F15","\u5343\u5E74\u6740","\u53BBtmd","\u53D1\u6296","\u5403","\u547C\u54C8","\u54ED","\u5931\u843D","\u5B64\u72EC","\u5E86\u795D","\u561A\u745F","\u5FC5\u80DC","\u60CA","\u62BD","\u62BD\u4E2B\u7684","\u6311\u8845","\u6361\u80A5\u7682","\u6492\u82B1","\u649E\u5899","\u671F\u5F85","\u677F\u51F3","\u72AF\u8D31","\u7B11","\u8DEF\u8FC7","\u9119\u89C6","\u9762\u58C1","\u9876","\u9876\u697C\u4E0A","\u9C81","\u9F13\u638C"],num:70,prev:"tiexing_",folder:"tiexing/",name:"\u75D2\u5C0F\u8D31",css:{cols:10,"class":"s_tiexing",width:40,offset:40},type:"img",power:1}},initial:function(t){var e=this,o=t.container;t.customEmotionEnable&&(this.emotionConfig.custom.power=1,this.defaultGroup="custom"),this.$container=o,this.defaultGroup=t.defaultGroup||e.defaultGroup,o.html(this._template.inner),this.$content=o.find(".j_content"),this.$tab=o.find(".j_tab"),e.scrollPanel=e.use("common/component/ScrollPanel",{container:e.$content,height:277,content:""}),t.customEmotionEnable&&(this.customEmotion=this.use("common/component/CustomEmotion"),this.customEmotion.bind("ok",function(){e.scrollPanel.$content.html(e.generateCustomTable())})),e.generateTabList(),e.switchTab(e.defaultGroup),e.initEvent()},initEvent:function(){this.$container;this.initEmotionEvent(),this.initTabEvent()},initEmotionEvent:function(){var t=this,e=this.getMouseenterHandler(this);this.$content.on("mouseleave",".j_emotion, .j_custom_emotion",function(){$(this).css("background-color","#ffffff"),$(".j_emotion_preview").hide().removeClass("emotion_preview_show")}),this.$content.on("mouseenter",".j_emotion, .j_custom_emotion",function(){e.call(this)}),this.$content.on("click",".j_emotion",function(){var e=$(this),o={url:e.data("surl"),type:e.data("stype"),title:e.tbattr("title")};"text"==e.data("stype")?$.stats.sendRequest("ev_type=click&st_mod=editor&st_type=text&st_value="+e.tbattr("title")):t.sendStats(e,"click"),t.trigger("insertemotion",o)}).on("click",".j_custom_emotion",function(e){var o=$(e.target);if(o.hasClass("j_delete")){if(confirm("\u786E\u8BA4\u8981\u5220\u9664\u6B64\u8868\u60C5\u5417\uFF1F")){var s=o.parent().data("surl");t.customEmotion.removeCustomEmotion(s),t.scrollPanel.$content.html(t.generateCustomTable())}}else t.trigger("insertemotion",{url:$(this).data("surl"),type:"custom"})}).on("click",".j_add_emotion",function(){t.customEmotion.openDialog({forumId:PosterContext.getContext().forum.id})})},initTabEvent:function(){var t=this;this.$tab.on("click",".s_prev",function(){t.prevTab()}).on("click",".s_next",function(){t.nextTab()}).on("click","li",function(){var e=$(this).data("type");e&&t.switchTab(e)}).on("mouseenter",".s_tab_btn",function(){$(this).addClass("s_hover")}).on("mouseleave",".s_tab_btn",function(){$(this).removeClass("s_hover")})},sendStats:function(t,e){var o=t.data("value"),s=t.data("sname"),i=[40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60];try{s&&"10th"==s&&$.stats.track(o,"PC\u7AEF\u5341\u5468\u5E74\u53D1\u5E16\u8868\u60C5\u70B9\u51FB\u7EDF\u8BA1"),-1!=$.inArray(o,i)?$.stats.sendRequest("st_all=doubleeleven&ev_type="+e+"&st_mod=editor&st_type="+s+"&st_value="+o):$.stats.sendRequest("ev_type="+e+"&st_mod=editor&st_type="+s+"&st_value="+o)}catch(n){}},getMouseenterHandler:function(){function t(){var t=e.width(),o=e.height();(t>60||o>60)&&(t>o?(e.width(60),e.height(60*(o/t))):(e.height(60),e.width(60*(t/o))));var s=(60-e.width())/2,i=(60-e.height())/2;e.css({left:s,top:i})}var e=null,o=null;return function(){var s=$(this),i=$(".j_emotion_preview");e&&e.remove(),s.css("background-color","#e8e8fd"),"text"!==s.data("stype")&&(e=$("<img/>"),e.addClass("review"),e.load(function(){clearTimeout(o),i.show();var n=e.width(),a=e.height();0==n||0==a?o=setTimeout(arguments.callee,50):(t(),1==s.data("posflag")&&i.addClass("emotion_preview_show"))}).error(function(){o=setTimeout(function(){e.tbattr("src",s.data("surl"))},50)}).tbattr("src",s.data("surl")),i.append(e))}},getEmotionFileName:function(t,e,o){return"i_f"==t&&e>=51&&(o="gif"),t+(10>e?"0":"")+e+"."+o},generateEmotions:function(t){var e=this,o=this.scrollPanel,s=this.emotionConfig,i=s[t],n=this.path,a=n+i.folder,l=i.css.cols,r=l/2,c=this.tableWidth/l,m=c;"text"==i.type&&(m/=2);var d,u=i.css["class"],p=i.css.offset,f=i.suffix||"gif",h=i.prev,_=this._template.table,b=this._template.tr,v=this._template.tdEmpty,g=this._template.td,x=this._template.a,w="",y=function(t){for(var o="",s=0,n=i.num;n>s;){for(var d="",_=0;l>_;_++,s++){var w=e.getEmotionFileName(h,s+1,f);if(w&&n>s){var y=a+w+"?t=20140803",j=r>_?0:1,E=p*s*-1;("lt"==t||"ali"==t)&&(E-=1),"ali"==t&&(E+=3);var C="text"==i.type?i.tip[s]:"&nbsp;",T=$.tb.format(x,{offset:E,content:C});d+=$.tb.format(g,{tdClassName:u,tdWidth:c,tdHeight:m,index:s,groupName:t,configType:i.type,tip:i.tip[s],url:y,posflag:j,content:T})}else d+=$.tb.format(v,{})}o+=$.tb.format(b,{content:d})}return o};d="custom"==i.type?this.generateCustomTable():y(t),w+=$.tb.format(_,{content:d}),o.setContent(w),o.$content.css("height",277)},generateCustomTable:function(){function t(t,e){return t?t.option?'<td><button type="button" class="j_add_emotion">\u6DFB\u52A0</button></td>':(t.posFlag=5>e?0:1,$.tb.format('<td class="emotion_cell"><a href="javascript:void(0)" class="j_custom_emotion" data-surl="#{url}" data-posflag="#{posFlag}"><div class="emotion_hole"><img title="#{title}" src="#{thumbnail}" onload="$.tb.resizePic(this, 50, 50, true);" /></div><div class="emotion_delete j_delete"></div></a></td>',t)):"<td>&nbsp;</td>"}function e(e,o){var s=[];s.push("<tr>");for(var i=0;10>i;i++)s.push(t(e[i+o],i));return s.push("</tr>"),s.join("")}var o=this.customEmotion.getCustomEmotions();o.push({option:"add"});for(var s=[],i=0,n=Math.floor(o.length/10)+1;n>i;i++)s.push(e(o,10*i));return"<table class='ue_emotion_table' cellspacing='1'>"+s.join("")+"</table>"},generateTabList:function(){for(var t=this.sequence,e=this.emotionConfig,o=this._template.tab,s=this._template.tabItem,i="",n=0,a=t.length;a>n;n++){var l=t[n];if(e[l].power){var r={isSelected:l===this.currentGroup?"selected":"",index:n,type:l,name:e[l].name};i+=$.tb.format(s,r)}}i=$.tb.format(o,{content:i}),this.$tab.html(i)},getTab:function(t){return this.$tab.find("li").filter('[data-type="'+t+'"]')},nextTab:function(){var t=this,e=this.$tab.find("ul");t.count=++t.count>=t.colsNum?t.colsNum-1:t.count,e.stop().animate({marginLeft:-502*t.count},500,"linear")},prevTab:function(){var t=this,e=this.$tab.find("ul");t.count=--t.count<1?0:t.count,e.stop().animate({marginLeft:-502*t.count},500,"linear")},activateTab:function(t){var e=this.$tab;e.find("li").removeClass("selected"),this.getTab(t).addClass("selected")},switchTab:function(t){var e=this;e.currentGroup=t,e.activateTab(t),e.generateEmotions(t)}}});_.Module.define({path:"common/widget/IndependentEmotion",requires:[],sub:{initial:function(e){this.$container=e.container||$("body"),this.$smiley=e.smiley||null,this.editor=e.editor||null,this.caretLocate=e.caretLocate,this.emotion=!1,this._buildSmileBody()},_buildSmileBody:function(){var e='<div class="inde_edui_dropdown_menu"></div><div class="inde_edui_popup_caret"></div>';this.$container.html(e)},_render:function(){this.setCaretLocate(),this._renderEmotion(),this.emotion=!0},_renderEmotion:function(){var e=this,i=$('<div class="j_emotion_container emotion_container"></div>');e.$container.find(".inde_edui_dropdown_menu").append(i),_.Module.use("common/component/UeditorEmotion",[{container:i}],function(i){i.bind("insertemotion",function(i,t){if(e.hide(),!e.editor)return!1;if("custom"==t.type)t.picType=1,e.editor.execCommand("insertimage",[t]);else{var n='<img unselectable="on" pic_type="" class="BDE_Smiley" src="#{url}">',o="text"===t.type?t.title:$.tb.format(n,t);e.editor.execCommand("inserthtml",o)}})})},setCaretLocate:function(){var e=this.caretLocate,i={};e&&($.each(e,function(e,t){i[e]=t}),this.$container.find(".inde_edui_popup_caret").css(i))},show:function(){!this.emotion&&this._render(),this.$container.show()},hide:function(){this.$container.hide()},toggle:function(){!this.emotion&&this._render(),this.$container.toggle()}}});_.Module.define({path:"common/widget/SimplePoster",requires:["common/widget/ParamsXssHandler"],sub:{initial:function(t){this.paramsXssHandler=this.requireInstance("common/widget/ParamsXssHandler"),this.option=t&&t.op,this._edOp_t=t&&t.edOp;var e=PageData.user.has_grade?PageData.user.level_id:PageData.user.is_like||0,e=PageData.user.is_like||(PageData.user.has_grade?PageData.user.level_id:PageData.user.is_like||0);this._edOp_t.bavl=e;var i=$("#j_simpleeditor_tpl").html();this.cur_sec=t.edOp.container,this.cur_sec.innerHTML=i,this.j_ed_container=$("#j_editor_for_container");var a=$(t.edOp.container);this._bc=a.find(".lzl_panel_btn"),this._enabled=!0,this._eh=a.find(".lzl_panel_error"),this._event={},this._statInit(t.op._login,t.op._can_post,t.op._no_un),$(".lzl_panel_wrapper").find("a").on("click",function(){$.stats.track("\u697C\u4E2D\u697C\u56DE\u590DPlaceHolder","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click")})},_statInit:function(t,e,i){var a=this.option;if(!t)return this._cannotPost(),void 0;if(t&&1==e&&i)return this._cannotPost(),void 0;if(t&&1!=e)return this._cannotPost(),void 0;if(a._reach_limit)return this._cannotPost(),void 0;if(a._is_block)return this._cannotPost(),void 0;if("pb"==PageData.product&&PageData.feedback&&0!=PageData.feedback&&PageData.user.user_name!=PageData.thread.author)return this._cannotPost(),void 0;if(t&&1==e&&!i){var n=this.cur_sec,o=$(n).find(".editor_for_container")[0];this._buildNormalEditor(o),this._postBtnInit("enble")}},_cannotPost:function(){var t=this.cur_sec;this._buildLimitedEditor(t),this._postBtnInit("disable")},_postBtnInit:function(t){switch(t){case"disable":this._disableEditor(),this._disableSmile();break;case"enble":var e=this._bc,i=this,a=e.find("span.j_lzl_p_sm");a.css("position","relative"),PageData.is_ipad?a.hide():this._addSmiley(),a=e.find("span.j_lzl_p_sb"),a.hover(function(){$(this).addClass("lzl_panel_submit_hover")},function(){$(this).removeClass("lzl_panel_submit_hover lzl_panel_submit_active")}),a.bind("click",function(t){$(this).addClass("lzl_panel_submit_active"),i.submitClick(),t.target.blur()})}},_addSmiley:function(){var t=$(this.cur_sec),e=this,i=t.find("span.j_lzl_p_sm"),a=t.find(".lzl_edui_dialog_container");e.indeSmile=e.use("common/widget/IndependentEmotion",{container:a,editor:e._se}),t.on("click",".j_lzl_p_sm",function(){e.indeSmile.toggle()}),$("body").on("click",function(t){t.target===i[0]||$.contains(i[0],t.target)||$.contains(a[0],t.target)||e.indeSmile.hide()})},bind:function(t,e,i){var a={stat:i?!0:!1,fun:e};this._event[t]?this._event[t].push(a):(this._event[t]=[],this._event[t].push(a))},triggerEvent:function(t){if(this._event[t])for(var e=this._event[t],i=0;i<e.length;i++)if(e[i].fun&&e[i].fun(),!e[i].stat)return!1;return!0},_buildLimitedEditor:function(){var t=this;if(!t._fe){var e=$("<div>");e.addClass("lzl_simple_wrapper");var i=(this._edOp_t,$(t.cur_sec).find(".editor_for_container"));e.css({width:t._edOp_t.width,height:t._edOp_t.height,position:"static"}),e.append(t._buildLimitedInfo()),t._fe=e}i.append(t._fe)},_tip:["","\u53C2\u4E0E\u672C\u5427\u8BA8\u8BBA\uFF0C\u8BF7\u5148 ","\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53CA\u6CE8\u518C\u6EE1\u4E00\u5B9A\u65F6\u95F4\u7684\u8001\u7528\u6237\u53D1\u8D34","\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8","\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53D1\u8D34","\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34","","\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u56DE\u590D\u8D34","\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u4E3B\u9898\u8D34","\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8","\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8","\u4E0D\u597D\u610F\u601D\u54E6\uFF0C\u672C\u697C\u76EE\u524D\u53EA\u5141\u8BB8\u697C\u4E3B\u56DE\u590D\u54E6~<br/>\u5982\u679C\u4F60\u6709\u76F8\u540C\u6216\u5176\u4ED6\u7684\u95EE\u9898\uFF0C\u8BF7\u5728\u672C\u5427\u53D1\u8D34\u53CD\u9988\u54E6~"],_buildLimitedInfo:function(){var t,e=$("<p>"),i='<div class="editor_banned_tip_info">',a=this.option,n=this;return a._reach_limit?(i+="<span>\u672C\u697C\u5C42\u56DE\u590D\u5DF2\u8FBE\u4E0A\u9650\uFF0C\u8BF7\u53C2\u4E0E\u5176\u4ED6\u697C\u5C42\u8BA8\u8BBA</span>",i+="</div>",e.html(i),e.css({margin:"14px 0 0 14px"})):a._is_block?(i+='<span class="j_ban_info"></span></div>',e.html(i),e.css({margin:"3px 0 0 14px"})):(i+="<span>",1==a._can_post&&a._no_un?(i+="\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u56DE\u590D\u3002\u8BF7\u5148<a href=\"javascript:void(0)\"  onclick=\"TbCom.process('User','buildUnameFrame','\u586B\u5199\u7528\u6237\u540D',' ')\">\u586B\u5199\u7528\u6237\u540D</a>",i+="</span>",i+="</div>",e.html(i),e.css({margin:"4px 0 0 14px"})):("pb"==PageData.product&&PageData.feedback&&0!=PageData.feedback&&PageData.user.user_name!=PageData.thread.author&&(a._forum_type=11),i+=n._tip[a._forum_type],i+="</span>",1==a._forum_type?(i+='<span class="lzl_login_wrapper">',i+="<a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', 'lzl']);return false;\">\u767B\u5F55</a>",i+="&nbsp;|&nbsp",i+="<a href=\"#\" onclick=\"TbCom.process('User', 'buildRegisterFrame', 'lzl');return false;\">\u6CE8\u518C</a>",i+="</span>"):3==a._forum_type?i+='<a href="//tieba.baidu.com/f/like/level?kw=d8" >4\u7EA7\u5934\u8854</a>\u4EE5\u4E0A\u4F1A\u5458\u53D1\u8D34\u3002':9==a._forum_type?i+="\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u56DE\u590D\u8D34\u3002":10==a._forum_type&&(i+="\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u4E3B\u9898\u8D34\u3002"),i+="</div>",e.html(i),3==a._forum_type||a._forum_type>=7?e.css({margin:"5px 0 0 14px"}):e.css({margin:"14px 0 0 14px"}))),_.Module.use("ueglibs/widget/Ban",[],function(i){t=i.render("simplePoster")||"",t=t.replace(/(href=\")(.*?)(\")/,"$1$2"+PageData.forum.forum_id+"$3"),e.find(".j_ban_info").html(t)}),e},_buildNormalEditor:function(){var t=this,e=(t.option,t._edOp_t),i={initialFrameHeight:/%$/.test(e.height)?e.height:parseInt(e.height)||40,initialFrameWidth:/%$/.test(e.width)?e.width:parseInt(e.width)||527,maxHeight:parseInt(e.height)||40,maxWordNum:e.maxWordNum||140,focusChangeColor:0,noToolbar:1,toolbar:[],excludePlugins:["emotion_transform"]};UE.clearCache("j_editor_for_container");var a=UE.getEditor("j_editor_for_container",i);a.ready(function(){a.addListener("overflow",function(){t._overFlow()}),a.addListener("unoverflow",function(){t._unoverFlow()}),t.j_ed_container.on("keydown",function(e){t._keyDown(e)}),t.j_ed_container.on("keyup",function(e){t._keyUp(e)}),e.autoFocus&&a.focus()}),t._se=a},_overFlow:function(){this._disableEditor()},_unoverFlow:function(){this._enableEditor()},_disableEditor:function(){var t=this;t._enabled=!1;var e=t._bc.find("span.j_lzl_p_sb");e.removeClass("lzl_panel_submit"),e.html(""),e.addClass("lzl_panel_submit_disabled")},_disableSmile:function(){var t=this,e=t._bc.find("span.j_lzl_p_sm");return PageData.is_ipad?(e.hide(),void 0):(t._enabled=!1,e.removeClass("lzl_panel_smile"),e.html(""),e.addClass("lzl_panel_smile_disabled"),void 0)},_enableEditor:function(){var t=this;t._enabled=!0;var e=t._bc.find("span.j_lzl_p_sb");e.removeClass("lzl_panel_submit_disabled"),e.addClass("lzl_panel_submit"),e.html("\u53D1\u8868")},_keyDown:function(t){var e=this;17==t.keyCode?e._ctrl_down=!0:13==t.keyCode&&e._ctrl_down&&(e.submitClick(),t.srcElement?t.srcElement.blur():t.target.blur()),t.altKey&&83==t.keyCode&&(t.preventDefault?t.preventDefault():t.returnValue=!1,setTimeout(function(){e.submitClick()},0))},_keyUp:function(t){17==t.keyCode&&(this._ctrl_down=!1)},_ie6RelativeHack:function(){var t=this,e=$(t.cur_sec),i=this._bc;e.find("div.insertsmiley_holder").hide();var a=e.find("div.wordlimit-holder"),n=i.find("span.j_lzl_p_sm");n.css("position","static"),"hidden"!=a.css("visibility")?(e.find("div.wordlimit-holder").hide(),t._hint_shown=!0):t._hint_shown=!1,e.find("div.lzl_simple_wrapper").css("position","static")},_ie6RelativeRecover:function(){var t=this,e=$(t.cur_sec),i=this._bc;e.find("div.insertsmiley_holder").show();var a=e.find("div.wordlimit-holder");this._hint_shown&&a.show();var n=i.find("span.j_lzl_p_sm");n.css("position","relative"),e.find("div.lzl_simple_wrapper").css("position","relative")},_getHtml:function(){var t=this._se.getContent();return t=t.replace(/<br[^>]*>/gi," ").replace(/[\u3000\s]+/g," ").replace(/&nbsp;/g," ")},_getUbbContent:function(){return UE.utils.html2ubb(this._getHtml())},_data:{},submitClick:function(){if(1===PageData.thread.is_ad&&document.images){var t=new Image;t.src=PageData.ecomStatDomain+"reply.php?forumid="+(PageData.forum.forum_id||"")+"&tid="+(PageData.thread.thread_id||"")+"&userid="+(PageData.user.user_id||"")+"&username="+encodeURIComponent(PageData.user.user_name||"")+"&exp="+encodeURIComponent(PageData.ecomExp||"")+"&t="+(new Date).getTime(),t=null}var e=this,i=$(e.cur_sec),a=i.find("div.insertsmiley_holder");return i.find("span.close").click(),a.css("position","static"),this._isValid()?(a.css("position","relative"),this._submitData(),void 0):(a.css("position","relative"),void 0)},_isValid:function(){return this._enabled?this._se.getContentLength()?this._se.getSmileyNum()>10?(this._eh.html("\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u8868\u60C5\u4E0D\u80FD\u8D85\u8FC710\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4").show(),!1):!0:(this._se.focus(),this._eh.html("\u53D1\u8D34\u5185\u5BB9\u9700\u5305\u542B\u6587\u5B57").show(),!1):!1},_submitData:function(){this._eh.hide(),this._disableEditor();var t=this,e=t._getData();$.tb.post(FORUM_POST_URL.postAdd,e,function(i){if(t._setPostData("vcode",""),t._setPostData("vcode_md5",""),0==i.no){{t.triggerEvent("onsuccess")}t._se.setContent(""),t.option.__data__&&(t.option.data=t.option.__data__,t.option.__data__=null),t._enableEditor();{t.triggerEvent("hide")}_.Module.use("frs/widget/snowflow",[e.content])}else t._showAddResult(i),t._enableEditor();return!1})},_setData:function(t){this.option.__data__=this.option.data,this.option.data=$.extend(this.option.data,t)},_setPostData:function(t,e){this._data[t]=e},_getData:function(){var t=this.option,e=t.data,i=this;i._data.kw=PageData.forum.forum_name,i._data.fid=PageData.forum.forum_id,i._data.tid=PageData.thread.thread_id,i._data.floor_num=e.floor_num,i._data.quote_id=e.pid,i._data.rich_text=1,i._data.tbs=PageData.tbs,i._data.content=i._getUbbContent(),i._data.lp_type=t._thread_topic_type,i._data.lp_sub_type=t._thread_topic_subtype,i._data.new_vcode=1,i._data.tag=11,i._data.repostid=void 0!=e.spid?e.spid:e.pid,i._data.anonymous=1==i._no_un?1:0;try{var a=window.external.GetVersion("version");a.indexOf("baidubrowser")>-1&&(i._data.browser_version="baidubrowser")}catch(n){}var o=this.paramsXssHandler.xssFilter(i._data);return o},_errorTipShow:function(t){var e=this;e._eh.html(t).show(),e._se.focus()},_showAddResult:function(t){var e=this,i=function(t){switch(t.getActionType()){case t.Action_FocusContent:e._se.focus();break;case t.Action_ClearYZM:break;case t.Action_GoToHead:break;case t.Action_FlushAndGoToHead:e._se.setContent("")}};if(Thread_add_result.init(t),0!=t.no)if(Thread_add_result.isNeedWaitForCheck()){var a='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="//tb2.bdstatic.com/tb/img/messageFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u7B49\u5F85\u5BA1\u6838...</td></tr></tbody></table>'+Thread_add_result.getMessage()+"</div>",n=$.dialog.alert(a,{width:380,height:105,title:"\u53D1\u8868\u8D34\u5B50"});n.bind("onclose",function(){return e._se.setContent(""),e._se.focus(),!0})}else if(901==t.no){var a="\u672C\u697C\u5C42\u56DE\u590D\u5DF2\u8FBE\u4E0A\u9650\uFF0C\u8BF7\u53C2\u4E0E\u5176\u4ED6\u697C\u5C42\u8BA8\u8BBA";e._errorTipShow(a)}else if(814==t.no){var a="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u8868\u60C5\u4E0D\u80FD\u8D85\u8FC710\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4";e._errorTipShow(a)}else if(902==t.no){var a="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u8F93\u5165\u7684\u6587\u5B57\u4E0D\u80FD\u8D85\u8FC7140\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4";e._errorTipShow(a)}else if(3010==t.no){var a="\u62B1\u6B49\uFF0C\u672C\u5427\u53EA\u5141\u8BB8\u7C89\u4E1D\u56E2\u6210\u5458\u53D1\u8D34\uFF0C\u5FEB\u53BB\u8BA4\u8BC1\u5427\u3002";e._errorTipShow(a)}else if(903==t.no){var a="\u7EBF\u8DEF\u5347\u7EA7\u6539\u9020\uFF0C\u6682\u65F6\u65E0\u6CD5\u53D1\u8D34\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u8868\u793A\u62B1\u6B49~";e._errorTipShow(a)}else if(7001==t.no){var o=this,s="";switch(t.data.access_state.type){case"email":s="\u5E10\u53F7\u5B89\u5168\u9A8C\u8BC1\uFF08\u90AE\u7BB1)";break;case"mobile":s="\u5E10\u53F7\u5B89\u5168\u9A8C\u8BC1\uFF08\u624B\u673A\uFF09";break;case"bindmobile":s="\u5E10\u53F7\u5B89\u5168\u7ED1\u5B9A\uFF08\u624B\u673A\uFF09"}if("bindmobile"!==t.data.access_state.type){var r=passport.pop.initForceverify({token:t.data.access_state.token,curType:t.data.access_state.type,title:s,msg:"\u60A8\u7684\u5E10\u53F7\u7591\u4F3C\u88AB\u76D7,\u9A8C\u8BC1\u5BC6\u4FDD\u540E\u7EE7\u7EED",onRender:function(){},onHide:function(){},onSendvcodeSuccess:function(){},onGetapiError:function(){$.ajax("/f/commit/commonapi/checkUserInfoCallback",{data:{action:"reset"},success:function(){}})},onSubmitSuccess:function(){$.ajax("/f/commit/commonapi/checkUserInfoCallback",{success:function(){}})},onInitFail:function(){o.trigger("complete"),$.ajax("/f/commit/commonapi/checkUserInfoCallback",{data:{action:"reset"},success:function(){}})}});r.show()}else{var d=passport.pop.ArmorWidget("bindmobile",{token:t.data.access_state.token,title:s,msg:"\u60A8\u7684\u5E10\u53F7\u7591\u4F3C\u88AB\u76D7,\u7ED1\u5B9A\u5BC6\u4FDD\u540E\u7EE7\u7EED",auth_title:"\u7ED1\u5B9A\u624B\u673A",auth_msg:"\u8BF7\u5148\u7ED1\u5B9A\u624B\u673A",onSubmitSuccess:function(t){$.ajax("/f/commit/commonapi/checkUserInfoCallback",{data:{bindid:t.bindid},success:function(){}})},onSubmitFail:function(){o.trigger("complete")},onHide:function(){o.trigger("complete")},onInitFail:function(){$.ajax("/f/commit/commonapi/checkUserInfoCallback",{data:{action:"reset"},success:function(){}})}});d.show()}}else if(277===t.no||278===t.no){var a="\u60A8\u5DF2\u88AB "+t.error+" \u7981\u8A00\u3002\u5728\u6B64\u671F\u95F4\u5185\uFF0C\u4E0D\u53EF\u56DE\u590D\u6216@ "+t.error+"\u3002";e._errorTipShow(a)}else if(40==t.no)e.captchaDialog?(e.captchaDialog.setTip(t.data.vcode.str_reason),e.captchaDialog.updateCaptchaImg(t.data.vcode.captcha_vcode_str,t.data.vcode.captcha_code_type),e.captchaDialog.show(),e.captchaDialog.focus()):_.Module.use("common/component/CaptchaDialog",{message:t.data.vcode.str_reason,vCode:t.data.vcode.captcha_vcode_str,vCodeType:t.data.vcode.captcha_code_type,forumName:e._data.kw,forumId:e._data.fid,isAnonymous:e._data.anonymous,postType:"reply",paramsCallback:function(){var t=e._getData(),i={content:t.content};return i.tid=PageData.thread.thread_id,i}},function(t){e.captchaDialog=t,t.bind("onclose",function(){return e._enableEditor(),t.hide(),!1}),t.bind("onaccept",function(){e._setPostData("vcode",t.getInputValue()),e._setPostData("vcode_md5",t.getVCode()),e._submitData()}),t.show()});else if(Thread_add_result.isNeedBindPhone())$.dialog.alert("<div style='margin: 15px;'>"+Thread_add_result.getMessage()+"</div>",{title:"\u53D1\u8D34\u5931\u8D25",acceptValue:"\u7ED1\u5B9A\u624B\u673A",width:410,onaccept:function(){return $.tb.location.setHref("//passport.baidu.com/v2/?accountbindphone&tpl=tb&u="+encodeURIComponent($.tb.location.getHref())),!1},onclose:function(){return i(Thread_add_result),!0}});else{var a='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="//tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u53D1\u8D34\u5931\u8D25</td></tr></tbody></table>'+Thread_add_result.getMessage()+"</div>",n=$.dialog.alert(a,{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"});n.bind("onclose",function(){return i(Thread_add_result),!0})}}}});_.Module.define({path:"common/widget/WordLimit",requires:[],sub:{checkTimer:null,isShow:!1,exceed:!1,initial:function(i){var t={container:$("body"),inputObj:null,checkDelay:50,showLimit:10,maxNum:120,isLimitInput:!1,autoPos:!0,numStyle:{},limitStyle:{}},e=$.extend(!0,t,i);this.container=$(e.container),this.inputObj=$(e.inputObj),this.showLimit=e.showLimit,this.option=e,this.holder=$('<div class="w_limit_wrapper "></div>'),this.container.append(this.holder)},init:function(){var i=this.option,t=this;if(null!=i.inputObj){var e=$(i.inputObj);e.keydown(function(i){return t.handlerEvent(i),!0}),e.focus(function(i){return t.handlerEvent(i),!0}),e.bind("input",function(i){return t.handlerEvent(i),!0}),e.bind("propertychange",function(i){return t.handlerEvent(i),!0})}},setLimitStyle:function(i){this.holder.css(i)},hideWordLimit:function(){this.trigger("wlhiding"),this.holder.hide(),this.isShow=!1,clearTimeout(this.checkTimer)},autoPosition:function(){var i=this.inputObj.offset(),t=this.inputObj.width(),e=$(document).width();this.holder.css({top:i.top-this.holder.height()-5,right:e-t-i.left-9})},handlerEvent:function(){clearTimeout(this.checkTimer);var i=this.option,t=this;t.blur=!1,this.checkTimer=setTimeout(function(){t.check()},i.checkDelay)},check:function(){var i=this.option,t=this.inputObj,e=t.val(),h=$.tb.getByteLength(e),n=i.maxNum-h;if(i.isLimitInput&&0>n&&t.val($.tb.subByte(e,i.maxNum+(0>n&&n>-2?n:0),"")),n=i.maxNum-$.tb.getByteLength(t.val()),n<=this.showLimit){i.autoPos?this.autoPosition():this.trigger("onSetPosition"),this.holder.show(),this.isShow=!0;var s=Math.ceil(n/2);0>n?(s=Math.floor(n/2),this.exceed||(this.trigger("overflow"),this.exceed=!0),this.trigger("wlshowing"),this.holder.html('\u5DF2\u7ECF\u8D85\u51FA<span class="w_limit_num" style="color:#f00;">'+-s+"</span>\u4E2A\u5B57")):(this.exceed&&(this.trigger("unoverflow"),this.exceed=!1),this.trigger("wlshowing"),0==n?this.holder.html('\u8FD8\u53EF\u8F93\u5165<span class="w_limit_num" style="color:#ff0000;">'+s+"</span>\u4E2A\u5B57"):this.holder.html('\u8FD8\u53EF\u8F93\u5165<span class="w_limit_num" style="color:#929292;">'+s+"</span>\u4E2A\u5B57"))}else this.isShow&&(this.trigger("wlhiding"),this.holder.hide(),this.isShow=!1,this.exceed&&(this.trigger("unoverflow"),this.exceed=!1))}}});_.Module.define({path:"common/widget/PostPrefix",requires:[],sub:{initial:function(e){this.$titleWrap=$(".j_title_wrap"),this.$target=e.$target,this.prefix=e.prefix,this.prefix.value&&(this.prefix.value=this.prefix.value.replace("&amp;","&")),this.$target.val(this.prefix.value),this.$target.data("prefix",this.prefix.value),this.feedbackBarId="898666",this.appendPrefixToBody(),this.prefix.need_sug&&(this.pickPrefix(this.$target,this.prefix.sug_html),this.autoResponse(this.$target,this.prefix.sug_html))},appendPrefixToBody:function(){this.$wrapper=$('<a class="pprefix-list"></a>'),this.$wrapper.appendTo("body").css({display:"none","box-sizing":"border-box"}),PageData.forum.forum_id==this.feedbackBarId&&(this.$autoRes_wrapper=$('<a class="auto-pprefix-list"></a>'),this.$autoRes_wrapper.appendTo("body").css({display:"none","box-sizing":"border-box"})),this.unsetAutoRespPrefix()},setAutoRespPrefix:function(){var e=this;e.$titleWrap.find(".j_title").removeClass("normal-prefix").addClass("auto-resp-prefix")},unsetAutoRespPrefix:function(){var e=this;e.$titleWrap.find(".j_title").removeClass("auto-resp-prefix").addClass("normal-prefix")},showNormalPrefix:function(e){var i=this;i.$wrapper.css({width:e.outerWidth()+"px",left:e.offset().left+"px",top:e.offset().top+e.outerHeight()-1+"px"}).show(),PageData.forum.forum_id==this.feedbackBarId&&i.$autoRes_wrapper.hide()},autoResponse:function(e){function i(e,i){"up"==e?0>o-1?o=s.length-1:o--:"down"==e?o+1==s.length?o=0:o++:"mouse"==e&&(o=i),p.$autoRes_wrapper.is(":visible")||(f.showPPrefix(),o=0),s&&s.removeClass("pprefix-item-shine").eq(o).addClass("pprefix-item-shine")}function t(i){var t=e.data("prefix");e.val(t+i),p.$autoRes_wrapper.hide(),setTimeout(function(){e.trigger("focus")},100)}function r(e){$.post("/hermes/suggestion",{kw:e,ie:"utf-8"},function(e){e.errno||a(e.query_match)},"json")}function a(e){if(0==e.length)return f.hidePPrefix(),!1;for(var i="",t=0,r=e.length;r>t;t++)i+='<div class="pprefix-item" data-id="'+e[t].id+'">'+e[t].title+"</div>";""!=i?p.$autoRes_wrapper.html(i):"",f.showPPrefix(),s=p.$autoRes_wrapper.children()}if(PageData.forum.forum_id!=this.feedbackBarId)return!1;var s="",o=-1,p=this,f={showPPrefix:function(){p.$autoRes_wrapper.css({width:e.outerWidth()-138+"px",left:e.offset().left+138+"px",top:e.offset().top+e.outerHeight()-1+"px"}).show(),p.$wrapper.hide()},hidePPrefix:function(){o=-1,""!=s?s.removeClass("pprefix-item-shine"):"",p.$autoRes_wrapper.hide(),p.setAutoRespPrefix()},autoResItemClickStat:function(e){$.post("/hermes/commit/sughit",{id:e},function(){},"json")}};p.$titleWrap.on("click.showPPrefix",".auto-resp-prefix",function(){p.showNormalPrefix(e),p.unsetAutoRespPrefix()}).on("blur.hidePPrefix",".auto-resp-prefix",function(){f.hidePPrefix()}).on("keyup",".auto-resp-prefix",function(a){switch(a.keyCode){case 40:a.preventDefault(),i("down");break;case 38:a.preventDefault(),i("up");break;case 13:a.preventDefault(),-1!=o&&(p.$autoRes_wrapper.find(".pprefix-item-shine").html()?t(p.$autoRes_wrapper.find(".pprefix-item-shine").html()):"",f.hidePPrefix(),p.setAutoRespPrefix());break;case 27:p.$autoRes_wrapper.is(":visible()")&&(a.preventDefault(),f.hidePPrefix());case 8:default:var s=e.val(),n="";if(PageData.forum.forum_id!=p.feedbackBarId||-1==s.indexOf("\u3010\u6C42\u52A9\u54A8\u8BE2\u3011"))return o=-1,f.hidePPrefix(),!1;var u=-1==s.indexOf("\u4E28")?s.indexOf("|"):s.indexOf("\u4E28");-1==u?u=s.indexOf("\uFF5C"):"",n=s.substring(u+1,s.length),""!=n?r(n):f.hidePPrefix(),p.setAutoRespPrefix()}}),p.$autoRes_wrapper.on("mousedown.pick",".pprefix-item",function(){f.autoResItemClickStat($(this).data("id")),t($(this).html())}).on("mouseover",".pprefix-item",function(){i("mouse",$(this).index())})},pickPrefix:function(e,i){function t(){f.$wrapper.css({width:e.outerWidth()+"px",left:e.offset().left+"px",top:e.offset().top+e.outerHeight()-1+"px"}).show(),PageData.forum.forum_id==f.feedbackBarId&&f.$autoRes_wrapper.hide()}function r(){p=-1,o.removeClass("pprefix-item-shine"),f.$wrapper.hide(),PageData.forum.forum_id==f.feedbackBarId&&e.val().indexOf("\u3010\u6C42\u52A9\u54A8\u8BE2\u3011")>-1&&f.setAutoRespPrefix()}function a(i){var t,r=e.val(),a=e.data("prefix");t=a&&r.indexOf(a)>-1?r.replace(a,i):i,e.val(t).data("prefix",i),-1==e.val().indexOf("\u3010\u6C42\u52A9\u54A8\u8BE2\u3011")&&f.unsetAutoRespPrefix(),setTimeout(function(){e.trigger("focus")},100)}function s(e,i){"up"==e?0>p-1?p=o.length-1:p--:"down"==e?p+1==o.length?p=0:p++:"mouse"==e&&(p=i),f.$wrapper.is(":visible")||(t(),p=0),o.removeClass("pprefix-item-shine").eq(p).addClass("pprefix-item-shine")}var o,p=-1,f=this;f.$wrapper.html(i),o=f.$wrapper.children(),f.$titleWrap.on("click.showPPrefix",".normal-prefix",function(){f.showNormalPrefix(e),f.unsetAutoRespPrefix()}).on("blur.hidePPrefix",".normal-prefix",function(){r()}).on("keydown",".normal-prefix",function(i){switch(i.keyCode){case 8:t();break;case 40:i.preventDefault(),s("down");break;case 38:i.preventDefault(),s("up");break;case 13:i.preventDefault(),-1!=p&&($(".pprefix-item-shine").html()?a($(".pprefix-item-shine").html()):"",r(),PageData.forum.forum_id==f.feedbackBarId&&e.val().index("\u3010\u6C42\u52A9\u54A8\u8BE2\u3011")>-1&&f.setAutoRespPrefix());break;case 27:f.$wrapper.is(":visible")&&(i.preventDefault(),r());default:p=-1,r()}}),f.$wrapper.on("mousedown.pick",".pprefix-item",function(){a($(this).html())}).on("mouseover",".pprefix-item",function(){s("mouse",$(this).index())})}}});_.Module.define({path:"common/widget/PostSignature",requires:[],sub:{_template:['<option value="#{id}" #{isSelected}>#{name}</option>'].join(""),url:"/f/user/sign_list?t="+ +new Date,hasRequested:!1,isUsed:0,data:null,initial:function(e){this.$root=e.$container,this.gameSignature=e.gameSignature},init:function(){var e=this;this.hasRequested||(this.hasRequested=!0,null==this.data&&this.requestSignature()),this.$root.on("change",".j_use_signature",function(){e.isUsed=this.checked?1:0,e.toggleList(),$.post("/f/user/cm/sign_setneed",{need:e.isUsed,tbs:PosterContext.getContext().tbs})})},requestSignature:function(){var e=this;$.get(this.url,function(t){t=$.json.decode(t),t&&0==t.no&&(e.data=t.data,e.isUsed=e.data.need,e.$root.find(".j_use_signature").tbattr("checked",1==e.isUsed),e.buildList(t.data),e.toggleList())})},toggleList:function(){var e=this.$root.find(".j_signature_wrapper");1==this.isUsed?e.show():e.hide()},buildList:function(e){var t="",i=this.$root.find(".j_signature_wrapper"),s=i.find("select"),n=!1;if(e&&e.signs.length>0){for(var a=0,r=e.signs.length;r>a;a++)t+=$.tb.format(this._template,{id:e.signs[a].id,isSelected:e.signs[a].id==e.used_id?"selected=selected":"",name:e.signs[a].name});s.html(t),n=!0}this.gameSignature&&!$.isEmptyObject(this.gameSignature.signature_info)&&(this.rebuildList(this.gameSignature),n=!0),n||(i.empty(),i.html('\uFF08\u60A8\u76EE\u524D\u6CA1\u6709\u53EF\u4F7F\u7528\u7684\u7B7E\u540D\u6863\uFF0C&nbsp;<a style="color:#0449BE" target="_blank" href="/i/sys/jump?type=signsetting">\u67E5\u770B\u5168\u90E8</a>\uFF09'))},rebuildList:function(e){var t=this,i="",s="",n=t.$root.find(".j_use_signature"),a=this.$root.find(".j_signature_wrapper select");1==e.is_open&&(s="selected=selected",a.find(":selected").tbprop("selected",!1),0==n.tbprop("checked")&&n.trigger("click")),i+=$.tb.format(this._template,{id:12345678,isSelected:s,name:"\u6E38\u620F\u7B7E\u540D\u6863"}),a.prepend(i)}}});_.Module.define({path:"common/widget/MousePwd",requires:[],sub:{initial:function(){function t(t){if(!t)var t=window.event;var e=0,n=0;return t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft,n=t.clientY+document.body.scrollTop),[e,n]}function e(t){return t.offsetParent?t.offsetLeft+e(t.offsetParent):t.offsetLeft}function n(t){return t.offsetParent?t.offsetTop+n(t.offsetParent):t.offsetTop}function o(o){o.stopPropagation();var i=t(o),r=h[this.id];if(r)r.hover||(r.hover=!0,r.count++);else{var s=e(this),u=n(this),f=s+this.offsetWidth,a=u+this.offsetHeight;r=h[this.id]={hover:!0,count:1,left:s,top:u,right:f,buttom:a}}r["mouse"+r.count]||(r["mouse"+r.count]=[],r["time"+r.count]={start:(new Date).getTime()},h.ma.push(r["mouse"+r.count])),r["mouse"+r.count].push(i),p.push("1")}function i(e){e.stopPropagation();var n=t(e),o=h[this.className];if(o&&o.hover){if(n[0]&&n[0]>o.left&&n[0]<o.right&&n[1]&&n[1]>o.top&&n[1]<o.buttom)return;o["time"+o.count].end=(new Date).getTime(),o.hover=!1}p.push("0")}function r(){var t=h.ma.length;if(t>0){var e=h.ma[t-1];return e[e.length-1]}}function s(){var t="",e=p.length;return e>10&&(p=p.slice(e-10)),t=p.join(",")}function u(){if(m)return c;var t=[r(),s(),(new Date).getTime()-this.UTSTART,[screen.width,screen.height].join(",")].join("	");return c.c=f(t)+","+g+this.MOUSEPWD_CLICK,m=!0,c}function f(t){for(var e=[],n={},o=g%100,i=0,r=t.length;r>i;i++){var s=t.charCodeAt(i)^o;e.push(s),n[s]||(n[s]=[]),n[s].push(i)}return e}function a(t){this.elements=t,$.each(t,function(t,e){$("."+e.toString()).bind("mouseover",o),$("."+e.toString()).bind("mouseout",i),l[e.toString()]=t}),$("body").bind("click",function(){this.MOUSEPWD_CLICK=1})}this.UTSTART=(new Date).getTime(),this.MOUSEPWD_CLICK=0;var h={ea:[],ma:[]},c={},m=!1,g=(new Date).getTime(),l={},p=[];this.start=a,this.report=u,this.time=g}}});_.Module.define({path:"encourage/widget/PostGuessingNew/Dialog",require:["common/widget/PostService","common/widget/PostService/PostResultHandlerManager"],sub:{$dom:null,_options:{},initial:function(){},buildDialog:function(e){var i=new $.dialog({html:e.html,width:e.width,height:e.height,showTitle:!1,showShadow:!1,draggable:!1,holderClassName:"guessing_dialog "+e.holderClassName});return i.element.find(".j_guessing_close").on("click",function(){i.close()}),i}}});
;_.Module.define({path:"encourage/widget/PostGuessingNew/Item",sub:{_tpl:['<li class="guessing_item_wrapper <%=isLast ? "last": ""%>">','<a href="javascript:;" class="icon_up j_icon_up">',"</a>",'<div class="guessing_icon_list_wrapper">','<ul class="guessing_icon_list">','<li data-val="1"><i class="icon_shitou"></i></li>','<li data-val="2"><i class="icon_jiandao"></i></li>','<li data-val="3"><i class="icon_bu"></i></li>',"</ul>","</div>",'<a href="javascript:;" class="icon_down j_icon_down">',"</a>",'<a href="javascript:;" class="icon_remove j_icon_remove" title="\u79FB\u9664"></a>','<div class="guessing_no">',"<%=matchNo%>","</div>","</li>"].join(""),$dom:null,_options:{},curPos:0,initial:function(i){this._options=i,this._generateDom()},_generateDom:function(){var i=baidu.template,t=i(this._tpl,{matchNo:this._options.matchNo,isLast:this._options.isLast});this.$dom=$(t),this._options.$insertBefore?this.$dom.insertBefore(this._options.$insertBefore):this._options.$container&&this._options.$container.append(this.$dom),this._bindEvents()},_bindEvents:function(){var i=this,t=this.$dom.find(".j_icon_up"),s=this.$dom.find(".j_icon_down"),o=Math.round(2*Math.random());$.JsLoadManager.use("//tb1.bdstatic.com/tb/cms/tbmall/guessing/jcarousellite_1.0.1.js",function(){i.$dom.data("curPos",o+1).find(".guessing_icon_list_wrapper").jCarouselLite({btnNext:s,btnPrev:t,visible:1,vertical:!0,circular:!0,start:o,afterEnd:function(t){var s=t.data("val");i.$dom.data("curPos",s)}})}),this.$dom.find(".j_icon_remove").on("click",function(){i.$dom.remove(),i.trigger("guessing:itemremove")}),this.$dom.on("mouseenter",function(){$(this).addClass("hover")}).on("mouseleave",function(){$(this).removeClass("hover")})},bindRemove:function(i){return this.bind("guessing:itemremove",i),this},getItemData:function(){var i=this.$dom.data("curPos");return i},setLastClass:function(){return this.$dom.addClass("last"),this},unsetLastClass:function(){return this.$dom.removeClass("last"),this},refresh:function(){var i,t=this.$dom.find(".j_icon_down"),s=10+Math.floor(3*Math.random()+1),o=100,n=function(){s>0?(s--,t.trigger("click"),i=setTimeout(n,o)):clearTimeout(i)};i=setTimeout(n,o)}}});
;_.Module.define({path:"encourage/widget/PostGuessingNew/Add",sub:{_tpl:['<li class="guessing_add_wrapper">','<a href="javascript:;" class="guessing_add j_guessing_add"></a>','<div class="guessing_no" id="add_guessing_no">',"<%=matchNo%>","</div>","</li>"].join(""),$dom:null,_options:{},initial:function(i){this._options=i,this._generateDom()},add:function(i){var n=this;this.bind("guessing:add",function(){n.$dom.find("#add_guessing_no").text(++n._options.matchNo),i()})},setMatchNo:function(i){this._options.matchNo=i,this.$dom.find("#add_guessing_no").text(i)},_generateDom:function(){var i=baidu.template,n=i(this._tpl,{matchNo:this._options.matchNo});this.$dom=$(n),this._options.$container.append(this.$dom),this._bindEvents()},_bindEvents:function(){var i=this;this.$dom.find(".j_guessing_add").on("click",function(){i.trigger("guessing:add")})}}});
;_.Module.define({path:"encourage/widget/PostGuessingNew",require:["common/widget/PostService","common/widget/PostService/PostResultHandlerManager","Item","Add","Dialog"],sub:{_tpl:['<div id="guessing_wrapper" class="guessing_wrapper guessing_wrapper_new guessing_wrapper_cid<%=cid%>">','<ul class="guessing_tab">','<li><i class="icon_guessing_tab"></i><a href="javascript:;">\u7ADE\u731C\u6E38\u620F</a></li>',"</ul>","<% if (login) { %>",'<div class="guessing_main">','<div class="guess_type">',"\u731C\u62F3\u7C7B\u578B\uFF1A",'<input type="radio" id="guess_streak_radio" class="j_guess_type" name="cid" value="1" <% if (cid == 1) { %> checked <% } %> />','<label id="guessing_label_cid1" for="guess_streak_radio" class="guess_radio_streak">\u8FDE\u80DC\u573A</label>','<input type="radio" id="guess_competitive_radio" class="j_guess_type" name="cid" value="0" <% if (cid == 0) { %> checked <% } %> />','<label id="guessing_label_cid0" for="guess_competitive_radio" class="guess_radio_competitive">\u7ADE\u6280\u573A</label>',"</div>",'<div class="guess_rule_tip">',"\u6BD4\u8D5B\u8BF4\u660E\uFF1A","<span>\u5BF9\u65B9\u9700\u89813\u5C40\u5168\u80DC\uFF0C\u624D\u53EF\u8D62\u8D70\u4F60\u7684T\u8C46\u3002\u5982\u679C\u7D2F\u8BA1\u6218\u80DC10\u4E2A\u5BF9\u624B\uFF0C\u53EF\u56DE\u6536\u672C\u91D1\u3002</span>","</div>",'<div class="guess_round_scores j_round_scores">',"\u53C2\u4E0E T \u8C46\uFF1A",'<a href="javascript:;" data-scores="100" <% if (roundScores == 100) { %> class="cur" <% } %>>\u666E\u901A\u5C40<b>(\u6BCF\u5C40100T\u8C46)</b></a>','<a href="javascript:;" data-scores="1000" <% if (roundScores == 1000) { %> class="cur" <% } %>>\u9AD8\u7AEF\u5C40<b>(\u6BCF\u5C401000T\u8C46)</b></a>','<a href="javascript:;" data-scores="3000" <% if (roundScores == 3000) { %> class="cur" <% } %>>\u571F\u8C6A\u5C40<b>(\u6BCF\u5C403000T\u8C46)</b></a>',"</div>",'<div class="guess_match_no">','<div class="guess_match_input_cid0 guess_match_input">',"\u53D1\u5E03\u5C40\u6570\uFF1A",'<input type="text" class="j_round_num" maxlength="2" value="3" />\u5C40','<a href="javascript:;" class="ui_btn ui_btn_s j_guessing_refresh">',"<span><em>\u5B8C\u5168\u968F\u673A</em></span>","</a>","</div>","</div>",'<div id="guessing_detail" class="guessing_detail">','<div class="guessing_detail_wrapper clearfix">',"<ul>","</ul>","</div>","</div>",'<a href="javascript:;" class="gueesing_prev j_gueesing_prev"></a>','<a href="javascript:;" class="gueesing_next j_gueesing_next"></a>','<div class="guessing_intro">','<div class="info">','<div class="info_title">T \u8C46\u652F\u51FA\uFF1A</div>','<div class="info_item"><span class="bold_text">\u731C\u62F3\u603B\u989D\uFF1A<i class="icon_tdou"></i><ins class="guesisng_fee j_guessing_fee">3000</ins></span></div>','<div class="info_item"><span class="bold_text">\u624B\u7EED\u8D39\uFF1A<i class="icon_tdou"></i><ins class="guesisng_fee j_sys_fee">300</ins></span></div>','<div class="info_item last"><a href="javascript:;" class="j_btn_charge ui_btn ui_btn_s">',"<span><em>\u5145\u503C</em></span>","</a></div>","</div>","</div>","</div>","<% } else { %>",'<div class="guessing_main unlogin">',"<div class=\"guessing_unlogin\"><div class=\"tb_poster_info poster_warning\">\u672C\u5427\u53D1\u8D34\uFF0C\u8BF7\u5148 <a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', 'editor']);return false;\">\u767B\u5F55</a> | <a href=\"#\" onclick=\"TbCom.process('User','buildRegisterFrame',null,null,null,'editor');return false;\">\u6CE8\u518C</a>&nbsp;</div></div>","</div>","<% } %>","</div>",'<div class="guess_safe_tips2">','<i class="guess_safe_icon"></i><a href="//tieba.baidu.com/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669\uFF01',"</div>",'<div class="post_guessing_btn">','<a href="#" class="<% if (login) { %>ui_btn ui_btn_m<% } else { %>ui_btn_disable ui_btn_m_disable<% } %> j_guessing_post">',"<span><em>\u53D1\u8868\u731C\u62F3</em></span>","</a>",'<a href="/tbmall/guess/center" class="post_guessing_link" target="_blank">\u53C2\u52A0\u8D34\u5427\u201C\u62F3\u738B\u201D\u4E89\u9738\u8D5B>></a>',"</div>"].join(""),_dialog:null,_root:null,_defaultAttr:{width:630,height:512,visible:3,container:$("body"),modal:!1,autoCenter:!1,fixed:!1,holderClassName:"guessing_holder",page:"frs",cid:1,roundScores:1e3},_attr:{},_items:[],_scroll:{step:130,pos:0},_round_scores:0,initial:function(s){this._mergeAttr(s),this._round_scores=this._attr.roundScores,this._render(),this._initPostService(),this._bindEvents()},_initPostService:function(){var s=this;this.postService=this.use("common/widget/PostService"),this.postService.success(function(){$('<div class="tb_poster_info poster_success poster_guessing_success"><p><strong>\u53D1\u8868\u731C\u62F3\u8D34\u6210\u529F\uFF01</strong></div>').appendTo(s._root),setTimeout(function(){$.tb.location.reload()},500)}).complete(function(){s._toggleSubmitButton(!1)})},_bindEvents:function(){var s=this;this._root.on("click",".j_btn_charge",function(){_.Module.use("common/widget/tcharge_dialog")}),this._root.on("click",".j_gueesing_prev",function(){0!=s._scroll.pos&&s._scrollToPos(s._scroll.pos-1)}),this._root.on("click",".j_gueesing_next",function(){s._scroll.pos!=s._items.length-s._attr.visible&&s._scrollToPos(s._scroll.pos+1)}),this._root.find(".j_guessing_refresh").on("click",function(){var e=Number(s._root.find(".j_round_num").val());s._items=[],$("#guessing_detail>div>ul").html(""),s._renderCompetitive(e),e-s._attr.visible>0?s._scrollToPos(e-s._attr.visible):s._scrollToPos(0)}),this._root.find(".j_round_scores a").on("click",function(){s._root.find(".j_round_scores a.cur").removeClass("cur"),$(this).addClass("cur"),s._round_scores=parseInt($(this).data("scores")),s._calcFee()}),this._root.find(".j_guess_type").on("change",function(){var e=s._root.find("input[name='cid']:checked").val();s._attr.cid=e,s._items=[],$("#guessing_detail>div>ul").html(""),s._root.find(".j_gueesing_next, .j_gueesing_prev").hide(),0==e?s._renderCompetitive():s._renderStreak(),s._root.find("#guessing_wrapper").tbattr("class","guessing_wrapper guessing_wrapper_new guessing_wrapper_cid"+e)}),this._root.find(".j_round_num, .j_back_num").on("keydown",function(s){var e=s.which,t=!1;return s.shiftKey&&(9==e&&(t=!0),t=!1),(57>=e&&e>=48||37==e||39==e||8==e||9==e||46==e||105>=e&&e>=96||229==e)&&(t=!0),t}).on("keyup change paste",function(){var s=$.trim($(this).val());s&&(s=s.replace(/\D/g,""),$(this).val(s)),0===parseInt(s,10)&&$(this).val(1)}),$(window).on("resize",function(){s._adjustDialog()})},_render:function(){var s=this,e=baidu.template,t=this._attr,i={};i.parr_score_total=0,i.cid=this._attr.cid,i.roundScores=this._attr.roundScores,i.login=PageData.user&&PageData.user.is_login,PageData.user&&PageData.user.Parr_scores&&(i.parr_score_total=PageData.user.Parr_scores.scores_total),html=e(this._tpl,i);var a=t.container,n={html:html,width:t.width,height:t.height,modal:t.modal,fixed:t.fixed,autoCenter:t.autoCenter,showShadow:!1,draggable:!1,closeable:!0,holderClassName:t.holderClassName};if(!t.autoCenter){var o=a.offset();n.left=o.left,n.top=o.top}this._dialog=new $.dialog(n),this._root=this._dialog.element,0==i.cid?this._renderCompetitive():this._renderStreak(),this._root.find(".j_guessing_post").on("click",function(e){e.preventDefault(),$(this).is(".ui_btn_disable")||s.post()})},_renderStreak:function(){var s=1,e=$("#guessing_detail>div>ul");for(this._root.find(".j_round_num").val(3),$("#guessing_detail").scrollLeft(0);3>=s;s++){var t=this.use("Item",{$container:e,matchNo:s});this._items.push(t)}e.removeClass("guessing_competitive_detail_list").addClass("guessing_streak_detail_list"),this._calcFee()},_renderCompetitive:function(s){for(var e=this,t=1,i=s||this._attr.visible,a=$("#guessing_detail>div>ul");i>=t;t++){var n=this.use("Item",{$container:a,matchNo:t,isLast:t==i});n.bindRemove(function(s){return function(){e._items.pop(),e._items.length>1&&e._items[e._items.length-1].setLastClass(),o.setMatchNo(s),e._scroll.pos-=1,e._items.length>=e._attr.visible&&e._scrollToPos(e._items.length-e._attr.visible),e._root.find(".j_round_num").val(e._items.length),e._calcFee()}}(t)),this._items.push(n)}a.removeClass("guessing_streak_detail_list").addClass("guessing_competitive_detail_list");var o=this.use("Add",{$container:$("#guessing_detail>div>ul"),matchNo:i+1});o.add(function(){e._items[e._items.length-1].unsetLastClass();var s=e.use("Item",{$insertBefore:$("#guessing_detail>div>ul>li.guessing_add_wrapper"),matchNo:e._items.length+1}).bindRemove(function(){e._items.pop(),e._items.length>1&&e._items[e._items.length-1].setLastClass(),o.setMatchNo(e._items.length+1),e._items.length>=e._attr.visible&&e._scrollToPos(e._items.length-e._attr.visible),e._root.find(".j_round_num").val(e._items.length),e._calcFee()}).setLastClass();e._items.push(s),e._items.length>e._attr.visible&&e._scrollToPos(e._items.length-e._attr.visible),e._root.find(".j_round_num").val(e._items.length),e._calcFee()}),e._calcFee()},_calcFee:function(){var s=this._round_scores,e=this._items.length,t=this._attr.cid,i=this._root.find(".j_guessing_fee"),a=this._root.find(".j_sys_fee"),n=0;n=0==t?s*e:10*s;var o=.1*n;i.text(n),a.text(o)},post:function(){var s=this._validateContent();!this.postService.isPosting()&&s&&(this.postService.post("guessingThreadNew",this._getPostData(),PosterContext.getContext()),this._toggleSubmitButton(!0))},_getGuessing:function(){for(var s={},e=0,t=this._items.length;t>e;e++)s["guessing["+e+"]"]=this._items[e].getItemData();return s},_getBackNum:function(){return 10},_getPostData:function(){var s=$.tb.location.getSearchValue(),e={content:"",fid:"12583317",kw:"\u8D34\u5427\u5609\u5E74\u534E"};return s&&s.kw&&s.fid&&(e.kw=decodeURIComponent(s.kw),e.fid=s.fid),$.isEmptyObject(PageData.forum)||(e.fid=PageData.forum.id,e.kw=PageData.forum.name),e.cid=this._attr.cid,e.back_num=this._getBackNum(),e.round_scores=this._round_scores,$.extend(e,this._getGuessing()),e},_adjustDialog:function(){if("frs"==PosterContext.context.product){var s=this._attr.container,e=s.offset();this._dialog.element.css({left:e.left,top:e.top})}},_scrollToPos:function(s){this._scroll.pos=s;var e=s*this._scroll.step;"frs"==this._attr.page&&(e=s*(this._scroll.step+2)),this._root.find("#guessing_detail").animate({scrollLeft:e});var t=s!=this._items.length-this._attr.visible;this._root.find(".j_gueesing_next").toggle(t);var i=0!=s;this._root.find(".j_gueesing_prev").toggle(i)},_toggleSubmitButton:function(s){this._root.find(".j_guessing_post").toggleClass("ui_btn ui_btn_m",!s),this._root.find(".j_guessing_post").toggleClass("ui_btn_disable ui_btn_m_disable",s)},_validateContent:function(){return!0},_mergeAttr:function(s){this._attr=$.extend(!0,{},this._defaultAttr);for(var e in s)this._defaultAttr.hasOwnProperty(e)&&(this._attr[e]=s[e])}}});F.module("props/widget/propsData",function(t,e){function n(){this._api={getProps:"/tbmall/get/userProps"}}var o=null,a={};n.prototype={getProps:function(t,e,n){if(arguments.length<2)throw"At least 2 arguments needed";"undefined"==typeof n?(n=e,e=!0):e=!!e,e&&a[t]?n(a[t]):$.get(this._api.getProps,{category:t,t:(new Date).getTime()},function(e){a[t]=e.data[t]||{},n(a[t])})}},n.getInstance=function(){return null===o&&(o=new n),o},e.getInstance=n.getInstance});_.Module.define({require:["props/widget/propsData"],path:"common/component/BubbleFactory",sub:{_curPropId:0,_bubbleDefaultProp:null,_list:[{id:0,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nobubble.png",name:"\u4E0D\u4F7F\u7528\u6C14\u6CE1",type:0},{id:1010034,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang.jpg",name:"\u4ECA\u5929\u957F\u8FD9\u6837",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010033,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing.jpg",name:"\u6211\u60F3\u9759\u9759",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010032,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan.jpg",name:"\u7136\u5E76\u5375",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010031,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji.jpg",name:"\u6324\u6324",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010030,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai.jpg",name:"\u524D\u6392",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010020,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi.jpg",name:"\u5C0F\u718A\u5F00\u5B66",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_03.png",topHeight:"11",bottomHeight:"108"}},{id:1010019,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliupings.jpg",name:"\u6F02\u6D41\u74F6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_3.png",topHeight:"110",bottomHeight:"34"}},{id:1010016,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasis.jpg",name:"\u6F58\u5E15\u65AF\u4E4B\u9E70",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasi_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasi_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasi_3.png",topHeight:"54",bottomHeight:"91"}},{id:1010015,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/riermans.jpg",name:"\u65E5\u8033\u66FC\u6218\u8F66",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/rierman_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/rierman_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/rierman_3.png",topHeight:"50",bottomHeight:"65"}},{id:1010014,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfeis.jpg",name:"\u8349\u957F\u83BA\u98DE",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_3.png",topHeight:"61",bottomHeight:"58"}},{id:1010012,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingnis.jpg",name:"\u6765\u81EA\u661F\u661F\u7684\u4F60",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingni_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingni_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingni_3.png",topHeight:"35",bottomHeight:"67"}},{id:1010011,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingrens.jpg",name:"\u4E18\u6BD4\u7279",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingren_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingren_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingren_3.png",topHeight:"60",bottomHeight:"66"}},{id:1010010,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjies.jpg",name:"\u6B22\u5EA6\u6625\u8282",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjie_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjie_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjie_3.png",topHeight:"35",bottomHeight:"68"}},{id:1010007,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandans.jpg",name:"\u559C\u5E86\u5143\u65E6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandan_03.png",topHeight:"24",bottomHeight:"56"}},{id:1010006,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdans.jpg",name:"\u5FEB\u4E50\u5723\u8BDE",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdian_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdan_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdan_3.png",topHeight:"26",bottomHeight:"72"}},{id:1010005,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyus.jpg",name:"\u6CE1\u6FA1\u7AE0\u9C7C",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_3.png",topHeight:"66",bottomHeight:"70"}},{id:1010004,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhaos.jpg",name:"\u94BB\u77F3\u571F\u8C6A\u91D1",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhao_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhao_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhao_3.png",topHeight:"37",bottomHeight:"42"}},{id:1010003,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dashus.jpg",name:"\u5FAE\u7B11\u5927\u53D4",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shushu_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/shushu_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shushu_3.png",topHeight:"31",bottomHeight:"55"}},{id:1010002,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguais.jpg",name:"\u5927\u5634\u602A",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_3.png",topHeight:"78",bottomHeight:"34"}},{id:1010001,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolus.jpg",name:"\u773A\u671B\u5C0F\u9E7F",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_3.png",topHeight:"45",bottomHeight:"55"}}],_npcPropsList:[{id:1010101,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei.jpg",name:"\u8DEF\u98DE",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei_03.png",topHeight:"19",bottomHeight:"101"}},{id:1010102,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren.jpg",name:"\u9E23\u4EBA",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren_03.png",topHeight:"42",bottomHeight:"117"}},{id:1010103,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi.jpg",name:"\u7EB3\u5179",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi_03.png",topHeight:"18",bottomHeight:"124"}},{id:1010104,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge.jpg",name:"\u9EC4\u9C7C\u54E5",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge_03.png",topHeight:"111",bottomHeight:"27"}},{id:1010105,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe.jpg",name:"\u6212\u8272\u5B88\u671B\u8005",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe_03.png",topHeight:"25",bottomHeight:"60"}},{id:1010106,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling.png",name:"\u5F20\u8D77\u7075",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling_03.png",topHeight:"80",bottomHeight:"48"}},{id:1010107,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen.png",name:"\u7D20\u8FD8\u771F",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen_03.png",topHeight:"23",bottomHeight:"126"}},{id:1010108,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan.png",name:"\u91D1\u6728\u7814",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan_03.png",topHeight:"53",bottomHeight:"87"}},{id:1010109,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu.png",name:"\u9ED1\u5D0E\u4E00\u62A4",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu_03.png",topHeight:"80",bottomHeight:"160"}},{id:1010110,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia.png",name:"\u6212\u64B8\u5427\u5C0F\u7BA1\u5BB6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia_03.png",topHeight:"80",bottomHeight:"175"}},{id:1010111,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jingtianming.png",name:"\u8346\u5929\u660E",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jingtianming_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jingtianming_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jjingtianming_03.png",topHeight:"27",bottomHeight:"80"}},{id:1010112,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage.png",name:"\u82F1\u4E09\u5609\u54E5",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage_03.png",topHeight:"74",bottomHeight:"44"}},{id:1010113,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi.png",name:"\u5742\u7530\u94F6\u65F6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi_03.png",topHeight:"40",bottomHeight:"100"}},{id:1010114,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan.png",name:"\u6696\u6696",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan_03.png",topHeight:"18",bottomHeight:"124"}},{id:1010115,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong.png",name:"\u9ED1\u4E1D\u63A7",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong_03.png",topHeight:"20",bottomHeight:"120"}},{id:1010116,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai.png",name:"\u7070\u539F\u54C0",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai_03.png",topHeight:"49",bottomHeight:"111"}},{id:1010117,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai.png",name:"\u4E1C\u65B9\u7231",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai_03.png",topHeight:"21",bottomHeight:"116"}},{id:1010118,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo.png",name:"\u9AD8\u5742\u7A57\u4E43\u679C",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo_03.png",topHeight:"17",bottomHeight:"118"}},{id:1010120,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi.jpg",name:"\u5E0C\u5C14\u74E6\u5A1C\u65AF",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi_03.png",topHeight:"45",bottomHeight:"82"}},{id:1010121,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang.jpg",name:"\u840C\u677F\u5A18",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang_03.png",topHeight:"36",bottomHeight:"104"}},{id:1010122,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun.jpg",name:"\u796D\u5251\u9B42",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun_03.png",topHeight:"94",bottomHeight:"32"}},{id:1010123,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu.png",name:"\u4F0F\u89C1\u733F\u6BD4\u53E4",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu_03.png",topHeight:"32",bottomHeight:"137"}},{id:1010124,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie.png",name:"\u76D6\u8042",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie_03.png",topHeight:"37",bottomHeight:"119"}},{id:1010125,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan.png",name:"\u6BDB\u5229\u5170",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan_03.png",topHeight:"30",bottomHeight:"103"}},{id:1010126,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie.png",name:"\u5434\u90AA",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie_03.png",topHeight:"39",bottomHeight:"100"}},{id:1010127,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi.png",name:"\u590F\u76EE\u8D35\u5FD7",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi_03.png",topHeight:"63",bottomHeight:"122"}},{id:1010128,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu.png",name:"\u66B4\u96E8\u5FC3\u5974",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu_03.png",topHeight:"45",bottomHeight:"33"}},{id:1010129,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan.png",name:"\u53F6\u51E1",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan_03.png",topHeight:"70",bottomHeight:"90"}},{id:1010130,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana.png",name:"kiana",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana_03.png",topHeight:"40",bottomHeight:"160"}},{id:1010131,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku.png",name:"\u521D\u97F3\u30DF\u30AF",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku_03.png",topHeight:"57",bottomHeight:"230"}},{id:1010132,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji.png",name:"\u6CA2\u7530\u7EB2\u5409",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji_03.png",topHeight:"128",bottomHeight:"84"}},{id:1010133,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming.png",name:"\u67F3\u9E23",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming_03.png",topHeight:"21",bottomHeight:"110"}},{id:1010134,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao.png",name:"\u5B5F\u6D69",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao_03.png",topHeight:"85",bottomHeight:"34"}},{id:1010135,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang.png",name:"\u96FE\u5C9B\u8463\u9999",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang_03.png",topHeight:"33",bottomHeight:"127"}}],initial:function(){PageData.user&&PageData.user.mParr_props&&PageData.user.mParr_props.default_bubble&&PageData.user.mParr_props.default_bubble.client&&PageData.user.mParr_props.default_bubble.client.props_id&&(this._bubbleDefaultProp=PageData.user.mParr_props.default_bubble.client,this._curPropId=this._bubbleDefaultProp.props_id)},loadUserPropsData:function(t){var b=this,i=this.require("props/widget/propsData"),c=i.getInstance();c.getProps(101,function(i){b._userPropList=i,b._list=$.map(b._list,function(t){return t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=b.hasUserPower(t.id),t.loseTime=t.isBuy?b.hasNearLosePower(t.id):0,t}),b._list=b._list.concat($.map(b._npcPropsList,function(t){var i=b.hasUserPower(t.id);if(i)return t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=i,t.loseTime=t.isBuy?b.hasNearLosePower(t.id):0,t})),b._npcPropsList=[],t()})},hasUserPower:function(t){if(0==t)return!0;var b=this.get(t),i=this._userPropList[b.id]||{},c=1*new Date,o=(parseInt(1e3*i.end_time)-c)/864e5;return 0==b.type?!0:i&&o>0?!0:!1},hasNearLosePower:function(t){var b=this._userPropList[t||0]||{},i=1*new Date,c=(parseInt(1e3*b.end_time)-i)/864e5;return b&&c>0&&2>c?parseInt(c+1):0},get:function(t){return _.filter(this._list.concat(this._npcPropsList),function(b){return b.id==t})[0]},getRandom:function(){var t=parseInt(Math.random()*this._list.length);return 0==this._list[t].id||this._list[t].id==this._curPropId?this.getRandom():this._list[t].id},getAll:function(){return this._list},setPropId:function(t){this._curPropId=this.get(t)?t:this._curPropId,PageData.user.bubble_id=this._curPropId},getPropId:function(){return this._curPropId},getCurrent:function(){if(this._bubbleDefaultProp.props_id===this._curPropId){var t=$.extend(this.get(this._curPropId),this._bubbleDefaultProp);t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=1e3*t.end_time>new Date;var b=(parseInt(1e3*t.end_time)-1e3*new Date)/864e5;return t.loseTime=t.isBuy?b>0&&2>b?b+1:0:0,t}return this.get(this._curPropId)}}});_.Module.define({path:"bawu/widget/complaintBarOwner",requires:["bawu/widget/complaintBarOwner/complaintBarOwnerTemplates"],sub:{isAddDialogTop:!1,initial:function(t){this.options=$.extend({uname:""},t),this.template=this.getInstance("bawu/widget/complaintBarOwner/complaintBarOwnerTemplates"),this.complaintWrapperTemplate=baidu.template(this.template.wrapper,this.options),this.complaintFailTemplate=this.template.fail,this.complaintSuccessTemplate=this.template.success,this.barItemTemplate=this.template.barItem,this.defaultFormData={manager_uid:"",manager_uname:"",forum_id:"",forum_name:"",complaint_type:"",reason:""},this.initDialog(),this._bindEvent()},initDialog:function(){if(this.$dialog)this.$dialog.setContent(this.complaintWrapperTemplate);else{this.$dialog=new $.dialog({html:this.complaintWrapperTemplate,title:"\u6295\u8BC9\u5427\u4E3B",show:!1,width:500,holderClassName:"complaint_bar_owner_dialog"});var t=this;this.$dialog.bind("onclose",function(e){return e.stopImmediatePropagation(),t.$dialog.hide(),!1});var e=this.$dialog.hide;this.$dialogElement=this.$dialog.element,this.$dialogElement.css("z-index",51e3),this.$dialog.hide=function(){t.isAddDialogTop&&(t.$dialogElement.css("top",parseInt(t.$dialogElement.css("top"),10)+70),t.isAddDialogTop=!1),e.call(t.$dialog)}}this.$submitBtn=this.$dialogElement.find(".submit_btn"),this.$barTypeList=this.$dialogElement.find(".j_bar_type"),this.$complaintReasonLayer=this.$dialogElement.find(".j_complaint_reason"),this.formData=$.extend({},this.defaultFormData)},_bindEvent:function(){var t=this,e=t.$dialogElement;e.on("blur",".j_bar_owner_id",function(e){var a=$(e.currentTarget),i=$.trim(a.val());t.checkBarOwnerName(i)}).on("keyup",".j_complaint_reason .textarea",function(e){var a=$(e.currentTarget);t.formData.reason=window.encodeURI($.trim(a.val())),t.checkCanSubmit()}).delegate(".radio","click",function(a){var i=$(a.currentTarget);"type"===i.tbattr("name")?(t.formData.forum_id=i.val(),t.formData.forum_name=window.encodeURI(i.data("name"))):(t.$complaintReasonLayer.show(),t.formData.complaint_type=i.val(),t.isAddDialogTop||(e.css("top",parseInt(e.css("top"),10)-70),t.isAddDialogTop=!0)),t.checkCanSubmit()}).delegate(".j_submit_btn","click",function(){if(t.checkCanSubmit()){var e=t.formData;$.post("/pmc/tousu/commitTousu",e,function(e){var a;a=0===e.errno?t.complaintSuccessTemplate:t.complaintFailTemplate,t.$resultDialog?t.$resultDialog.setContent(a):(t.$resultDialog=new $.dialog({html:a,title:"\u6295\u8BC9\u5427\u4E3B",show:!1,width:500}),t.$resultDialog.element.delegate(".j_back_btn","click",function(){t.$dialog.show(),t.$resultDialog.hide()}).delegate(".j_close_btn","click",function(){t.$dialog.hide(),t.$resultDialog.hide(),t.formData=$.extend({},this.defaultFormData)}).bind("onclose",function(e){return e.stopImmediatePropagation(),t.$resultDialog.hide(),!1})),202===e.errno&&t.$resultDialog.element.find(".j_error_remind").html("\u60A8\u5DF2\u7ECF\u6295\u8BC9\u8FC7\u8BE5\u5427\u4E3B"),1211056===e.errno&&t.$resultDialog.element.find(".j_error_remind").html("\u4EB2\u7231\u7684\u5427\u53CB\u60A8\u597D\uFF0C\u6211\u4EEC\u5DF2\u63A5\u5230\u5176\u4ED6\u7528\u6237\u5BF9\u8BE5\u5427\u4E3B\u7684\u6295\u8BC9\uFF0C\u6B63\u5728\u5BA1\u6838\u4E2D\uFF0C\u8C22\u8C22\u3002"),t.$resultDialog.show(),t.$dialog.hide()},"json")}})},checkBarOwnerName:function(t){var e=this;return t?(t=window.encodeURI(t),$.get("/pmc/tousu/getRole",{manager_uname:t},function(a){var i=$.extend({},e.defaultFormData),n=a.data,o=a.errno;if(0===o)i={manager_uid:n.manager_uid,manager_uname:t},e.$barTypeList.html(baidu.template(e.barItemTemplate,n)),e.$dialogElement.removeClass("check_error"),1===n.roles.length&&(i.forum_id=n.roles[0].forum_id,i.forum_name=window.encodeURI($("<span>"+n.roles[0].forum_name+"</span>").text()));else{var l={207:"\u8BE5\u5427\u4E3B\u4E3A\u5B98\u65B9\u6307\u5B9A\u5427\u4E3B\uFF0C\u6709\u4E13\u95E8\u4EBA\u5458\u8FDB\u884C\u76D1\u7763\uFF0C\u76EE\u524D\u4E0D\u63A5\u53D7\u7528\u6237</br>\u6295\u8BC9\u54E6~",204:"\u6B64\u4EBA\u4E0D\u662F\u5427\u4E3B\u54E6~"},r=e.$dialogElement.find(".id_remind");e.$dialogElement.addClass("check_error"),l[o]&&r.html(l[o]),e.$barTypeList.html("")}i.tbs=a.tbs,$.extend(e.formData,i),e.checkCanSubmit()},"json"),void 0):(e.formData.manager_uname="",e.$barTypeList.html(""),e.checkCanSubmit(),void 0)},checkCanSubmit:function(){var t=this;for(var e in t.formData)if(t.formData.hasOwnProperty(e)){var a=t.formData[e];if(void 0!==a&&""===a)return t.$submitBtn.removeClass("j_submit_btn").addClass("disable"),!1}return t.$submitBtn.removeClass("disable").addClass("j_submit_btn"),!0},showDialog:function(){this.initDialog(),this.$dialog.show(),this.options&&this.options.uname&&this.checkBarOwnerName(this.options.uname)}}});_.Module.define({requires:["user/widget/userApi"],path:"common/component/quick_reply_data_handler",sub:{initial:function(){var e=this.requireInstance("user/widget/userApi",[]);this.uid=$.getPageData("user.id"),this.isSuperMember=e.checkSuperMemberShipOf(PageData.user),this.Storage.initData({isSuperMember:this.isSuperMember})},Storage:function(){var e=null,t=$.Deferred(),a=!1,r=!1,n=function(n){if(r=n.isSuperMember||!1,!a){var o=s(),u=i();u.done(function(a){e={localData:o||{},serverData:a},t.resolve()}),a=!0}},s=function(){var e=$.tb.Storage.get("user_quick_reply_data")||"";return e=$.json.decode(e)||{}},i=function(){var e="/member/submit/getQuickPost",t={tbs:PageData.tbs,ie:"utf-8",_t:1*new Date},a=$.Deferred();return r?$.getJSON(e,t,function(e){if(0==e.no){for(var t=[],r=e.data||[],n=0,s=r.length;s>n;n++)t.push(r[n].content);a.resolve(t)}else a.resolve([])}):a.resolve([]),a},o=function(){return e};return{getData:o,$deferred:t,initData:n}}(),getLocalData:function(){var e=$.getPageData("localData."+this.uid,[],this.Storage.getData());return e.slice(0)},getServerData:function(){var e=$.getPageData("serverData",[],this.Storage.getData());return e.slice(0)},getData:function(){var e=$.Deferred(),t=this;return this.Storage.$deferred.done(function(){t.isSuperMember?e.resolve(t.getServerData()):e.resolve(t.getLocalData())}),e},saveLocalToServer:function(e){e||(e=this.getServerData());var t=this.getLocalData(),a=10;if(t=this._unescapeData(t),e=e.concat(t),e.length>a){var r=$.Deferred();return r.resolve({no:952701,data:{overflow:e.length-a}}),r}var n=this.saveData(e),s=this;return n.done(function(e){0==e.no&&s.saveInLocalStorage([])}),n},saveData:function(e){var t=$.Deferred();return this.isSuperMember?this.saveInServer(e,t):t.resolve(this.saveInLocalStorage(e)),t},errMap:{TOO_MUCH:{no:952701},CONTENT_LENGTH_REACH_LIMIT:{no:952702},SUCCESS:{no:0}},_escapeData:function(e){e=e.slice(0);for(var t in e)e[t]=$.tb.escapeHTML(e[t]);return e},_unescapeData:function(e){e=e.slice(0);for(var t in e)e[t]=$.tb.unescapeHTML(e[t]);return e},saveInLocalStorage:function(e){if(e.length>2)return this.errMap.TOO_MUCH;for(var t=0,a=e.length;a>t;t++)if(e[t].length>140)return this.errMap.CONTENT_LENGTH_REACH_LIMIT;var r=this.Storage.getData();e=this._escapeData(e),r.localData[this.uid]=e;var n=$.json.encode(r.localData);return $.tb.Storage.set("user_quick_reply_data",n),this.errMap.SUCCESS},saveInServer:function(e,t){var a=this.Storage.getData(),r="/member/submit/resetQuickPost",n=this;$.post(r,{tbs:PageData.tbs,contents:e},function(r){0==r.no?(a.serverData=n._escapeData(e),t.resolve({no:0,data:e})):t.resolve(r)},"json")}}});_.Module.define({requires:["user/widget/userApi","common/component/quick_reply_data_handler","common/component/ScrollPanel"],path:"common/component/quick_reply_edit",sub:{WRAPPER_TMP:'<div id="quick-reply-edit-wrapper"><div class="quick-reply-container"></div><div class="quick-reply-add-btn">\u6DFB\u52A0\u5FEB\u901F\u56DE\u8D34</div><div class="quick-reply-hint quick-reply-desc">#{descContent}</div><div class="quick-reply-footer"><button class="btn-default btn-middle submit-btn">\u5B8C\u6210</button><button class="btn-sub btn-middle j-cancel-btn">\u53D6\u6D88</button></div></div>',QUICK_REPLY_TMP:'<div class="quick-reply-item"><div class="quick-reply-delete-btn" data-index="#{index}"></div><div class="quick-reply-edit-container"  id="quick-reply-item-#{index}">#{content}</div></div>',DESC_CONTENT_FOR_NORMAL:'<i class="icon-vip2-16"></i><span class="red-text">\u8D85\u7EA7\u4F1A\u5458</span>\u53EF\u6DFB\u52A010\u6761\u5FEB\u901F\u56DE\u590D\u5E76\u4E14\u4E91\u7AEF\u540C\u6B65\uFF01<a href="#" onclick="return false;" class="j-open-super-member">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a>',defaultOpts:{additionalContent:null},initial:function(t){$.extend(this.defaultOpts,t),this.additionalContent=$.tb.escapeHTML(this.defaultOpts.additionalContent)||null;var e=this.requireInstance("user/widget/userApi",[]);this.isSuperMember=e.checkSuperMemberShipOf(PageData.user),this.replyDataHandler=this.requireInstance("common/component/quick_reply_data_handler"),this._initReply()},dialog_config:{html:"",title:"\u7F16\u8F91\u5FEB\u901F\u56DE\u8D34",width:"auto",escable:!1},_initReply:function(){var t=this;t.$wrapper=$($.tb.format(t.WRAPPER_TMP,{descContent:t.isSuperMember?t.DESC_CONTENT_FOR_VIP:t.DESC_CONTENT_FOR_NORMAL})),$.extend(t.dialog_config,{html:t.$wrapper}),t._showLocalToServerEnter(),t.dialog=new $.dialog(t.dialog_config),t.dialog.bind("onclose",function(){t._destroyEditorAll()}),t.scrollPanel=t.requireInstance("common/component/ScrollPanel",{container:t.$wrapper.find(".quick-reply-container"),height:200}),t._fillReplyContent(),t._bindEvents()},_showLocalToServerEnter:function(){var t='\u60A8\u6709<span class="red-text">#{num}</span>\u6761\u672C\u5730\u6570\u636E\u662F\u5426&nbsp;<a href="#" onclick="return false;" class="j-local-to-server">\u7ACB\u5373\u540C\u6B65</a>',e=this.replyDataHandler.getLocalData();if(this.isSuperMember&&e&&e.length>0){var n=$.tb.format(t,{num:e.length});this.$wrapper.find(".quick-reply-desc").html(n)}},_resizeScroll:function(t){var e={toBottom:!0};e=$.extend(e,t),this.scrollPanel._resizeHeight(),this.scrollPanel._resizeScroll(),e.toBottom?this.scrollPanel.scrollTopTo(2e4):this.scrollPanel.scrollTopTo(this.scrollPanel._scrollTop-30)},editorMaxId:0,_fillReplyContent:function(){var t=this;t._destroyEditorAll(),this.replyDataHandler.getData().done(function(e){var n="",i=!1;t.additionalContent&&(e.push(t.additionalContent),i=!0);for(var o=0,l=e.length;l>o;o++)n+=$.tb.format(t.QUICK_REPLY_TMP,{content:e[o],index:o}),t.editorMaxId++;for(t.scrollPanel.setContent(n),o=0,l=e.length;l>o;o++)t._initEditorById("quick-reply-item-"+o);t.additionalContent&&(t._focusEditorById("quick-reply-item-"+(o-1)),t.additionalContent=null),t._resizeScroll({toBottom:i}),t.dialog.setPosition()})},editorList:{},_initEditorById:function(t){var e={initialFrameHeight:45,initialFrameWidth:562,maxHeight:90,maxWordNum:140,maxWordNumType:"NormalAsciiCodeLen",focusChangeColor:1,toolbar:[],noToolbar:1,excludePlugins:["draft","at","tb_image","baiduinput","emotion_transform","setting"]},n=UE.getEditor(t,e);this.editorList[t]=n},_focusEditorById:function(t){var e=this.editorList[t];e.focus()},_collectReplyData:function(t){var e={filterEmpty:!0};e=$.extend(e,t);var n=[],i=this.$wrapper.find(".quick-reply-edit-container"),o=this;return i.each(function(t,i){var l=$(i).tbattr("id"),r=o.editorList[l].getContentTxt();(r||!e.filterEmpty)&&n.push(r)}),n},_showErrorMsg:function(t){952702==t?$.dialog.alert("\u5B57\u6570\u8D85\u8FC7\u9650\u5236\uFF0C\u8BF7\u91CD\u65B0\u586B\u5199"):952701==t&&(this.isSuperMember?$.dialog.alert("\u8D85\u8FC7\u4E0A\u4F20\u6761\u6570\u9650\u5236\uFF0C\u8BF7\u5220\u9664\u591A\u4F59\u7684\u5185\u5BB9"):this._dialogAlert("\u8D85\u8FC7\u4E0A\u4F20\u6761\u6570\u9650\u5236\uFF0C\u8BF7\u5220\u9664\u591A\u4F59\u7684\u5185\u5BB9"))},_submitQuickReply:function(){var t=this._collectReplyData(),e=this;this.replyDataHandler.saveData(t).done(function(t){0==t.no?(e._destroyEditorAll(),e.dialog.close()):e._showErrorMsg(t.no)})},_destroyEditorById:function(t,e){var n=this;e?$("#"+t).parents(".quick-reply-item").fadeOut(function(){UE.delEditor(t),delete n.editorList[t],$("#"+t).remove(),n._resizeScroll({toBottom:!1})}):(UE.delEditor(t),delete this.editorList[t],$("#"+t).remove())},_destroyEditorAll:function(){for(var t in this.editorList)this._destroyEditorById(t)},_dialogConfirm:function(t){var e='<div id="quick-reply-confirm-dialog"><p class="confirm-text">#{content}</p><p><button class="btn-default btn-middle confirm-submit-btn">\u786E\u5B9A</button><button class="btn-sub btn-middle j-confirm-cancel-btn">\u53D6\u6D88</button></p></div>',n={title:"\u63D0\u793A",content:"\u8BF7\u9009\u62E9\u786E\u5B9A\u6216\u8005\u53D6\u6D88",onaccept:null,oncancel:null};n=$.extend(n,t);var i={html:$.tb.format(e,{content:n.content}),title:n.title,width:400,height:90},o=new $.dialog(i);o.element.on("click",".confirm-submit-btn",function(){o.close(),$.isFunction(n.onaccept)&&n.onaccept()}).on("click",".j-confirm-cancel-btn",function(){o.close(),$.isFunction(n.oncancel)&&n.oncancel()})},_dialogAlert:function(t){var e=this,n='<div id="quick-reply-confirm-dialog"><p class="confirm-text">#{content}</p><p><button class="btn-default btn-middle confirm-submit-btn">\u5F00\u901A\u4F1A\u5458</button><button class="btn-sub btn-middle j-confirm-cancel-btn">\u53D6\u6D88</button></p></div>',i={title:"\u63D0\u793A",content:'<p>\u8BBE\u7F6E\u8D85\u8FC7\u4E0A\u9650</p><p><i class="icon-vip2-16"></i>&nbsp;<span class="red-text">\u8D85\u7EA7\u4F1A\u5458</span>\u53EF\u6DFB\u52A010\u6761\u5FEB\u901F\u56DE\u590D\u5E76\u4E14\u4E91\u7AEF\u540C\u6B65\uFF01</p>',onaccept:null,oncancel:null};i=$.extend(i,t);var o={html:$.tb.format(n,{content:i.content}),title:i.title,width:400,height:120},l=new $.dialog(o);l.element.on("click",".confirm-submit-btn",function(){e.requireInstanceAsync("common/widget/JoinVipDialog",[],function(t){t.getMemberDialog("quick_reply",1007001e3)}),$.isFunction(i.onaccept)&&i.onaccept()}).on("click",".j-confirm-cancel-btn",function(){l.close(),$.isFunction(i.oncancel)&&i.oncancel()})},_showLocalToServerResult:function(t,e){var n={0:"\u540C\u6B65\u6210\u529F",952702:"\u672C\u5730\u6570\u636E\u5B57\u6570\u8D85\u8FC7\u9650\u5236",952701:'\u4E91\u7AEF\u6570\u636E\u5DF2\u6EE1\uFF0C\u9700\u5148\u5220\u9664<span class="red-text">#{num}</span>\u6761\u540E&nbsp;<a href="#" onclick="return false;" class="j-local-to-server">\u518D\u6B21\u540C\u6B65</a>'},i=$.tb.format(n[t]||"",{num:e.overflow});this.$wrapper.find(".quick-reply-desc").html(i)},_bindEvents:function(){var t=this;this.$wrapper.on("click",".quick-reply-delete-btn",function(){var e=$(this),n=e.data("index"),i="quick-reply-item-"+n;t._destroyEditorById(i,!0),t.scrollPanel,t._postTrack("\u5220\u9664")}).on("click",".quick-reply-add-btn",function(){var e=t._collectReplyData({filterEmpty:!1});if(!t.isSuperMember&&e.length>=2)return t._dialogAlert("\u666E\u901A\u7528\u6237\u53EA\u80FD\u6DFB\u52A0\u4E24\u6761"),void 0;if(e.length>=10)return $.dialog.alert("\u6700\u591A\u53EA\u80FD\u6DFB\u52A0\u5341\u6761"),void 0;var n=$.tb.format(t.QUICK_REPLY_TMP,{content:"",index:t.editorMaxId}),i=$(n);t.scrollPanel.appendContent(i),t._initEditorById("quick-reply-item-"+t.editorMaxId),t._focusEditorById("quick-reply-item-"+t.editorMaxId),t._resizeScroll(),t.dialog.setPosition(),t.editorMaxId++,t._postTrack("\u6DFB\u52A0")}).on("click",".submit-btn",function(){t._submitQuickReply(),t._postTrack("\u4FEE\u6539\u63D0\u4EA4")}).on("click",".j-cancel-btn",function(){t._destroyEditorAll(),t.dialog.close(),t._postTrack("\u53D6\u6D88\u63D0\u4EA4")}).on("click",".j-local-to-server",function(){t.$wrapper.find(".quick-reply-desc").html("\u540C\u6B65\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),t.replyDataHandler.saveLocalToServer(t._collectReplyData()).done(function(e){0==e.no&&(t._fillReplyContent(),t.scrollPanel.scrollTopTo(2e4)),t._showLocalToServerResult(e.no,e.data)})}).on("click",".j-open-super-member",function(){t.requireInstanceAsync("common/widget/JoinVipDialog",[],function(t){t.getMemberDialog("quick_reply",1007001004)})}).on("keydown",function(){t._resizeScroll()})},_postTrack:function(t){"undefined"==typeof t&&(t=""),$.stats.track(t,"\u5FEB\u901F\u56DE\u8D34","","click")}}});_.Module.define({path:"encourage/widget/post_marry",requires:[],sub:{URL:{postMarryThread:"/marriage/postMarriageThread",getGift:"/marriage/gift/getSceneGiftList",sendGift:"/marriage/gift/sendGift",saveOrder:"/marriage/gift/saveOrder"},giftData:{},sceneId:2000135,initial:function(t){return this.opt=t,this.checkLogin()?("poster"===t.type?this.buildInPoster():"float"===t.type&&this.buildInFloat(),void 0):!1},bindEvent:function(){var t=this;$("body").on("click","[j-post-marry]",function(){t.buildInPoster()})},bindTemplateEvent:function(){var t=this,a=5;this.$root.find("[j-post-marry-title]").focus(),this.$root.on("click","[j-post-marry-gift-list-left]",function(){var r=t.$root.find(".post-marry-gift-list-wrapper ul");if(r.find("li").length<=6)return!1;var e=r.find("li").first();e.animate({marginLeft:-e.width()},function(){e.appendTo(r),e.css({marginLeft:a})})}).on("click","[j-post-marry-gift-list-right]",function(){var r=t.$root.find(".post-marry-gift-list-wrapper ul");if(r.find("li").length<=6)return!1;var e=r.find("li").last();e.css({marginLeft:-e.width()}),e.prependTo(r);var i=r.find("li").first();i.animate({marginLeft:a})}).on("click",".post-marry-gift-item",function(){var a=$(this);a.hasClass("post-marry-gift-item-active")?(t.$root.find(".post-marry-gift-list-wrapper ul li").removeClass("post-marry-gift-item-active"),t.giftData.gift_id=null,t.giftData.price=0):(t.$root.find(".post-marry-gift-list-wrapper ul li").removeClass("post-marry-gift-item-active"),a.addClass("post-marry-gift-item-active"),t.giftData.gift_id=a.tbattr("data-id"),t.giftData.price=a.tbattr("data-price"))}).on("mouseover",".post-marry-gift-item",function(){var a=$(this);t.buildGiftTipCard(a)}).on("mouseout",".post-marry-gift-item",function(){$(this);t._visit_card&&t._visit_card.closeCard({type:"delayClose",time:100}),t._visit_card=null}).on("change","[j-post-marry-oath]",function(){var a=$(this),r=a.val(),e=null==r.match(/[^ -~]/g)?r.length:r.length+r.match(/[^ -~]/g).length;e>280?(a.parent().find("[j-post-marry-value-warning]").text("\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7140\u4E2A\u6C49\u5B57\uFF0C\u73B0\u5728\u662F"+Math.ceil(e/2)+"\u5B57"),t.oathReady=!1):r?(a.parent().find("[j-post-marry-value-warning]").html('<div class="post-marry-checked" ></div>'),t.oathReady=!0):(a.parent().find("[j-post-marry-value-warning]").text("\u6C42\u5A5A\u8A93\u8A00\u4E0D\u80FD\u4E3A\u7A7A"),t.oathReady=!1)}).on("change","[j-post-marry-title]",function(){var a=$(this),r=a.val(),e=null==r.match(/[^ -~]/g)?r.length:r.length+r.match(/[^ -~]/g).length;e>280?(a.parent().find("[j-post-marry-value-warning]").text("\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7140\u4E2A\u6C49\u5B57\uFF0C\u73B0\u5728\u662F"+Math.ceil(e/2)+"\u5B57"),t.titleReady=!1):r?"\u3010\u6C42\u5A5A\u3011"===r?(a.parent().find("[j-post-marry-value-warning]").text("\u8BF7\u8865\u5168\u6807\u9898"),t.titleReady=!1):(a.parent().find("[j-post-marry-value-warning]").html('<div class="post-marry-checked" ></div>'),t.titleReady=!0):(a.parent().find("[j-post-marry-value-warning]").text("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),t.titleReady=!1)}).on("change","[j-post-marry-user]",function(){var a=$(this),r=a.val();r?(a.parent().find("[j-post-marry-value-warning]").html('<div class="post-marry-checked" ></div>'),t.userReady=!0):(a.parent().find("[j-post-marry-value-warning]").text("\u88AB\u6C42\u5A5A\u4EBA\u4E0D\u80FD\u4E3A\u7A7A"),t.userReady=!1)}).on("click","[j-post-marry-btn]",function(){t.$root.find("[j-post-marry-form]").trigger("submit")}).on("keypress","[j-post-marry-btn]",function(){return!1}).on("submit","[j-post-marry-form]",function(){var a=$(this);if(!t.userReady)return t.showAlert("\u8BF7\u586B\u5199\u6C42\u5A5A\u5BF9\u8C61"),!1;if(!t.titleReady)return t.showAlert("\u8BF7\u586B\u5199\u6C42\u5A5A\u6807\u9898"),!1;if(!t.oathReady)return t.showAlert("\u8BF7\u586B\u5199\u6C42\u5A5A\u8A93\u8A00"),!1;t.giftData.user_name=a.find('[name="post-marry-user"]').val();var r={title:a.find('[name="post-marry-title"]').val(),content:a.find('[name="post-marry-oath"]').val(),forum_name:PageData.forum.forum_name||"\u82F1\u4E09\u5609\u54E5",user_name:t.giftData.user_name,gift_id:t.giftData.gift_id,tbs:PageData.tbs};return t.giftData.scene_id=t.sceneId,t.showAlert("\u7ED3\u5A5A\u8D34\u53D1\u5E03\u4E2D...  "),$.post(t.URL.postMarryThread,r,function(a){if(a)switch(a.no){case 0:t.giftData.gift_id?(t.giftData.post=a.data,t.genOrder(t.giftData)):(t.showAlert("\u7ED3\u5A5A\u8D34\u53D1\u5E03\u6210\u529F!  "),setTimeout(function(){$.tb.location.reload()},1e3));break;case 2670002:t.showAlert("\u6765\u665A\u4E00\u6B65\uFF0C\u8BE5\u7528\u6237\u5DF2\u7ECF\u7ED3\u5A5A");break;case 2672671:t.showAlert("\u8BE5\u7528\u6237\u6B63\u5728\u7533\u8BF7\u6C42\u5A5A\u4E2D");break;case 2670006:t.showAlert('\u60A8\u8FD8\u6CA1\u6709\u8BBE\u7F6E\u6027\u522B\uFF0C\u4E0D\u80FD\u6C42\u5A5A <p style="text-align:center; padding:20px; "><a class="btn-small btn-default" href="//www.baidu.com/p/setting/profile/basic" target="_blank">\u70B9\u51FB\u8BBE\u7F6E</a><p>');break;case 2670007:t.showAlert("\u6C42\u5A5A\u5BF9\u8C61\u6CA1\u6709\u8BBE\u7F6E\u6027\u522B\u4E0D\u80FD\u6C42\u5A5A");break;case 2670008:t.showAlert("\u5185\u6D4B\u671F\u95F4\uFF0C\u53EA\u5141\u8BB8\u5F02\u6027\u7ED3\u5A5A\u54E6~");break;case 2380009:t.showAlert("\u5185\u6D4B\u671F\u95F4\uFF0C\u9700\u8981\u7ED3\u5A5A\u53CC\u65B9\uFF0C\u81F3\u5C11\u4E00\u65B9\u6709\u59B9\u5B50\u56E2\u5370\u8BB0\u65B9\u53EF\u7ED3\u5A5A");break;default:t.showAlert("\u7ED3\u5A5A\u8D34\u53D1\u5E03\u5931\u8D25! ")}else t.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86! ")}),!1}).on("click","[j-post-marry-header-close]",function(a){a.preventDefault(),t.dialog.hide()})},buildGiftTipCard:function(t){var a=this,r=parseInt(t.tbattr("data-proportion")),e=parseInt(t.tbattr("data-price")),i=Math.floor(e*(1-r/100));if(0!=i&&!isNaN(i)){a._visit_card&&(a._visit_card.closeCard(),a._visit_card=null);var s="";s=0===+a.currency?'<div class="marry-gift-tip-card-content">\u6536\u793C\u4EBA\u53EF\u83B7\u5F97 <i class="icon-tbean"></i><span class="orange-text" >'+i+"</span></div>":'<div class="marry-gift-tip-card-content">\u6536\u793C\u4EBA\u53EF\u83B7\u5F97 <i class="icon-blue"></i><span class="orange-text" >'+i+"</span></div>";var o={content:s,card_css:{width:200,zIndex:60002},auto_positon:!0,event_target:t,attr:"id='marry-gift-tip-card'",wrap:$("body")};a._visit_card=a.requireInstance("common/widget/Card",o),a._visit_card.showCard({type:"delayShow",time:200})}},loadTemplate:function(t,a){var r=this;this.template='<div id="post-marry" class="post-marry" >      <% if (canClose == 0) { %>      <div class="post-marry-header" >\u6B63\u5F0F\u6C42\u5A5A</div>      <% } %>                   <form class="post-marry-form" j-post-marry-form>      <div class="post-marry-wrapper" >                   <div class="post-marry-row post-marry-title" >              <label class="post-marry-label" >\u8D34\u5B50\u6807\u9898:</label>              <input class="post-marry-value" name="post-marry-title" j-post-marry-title required value="\u3010\u6C42\u5A5A\u3011"/>              <div  class="post-marry-value-warning" j-post-marry-value-warning ></div>          </div>          <div class="post-marry-row post-marry-user" >              <label class="post-marry-label" >\u6C42\u5A5A\u4EBA:</label>              <input class="post-marry-value" required readonly=true value="<%= user_name %>" />          </div>          <div class="post-marry-row post-marry-propose" >              <label class="post-marry-label" >\u88AB\u6C42\u5A5A\u4EBA:</label>              <input class="post-marry-value" name="post-marry-user" j-post-marry-user  value="<%= propose_name %>"  required placeholder="\u53EA\u80FD\u5BF9\u62E5\u6709\u59B9\u7EB8\u5370\u8BB0\u7684\u7528\u6237\u6C42\u5A5A" />              <div  class="post-marry-value-warning" j-post-marry-value-warning ><% if( propose_name) { %><div class="post-marry-checked" ></div> <% } %></div>          </div>          <div class="post-marry-row post-marry-oath" >              <label class="post-marry-label"  >\u6C42\u5A5A\u8A93\u8A00:</label>              <textarea class="post-marry-value" name="post-marry-oath" j-post-marry-oath required  placeholder="\u751C\u871C\u800C\u53C8\u771F\u8BDA\u7684\u8A93\u8A00\uFF0C\u80FD\u63D0\u9AD8\u6C42\u5A5A\u6210\u529F\u51E0\u7387\uFF0C\u4E0D\u8D85\u8FC7140\u4E2A\u5B57\u3002"  ></textarea>              <div  class="post-marry-value-warning" j-post-marry-value-warning ></div>          </div>                    <div class="post-marry-row post-marry-gift" >              <label class="post-marry-label" >\u6C42\u5A5A\u793C\u7269\u9009\u62E9(\u53EF\u9009)</label>              <div class="post-marry-gift-list clearfix">                  <% if (giftList.length > 7 ){ %>                      <div class="post-marry-gift-list-left" j-post-marry-gift-list-left ></div>                  <% } %>                                    <div class="post-marry-gift-list-wrapper clearfix" >                      <ul>                          <% for (var i in giftList) {                               var item = giftList[i];                          %>                               <li class="post-marry-gift-item" data-price="<%=item.price %>" data-proportion="<%=item.proportion %>" data-id="<%=item.gift_id %>" >                                  <div class="post-marry-gift-item-wrapper" >                                      <div  class="post-marry-gift-item-img" >                                          <img src="<%=item.large_thumbnail_url %>" />                                          <% if (item.proportion != 100) { %> <i class="icon-marry-gift-dou"></i><% } %>                                      </div>                                      <span class="post-marry-gift-worth orange-text"><i class="icon-tbean"></i><%=item.price %></span>                                      <div  class="post-marry-gift-item-check" ></div>                                  </div>                                  <p class="post-marry-gift-item-name" ><%=item.gift_name %></p>                                                                </li>                          <% } %>                                                                         </ul>                  </div>                  <% if (giftList.length > 7 ){ %>                      <div class="post-marry-gift-list-right"  j-post-marry-gift-list-right ></div>                  <% } %>              </div>          </div>          </div>        <button type="button" class="btn-default btn-small post-marry-btn" j-post-marry-btn >\u5F00\u59CB\u6C42\u5A5A</button>      <% if (canClose) { %>     <!--  <a class="btn-small btn-sub post-marry-header-close" j-post-marry-header-close >\u5173\u95ED</a> -->      <span class="post-marry-tip">( \u60A8\u7684\u7ED3\u5A5A\u8D34\u5C06\u4F1A\u53D1\u5230<a href="/f?ie=utf-8&kw=\u82F1\u4E09\u5609\u54E5&fr=marriage_post" target="_blank" >\u82F1\u4E09\u5609\u54E5\u5427</a> )</span>      <% } %>          </form>  </div>';var e=[],i={scene_id:this.sceneId};$.get(this.URL.getGift,i,function(i){if(i)switch(i.no){case 0:e=i.data.gift_list,r.currency=i.data.currency;break;default:console.log("\u793C\u7269\u83B7\u53D6\u5931\u8D25")}else e=[];e||(e=[]),r.$root=$(_.template(r.template)({user_name:PageData.user.user_name,propose_name:r.opt.propose_name||"",giftList:e,canClose:"poster"===t?0:1})),r.opt.propose_name&&(r.userReady=!0),r.bindTemplateEvent(),a()})},showAlert:function(t,a){this.dialog_tip&&this.dialog_tip.close(),this.dialog_tip=null,t&&(this.dialog_tip=new $.dialog({title:a?a:"\u53D1\u8D34\u63D0\u793A",html:'<div style="text-align:center" >'+t+"</div>"}))},showCaptchaDialog:function(t){var a=this;a.captchaDialog?(this._isPosting=!1,a.captchaDialog.setTip(t.data.vcode.str_reason),a.captchaDialog.updateCaptchaImg(t.data.vcode.captcha_vcode_str,t.data.vcode.captcha_code_type),a.captchaDialog.show(),a.captchaDialog.focus()):this.requireInstanceAsync("common/component/CaptchaDialog",{message:t.data.vcode.str_reason,vCode:t.data.vcode.captcha_vcode_str,vCodeType:t.data.vcode.captcha_code_type,forumName:a._dataPostor.kw,forumId:a._dataPostor.fid,postType:"reply",paramsCallback:function(){var t=a._getData(),r={content:t.content};return r.tid=a._dataPostor.tid,r}},function(t){a.captchaDialog=t,t.bind("onclose",function(){return a._isPosting=!1,a._enableEditor(),t.hide(),!1}),t.bind("onaccept",function(){a.setDataPostor({vcode:t.getInputValue(),vcode_md5:t.getVCode()}),a._submitData(),a.removeDataPostor("vcode"),a.removeDataPostor("vcode_md5")}),t.show()})},checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)},genOrder:function(t){var a=this.requireInstance("tbmall/widget/TbeanSafeAjax"),r=this,e=t;e.user_name=this.giftData.user_name,e.tbs=PageData.tbs,a.post(this.URL.sendGift,e,function(a){if(0==a.no&&a.data){var e=a.data,i={};i.order_id=a.data.order_id,i.thread_id=t.post.thread_id,i.post_id=t.post.post_id,i.gift_from=1,i.price=r.giftData.price,i.tbs=PageData.tbs,$.post(r.URL.saveOrder,i,function(){var t=r.requireInstance("common/widget/Tdou/TdouViewPay",function(t){t.data&&!t.data.no&&(r.showAlert("\u793C\u7269\u8D60\u9001\u6210\u529F\uFF01","\u793C\u7269\u8D60\u9001"),setTimeout(function(){$.tb.location.reload()},1e3))});t.createMain(e)})}else r.showAlert("\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5","\u793C\u7269\u8D60\u9001"),setTimeout(function(){$.tb.location.reload()},1e3)})},hide:function(){this.dialog.hide()},show:function(){this.dialog.show()},buildInFloat:function(){this.dialog&&this.dialog.close();var t=this;this.loadTemplate("float",function(){t.dialog=new $.dialog({title:"\u53D1\u8868\u7ED3\u5A5A\u8D34",html:t.$root,width:709,holderClassName:"post-marry-dialog"})})},buildInPoster:function(){if(this.dialog)this.show();else{var t=$("#tb_rich_poster .poster_body"),a=this;this.loadTemplate("poster",function(){a.dialog=new $.dialog({html:a.$root,showTitle:!1,showModal:!1,modal:!1,width:720,showShadow:!1,fixed:!1,top:t.offset().top,left:t.offset().left,holderClassName:"post-marry-dialog-poster"})})}}}});!function(e){var t;_.Module.use("ueglibs/widget/Ban",[],function(e){t=e}),$(".j_richPosterAppealLink").live("click",function(){$.stats.track("posterAppealLink","uegCount","bawuAppeal","click")});var r={POST_AUTHORIZED:"authorized",POST_LOGIN_NEEDED:"\u672C\u5427\u53D1\u8D34\uFF0C\u8BF7\u5148 <a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', 'editor']);return false;\">\u767B\u5F55</a> | <a href=\"#\" onclick=\"TbCom.process('User','buildRegisterFrame',null,null,null,'editor');return false;\">\u6CE8\u518C</a>&nbsp;",POST_USERNAME_NEEDED:"\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148<a href=\"#\" onclick=\"TbCom.process('User','buildUnameFrame','\u586B\u5199\u7528\u6237\u540D',' ');return false;\">\u586B\u5199\u7528\u6237\u540D</a>",POST_BLOCKED:t.render("richPoster"),POST_LEVEL_LIMITED:'\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8<a href="//tieba.baidu.com/f/like/level?kw=#{forum_name}&ie=utf-8" target="_blank">4\u7EA7\u5934\u8854</a><br />\u4EE5\u4E0A\u4F1A\u5458\u53D1\u8D34',POST_BAWU_LIMITED:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53D1\u8D34",POST_LAW_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34",POST_QUALIFICATIONS_LIMITED:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53CA\u6CE8\u518C\u6EE1\u4E00\u5B9A\u65F6\u95F4\u7684\u8001\u7528\u6237\u53D1\u8D34",POST_THREAD_ONLY:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u4E3B\u9898\u8D34",POST_REPLY_ONLY:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u56DE\u590D\u8D34",POST_THREAD_LEVEL_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u4E3B\u9898\u8D34",POST_REPLY_LEVEL_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u56DE\u590D\u8D34",POST_PAD_LIMITED:"\u5207\u6362\u6210pad\u7248\u8D34\u5427\uFF0C\u7545\u4EAB\u66F4\u987A\u7545\u7684\u53D1\u8D34\u4F53\u9A8C\uFF01",POST_ONLY_LOUZHU_CAN_REPLY:"\u4E0D\u597D\u610F\u601D\u54E6\uFF0C\u672C\u697C\u76EE\u524D\u53EA\u5141\u8BB8\u697C\u4E3B\u56DE\u590D\u54E6~<br/>\u5982\u679C\u4F60\u6709\u76F8\u540C\u6216\u5176\u4ED6\u7684\u95EE\u9898\uFF0C\u8BF7\u5728\u672C\u5427\u53D1\u8D34\u53CD\u9988\u54E6~",context:null,authorities:null,loadContext:function(e){this.context=e},loadContextFromPageData:function(e){var t="frs"==e.product,r="pb"==e.product;this.context={forum:{id:e.forum.forum_id,name:e.forum.forum_name,nameEncoded:e.forum.name_url},user:{id:e.user.user_id,name:e.user.user_name,level:e.user.level_id?e.user.level_id:e.user.balv.level_id,isFavorForum:t?e.user.balv.is_like:PageData.user.is_like,isLogin:!!e.user.is_login,isBlocked:t?!!e.user.is_block:!!PageData.user.forbidden.isForbid,isBlack:t?!!e.user.balv.is_black:!!e.user.is_black,noUsername:!!e.user.no_un,canPost:t?e.user.power.post:PageData.power.can_post,canVote:t?e.user.power.vote_creater:!1,forbidFlag:e.forum.forbid_flag,signNumber:e.user.is_login?e.forum.sign_in_info&&e.forum.sign_in_info.user_info?e.forum.sign_in_info.user_info.c_sign_num:0:0,superboy:e.user.superboy,props:e.user.Parr_props,gameSignature:e.user.game_attr},product:e.product,floor:0,tbs:e.tbs,isPad:e.is_ipad,page:e.page},r&&(this.context.thread={id:e.thread.thread_id,thread_type:PageData.thread.thread_type},this.context.floor=e.thread.reply_num)},loadAuthorities:function(e){$.browser.msie&&$.browser.version<8&&(e.long_editor=!1,e.float_editor=!1),this.authorities=e},getContext:function(){return this.context},getAuthorities:function(){return this.authorities},isPostAllowed:function(){return this._validatePostAuthority()==this.POST_AUTHORIZED},getPostRejectedMessage:function(){var e=this._validatePostAuthority();return e!=this.POST_AUTHORIZED?$.tb.format(e,$.extend({forum_name:this.context.forum.name},this.context)):null},_validatePostAuthority:function(){var e=this.context.user;return e.isLogin?e.noUsername?this.POST_USERNAME_NEEDED:e.isBlocked?this.POST_BLOCKED:e.canPost?"pb"==PageData.product&&PageData.feedback&&0!=PageData.feedback&&PageData.user.user_name!=PageData.thread.author?this.FORBID_FLAG_MAP[11]:this.context.isPad?this.POST_PAD_LIMITED:this.POST_AUTHORIZED:this.FORBID_FLAG_MAP[e.forbidFlag]:this.POST_LOGIN_NEEDED}};r.FORBID_FLAG_MAP={1:r.POST_LOGIN_NEEDED,2:r.POST_QUALIFICATIONS_LIMITED,3:r.POST_LEVEL_LIMITED,4:r.POST_BAWU_LIMITED,5:r.POST_LAW_LIMITED,7:r.POST_REPLY_ONLY,8:r.POST_THREAD_ONLY,9:r.POST_REPLY_LEVEL_LIMITED,10:r.POST_THREAD_LEVEL_LIMITED,11:r.POST_ONLY_LOUZHU_CAN_REPLY},e.PosterContext=r}(window);_.Module.define({require:["common/widget/paypost_data"],path:"common/widget/RichPoster",requires:["common/widget/PostService","common/widget/WordLimit","common/widget/PostPrefix","common/widget/PostSignature","common/widget/MousePwd","encourage/widget/PostGuessingNew","common/component/BubbleFactory","bawu/widget/complaintBarOwner","encourage/widget/paypost_agree_dialog","common/component/quick_reply_edit","encourage/widget/post_marry","common/widget/payMember","common/widget/LoginDialog"],sub:{_options:{},_widnowScrollTimer:"",_windowHeight:0,_payMemberTpl:'<a href="javascript:;" class="j-placeholder-pay-member" style="color:#999; text-decoration:none;margin-left: 80px;margin-top:12px;display:block;">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C</a>',initial:function(t){this._options=t,this._windowHeight=screen.height,this.bindWannaPost(),this.bindTousuEvent(),this.bindScrollEvent()},bindTousuEvent:function(){var t=this;$("#frs_footer_tieba_report").on("click",function(e){if(PageData.user.is_login){var i=t.getInstance("bawu/widget/complaintBarOwner");i.showDialog()}else e.preventDefault(),_.Module.use("common/widget/LoginDialog")})},bindScrollEvent:function(){var t=this;$("body").height()<=2*t._windowHeight||"hottopic"===PosterContext.getContext().product?t.init():$(window).bind("scroll",[t],t.scrollHandler)},unbindScrollEvent:function(){var t=this;$(window).unbind("scroll",t.scrollHandler)},bindFullScreenEvent:function(){var t=this;$editorContainer=this.$root.find(".ueditor_container"),$editorContainer.on("onSetFullScreen",function(){t.fullscreenBubble&&t.fullscreenBubble.closeBubble()})},scrollHandler:function(t){var e=t.data[0];e._widnowScrollTimer&&clearTimeout(e._widnowScrollTimer),e._widnowScrollTimer=setTimeout(function(){$(window).scrollTop()+2*e._windowHeight>=$("body").height()&&(e.init(),e.unbindScrollEvent())},200)},bindWannaPost:function(){var t=this;this.observe("wanna_post",function(){PosterContext.getAuthorities().float_editor?t.enableFloatingPoster():$(window).scrollTop($("body").height()),setTimeout(function(){t.focus()},600)})},init:function(){var t=$("#tb_rich_poster_container"),e=this._options;this.$container=t,this.$root=t.find("#rich_ueditor_tpl"),this.$window=$(window),this.$editorContainer=this.$root.find(".ueditor_container"),this.prefix=e.prefix,this.isFrs="frs"===PosterContext.getContext().product,this.isHotTopic="hottopic"===PosterContext.getContext().product,this.isPb="pb"===PosterContext.getContext().product,this.isQinglang=e.isQinglang,this.redirectAfterPost=e.redirectAfterPost||!1,this.QinglangData=e.QinglangData,this.hideHolder=0,this.initPostService(),(this.isFrs||this.isHotTopic)&&(this.$title=this.$root.find(".j_title"),this.initTitle());var i=PosterContext.getContext().page;if(this.isPb&&"pb_bright"!==i&&this.$root.addClass("compat_rich_poster"),this.initDraft(),this.initEditor(),this.initAntiSpamming(),this.initEvent(),this.initPlaceholder(),this.initSaveToQuickReply(),PosterContext.getAuthorities().long_editor&&this.initFloatingToolbar(),this.initMousePwd(),this.initSignature(),PosterContext.context.user.isLogin&&!PosterContext.isPostAllowed())$.browser.msie&&6==$.browser.version||this.editor.ready(function(){this.disable()}),this.showWarning(PosterContext.getPostRejectedMessage()),this.toggleSubmitButton(!0),this.$title&&this.$title.tbprop("disabled",!0);else{if(this.isFrs||this.isHotTopic){var o="",s=window.PageData.user;if(this.QinglangData&&this.QinglangData.title)o=this.QinglangData.title;else{var n=s.mParr_props&&s.mParr_props.level&&this.isBeMember()?"\u4EB2\u7231\u7684\u4F1A\u5458\uFF0C\u8BF7\u8F93\u5165\u60A8\u7684\u6807\u9898":"\u8BF7\u586B\u5199\u6807\u9898";o=n}_.Module.use("common/widget/Placeholder",[this.$title,o,{color:"#bfbfbf"}])}this.editor.ready(function(){this.restoreDraft()})}PageUnit.load("rich_poster_show_music_recommend"),this.isFrs&&PosterContext.getContext().user.isLogin&&this.showOfflineCard()},initSaveToQuickReply:function(){var t=this;this.$container.on("click",".save-to-quick-reply-btn",function(){if(!PageData.user.is_login)return t.requireInstanceAsync("common/widget/LoginDialog"),void 0;var e=t.editor.getContentTxt();t.requireInstance("common/component/quick_reply_edit",[{additionalContent:e}])})},showOfflineCard:function(){var t=this,e=1*new Date;e>1408032e6||$.tb.Storage.get("balv_tdou_update")>e||(this.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="//tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":0,left:34,top:122},arrow_pos:{left:25},wrap:$("#tb_rich_poster"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("poster_doupiao_offline",e+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("poster_doupiao_offline",e+864e5),t.offline_card._j_card.remove()}),this.offline_card.showCard())},initPostService:function(){var t=this,e="",i=!(!window.history||!window.history.pushState);this.postService=this.use("common/widget/PostService"),this.postService.success(function(){$.stats.track("pb\u53D1\u8868\u6309\u94AE\u70B9\u51FB\u91CF","\u53D1\u8D34\u4F18\u5316\u7EDF\u8BA1","pb","click"),t.editor.setContent(""),t.editor.clearDraft(),t.showPostSuccess(),PosterContext.getContext().isBlessForum&&t.setBlessCookie();var o=t.require("common/widget/paypost_data").getInstance();o.get("isPaypost")&&(t.feeEditor.setContent(""),t.feeEditor.clearDraft());var s=Math.ceil(10*Math.random());s>8&&($.stats.track("pb-list\u6700\u4E0B_F90","PC\u7AEF\u5F69\u7968pb\u53D1\u5E16\u8BD5\u9A8C","pb","view",{obj_url:"//tb1.bdstatic.com/tb/cms/com/icon/F90_icon.gif"}),$.tb.Storage.set("pb_show_ad_f90","Y",(new Date).getTime()+8e3)),"pb"===PageData.product?PageData.pager.total_page===PageData.pager.cur_page&&setTimeout(function(){e=$.tb.location.getHref().replace($.tb.location.getProtocol()+"//"+$.tb.location.getHost(),""),-1!==e.indexOf("#")&&(e=e.slice(0,e.indexOf("#"))),-1===e.search(/pn=(\d+)/)&&(e+=-1===e.search(/\?/)?"?pn=1":"&pn=1"),i?window.refreshPage(e):window.refreshPage("",+e.match(/pn=(\d+)/)[1])},500):setTimeout(function(){t.redirectAfterPost?$.tb.location.setHref(t.redirectAfterPost):t.refresh(),$.browser.msie&&t.isHotTopic&&$.tb.location.reload()},1e3),setTimeout(function(){$(".tb_poster_info").remove(),t.togglePostState(!1);var e=$(window).scrollTop();e>0&&(window.scrollTo(0,1),setTimeout(function(){window.scrollTo(0,0)},0))},2e3),setTimeout(function(){t.editor.execCommand("clearfullscreen");var e=$(".j_submit").data("fullscreen")||"\u9ED8\u8BA4";$.stats.track("\u56DE\u590D\u6210\u529F-"+e,"\u65B0\u53D1\u8D34\u4F18\u5316\u7EDF\u8BA1","pb","view")},1e3)}).complete(function(){t.togglePostState(!1)})},initEvent:function(){var t=this;this.$submit=this.$root.find(".j_submit").click(function(e){e.preventDefault(),t.$submit.is(".ui_btn_disable")||t.post()}),this.$submit=this.$root.find(".j_get_editor_content").click(function(e){e.preventDefault();var i='<textarea style="width:700px;height:460px">'+t.getContentUbb()+"</textarea>",o={modal:!0,fixed:!0,width:726,height:464,holderClassName:"",draggable:!0,html:i};t._content_dialog=new $.dialog(o),t._content_dialog.show()}),this.$root.on("keyup",function(e){e.ctrlKey&&13==e.keyCode&&t.post()}),this.$root.find(".add_vote_btn").click(function(){if(!PosterContext.getContext().user.canVote){var t=PosterContext.getContext().forum.nameEncoded;return $.tb.alert({title:"\u53D1\u8D77\u6295\u7968",message:'\u83B7\u5F97<a target="_blank" href="/f/like/level?kw='+t+'">3\u7EA7\u5934\u8854</a>\u624D\u53EF\u53D1\u8D77\u6295\u7968\u54E6~~<br />\u7533\u8BF7\u52A0\u5165\u4F1A\u5458\uFF0C\u9A6C\u4E0A\u53D1\u8D77\u6295\u7968\uFF01\uFF08\u66F4\u591A\u4F1A\u5458\u7279\u6743<a target="_blank" href="/f/like/level?kw= '+t+'">\u70B9\u6B64\u67E5\u770B</a>',buttons:{text:"\u786E\u5B9A"}}),!1}}),this.$root.find(".j_disable_float").click(function(){t.disableFloatingPoster()}),this.observe("insertimage",function(e,i){t.editor.execCommand("insertimage",[i])}),this.observe("file_added.attachment",function(){t.togglePostState(!0)}),this.observe("upload_complete.attachment",function(){t.togglePostState(!1)});this.$root.find(".add_guessing_btn").on("click",function(){t.guessingDialog?t.guessingDialog._dialog.show():(t.guessingDialog=t.use("encourage/widget/PostGuessingNew",{container:$("#tb_rich_poster .poster_body")}),$(".guessing_holder").css("width","720"),$("#guessing_wrapper").css({paddingLeft:60})),t.$root.find(".post_head_btn").removeClass("cur"),$(this).addClass("cur"),t.marryDialog&&t.marryDialog.hide(),$("#tb_rich_poster_container").height(512)}),this.$root.find(".add_thread_btn").on("click",function(){t.guessingDialog&&t.guessingDialog._dialog.hide(),t.marryDialog&&t.marryDialog.hide(),t.$root.find(".post_head_btn").removeClass("cur"),$(this).addClass("cur"),$("#tb_rich_poster_container").height("auto")}),this.$root.find(".add_marry_btn").on("click",function(){t.marryDialog?t.marryDialog.show():(t.marryDialog={},t.marryDialog.hide=t.marryDialog.show=function(){},t.requireInstanceAsync("encourage/widget/post_marry",{type:"poster"},function(e){t.marryDialog=e})),t.$root.find(".post_head_btn").removeClass("cur"),$(this).addClass("cur"),t.guessingDialog&&t.guessingDialog._dialog.hide(),$("#tb_rich_poster_container").height(623)})},initTitle:function(){this.initTitleWordLimit(),this.initTitlePrefix()},initFloatingToolbar:function(){function t(){s.removeClass("poster_floating_toolbar").removeClass("poster_locked_toolbar"),i=!1}var e=this,i=!1,o=this.$root.find(".editor_bottom_panel"),s=this.$root.find(".j_floating");if(this.$window.scroll(function(){if(e.editor.$container.height()>e.$window.height()){var n=e._viewPortOn(e.$root);if(n.isOnScreen){var r=e._viewPortOn(o);r.bottomToBottom>=0?i&&t():n.topToBottom>400?(s.addClass("poster_floating_toolbar").removeClass("poster_locked_toolbar"),i=!0):(s.addClass("poster_locked_toolbar").removeClass("poster_floating_toolbar"),i=!0)}else i&&t()}else i&&t()}),this.bind("draft_clean",t),this.bind("poster_float",t),"1"!=$.tb.Storage.get("close_long_editor_bubble")){var n={content:"\u5DF2\u4E3A\u4F60\u5F00\u542F\u8D85\u957F\u53D1\u8D34\u6846\u529F\u80FD\uFF0C\u4E86\u89E3\u66F4\u591A\u6216\u5173\u95ED\u6B64\u529F\u80FD<a href='//tieba.baidu.com/mo/q/topic_page/219_1' target='_blank'>\u70B9\u51FB\u8FD9\u91CC</a>",arrow_dir:"down",bubble_css:{top:80,left:100,width:179},wrap:this.$root.find(".j_bubble_container"),closeBtn:!0},r=new UiBubbleTipBase(n);r.bind("onclose",function(){$.tb.Storage.set("close_long_editor_bubble","1",(new Date).getTime()+2592e6),r.closeBubble()}),r.showBubble()}},initTitleWordLimit:function(){var t=this,e=$("#tb_rich_poster"),i={inputObj:this.$title,checkDelay:200,showLimit:10,maxNum:60,isLimitInput:!0},o=this.use("common/widget/WordLimit",i);o.init(),o.bind("wlshowing",function(){e.find(".j_surveillance").hide(),t.$root.hasClass("tb_floating_poster")&&o.holder.css("zIndex",1e4)}),o.bind("wlhiding",function(){e.find(".j_surveillance").show(),o.holder.css("zIndex","auto")})},initTitlePrefix:function(){var t={$target:this.$title,prefix:this.prefix};this.use("common/widget/PostPrefix",t)},initEditor:function(){var t=this.requireInstance("user/widget/userApi",[]),e=t.checkSuperMemberShipOf(window.PageData.user);if(e&&(this.hideHolder=1),PosterContext.isPostAllowed()){var i={};i.excludePlugins=["medal"],i.contentWidth=708,i.initialFrameWidth=720,PosterContext.getAuthorities().long_editor&&(i.autoFloatEnabled=!0,i.topOffset=this.isFrs?40:0,i.heightLimit=!1),PosterContext.getAuthorities().emotion_transform||i.excludePlugins.push("emotion_transform"),this.isHotTopic&&(i.toolbar=["image","emotion","topic","fullscreen"]),this.editor=UE.getEditor("ueditor_replace",i),this.initBubble()}else this.editor=UE.getEditor("ueditor_replace",{toolbar:""});window.test_editor=this.editor,window.test_poster=this,this.initBubbleTips()},initBubble:function(){var t=this,e=this.use("common/component/BubbleFactory");return e.getPropId()&&e.getCurrent()?(t.editor.ready(function(){t.editor.execCommand("background","bubble",e.getCurrent().background),t.editor.execCommand("setmsg",e.getCurrent())}),void 0):(this.isBeMember()&&!$.cookie("bubguide")&&this.editor.execCommand("setmsg","MSG_USE_GUIDE"),void 0)},initDraft:function(){var t=this,e=this.$root.find(".j_draft"),i=e.children(".j_content"),o=e.children(".j_clear");this.$root.on("saved.draft",function(){i.text("\u4F60\u6B63\u5728\u8F93\u5165\u7684\u5185\u5BB9\u5DF2\u81EA\u52A8\u4FDD\u5B58, "+$.dateFormat(new Date,"HH:mm:ss")),e.show()}),this.$root.on("restored.draft",function(){i.text("\u4F60\u4E0A\u6B21\u672A\u53D1\u8868\u7684\u5185\u5BB9\u5DF2\u81EA\u52A8\u6062\u590D"),e.show()}),o.on("click",function(){t.editor.clearDraft(),t.editor.setContent("");var i=t.require("common/widget/paypost_data").getInstance();i.get("isPaypost")&&(t.feeEditor=t.feeEditor||UE.getEditor("ueditor_fee_replace"),t.feeEditor.setContent(""),t.feeEditor.clearDraft()),e.hide(),t.trigger("draft_clean")})},initPlaceholder:function(){var t=this,e=0;if(this.$placeholder=$('<div class="tb_poster_placeholder"></div>'),this.$placeholder.click(function(e){$(e.target).is("a")||(t.$placeholder.hide(),t.editor.focus())}),this.editor.ready(function(){t.$placeholder.prependTo(t.$root.find(".edui-container")),t.editor.addListener("focus",function(){t.$placeholder.hide()}),t.editor.addListener("blur",function(){e||t._showPlaceHolder()}),t._showPlaceHolder()}),this.$root.on("restored.draft",function(){t.$placeholder.hide()}),this.QinglangData&&this.QinglangData.content&&PageData.user.is_login){this.$placeholder.css({left:15,top:55});var i='<p style="width:565px;line-height:25px;">'+this.QinglangData.content+"</p>";this.$placeholder.html(i)}else this.$placeholder.html(this._payMemberTpl),this.bindSuperMemberExpUpTrack();this.$editorContainer.on("setbackground",function(i,o){return"default"!==o&&o?(t.hideHolder=1,t.$placeholder.hide(),void 0):(e||t._showPlaceHolder(),void 0)}),this.$placeholder.find("a").on("click",function(){var t="";"frs"==PageData.product?t="frs":"pb"==PageData.product&&(t="pb"),$.stats.track("\u53D1\u8868\u56DE\u590D\u6846PlaceHolder","\u8D34\u5427PC\u9875\u9762\u4F18\u5316",t,"click")}),PosterContext.getContext().user.isLogin&&"\u8D34\u5427\u610F\u89C1\u53CD\u9988"==PosterContext.getContext().forum.name&&this.$placeholder.addClass("tb_poster_plain_placeholder").html(PageUnit.load("rich_poster_feedback"))},_showPlaceHolder:function(){var t=this.editor.getContent();0!=t.length||this.hideHolder||this.$placeholder.show()},initMousePwd:function(){this.MousePwd=this.use("common/widget/MousePwd"),this.MousePwd.start(["editor_content_wrapper"])},initSignature:function(){var t=this,e=this.$root.find(".j_poster_signature");e.hide(),PosterContext.getContext().user.isLogin&&this.$root.find("#ueditor_replace").one("click",function(){var i=t.use("common/widget/PostSignature",{$container:e,gameSignature:PosterContext.getContext().user.gameSignature});i.init(),e.show()})},initAntiSpamming:function(){},initBubbleTips:function(){try{!localStorage.getItem("postFullscreenForPB")&&this.initFullScreen()}catch(t){}},initFullScreen:function(){var t={arrow_dir:"up",bubble_css:{top:30,right:-10,width:150,height:50,zIndex:6e4},arrow_pos:{right:10},wrap:$(".edui-btn-toolbar"),closeBtn:!0,content:"\u5168\u5C4F\u53D1\u8D34\u4F53\u9A8C\u4F1A\u66F4\u597D\u54E6~"};this.fullscreenBubble=new UiBubbleTipBase(t),this.fullscreenBubble.showBubble(),localStorage.setItem("postFullscreenForPB",1),this.bindFullScreenEvent()},isBeMember:function(){var t=window.PageData.user;return t.mParr_props&&t.mParr_props.level&&parseInt(t.mParr_props.level.props_id,10)>0&&1e3*t.mParr_props.level.end_time>Env.server_time?!0:!1},showPostSuccess:function(){var t="",e=window.PageData.user;e.mParr_props&&e.mParr_props.level&&this.isBeMember()&&(t="\u5C0A\u656C\u7684\u4F1A\u5458\uFF0C");var i=this.getPosterSuccessContent(t);$(i).appendTo(this.$editorContainer),this.showAddExp($(".poster_submit"))},bindSuperMemberExpUpTrack:function(){if(-1!=$(".j-placeholder-pay-member").html().indexOf("\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C")){var t=this;t.$placeholder.on("click","a",function(){if(!PageData.user.is_login)return t.requireInstance("common/widget/LoginDialog"),!1;var e=t.requireInstance("common/widget/payMember"),i={fr:"\u53D1\u5E16\u6846\u5F00\u901A\u4F1A\u5458\u70B9\u51FB\u91CF",scene_id:1007001003};e.showCashier(i),$.stats.track("\u53D1\u5E16\u6846\u5F00\u901A\u4F1A\u5458\u70B9\u51FB\u91CF","\u4F1A\u5458\u52A0\u901F2.0")})}},getPosterSuccessContent:function(t){var e=['<div class="tb_poster_info poster_success">','<div class="poster_success_content clearfix #{className}">','<div class="post_success_tip">#{headCrown}\u53D1\u8868\u6210\u529F\uFF01</div>','<div class="post_success_exp">','<span class="post_success_exp_name">\u7ECF\u9A8C</span>','<b class="post_success_exp_plus">+#{experience}</b>',"</div>","</div>","#{footTip}","</div>"].join(""),i=this.requireInstance("user/widget/userApi",[]),o=i.checkSuperMemberShipOf(PageData.user),s={className:t?"poster_success_content_mem":""},n={experience:6,footTip:"",headCrown:'<i class="middle_size_crown"></i>'},r={experience:1,footTip:'<div class="success-foot-tip"><i class="middle_size_crown"></i>\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C</div>',headCrown:""};if(o)var a=$.extend(s,n);else var a=$.extend(s,r);var l=$.tb.format(e,a);return l},showAddExp:function(){$(".post_success_exp").fadeIn(function(){})},showWarning:function(t){void 0==this.$warning&&(this.$warning=$('<div class="tb_poster_info poster_warning"></div>').appendTo(this.$editorContainer)),this.$warning.html(t)},getTitle:function(){return this.$title?this.$title.val():""},getContent:function(){return this.editor.getContent()},getContentUbb:function(){return this.editor.getContentUbb()},getGameUser:function(){var t=PosterContext.getContext().user.gameSignature;return t&&!$.isEmptyObject(t.signature_info)},getPostType:function(){var t=this.isFrs||this.isHotTopic?"thread":"reply";return this.editor.getExtendContent().hasLocalVideo&&(t="thread"==t?"vpostThread":"vpostReply"),t},getPostData:function(){var t=this.editor.getExtendContent(),e={content:this.getContentUbb()};if(this.isFrs||this.isHotTopic){var i=this.getTitle(),o=this.$title.data("prefix");-1==i.indexOf(o)&&(o=""),i=i.replace(/\u2006/g,""),i=i.replace(o,""),e.title=i,e.prefix=o}t.videoNumber>0&&(e.video_url=t.videoUrl,t.hasLocalVideo&&(e.file_id=t.fileId)),t.ptype&&(e.ptype=t.ptype),t.attachments&&(e.files=t.attachments);var s=this.$root.find(".j_sign_id"),n=this.$root.find(".j_use_signature");n.tbattr("checked")&&s.size()>0&&s.val()&&(e.sign_id=s.val()),e.game_user=this.getGameUser(),e.mouse_pwd=this.MousePwd.report().c,e.mouse_pwd_t=this.MousePwd.time,e.mouse_pwd_isclick=this.MousePwd.MOUSEPWD_CLICK,PageData&&PageData.thread&&PageData.thread.is_novel&&(e.is_novel=1);var r=this.require("common/widget/paypost_data").getInstance();if(r.get("isPaypost")){var a=this.feeEditor||UE.getEditor("ueditor_fee_replace");e.is_paypost=1,e.secret=a.getContentUbb(),e.score=$(a.container).find(".j_paypost_tdou_ipt").val();var l=a.getExtendContent();if(l.attachments){var c=JSON.parse(l.attachments);e.files=JSON.stringify(JSON.parse(e.files).concat(c)),e.secret_files=JSON.stringify(_.pluck(c,"fs_id"))}}return 1===this._options.isPaypost&&(e.is_paypost=1),this.isHotTopic&&PageData.selectedForum&&(e.fid=PageData.selectedForum.forum_id,e.kw=PageData.selectedForum.forum_name),e},togglePostState:function(t){var e=this.$root.find(".j_posting_status");e.toggleClass("poster_posting_status_loading",t),this.toggleSubmitButton(t)},toggleSubmitButton:function(t){this.$submit.toggleClass("ui_btn ui_btn_m",!t),this.$submit.toggleClass("ui_btn_disable ui_btn_m_disable",t)},validateContent:function(){var t=this.isFrs?3e4:1e4,e=this.editor.getContentByteLength(),i=this.editor.getExtendContent(),o=this.$root.find(".ueditor_container .j_error"),s="";if(this.isFrs||this.isHotTopic){var n=$.trim(this.getTitle()),r=this.$title.data("prefix");if(0===n.length)return this.$root.find(".title_container .j_error").text("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;if(0===n.replace(r,"").length)return this.$root.find(".title_container .j_error").text("\u53EA\u6709\u524D\u7F00\u662F\u4E0D\u884C\u7684\u54DF~\u8BF7\u5728\u524D\u7F00\u540E\u586B\u5199\u6B63\u5F0F\u6807\u9898\uFF01").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;if(""==$.trim(n.replace(/#([^#]+)#/g,"")))return this.$root.find(".title_container .j_error").text("\u53EA\u6709#\u8BDD\u9898#\u662F\u4E0D\u884C\u7684\u54DF~\u8BF7\u5728\u8BDD\u9898\u540E\u586B\u5199\u6B63\u5F0F\u6807\u9898\uFF01").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;var a=this.require("common/widget/paypost_data").getInstance();if(a.get("isPaypost")){this.feeEditor=UE.getEditor("ueditor_fee_replace");var l=$(this.feeEditor.container),c=l.find(".j_paypost_tdou_ipt").val();if(100>c)return o.text("\u9690\u85CF\u5185\u5BB9\u552E\u4EF7\u987B\u81F3\u5C11100T\u8C46").show(),!1;if(c>1e7)return o.text("\u9690\u85CF\u5185\u5BB9\u552E\u4EF7\u4E0D\u5F97\u9AD8\u4E8E10000000T\u8C46").show(),!1;var d=this.feeEditor.getExtendContent();if(0==$.trim(this.feeEditor.getContent()).length&&"[]"==d.attachments)return o.text("\u4ED8\u8D39\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show(),!1;if(this._options.needPaypostAgree&&!a.get("hasAgree")){var h=this.requireInstance("encourage/widget/paypost_agree_dialog");return h.registNextFn(this.post,this),h.show(),!1}}}return 0!==e||this.isFrs?e>t?(s="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8D85\u8FC7"+t/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u518D\u63D0\u4EA4",o.text(s).show(),!1):i.videoNumber>1?(s="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u89C6\u9891\u4E2A\u6570\u4E0D\u80FD\u8D85\u8FC71\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",o.text(s).show(),!1):i.musicNumber>10?(s="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u97F3\u4E50\u4E2A\u6570\u4E0D\u80FD\u8D85\u8FC710\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",o.text(s).show(),!1):i.ptype&&!i.ptypePower?(s="\u6CA1\u6709\u9053\u5177\u4F7F\u7528\u6743\u9650\u5C06\u65E0\u6CD5\u53D1\u8868\u6210\u529F",o.text(s).show(),!1):(this.$root.find(".j_error").hide(),!0):(this.isHotTopic?o.text("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show():o.text("\u56DE\u590D\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show(),!1)},post:function(t){var e=this.getPostData(),i=this.validateContent();"object"==typeof postObj&&"object"==typeof t&&$.extend(e,t),!this.postService.isPosting()&&i&&(PosterContext.context.user.isLogin?($.cookie("GET_TOPIC","-",{expires:-1,path:"/"}),this.postService.post(this.getPostType(),e,PosterContext.getContext()),this.togglePostState(!0),_.Module.use("frs/widget/snowflow",[e.content,PosterContext.getContext().product,"rich_poster"])):_.Module.use("common/widget/LoginDialog",["","editor",function(){$.stats.track("\u53D1\u8868\u6309\u94AE_\u767B\u5F55\u6210\u529F","\u975E\u767B\u5F55\u7528\u6237\u53D1\u5E16")}]))},refresh:function(){var t=$.tb.location.getHref();t=t.replace(/#\w*$/,""),$.tb.location.setHref(t)},focus:function(){this.isFrs||this.isHotTopic?this.$title.focus():$.browser.msie&&$.browser.version<=7||this.editor.focus()},enableFloatingPoster:function(){var t=this;if(!this.$root.hasClass("tb_floating_poster")&&(this.editor.enableHeightLimit(this.$window.height()-450),this.trigger("poster_float"),this.$root.hide().addClass("tb_floating_poster"),this.position&&this.$root.css(this.position),this.$root.fadeIn(function(){t.$root.draggable({handle:t.$root.find(".poster_head"),start:function(){t.$root.css({right:"auto",bottom:"auto"})}})}),"1"!=$.tb.Storage.get("close_float_draggable_bubble"))){var e={content:"\u6D6E\u52A8\u53D1\u8D34\u6846\u53EF\u4EE5<span class='ui_text_emphasize'>\u62D6\u62FD</span>\u4E86\uFF0C\u8D76\u5FEB\u62D6\u52A8\u6807\u9898\u8BD5\u8BD5\uFF01\u66F4\u591A\u8BE6\u60C5<a href='//tieba.baidu.com/mo/q/topic_page/219_1' target='_blank'>\u70B9\u51FB\u8FD9\u91CC</a>",arrow_dir:"down",bubble_css:{top:0,left:10,width:179},wrap:this.$root.find(".j_bubble_container"),closeBtn:!0},i=new UiBubbleTipBase(e);i.bind("onclose",function(){$.tb.Storage.set("close_float_draggable_bubble","1",(new Date).getTime()+2592e6),i.closeBubble()}),i.showBubble()}},disableFloatingPoster:function(){var t=this;t.$root.fadeOut(function(){t.position={left:t.$root.css("left"),top:t.$root.css("top")},t.$root.draggable("destroy").css({left:"auto",top:"auto"}),t.$root.removeClass("tb_floating_poster").show(),PosterContext.getAuthorities().long_editor?t.editor.disableHeightLimit():t.editor.enableHeightLimit()})},_viewPortOn:function(t){var e=this.$window.scrollTop(),i=e+this.$window.height(),o=t.offset().top,s=o+t.height();return{isOnScreen:i>o&&s>e,topToBottom:i-o,bottomToTop:s-e,topToTop:o-e,bottomToBottom:i-s}},setBlessCookie:function(){var t=PosterContext.getContext().forum.id,e=$.cookie("bless_post_"+t);null==e&&$.cookie("bless_post_"+t,1,1)}}});var baidusearch=function(){function e(e){function t(){var e="getSelection"in window,t=document.getElementById("selectsearch-icon");t&&t.parentNode.removeChild(t),setTimeout(function(){selection=e?window.getSelection():document.selection.createRange();var t=(e?selection+"":selection.text).replace(/\n+/g,"");t&&t.length&&(t.length>76&&(t=t.substring(0,76)),n(e,selection,t))},25)}function n(t,n,o){var c=document.body.scrollTop+document.documentElement.scrollTop,i=document.body.scrollLeft+document.documentElement.scrollLeft;if(t){var a=n.getRangeAt(0).getBoundingClientRect();if(0==a.top&&0==a.right)return;var d=a.top>35?a.top-35+c:c,r=a.right+70>document.documentElement.clientWidth?document.documentElement.clientWidth-65+i:a.right+5+i}else var s=n.boundingLeft+n.boundingWidth,d=n.boundingTop>35?n.boundingTop-35+c:c,r=s+70>document.documentElement.clientWidth?document.documentElement.clientWidth-65+i:s+i;var o=encodeURI(o),l=document.createElement("img");l.src="//tb2.bdstatic.com/tb/static-pb/widget/baidusearch/select-search_9b9b8e9.png",l.alt="\u641C\u7D22",l.style.cssText="width:65px; height:31px; border:0px none;";var u=document.createElement("a");u.id="selectsearch-icon",u.style.cssText="cursor:pointer; position:absolute;",u.href="https://www.baidu.com/s?ie=utf-8&wd="+o+"&tn="+e+"&hl_tag=flayer",u.target="_blank",u.onclick=function(){try{u.parentNode.removeChild(u)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/baidusearch/baidusearch.js",method:"",ln:52}),e}},u.style.left=r+"px",u.style.top=d+"px",u.appendChild(l),document.body.appendChild(u),l.onmouseup=function(e){e=e||window.event,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}}function o(e,t,n){window.attachEvent?e.attachEvent("on"+t,n):window.addEventListener&&e.addEventListener(t,n,!1)}o(document,"mouseup",t)}return{init:e}}();_.Module.define({path:"pb/widget/Baidusearch",sub:{initial:function(){try{this._baiduSearch()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/baidusearch/baidusearch.js",method:"",ln:87}),e}},_baiduSearch:function(){baidusearch.init("SE_hldp00980_x3znwgz5"),$(document.body).on("click",function(e){try{var t=e.target,n=$(t).parent();"selectsearch-icon"===n.tbattr("id")&&$.stats.track("Pb_huaci_search","ps_callback_statics")}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"pb:widget/baidusearch/baidusearch.js",method:"",ln:97}),o}})}}});_.Module.define({requires:["pb/widget/Baidusearch"],path:"pb/widget/Stat",sub:{initial:function(){try{$.stats.scanPage(),this._wpoTongji(),this._baiduSearch()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/stat/stat.js",method:"",ln:10}),t}},_baiduSearch:function(){this.requireInstance("pb/widget/Baidusearch")},_wpoTongji:function(){window.alogObjectConfig={product:"14",page:"14_1",monkey_page:"tieba-pb",speed_page:"1",speed:{sample:PageData.is_ipad?1:.01},monkey:{sample:"0.05",hid:"762"},exception:{sample:"0.05"},csp:{sample:"0.004","script-src":[{match:"*bae.baidu.com",target:"Accept,Warn"},{match:"*.baidu.com,*.bdstatic.com,*.baidustatic.com,*.bdimg.com,www.aipai.com,jump.luna.58.com,www.pokersc.cn",target:"Accept"},{match:/^(127|172|192|10)(\.\d+){3}$/,target:"Accept"},{match:"*",target:"Accept,Warn"}]}}}}});var T,baidu=T=baidu||{version:"1.5.0"};baidu.guid="$BAIDU$",window[baidu.guid]=window[baidu.guid]||{},baidu.fn=baidu.fn||{},baidu.fn.blank=function(){},baidu.string=baidu.string||{},baidu.string.format=function(t,e){t=String(t);var i=Array.prototype.slice.call(arguments,1),n=Object.prototype.toString;return i.length?(i=1==i.length?null!==e&&/\[object Array\]|\[object Object\]/.test(n.call(e))?e:i:i,t.replace(/#\{(.+?)\}/g,function(t,e){var s=i[e];return"[object Function]"==n.call(s)&&(s=s(e)),"undefined"==typeof s?"":s})):t},baidu.format=baidu.string.format,baidu.object=baidu.object||{},baidu.object.each=function(t,e){var i,n,s;if("function"==typeof e)for(n in t)if(t.hasOwnProperty(n)&&(s=t[n],i=e.call(t,s,n),i===!1))break;return t},baidu.extend=baidu.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},baidu.number=baidu.number||{},baidu.number.pad=function(t,e){var i="",n=0>t,s=String(Math.abs(t));return s.length<e&&(i=new Array(e-s.length+1).join("0")),(n?"-":"")+i+s},baidu.platform=baidu.platform||{},baidu.platform.isAndroid=/android/i.test(navigator.userAgent),baidu.platform.isIpad=/ipad/i.test(navigator.userAgent),baidu.platform.isIphone=/iphone/i.test(navigator.userAgent),baidu.swf=baidu.swf||{},baidu.browser=baidu.browser||{},baidu.browser.ie=baidu.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,baidu.array=baidu.array||{},baidu.array.remove=function(t,e){for(var i=t.length;i--;)i in t&&t[i]===e&&t.splice(i,1);return t},baidu.lang=baidu.lang||{},baidu.lang.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)},baidu.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},baidu.lang.toArray=function(t){if(null===t||void 0===t)return[];if(baidu.lang.isArray(t))return t;if("number"!=typeof t.length||"string"==typeof t||baidu.lang.isFunction(t))return[t];if(t.item){for(var e=t.length,i=new Array(e);e--;)i[e]=t[e];return i}return[].slice.call(t)},baidu.swf.getMovie=function(t){var e,i=document[t];return 9==baidu.browser.ie?i&&i.length?1==(e=baidu.array.remove(baidu.lang.toArray(i),function(t){return"embed"!=t.tagName.toLowerCase()})).length?e[0]:e:i:i||window[t]},baidu.swf.version=function(){var t=navigator;if(t.plugins&&t.mimeTypes.length){var e=t.plugins["Shockwave Flash"];if(e&&e.description)return e.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(window.ActiveXObject&&!window.opera)for(var i=12;i>=2;i--)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i);if(n){var s=n.GetVariable("$version");return s.replace(/WIN/g,"").replace(/,/g,".")}}catch(a){}}(),baidu.string.encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},baidu.encodeHTML=baidu.string.encodeHTML,baidu.swf.createHTML=function(t){t=t||{};var e,i,n,s,a,r,o=baidu.swf.version,u=t.ver||"6.0.0",l={},h=baidu.string.encodeHTML;for(s in t)l[s]=t[s];if(t=l,!o)return"";for(o=o.split("."),u=u.split("."),n=0;3>n&&(e=parseInt(o[n],10),i=parseInt(u[n],10),!(e>i));n++)if(i>e)return"";var d=t.vars,c=["classid","codebase","id","width","height","align"];if(t.align=t.align||"middle",t.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",t.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0",t.movie=t.url||"",delete t.vars,delete t.url,"string"==typeof d)t.flashvars=d;else{var g=[];for(s in d)r=d[s],g.push(s+"="+encodeURIComponent(r));t.flashvars=g.join("&")}var p=["<object "];for(n=0,a=c.length;a>n;n++)r=c[n],p.push(" ",r,'="',h(t[r]),'"');p.push(">");var f={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(s in t)r=t[s],s=s.toLowerCase(),f[s]&&(r||r===!1||0===r)&&p.push('<param name="'+s+'" value="'+h(r)+'" />');t.src=t.movie,t.name=t.id,delete t.id,delete t.movie,delete t.classid,delete t.codebase,t.type="application/x-shockwave-flash",t.pluginspage="http://www.macromedia.com/go/getflashplayer",p.push("<embed");var m;for(s in t)if(r=t[s],r||r===!1||0===r){if(new RegExp("^salign$","i").test(s)){m=r;continue}p.push(" ",s,'="',h(r),'"')}return m&&p.push(' salign="',h(m),'"'),p.push("></embed></object>"),p.join("")},baidu.swf.create=function(t,e){t=t||{};var i=baidu.swf.createHTML(t)||t.errorMessage||"";e&&"string"==typeof e&&(e=document.getElementById(e)),e?e.innerHTML=i:document.write(i)},function(){var t=window[baidu.guid];baidu.lang.guid=function(){return"TANGRAM__"+(t._counter++).toString(36)},t._counter=t._counter||1}(),window[baidu.guid]._instances=window[baidu.guid]._instances||{},baidu.lang.Class=function(t){this.guid=t||baidu.lang.guid(),window[baidu.guid]._instances[this.guid]=this},window[baidu.guid]._instances=window[baidu.guid]._instances||{},baidu.lang.Class.prototype.dispose=function(){delete window[baidu.guid]._instances[this.guid];for(var t in this)baidu.lang.isFunction(this[t])||delete this[t];this.disposed=!0},baidu.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},baidu.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},baidu.isString=baidu.lang.isString,baidu.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},baidu.lang.Class.prototype.addEventListener=function(t,e,i){if(baidu.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,s=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;e.hashCode=i,n=i}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof s[t]&&(s[t]={}),n=n||baidu.lang.guid(),e.hashCode=n,s[t][n]=e}},baidu.lang.Class.prototype.removeEventListener=function(t,e){if("undefined"==typeof e||(!baidu.lang.isFunction(e)||(e=e.hashCode))&&baidu.lang.isString(e)){!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this.__listeners;if(i[t])if("undefined"!=typeof e)i[t][e]&&delete i[t][e];else for(var n in i[t])delete i[t][n]}},baidu.lang.Class.prototype.dispatchEvent=function(t,e){baidu.lang.isString(t)&&(t=new baidu.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var i in e)t[i]=e[i];var i,n=this.__listeners,s=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=s.indexOf("on")&&(s="on"+s),baidu.lang.isFunction(this[s])&&this[s].apply(this,arguments),"object"==typeof n[s])for(i in n[s])n[s][i].apply(this,arguments);return t.returnValue},baidu.lang.createClass=function(t,e){e=e||{};var i=e.superClass||baidu.lang.Class,n=function(){i!=baidu.lang.Class?i.apply(this,arguments):i.call(this),t.apply(this,arguments)};n.options=e.options||{};var s=function(){},a=t.prototype;s.prototype=i.prototype;var r=n.prototype=new s;for(var o in a)r[o]=a[o];return"string"==typeof e.className&&(r._className=e.className),r.constructor=a.constructor,n.extend=function(t){for(var e in t)n.prototype[e]=t[e];return n},n},baidu.lang.inherits=function(t,e,i){var n,s,a=t.prototype,r=new Function;r.prototype=e.prototype,s=t.prototype=new r;for(n in a)s[n]=a[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(s._className=i)},baidu.inherits=baidu.lang.inherits,baidu.lang.isBoolean=function(t){return"boolean"==typeof t},baidu.lang.isElement=function(t){return!(!t||!t.nodeName||1!=t.nodeType)},baidu.lang.isNumber=function(t){return"[object Number]"==Object.prototype.toString.call(t)&&isFinite(t)},baidu.lang.isObject=function(t){return"function"==typeof t||!(!t||"object"!=typeof t)},baidu.isObject=baidu.lang.isObject,baidu.fn.bind=function(t,e){var i=arguments.length>2?[].slice.call(arguments,2):null;return function(){var n=baidu.lang.isString(t)?e[t]:t,s=i?i.concat([].slice.call(arguments,0)):arguments;return n.apply(e||n,s)}},baidu.each=baidu.array.forEach=baidu.array.each=function(t,e,i){var n,s,a,r=t.length;if("function"==typeof e)for(a=0;r>a&&(s=t[a],n=e.call(i||t,s,a),n!==!1);a++);return t},baidu.array.some=function(t,e,i){for(var n=0,s=t.length;s>n;n++)if(n in t&&e.call(i||t,t[n],n))return!0;return!1},baidu.browser.chrome=/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,baidu.browser.firefox=/firefox\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,baidu.browser.isWebkit=/webkit/i.test(navigator.userAgent);try{/(\d+\.\d+)/.test(external.max_version)&&(baidu.browser.maxthon=+RegExp.$1)}catch(e){}!function(){var t=navigator.userAgent;baidu.browser.safari=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(t)&&!/chrome/i.test(t)?+(RegExp.$1||RegExp.$2):void 0}(),baidu.dom=baidu.dom||{},baidu.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},baidu.g=baidu.G=baidu.dom.g,baidu.dom._styleFixer=baidu.dom._styleFixer||{},baidu.dom._styleFilter=baidu.dom._styleFilter||[],baidu.dom._styleFilter.filter=function(t,e,i){for(var n,s=0,a=baidu.dom._styleFilter;n=a[s];s++)(n=n[i])&&(e=n(t,e));return e},baidu.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},baidu.dom.setStyle=function(t,e,i){var n,s=baidu.dom;return t=s.g(t),e=baidu.string.toCamelCase(e),(n=s._styleFilter)&&(i=n.filter(e,i,"set")),n=s._styleFixer[e],n&&n.set?n.set(t,i):t.style[n||e]=i,t},baidu.setStyle=baidu.dom.setStyle,baidu.dom.setStyles=function(t,e){t=baidu.dom.g(t);for(var i in e)baidu.dom.setStyle(t,i,e[i]);return t},baidu.setStyles=baidu.dom.setStyles,baidu.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return baidu.browser.ie<8?(t["for"]="htmlFor",t["class"]="className"):(t.htmlFor="for",t.className="class"),t}(),baidu.dom.setAttr=function(t,e,i){return t=baidu.dom.g(t),"style"==e?t.style.cssText=i:(e=baidu.dom._NAME_ATTRS[e]||e,t.setAttribute(e,i)),t},baidu.setAttr=baidu.dom.setAttr,baidu.dom.setAttrs=function(t,e){t=baidu.dom.g(t);for(var i in e)baidu.dom.setAttr(t,i,e[i]);return t},baidu.setAttrs=baidu.dom.setAttrs,baidu.dom.create=function(t,e){var i=document.createElement(t),n=e||{};return baidu.dom.setAttrs(i,n)},baidu.cookie=baidu.cookie||{},baidu.cookie._isValidKey=function(t){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(t)},baidu.cookie.getRaw=function(t){if(baidu.cookie._isValidKey(t)){var e=new RegExp("(^| )"+t+"=([^;]*)(;|$)"),i=e.exec(document.cookie);if(i)return i[2]||null}return null},baidu.cookie.get=function(t){var e=baidu.cookie.getRaw(t);return"string"==typeof e?e=decodeURIComponent(e):null},baidu.cookie.setRaw=function(t,e,i){if(baidu.cookie._isValidKey(t)){i=i||{};var n=i.expires;"number"==typeof i.expires&&(n=new Date,n.setTime(n.getTime()+i.expires)),document.cookie=t+"="+e+(i.path?"; path="+i.path:"")+(n?"; expires="+n.toGMTString():"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":"")}},baidu.cookie.remove=function(t,e){e=e||{},e.expires=new Date(0),baidu.cookie.setRaw(t,"",e)},baidu.cookie.set=function(t,e,i){baidu.cookie.setRaw(t,encodeURIComponent(e),i)},baidu.sio=baidu.sio||{},baidu.sio._createScriptTag=function(t,e,i){t.setAttribute("type","text/javascript"),i&&t.setAttribute("charset",i),t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t)},baidu.sio._removeScriptTag=function(t){if(t.clearAttributes)t.clearAttributes();else for(var e in t)t.hasOwnProperty(e)&&delete t[e];t&&t.parentNode&&t.parentNode.removeChild(t),t=null},baidu.sio.callByServer=function(t,e,i){function n(t){return function(){try{t?l.onfailure&&l.onfailure():(e.apply(window,arguments),clearTimeout(a)),window[s]=null,delete window[s]}catch(i){}finally{baidu.sio._removeScriptTag(o)}}}var s,a,r,o=document.createElement("SCRIPT"),u="bd__cbs__",l=i||{},h=l.charset,d=l.queryField||"callback",c=l.timeOut||0,g=new RegExp("(\\?|&)"+d+"=([^&]*)");baidu.lang.isFunction(e)?(s=u+Math.floor(2147483648*Math.random()).toString(36),window[s]=n(0)):baidu.lang.isString(e)?s=e:(r=g.exec(t))&&(s=r[2]),c&&(a=setTimeout(n(1),c)),t=t.replace(g,"$1"+d+"="+s),t.search(g)<0&&(t+=(t.indexOf("?")<0?"?":"&")+d+"="+s),baidu.sio._createScriptTag(o,t,h)};var mbox=mbox||{};T.extend(mbox,{namespace:function(){var t,e,i,n=arguments,s=null;for(t=0,len=n.length;len>t;t++)for(i=(""+n[t]).split("."),s=mbox,e="mbox"==i[0]?1:0;e<i.length;e+=1)s[i[e]]=s[i[e]]||{},s=s[i[e]];return s},Fuze:function(){var t,e,i;return t=[],e=function(e){i?e():t.push(e)},e.fire=function(){for(;t.length;)t.shift()();i=!0},e.extinguish=function(){i=!1},e.wettish=function(){this.fire(),this.extinguish()},e.clear=function(){for(;t.length;)t.shift();this.extinguish()},e},convertTime:function(t){var e,i;return t=Math.round(t/1e3),e=Math.floor(t/60),i=t%60,T.number.pad(e,2)+":"+T.number.pad(i,2)},Timer:function(t){var e=function(t,e){this._timer=function(){},this._listener=function(){},this._timerComplete=function(){},this._timerID=null,this._delay=this._remain=t,this._repeatCount=e||0,this._currentCount=0,this._isRunning=!1,this._startTime=this._endTime=0,this.EVENTS={TIMER:"timer",COMPLETE:"timerComplete"}};return e.prototype={_createTimer:function(e,i){var n=this;return 1==i?function(){return t.setTimeout(function(){n.reset(),n._listener(n._delay,i),n._timerComplete()},e)}:function(){return t.setInterval(function(){0!=i&&n._currentCount>=i?(n.reset(),n._timerComplete()):(n._currentCount++,n._listener(e,n._currentCount))},e)}},addEventListener:function(t,e){"timer"==t?(this._listener=e,this._timer=this._createTimer(this._delay,this._repeatCount)):"timerComplete"==t&&(this._timerComplete=e)},reset:function(){this.stop(),1==this._repeatCount&&(this._timer=this._createTimer(this._delay,this._repeatCount)),this._currentCount=0,this._remain=this._delay,this._startTime=this._endTime=0},start:function(){this._timerID||(this._timerID=this._timer(),1==this._repeatCount&&(this._startTime=(new Date).getTime()),this._isRunning=!0)},stop:function(){this._timerID&&(1==this._repeatCount?t.clearTimeout(this._timerID):t.clearInterval(this._timerID),this._timerID=null,this._isRunning=!1)},pause:function(){1==this._repeatCount?this._timerID&&(this.stop(),this._endTime=(new Date).getTime(),this._remain=this._remain-(this._endTime-this._startTime),this._remain>0?this._timer=this._createTimer(this._remain,1):this.reset()):this.stop()},getCurrentCount:function(){return this._currentCount},isRunning:function(){return this._isRunning}},e}(window),StopWatch:function(){var t=0,e=function(){this.startTime=0,this.isRunning=!1,this.isReset=!0,this.passedTime=0,t++};return e.prototype={reset:function(){this.startTime=0,this.pauseTime=0,this.passedTime=0,this.isRunning=!1,this.isReset=!0},start:function(){this.isReset?(this.reset(),this.startTime=(new Date).getTime()):this.isRunning||(this.startTime=(new Date).getTime()),this.isRunning=!0,this.isReset=!1},pause:function(){!this.isReset&&this.isRunning&&(this.pauseTime=(new Date).getTime(),this.passedTime+=this.pauseTime-this.startTime,this.isRunning=!1)},isRunning:function(){return this.isRunning},isReset:function(){return this.isReset},getTime:function(){return this.isReset?0:this.isRunning?(new Date).getTime()-this.startTime+this.passedTime:this.passedTime},getCounts:function(){return t}},e}(window)}),mbox.namespace("mbox.lang"),T.extend(mbox.lang,{createClass:function(t,e){var i=T.lang.createClass(t,e);return i.prototype.removeEventListener=function(t,e){if("undefined"==typeof e||(!baidu.lang.isFunction(e)||(e=e.hashCode))&&baidu.lang.isString(e)){!this.__listeners&&(this.__listeners={});var i=t.split(".");t.length>1&&(t=i[0],e=i[1]),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;if(n[t])if("undefined"!=typeof e)n[t][e]&&delete n[t][e];else for(var s in n[t])delete n[t][s]}},i.extend=function(t){for(var e in t)i.prototype[e]=function(t,e){return T.lang.isFunction(t)?function(){this.dispatchEvent(e,{name:e,arguments:arguments});var i=t.apply(this,arguments);return i}:t}(t[e],e);return i},i}});var mbox=mbox||{};!function(){var t="mbox";mbox.CONF={instanceCallName:t,autoPlay:!1,autoNext:!1,engineArg:{audio:{constructorName:"PlayEngine_Audio"},fmp:{constructorName:"PlayEngine_FMP_MP3",args:{swfPath:"https://gss2.baidu.com/5LgHhXSm2Q5IlBGlnYG/player/static/flash/fmp.swf",instanceName:t+".player"}}},logOpt:{ref:"pc_widget_tieba"},songLinkHost:{link:"https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.song.play&format=jsonp&bit=128&songid=",lrc:"https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.song.lry&fromat=jsonp&songid=",sug:"https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.search.common&page_size=1&page_no=1&query="}}}(void 0);var PlayEngine_Interface=mbox.lang.createClass(function(){var t=0,e={mute:!1,volume:50},i=function(t){this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"},this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"},t=t||{},this.mute="undefined"==typeof t.mute?e.mute:!!t.mute,this.volume="undefined"==typeof t.volume?e.volume:t.volume,this.ready=!1,this.url="",this.state=this.STATES.INIT,this.engineType="",this.stateStack=[this.STATES.INIT],this.supportMimeType=[]};return i.prototype={newId:function(){return"_m3_"+t++},init:function(){},reset:function(){},setUrl:function(){},getUrl:function(){return this.url},play:function(){},pause:function(){},stop:function(){},setMute:function(){},getMute:function(){return this.mute},setVolume:function(){},getVolume:function(){return this.volume},getState:function(){return""},setCurrentPosition:function(){},getCurrentPosition:function(){return 0},getLoadedPercent:function(){return 0},getLoadedBytes:function(){return 0},getTotalBytes:function(){return 0},getTotalTime:function(){return 0},getVersion:function(){return""},getEngineType:function(){return this.engineType},canPlayType:function(t){var e=this.getSupportMimeTypeList();return T.array.some(e,function(e){return t==e})},getSupportMimeTypeList:function(){return this.supportMimeType},setEventListener:function(t,e,i){var n=T.fn.bind(function(){return e.apply(this,arguments)},this);this.addEventListener(t,n,i)}},i}(window),{superClass:T.lang.Class,className:"PlayEngine_Interface"}),PlayEngine_Audio=mbox.lang.createClass(function(t){t=t||{},this.engineType="audio",this.contentType={mp3:["audio/mpeg","audio/mp3"],mp4:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],m4a:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],aac:["audio/aac","audio/aacp"],"3gp":["audio/3gpp","audio/3gpp2"],ogg:["audio/ogg","video/ogg","application/ogg","audio/vorbis"],oga:["audio/ogg","application/ogg","audio/vorbis"],wma:["audio/x-ms-wma"]},this.supportAudio="undefined"!=typeof Audio,this.supportMimeType=[],this.supportAudio&&(this.audio=new Audio,"function"==typeof this.audio.canPlayType&&T.object.each(this.contentType,T.fn.bind(function(t,e){for(var i=0;i<t.length;i++){var n=this.audio.canPlayType(t[i]);if("probably"==n||"maybe"==n){this.supportMimeType.push(e);break}}},this)),this.supportMimeType.length||(this.supportAudio=!1)),this.supportVolume=T.fn.bind(function(){return this.supportAudio?(this.audio.volume=.5,this.audio.volume<1):!1},this)()},{superClass:PlayEngine_Interface,className:"PlayEngine_Audio"}).extend({test:function(t){return t=!!t,!this.supportAudio&&t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),this.supportAudio},init:function(){this.lastState=this.STATES.INIT,this.muted=this.audio.muted=!1,this.volume=50,this.audio.volume=.5,this.url="",this._definedEvents(),this.state=this.STATES.READY,this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.audio})},reset:function(){this.supportAudio&&(this.url="",this.audio.pause(),this.state="ready",this.lastState="ready")},setUrl:function(t){this.supportAudio&&(this.url=t,this.audio.src=t,this.audio.load(),this._firePlayStateChange(this.STATES.PREBUFFER))},play:function(){if(this.supportAudio&&"ready"!=this.state)if(T.platform.isAndroid&&T.browser.isWebkit&&this.audio.readyState<3){var t=T.fn.bind(function(){this.audio.play(),this.audio.removeEventListener("canplay",t,!1)},this);this.audio.addEventListener("canplay",t,!1)}else this.audio.play()},pause:function(){this.supportAudio&&this.state!=this.STATES.STOP&&this.state!=this.STATES.READY&&this.state!=this.STATES.END&&(this.audio.pause(),this._firePlayStateChange(this.STATES.PAUSE))},stop:function(){this.supportAudio&&this.state!=this.STATES.READY&&(0!=this.audio.currentTime&&(this.audio.currentTime=0),this.audio.pause(),this._firePlayStateChange(this.STATES.STOP))},setMute:function(t){this.supportAudio&&(this.audio.muted=this.mute=t)},setVolume:function(t){this.supportAudio&&(t=T.lang.isNumber(t)?t:50,t=Math.max(Math.min(t,100),0),this.volume=t,this.audio.volume=t/100)},setCurrentPosition:function(t){if(this.supportAudio)if(T.platform.isAndroid&&this.audio.readyState<3){var e=T.fn.bind(function(){this.audio.currentTime=t/1e3,this.audio.play(),this.audio.removeEventListener("canplay",e,!1)},this);this.audio.addEventListener("canplay",e,!1)}else this.audio.currentTime=t/1e3,this.audio.play()},getCurrentPosition:function(){return this.supportAudio?Math.round(1e3*this.audio.currentTime):0},getLoadedPercent:function(){try{var t=this.audio.buffered.end(0),e=this.audio.duration;return e=isNaN(e)?0:e,Math.round(t/e*100)/100}catch(i){return 0}},getTotalTime:function(){if(!this.supportAudio)return 0;var t=this.audio.duration;return t=isNaN(t)?0:t,Math.round(1e3*t)},getState:function(){return this.state},_firePlayStateChange:function(t){this.state!=t&&(this.lastState=this.state,this.state=t,this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:t,oldState:this.lastState,engineType:this.engineType}))},_definedEvents:function(){this.audio.addEventListener("error",T.fn.bind(function(){this._firePlayStateChange(this.STATES.ERROR),this.dispatchEvent(this.EVENTS.ERROR,{engineType:this.engineType})},this),!1),this.audio.addEventListener("ended",T.fn.bind(function(){this._firePlayStateChange(this.STATES.END)},this),!1),this.audio.addEventListener("playing",T.fn.bind(function(){this._firePlayStateChange(this.STATES.PLAY)},this),!1),this.audio.addEventListener("pause",T.fn.bind(function(){this.getState()==this.STATES.PLAY&&this._firePlayStateChange(this.getCurrentPosition()?this.STATES.PAUSE:this.STATES.STOP)},this),!1),this.audio.addEventListener("waiting",T.fn.bind(function(){this._firePlayStateChange(this.getCurrentPosition()?this.STATES.BUFFERING:this.STATES.PREBUFFER)},this),!1)}}),PlayEngine_FMP_MP3=mbox.lang.createClass(function(t){t=t||{},this.supportMimeType=["mp3"],this.engineType="fmp_mp3",this.swfPath="fmp_mp3.swf",this.flashVersionRequire=t.flashVersionRequire||"9.0.0",this.versionErrorMessage=t.versionErrorMessage||"",this.stateCode={"-2":this.STATES.INIT,"-1":this.STATES.READY,0:this.STATES.STOP,1:this.STATES.PLAY,2:this.STATES.PAUSE,3:this.STATES.END,4:this.STATES.BUFFERING,5:this.STATES.PREBUFFER,6:this.STATES.ERROR},this.flashLoaded=!1,this.flashReady=new mbox.Fuze},{superClass:PlayEngine_Interface,className:"PlayEngine_FMP_MP3"}).extend({test:function(t){return this._checkPlayer(t)},init:function(t){t=t||{};var e=t.el;this.instanceName=t.instanceName,this.swfPath=t.swfPath||this.swfPath;var i,n=this.newId();T.lang.isString(e)&&(e=T.g(e)),e||(e=T.dom.create("div"),document.body.appendChild(e)),i=T.dom.create("div"),e.appendChild(i),this.swfPath+="?"+n+"_"+Math.random(),T.swf.create({id:this.flashObjectId=n,width:"1px",height:"1px",ver:this.flashVersionRequire,errorMessage:this.versionErrorMessage,allowscriptaccess:"always",url:this.swfPath,bgcolor:"#ffffff",wmode:"window",scale:"noscale",vars:{_instanceName:this.instanceName+"",_buffertime:2e3}},i),this.flashObject=T.swf.getMovie(this.flashObjectId)},reset:function(){this.stop(),this.state!=this.STATES.INIT&&(this.url="",this.state=this.STATES.READY,this.stateStack=[this.STATES.READY])},setUrl:function(t){this.flashReady(T.fn.bind(function(){this.url=t,this.flashObject.closeStream(),this.flashObject.f_load(t)},this))},play:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.PLAY&&this.flashObject.f_play()},this))},pause:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.PAUSE&&this.state!=this.STATES.STOP&&this.state!=this.STATES.END&&this.flashObject.f_pause()},this))},stop:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.STOP&&this.flashObject.f_stop()},this))},setMute:function(t){this.flashReady(T.fn.bind(function(){this.mute=t,this.flashObject.setData("mute",t)},this))},setVolume:function(t){this.flashReady(T.fn.bind(function(){this.volume=t,this.flashObject.setData("volume",t)},this))},setCurrentPosition:function(t){this.flashReady(T.fn.bind(function(){this.flashObject.f_play(t)},this))},getCurrentPosition:function(){return this.flashLoaded?this.flashObject.getData("currentPosition"):0},getLoadedPercent:function(){return this.flashLoaded?this.flashObject.getData("loadedPct"):0},getTotalTime:function(){return this.flashLoaded?this.flashObject.getData("length"):0},getState:function(t){return T.lang.isNumber(t)?this.stateCode[t]:this.state},getVersion:function(){return T.swf.version},_firePlayStateChange:function(t){if(this.state!=t){this.state=t,this.stateStack.push(t);var e=this.stateStack.shift();this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:t,oldState:e,engineType:this.engineType})}},_onLoad:function(){this.state=this.STATES.READY,this.stateStack=[this.state],this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.flashObject}),setTimeout(T.fn.bind(function(){this.flashReady.fire(),this.flashLoaded=!0},this),0)},_onPlayStateChange:function(t){setTimeout(T.fn.bind(function(){this._firePlayStateChange(this.getState(t))},this),0)},_checkPlayer:function(t){t=!!t;var e=T.swf.version,i=this.flashVersionRequire;if(e){var n=e.split("."),s=i.split(".");return n[0]-s[0]>=0&&n[1]-s[1]>=0?!0:(t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),!1)}return t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),!1}}),PlayEngine=mbox.lang.createClass(function(t){t=t||{},this.subEnginesConf=[],this.subEnginesInitArgs={},this.curEngine=null,this.curEngineType="",this.unInitEngineList=[],this.engineList=[],this.engineTypeList=[],this.ready=!1,this.defaultExt=".mp3",this.coreContainer=null,this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"},this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"},this.progressTimer=new mbox.Timer(200,0),this.positionTimer=new mbox.Timer(100,0),this._initEngines(t)},{className:"PlayEngine"}).extend({_error:function(t){throw new Error(t)},_initEngines:function(config){this.coreContainer=config.el||null,this.subEnginesConf=config.subEngines||[],T.array.each(this.subEnginesConf,T.fn.bind(function(item,index){var subEngineName=item.constructorName,args=item.args||{},subEngineConstructor;this.subEnginesInitArgs[subEngineName]=args;try{if(subEngineConstructor=eval(subEngineName),!T.lang.isFunction(subEngineConstructor))return}catch(e){return}var engine=new subEngineConstructor(args);this.unInitEngineList.push(engine)},this)),this.curEngine=this.unInitEngineList[0]},init:function(t){if(this.ready)return this._error("");if(t=t||{},this.subEnginesInitArgs=t.subEngines?t.subEngines:this.subEnginesInitArgs,this.coreContainer=t.el?t.el:this.coreContainer,!this.coreContainer){var e=T.dom.create("div",{id:"_player_container_"+T.lang.guid()});T.dom.setStyles(e,{width:"1px",height:"1px",overflow:"hidden"}),document.body.appendChild(e),this.coreContainer=t.el=e}T.array.each(this.unInitEngineList,T.fn.bind(function(t){var e=t.toString(),i="",n=/^\[object (.*)\]$/i;n.test(e)&&(i=RegExp.$1);var s=this.subEnginesInitArgs[i]||{};t.test(!0)&&(s.instanceName=s.instanceName+".engineList["+this.engineList.length+"]",s.el=s.el||this.coreContainer,this.engineList.push(t),t.init.apply(t,[s]))},this)),this.switchEngineByUrl(this.defaultExt),this.ready=!0,this._initProgressEvent(),this._initPositionChangeEvent()},canPlayType:function(t){return T.array.some(this.engineList,function(e){return e.canPlayType(t)})},getSupportMimeTypeList:function(){var t=[];return T.array.each(this.engineList,T.fn.bind(function(e){t=t.concat(e.getSupportMimeTypeList())},this)),t},switchEngineByUrl:function(t){var e=T.array.some(this.engineList,T.fn.bind(function(e){var i=e.getSupportMimeTypeList().join("|"),n=new RegExp("\\.("+i+")(\\?|$)","ig");return n.test(t)?(this.curEngine=e,this.curEngineType=e.getEngineType(),!0):void 0},this)),i=arguments[1];e||i||arguments.callee.apply(this,[this.defaultExt,!0])},switchEngineByMimeType:function(t){T.array.some(this.engineList,T.fn.bind(function(e){return e.canPlayType(t)?(this.curEngine=e,this.curEngineType=e.getEngineType(),!0):void 0},this))},reset:function(){this.curEngine.reset.apply(this.curEngine,arguments)},setUrl:function(t){var e=this.curEngine;this.switchEngineByUrl(t),e&&e!=this.curEngine&&e.stop(),this.curEngine&&this.curEngine.setUrl.apply(this.curEngine,arguments)},getUrl:function(){return this.curEngine.getUrl.apply(this.curEngine,arguments)},play:function(t){return"undefined"!=typeof t?this.setCurrentPosition(t):this.curEngine?this.curEngine.play.apply(this.curEngine,arguments):void 0},pause:function(){return this.curEngine?this.curEngine.pause.apply(this.curEngine,arguments):void 0},stop:function(){return this.curEngine?this.curEngine.stop.apply(this.curEngine,arguments):void 0},setMute:function(){var t=arguments;T.array.each(this.engineList,function(e){e.setMute.apply(e,t)})},getMute:function(){return this.curEngine?this.curEngine.getMute.apply(this.curEngine,arguments):!1},setVolume:function(){var t=arguments;T.array.each(this.engineList,function(e){e.setVolume.apply(e,t)})},getVolume:function(){return this.curEngine?this.curEngine.getVolume.apply(this.curEngine,arguments):0},setCurrentPosition:function(){return this.curEngine?this.curEngine.setCurrentPosition.apply(this.curEngine,arguments):void 0},getCurrentPosition:function(){return this.curEngine?this.curEngine.getCurrentPosition.apply(this.curEngine,arguments):0},getCurrentPositionString:function(){return mbox.convertTime(this.getCurrentPosition())},getLoadedPercent:function(){return this.curEngine?this.curEngine.getLoadedPercent.apply(this.curEngine,arguments):0},getLoadedBytes:function(){return this.curEngine?this.curEngine.getLoadedBytes.apply(this.curEngine,arguments):void 0},getTotalBytes:function(){return this.curEngine?this.curEngine.getTotalBytes.apply(this.curEngine,arguments):0},getTotalTime:function(){return this.curEngine?this.curEngine.getTotalTime.apply(this.curEngine,arguments):0},getTotalTimeString:function(){return mbox.convertTime(this.getTotalTime())},getCurEngine:function(){return this.curEngine},getEngineType:function(){return this.getCurEngine().getEngineType()},getVersion:function(){var t={};return T.array.each(this.engineList,function(e){t[e.getEngineType()]=e.getVersion()}),t},getState:function(){return this.curEngine?this.curEngine.getState.apply(this.curEngine,arguments):null},setEventListener:function(t,e,i){var n;n=t==this.EVENTS.INITFAIL||t==this.EVENTS.INIT?T.fn.bind(function(){e.apply(this,arguments)},this):T.fn.bind(function(t){t.target&&t.target.getEngineType()==this.curEngineType&&e.apply(this,arguments)
},this),T.array.each(this.unInitEngineList,function(e){e.setEventListener(t,n,i)})},removeEventListener:function(t,e){T.array.each(this.unInitEngineList,function(i){i.removeEventListener(t,e)})},_initProgressEvent:function(){this.progressTimer.addEventListener("timer",T.fn.bind(function(){var t=this.getLoadedPercent();this.curEngine.dispatchEvent(this.EVENTS.PROGRESS,{progress:t,totalBytes:this.getTotalBytes(),loadedBytes:this.getLoadedBytes(),totalTime:this.getTotalTime()}),1==t&&"wmp"!=this.curEngineType&&this.progressTimer.stop()},this)),this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(t){var e=t.newState;switch(e){case this.STATES.PREBUFFER:case this.STATES.PLAY:this.getLoadedPercent()<1&&this.progressTimer.start();break;case this.STATES.STOP:case this.STATES.READY:case this.STATES.END:this.progressTimer.reset()}},this)),this.setEventListener("setUrl",T.fn.bind(function(){this.progressTimer.reset(),this.progressTimer.start()},this))},_initPositionChangeEvent:function(){this.positionTimer.addEventListener("timer",T.fn.bind(function(){var t=this.getCurrentPosition();this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:t})},this)),this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(t){var e=t.newState;switch(e){case this.STATES.PLAY:this.positionTimer.start();break;case this.STATES.STOP:case this.STATES.PAUSE:this.positionTimer.pause(),this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:this.getCurrentPosition()});break;case this.STATES.READY:case this.STATES.END:this.positionTimer.reset()}},this)),this.setEventListener("setUrl",T.fn.bind(function(){this.positionTimer.reset()},this))}});mbox.SongModel=function(t){t=t||{},this.hasLink=!1,this.songId=0,this.songName="",this.artistId=0,this.artistName="",this.albumId=0,this.albumName="",this.songPicSmall="",this.songPicBig="",this.songPicRadio="",this.lrcLink="",this.time=0,this.songLink="",this.showLink="",this.format="",this.rate=0,this.size=0,this.lyricContent="",this.relateStatus=0,this.resourceType=0,this.copyType=0;for(var e in t){var i=t[e];if(!T.isString(this[e])&&""!=i){var n=+i;n==i?i=n:null==i&&(i="")}this[e]=i}},mbox.SongModel.prototype={set:function(t){for(var e in t){var i=t[e];if(!T.isString(this[e])&&""!=i){var n=+i;n==i?i=n:null==i&&(i="")}this[e]=i}},get:function(t){return this[t]},unset:function(t){delete this[t]}},function(){var t=T.lang.createClass(function(){this.allSongCache={},this.apiAddress=mbox.CONF.songLinkHost.link,this.lrcAddress=mbox.CONF.songLinkHost.lrc,this.sugAddress=mbox.CONF.songLinkHost.sug}).extend({createSongModel:function(t,e){var i=[],t=T.lang.toArray(t),e=T.lang.toArray(e);return T.each(t,function(t){t&&"null"!==t&&"undefined"!==t&&(this.allSongCache[t]||(this.allSongCache[t]=new mbox.SongModel({songId:t})),i.push(this.allSongCache[t]))},this),T.object.each(e,function(t){this.allSongCache[t.queryId||t.id]&&this.allSongCache[t.queryId||t.id].set(t)},this),i},fetchIdByQuery:function(t,e){var i=t.split("$$"),n=i[0]||i[2],s=i[1];T.sio.callByServer(this.sugAddress+n+" "+s,function(i){i.song_list&&i.song_list.length?e(i.song_list[0].song_id):e(t)})},parseHttpsSongPic:function(t){return t&&"https:"===$.tb.location.getProtocol()?t.replace("http://musicdata.baidu.com","https://gss0.baidu.com/8_1ZdTmk2RIF8t7jm9iCKT-xh_"):t},fetchSong:function(t,e){var i=this;t.hasLink?T.lang.isFunction(e.success)&&e.success(t,this):t.songId.toString().indexOf("$$")>-1?this.fetchIdByQuery(t.songId,T.fn.bind(function(n){T.sio.callByServer(this.apiAddress+n,function(n){if(22e3===n.error_code){var s=n.songinfo,a=n.bitrate;if(s.extra){var r=s.extra.split("$$");s.song_id=s.extra,s.title=r[0]||r[2],s.author=r[1]}t.set({hasLink:!0,songId:s.song_id,songName:s.title,artistId:s.ting_uid,artistName:s.author,albumId:s.album_id,albumName:s.album_title,songPicBig:i.parseHttpsSongPic(s.pic_big),songPicSmall:i.parseHttpsSongPic(s.pic_small)||"//tb2.bdstatic.com/tb/static-common/widget/music_player/noPic_7a0425f.jpg",songPicRadio:s.pic_radio,resourceType:s.resource_type,relateStatus:s.relate_status,copyType:s.copy_type,lrcLink:s.lrclink,rate:a.file_bitrate,songLink:a.file_link,showLink:a.show_link,format:a.file_extension,size:a.file_size,time:a.file_duration}),T.lang.isFunction(e.success)&&e.success(t,this)}else T.lang.isFunction(e.error)&&e.error(t,n.error_code)})},this)):T.sio.callByServer(this.apiAddress+t.songId,function(n){if(22e3===n.error_code){var s=n.songinfo,a=n.bitrate;if(s.extra){var r=s.extra.split("$$");s.song_id=s.extra,s.title=r[0]||r[2],s.author=r[1]}t.set({hasLink:!0,songId:s.song_id,songName:s.title,artistId:s.ting_uid,artistName:s.author,albumId:s.album_id,albumName:s.album_title,songPicBig:i.parseHttpsSongPic(s.pic_big),songPicSmall:i.parseHttpsSongPic(s.pic_small)||"//tb2.bdstatic.com/tb/static-common/widget/music_player/noPic_7a0425f.jpg",songPicRadio:s.pic_radio,resourceType:s.resource_type,relateStatus:s.relate_status,copyType:s.copy_type,lrcLink:s.lrclink,rate:a.file_bitrate,songLink:a.file_link,showLink:a.show_link,format:a.file_extension,size:a.file_size,time:a.file_duration}),T.lang.isFunction(e.success)&&e.success(t,this)}else T.lang.isFunction(e.error)&&e.error(t,n.error_code)})},getLrcContent:function(t,e){var i=T.lang.isFunction,n=i(e)?e:i(e.success)?e.success:function(){},s=i(e.error)?e.error:function(){};t.lrcContent?n(t.lrcContent):t.songLink&&t.lrcLink?T.sio.callByServer(this.lrcAddress+t.songId,function(e){e.lrcContent?(t.lrcContent=e.lrcContent,n(e.lrcContent)):s()}):s()}});mbox.SongDataModel=new t}(void 0),function(){var t={RANDOM:0,SINGLE:1,CYCLE:2};mbox.PlayList=T.lang.createClass(function(){this.curSongIndex=-1,this.curSong=null,this.songModels=[],this.mode=t.SINGLE}).extend({_random:function(){return parseInt(Math.random()*this.getLength(),10)},addSong:function(t){t=T.lang.toArray(t),t.length&&(this.songModels=this.songModels.concat(t),this.dispatchEvent("add:songModels",{songModels:t}))},removeSong:function(t){if(-1===t)this.reset(),this.dispatchEvent("remove:songModels",{indexes:e});else{var e=T.lang.toArray(t),i=e.length;if(i){e.sort(function(t,e){return t-e});for(var n=this.curSongIndex,s=n,a=!1;i--;){var r=e[i];this.songModels.splice(r,1),-1!==s&&(r===n&&(a=!0),n>=r&&n--)}a&&n++,-1!==s&&(0>n&&songlist.length>0?(n=0,a=!0):n>songlist.length-1&&(n=0)),a&&(this.curSong=songlist[n],this.curSongIndex=n),this.dispatchEvent("remove:songModels",{indexes:e})}}},prev:function(){var e=this.getLength(),i=-1===this.curSongIndex?0:(this.curSongIndex+e-1)%e;e&&(this.mode===t.RANDOM?this.setCurIndex(this._random()):this.setCurIndex(i))},next:function(){var e=this.getLength(),i=(this.curSongIndex+1)%e;e&&(this.mode===t.RANDOM?this.setCurIndex(this._random()):this.setCurIndex(i))},autoNext:function(){this.mode===t.SINGLE?this.setCurIndex(this.curSongIndex):this.next()},setCurIndex:function(t){this.curSongIndex=t,this.setCurSong(this.songModels[t]),this.dispatchEvent("change:curSongIndex",{index:t})},setCurSong:function(t){this.curSong=t,this.dispatchEvent("change:curSong",{curSong:t})},getCurIndex:function(){return this.curSongIndex},getCurSong:function(){return this.curSong},getSongList:function(){return this.songModels},setMode:function(t){this.mode=t},getMode:function(){return this.mode},getLength:function(){return this.songModels.length},reset:function(){this.curSongIndex=-1,this.curSong=null,this.songModels=[],this.playlist=[]},fetchLink:function(t){mbox.SongDataModel.fetchSong(this.curSong,t)}})}(),mbox.LogModel=T.lang.createClass(function(t,e){this.logUrl="http://qianclick.baidu.com/v.gif",this.playerRules={},this.playerRuleCtrl=null,this.player=t,this.playList=e,this.initLog()}).extend({initLog:function(){{var t=this;new mbox.PlayerLog({time:100,resetOnNoVoice:!0,type:"play100ms",player:this.player,handler:function(){t.sendLog("playsong100ms",t.logUrl,{sendCurSong:!0})}}),new mbox.PlayerLog({time:6e4,resetOnNoVoice:!1,type:"play60s",player:this.player,handler:function(){t.sendLog("60play",t.logUrl,{sendCurSong:!0})}})}this.player.setEventListener("setUrl",function(){t.sendLog("playstart",t.logUrl,{sendCurSong:!0})})},_addCurSong:function(t){var e={song_id:"songId",song_title:"songName",singer_id:"artistId",singer_name:"artistName",album_id:"albumId",album_name:"albumName",copytype:"copyType",format:"format",queryid:"queryId",rate:"rate",relatestatus:"relateStatus",resourcetype:"resourceType",songsize:"size",linkCode:"linkCode",lrcLink:"lrcLink",time:"time",status:"status",from:"from",link:"songLink"},i=this.playList.getCurSong();T.object.each(e,function(e,n){t.push(n+"="+encodeURIComponent(null==i[e]?"":i[e]))})},sendLog:function(t,e,i){return}}),mbox.PlayerLog=function(t){this.type=t.type,this.time=t.time,this.resetOnNoVoice=t.resetOnNoVoice,this.player=t.player,this.active=!1,this.timer=null,this.handlers=[],t.handler&&this.handlers.push(t.handler),this._init()},mbox.PlayerLog.prototype={_init:function(){this.timer||null==this.time||(this.timer=new mbox.Timer(this.time,1),this.addHandler(this.handler),this.timer.addEventListener("timer",T.fn.bind(function(){for(var t=0,e=this.handlers.length;e>t;t++)this.handlers[t]&&this.handlers[t].apply(this,arguments)},this)));var t=this.player.EVENTS.STATECHANGE,e=this.player.STATES;this.player.setEventListener("setUrl",T.fn.bind(function(){this.active=!0,this.timer.reset()},this)),this.player.setEventListener(t,T.fn.bind(function(t){this.active&&(t.newState==e.PLAY?this.timer.start():this.resetOnNoVoice?this.timer.reset():t.newState==e.PAUSE||t.newState==e.BUFFERING?t.oldState==e.PLAY&&this.timer.pause():this.timer.reset())},this))},addHandler:function(t){this.handlers.push(t)}},mbox.PlayCtrl=mbox.lang.createClass(function(t){var e=[],i=mbox.CONF.instanceCallName,n=mbox.CONF.engineArg;"object"!=typeof window[i]&&(window[i]={}),/(macintosh|iphone|ipod|ipad)/i.test(navigator.userAgent)?(e.push(n.audio),e.push(n.fmp)):(e.push(n.fmp),e.push(n.audio)),this.player=window[i].player=new PlayEngine({subEngines:e}),this.player.init(),this.curSong=null,this.playList=new mbox.PlayList,this.log=new mbox.LogModel(this.player,this.playList),window[i].logger=this.log,this._init(t),mbox.CONF.exportAPI&&(window[i][mbox.CONF.exportAPI]=this.exportAPI())}).extend({_init:function(t){t=t||{};var e=this.player,i=this.playList,n=t.songId||[],s=mbox.SongDataModel.createSongModel(n),a=this,r=T.lang.isFunction;t.logOpt&&T.object.extend(mbox.CONF.logOpt||{},t.logOpt),e.setEventListener(e.EVENTS.POSITIONCHANGE,function(e){var i=e.position,n=a.getTotalTime();r(t.onPositionChange)&&t.onPositionChange(i,100*i/n||0)}),r(t.onProgressChange)&&e.setEventListener(e.EVENTS.PROGRESS,function(e){t.onProgressChange(100*e.progress)}),e.setEventListener(e.EVENTS.STATECHANGE,function(n){switch(r(t.onPlayStateChange)&&t.onPlayStateChange(n.newState,n.oldState),n.newState){case e.STATES.END:mbox.CONF.autoNext?(i.autoNext(),a.play()):e.stop()}}),i.addEventListener("change:curSong",function(i){e.stop(),(a.curSong=i.curSong)?a.playList.fetchLink({success:function(e){r(t.onChangeCurSong)&&t.onChangeCurSong(e),a.dispatchEvent("fetch:link",{song:e})},error:function(e){r(t.onChangeCurSong)&&t.onChangeCurSong(null,e)}}):r(t.onChangeCurSong)&&t.onChangeCurSong(null)}),i.addSong(s),this.playList.setCurIndex(0),(void 0!==t.autoPlay?t.autoPlay:mbox.CONF.autoPlay)&&this.play()},getCurSong:function(){return this.curSong},getTotalTime:function(){return this.curSong&&1e3*this.curSong.time||this.player.getTotalTime()},setPlayIndex:function(t,e){this.playList.setCurIndex(t),e&&this.play()},play:function(){if(this.curSong&&this.curSong.songLink)this.curSong.songLink!==this.player.getUrl()&&(this.player.reset(),this.player.setUrl(this.curSong.songLink)),this.player.play();else{var t=this;this.addEventListener("fetch:link",function(e){if(!e.song)throw"fetch songLink fail";t.player.setUrl(e.song.songLink),t.player.play(),t.removeEventListener("fetch:link.link")},"link")}},pause:function(){this.player.pause()},stop:function(){this.player.stop()},exportAPI:function(){var t=this,e=this.player.EVENTS;return{getCurSong:function(){return t.curSong},getTotalTime:function(){return t.totalTime},getPlayerState:function(){return t.player.getState()},getPosition:function(){return t.player.getPosition()},getProgress:function(){return t.player.getProgress()},play:function(){t.play.apply(t,arguments)},pause:function(){t.pause()},stop:function(){t.stop()},listenToStateChange:function(i){t.player.setEventListener(e.STATECHANGE,i)},listenToPosChange:function(i){t.player.setEventListener(e.POSITIONCHAGNE,i)},listenToLoadedPercentChange:function(i){t.player.setEventListener(e.PROGRESS,i)},getCurIndex:function(){return t.playList.getCurIndex()},addSong:function(e){var i=T.lang.toArray(e);i.length&&"object"!=typeof i[0]&&(i=mbox.SongDataModel.createSongModel(i)),t.playList.addSong(i)},removeSong:function(e){t.playList.removeSong(e)},setPlayIndex:function(e,i){this.setPlayIndex.call(t,e,i)},setPlayMode:function(e){t.playList.setMode(e)}}}}),mbox.uiConf={prefix:"mbox",allWidget:["slider","time","volume","mute","title","lrc","album","playList","playBtn"],tpl:'<div class="mbox">                <div class="logo" ><a href="http://music.baidu.com" target="_blank" title="\u767E\u5EA6\u97F3\u4E50"></a></div>                <div class="player-main">                    <div class="album-pic mbox-album">                        <img class="pic" data-src="<%=songPicSmall%>"/>                    </div>                    <div class="right-wrapper">                        <div class="right-top">                            <div class="mbox-title player-title">                                <div class="song-name song-info" songid="<%=songId%>"><a href="http://music.baidu.com/song/<%=songId%>" target="_blank"><%=songName%></a></div>                                <span class="artist song-info">\u6B4C\u624B\uFF1A<span class="artist-name"><%var i =0, len = all_artist.length; for(;len -i; i++){%>                                    <a href="<%=all_artist_link[i]%>" target="_blank"><%=all_artist[i]%></a><%};%></span></span>                                <span class="album song-info">\u4E13\u8F91\uFF1A<span class="album-name"><a href="<%=albumLink%>" target="_blank"><%=albumName%></a></span></span>                                <span class="source song-info">\u6765\u6E90\uFF1A<span class="link-source"><a href="javascript:void(0)"></a></span></span>                                <div class="lrc"></div>                            </div>                            <div class="button-wrapper">                                <a class="button add-favour" href="javascript:void(0)" onclick="return false;" title="\u70B9\u51FB\u6536\u85CF"></a>                                <a class="button lrc-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u67E5\u770B\u5168\u90E8\u6B4C\u8BCD"></a>                                <a class="button download-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u4E0B\u8F7D\u6B4C\u66F2"></a>                                <a class="button go-to-listen-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u5F39\u51FA\u64AD\u653E"></a>                            </div>                        </div>                        <div class="bottom-bars">                            <div class="bottom-bars-item mbox-playBtn ctrl-btn stop"><a href="javascript:void(0)" onclick="return false;"></a></div>                            <div class="bottom-bars-item  progress "><div class="slider-wrapper mbox-slider"></div></div>                            <div class="bottom-bars-item mbox-time time"><%=curTime%>/<%=totalTime%></div>                            <div class="bottom-bars-item volume">                                <a class="volume-btn mbox-mute" href="javascript:void(0)" onclick="return false;"  title="">&nbsp</a>                                <div class="slider-wrapper mbox-volume"></div>                            </div>                        </div>                    </div>                </div>                </div>'},function(t){var e="undefined"==typeof module?t.baidu=t.baidu||{}:module.exports;e.template=function(e,n){var s=function(){if(!t.document)return i._compile(e);var n=document.getElementById(e);if(n){if(i.cache[e])return i.cache[e];var s=/^(textarea|input)$/i.test(n.nodeName)?n.value:n.innerHTML;return i._compile(s)}return i._compile(e)}(),a=i._isObject(n)?s(n):s;return s=null,a};var i=e.template;i.versions=i.versions||[],i.versions.push("1.0.6"),i.cache={},i.LEFT_DELIMITER=i.LEFT_DELIMITER||"<%",i.RIGHT_DELIMITER=i.RIGHT_DELIMITER||"%>",i.ESCAPE=!0,i._encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"&#92;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},i._encodeReg=function(t){return String(t).replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")},i._encodeEventHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\\\/g,"\\").replace(/\\\//g,"/").replace(/\\n/g,"\n").replace(/\\r/g,"\r")},i._compile=function(t){var e="var _template_fun_array=[];\nvar fn=(function(__data__){\nvar _template_varName='';\nfor(name in __data__){\n_template_varName+=('var '+name+'=__data__[\"'+name+'\"];');\n};\neval(_template_varName);\n_template_fun_array.push('"+i._analysisStr(t)+"');\n_template_varName=null;\n})(_template_object);\nfn = null;\nreturn _template_fun_array.join('');\n";return new Function("_template_object",e)},i._isObject=function(t){return"function"==typeof t||!(!t||"object"!=typeof t)},i._analysisStr=function(t){var e=i.LEFT_DELIMITER,n=i.RIGHT_DELIMITER,s=i._encodeReg(e),a=i._encodeReg(n);return t=String(t).replace(new RegExp("("+s+"[^"+a+"]*)//.*\n","g"),"$1").replace(new RegExp("<!--.*?-->","g"),"").replace(new RegExp(s+"\\*.*?\\*"+a,"g"),"").replace(new RegExp("[\\r\\t\\n]","g"),"").replace(new RegExp(s+"(?:(?!"+a+")[\\s\\S])*"+a+"|((?:(?!"+s+")[\\s\\S])+)","g"),function(t,e){var i="";if(e)for(i=e.replace(/\\/g,"&#92;").replace(/'/g,"&#39;");/<[^<]*?&#39;[^<]*?>/g.test(i);)i=i.replace(/(<[^<]*?)&#39;([^<]*?>)/g,"$1\r$2");else i=t;return i}),t=t.replace(new RegExp("("+s+"[\\s]*?var[\\s]*?.*?[\\s]*?[^;])[\\s]*?"+a,"g"),"$1;"+n).replace(new RegExp("("+s+":?[hvu]?[\\s]*?=[\\s]*?[^;|"+a+"]*?);[\\s]*?"+a,"g"),"$1"+n).split(e).join("	"),t=i.ESCAPE?t.replace(new RegExp("\\t=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'"):t.replace(new RegExp("\\t=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':$1,'"),t=t.replace(new RegExp("\\t:h=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'").replace(new RegExp("\\t(?::=|-)(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':$1,'").replace(new RegExp("\\t:u=(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':encodeURIComponent($1),'").replace(new RegExp("\\t:v=(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':baidu.template._encodeEventHTML($1),'").split("	").join("');").split(n).join("_template_fun_array.push('").split("\r").join("\\'")}}(window),function(t,e){t.widget&&"function"===t.widget&&(t.box_widget=t.widget);var i=0,n=Array.prototype.slice,s=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(a){}s(e)},t.box_widget=function(e,i,n){var s,a,r,o,u=e.split(".")[0];e=e.split(".")[1],s=u+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][s.toLowerCase()]=function(e){return!!t.data(e,s)},t[u]=t[u]||{},a=t[u][e],r=t[u][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new r(t,e)},t.extend(r,a,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),o=new i,o.options=t.box_widget.extend({},o.options),t.each(n,function(e,s){t.isFunction(s)&&(n[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},n=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,a=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=a,e}}())}),r.prototype=t.box_widget.extend(o,{widgetEventPrefix:e},n,{constructor:r,namespace:u,widgetName:e,widgetBaseClass:s,widgetFullName:s}),a?(t.each(a._childConstructors,function(e,i){var n=i.prototype;t.box_widget(n.namespace+"."+n.widgetName,r,i._proto)}),delete a._childConstructors):i._childConstructors.push(r),t.box_widget.bridge(e,r)},t.box_widget.extend=function(i){for(var s,a,r=n.call(arguments,1),o=0,u=r.length;u>o;o++)for(s in r[o])a=r[o][s],r[o].hasOwnProperty(s)&&a!==e&&(i[s]=t.isPlainObject(a)?t.box_widget.extend({},i[s],a):a);return i},t.box_widget.bridge=function(i,s){var a=s.prototype.widgetFullName;t.fn[i]=function(r){var o="string"==typeof r,u=n.call(arguments,1),l=this;return r=!o&&u.length?t.box_widget.extend.apply(null,[r].concat(u)):r,o?this.each(function(){var n,s=t.data(this,a);return s?t.isFunction(s[r])&&"_"!==r.charAt(0)?(n=s[r].apply(s,u),n!==s&&n!==e?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0):t.error("no such method '"+r+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+r+"'")}):this.each(function(){var e=t.data(this,a);e?e.option(r||{})._init():new s(r,this)}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.box_widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetName,this),t.data(n,this.widgetFullName,this),this._on({remove:"destroy"}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var s,a,r,o=i;if(0===arguments.length)return t.box_widget.extend({},this.options);if("string"==typeof i)if(o={},s=i.split("."),i=s.shift(),s.length){for(a=o[i]=t.box_widget.extend({},this.options[i]),r=0;r<s.length-1;r++)a[s[r]]=a[s[r]]||{},a=a[s[r]];if(i=s.pop(),n===e)return a[i]===e?null:a[i];a[i]=n}else{if(n===e)return this.options[i]===e?null:this.options[i];o[i]=n}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,i){i?(e=t(e),this.bindings=this.bindings.add(e)):(i=e,e=this.element);var n=this;t.each(i,function(i,s){function a(){return n.options.disabled===!0||t(this).hasClass("ui-state-disabled")?void 0:("string"==typeof s?n[s]:s).apply(n,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var r=i.match(/^(\w+)\s*(.*)$/),o=r[1]+n.eventNamespace,u=r[2];u?n.widget().delegate(u,o,a):e.bind(o,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var s,a,r=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(s in a)s in i||(i[s]=a[s]);return this.element.trigger(i,n),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,s,a){"string"==typeof s&&(s={effect:s});var r,o=s?s===!0||"number"==typeof s?i:s.effect||i:e;s=s||{},"number"==typeof s&&(s={duration:s}),r=!t.isEmptyObject(s),s.complete=a,s.delay&&n.delay(s.delay),r&&t.effects&&(t.effects.effect[o]||t.uiBackCompat!==!1&&t.effects[o])?n[e](s):o!==e&&n[o]?n[o](s.duration,s.easing,a):n.queue(function(i){t(this)[e](),a&&a.call(n[0]),i()})}}),t.uiBackCompat!==!1&&(t.Widget.prototype._getCreateOptions=function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.box_widget("ui.box_mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1==i.which,a="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return s&&!a&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return!t.browser.msie||document.documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){var e=5;t.box_widget("ui.box_slider",t.ui.box_mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",progressbar:!1,progress:0,constraintProgress:!1,range:!1,step:1,value:0,values:null},_create:function(){var i=this,n=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' hidefocus='true'><span></span></a>",r=n.values&&n.values.length||1,o=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(n.disabled?" ui-slider-disabled ui-disabled":"")),this.range=t([]),n.range&&(n.range===!0&&(n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&2!==n.values.length&&(n.values=[n.values[0],n.values[0]])),this.range=t("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===n.range||"max"===n.range?" ui-slider-range-"+n.range:""))),n.progressbar&&(this.progressbar=t("<div></div>").appendTo(this.element).addClass("ui-slider-progressbar ui-widget-header"));for(var u=s.length;r>u;u+=1)o.push(a);this.handles=s.add(t(o.join("")).appendTo(i.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(t){t.preventDefault()}).hover(function(){n.disabled||t(this).addClass("ui-state-hover ui-slider-handle-hover")},function(){t(this).removeClass("ui-state-hover ui-slider-handle-hover")}).focus(function(){n.disabled?t(this).blur():(t(".ui-slider .ui-state-focus").removeClass("ui-state-focus ui-slider-handle-focus"),t(this).addClass("ui-state-focus ui-slider-handle-focus"))}).blur(function(){t(this).removeClass("ui-state-focus ui-slider-handle-focus")}),this.handles.each(function(e){t(this).data("index.ui-slider-handle",e)}),this.handles.keydown(function(n){var s,a,r,o,u=t(this).data("index.ui-slider-handle");if(!i.options.disabled){switch(n.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n.preventDefault(),!i._keySliding&&(i._keySliding=!0,t(this).addClass("ui-state-active ui-slider-handle-active"),s=i._start(n,u),s===!1))return}switch(o=i.options.step,a=r=i.options.values&&i.options.values.length?i.values(u):i.value(),n.keyCode){case t.ui.keyCode.HOME:r=i._valueMin();break;case t.ui.keyCode.END:r=i._valueMax();break;case t.ui.keyCode.PAGE_UP:r=i._trimAlignValue(a+(i._valueMax()-i._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:r=i._trimAlignValue(a-(i._valueMax()-i._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(a===i._valueMax())return;r=i._trimAlignValue(a+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(a===i._valueMin())return;r=i._trimAlignValue(a-o)}i._slide(n,u,r)}}).keyup(function(e){var n=t(this).data("index.ui-slider-handle");i._keySliding&&(i._keySliding=!1,i._stop(e,n),i._change(e,n),t(this).removeClass("ui-state-active ui-slider-handle-active"))}),this._refreshValue(),this._refreshProgress(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(e){var i,n,s,a,r,o,u,l,h,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,r=this,this.handles.each(function(e){var i=Math.abs(n-r.values(e));
s>i&&(s=i,a=t(this),o=e)}),d.range===!0&&this.values(1)===d.min&&(o+=1,a=t(this.handles[o])),u=this._start(e,o),u===!1?!1:(this._mouseSliding=!0,r._handleIndex=o,a.addClass("ui-state-active ui-slider-handle-active").focus(),l=a.offset(),h=!t(e.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active ui-slider-handle-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,s,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),a=this._valueMin()+n*s,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,s,a;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>n||1===e&&n>i)&&(i=n),i!==this.values(e)&&(s=this.values(),s[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:s}),n=this.values(e?0:1),a!==!1&&this.values(e,i,!0))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("change",t,i)}},_progress:function(t){var e={progress:this.options.progress};this._trigger("progress",t,e)},progress:function(t){var e=this._trimAlignProgress(t);return arguments.length&&this.options.progress!=e?(this.options.progress=e,this._refreshProgress(),this._progress(null),this.options.constraintProgress&&this.value()>e&&this.value(e),void 0):this.options.progress},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var n,s,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,s=arguments[0],a=0;a<n.length;a+=1)n[a]=this._trimAlignValue(s[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var n,s=0;switch(t.isArray(this.options.values)&&(s=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover ui-slider-handle-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this._refreshProgress();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;s>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"progress":this._refreshProgress(),this._progress(null),this.options.constraintProgress&&this.options.value>this.options.progress&&(this._animateOff=!0,this.value(this.options.progress),this._animateOff=!1);break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._refreshProgress(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(t){if(t<=this._valueMin())return this._valueMin();if(!this.options.constraintProgress&&t>=this._valueMax())return this._valueMax();this.options.progressbar&&this.options.constraintProgress&&t>=this.options.progress&&(t=this.options.progress);var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_trimAlignProgress:function(t){return t<=this._valueMin()?this._valueMin():t>=this._valueMax()?this._valueMax():t},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,n,s,a,r=this.options.range,o=this.options,u=this,l=this._animateOff?!1:o.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){e=(u.values(n)-u._valueMin())/(u._valueMax()-u._valueMin())*100,h["horizontal"===u.orientation?"left":"bottom"]=e+"%",t(this).stop(1,1)[l?"animate":"css"](h,o.animate),u.options.range===!0&&("horizontal"===u.orientation?(0===n&&u.range.stop(1,1)[l?"animate":"css"]({left:e+"%"},o.animate),1===n&&u.range[l?"animate":"css"]({width:e-i+"%"},{queue:!1,duration:o.animate})):(0===n&&u.range.stop(1,1)[l?"animate":"css"]({bottom:e+"%"},o.animate),1===n&&u.range[l?"animate":"css"]({height:e-i+"%"},{queue:!1,duration:o.animate}))),i=e}):(n=this.value(),s=this._valueMin(),a=this._valueMax(),e=a!==s?(n-s)/(a-s)*100:0,h["horizontal"===u.orientation?"left":"bottom"]=e+"%",this.handle.stop(1,0)[l?"animate":"css"](h,o.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,0)[l?"animate":"css"]({width:e+"%"},o.animate),"max"===r&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-e+"%"},{queue:!1,duration:o.animate}),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,0)[l?"animate":"css"]({height:e+"%"},o.animate),"max"===r&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-e+"%"},{queue:!1,duration:o.animate}))},_refreshProgress:function(){var t=this.options,e=this._valueMax(),i=t.progress,n=i/e*100;this.progressbar&&("horizontal"===this.orientation?this.progressbar.css({width:n+"%"}):this.progressbar.css({height:n+"%"}))},setLoading:function(t,e){var i;arguments.length<=1?(e=t,i=this.handle):i=this.handles.eq(t),i[e?"addClass":"removeClass"]("ui-slider-handle-loading")}}),t.extend(t.ui.box_slider,{version:"1.8.20"})}(jQuery),function(t){t.cutString=function(t,e,i){var n,s,a,r=t.length,o=0,u=0;for(s=0;r>s;s++)if(o+=t.charCodeAt(s)>128?2:1,o>e){n=t.substring(0,s-1)+"...";break}for(a=r;a>0;a--){if(s>=a||0===i)return n;if(u+=t.charCodeAt(s)>128?2:1,u>i)return n+=t.substring(a)}return t}}(jQuery),mbox.UiCtrl=mbox.lang.createClass(function(t,e){this.guid="mbox_ui_"+setTimeout(function(){},0),this.conf=e||mbox.uiConf,this.conf&&(this.widget={},this._init(t),this.EVENTS={POSITIONCHANGE:"ui_poschange",TOGGLEPLAY:"ui_toggleplay",VOLCHANGE:"ui_volchange",MUTECHANGE:"ui_mutechange"},this.volume=80,this.$root=$(t),this.active=!1)}).extend({_init:function(t){if(this.conf.tpl){for(var e=$(this.conf.tpl).appendTo(t||"body").css("display","none"),i=this.conf.allWidget,n=this.conf.prefix,s={},a=i.length-1;a>-1;a--){var r=e.find("."+n+"-"+i[a]),o=r.html();o=o&&o.replace(/&lt;%/g,"<%").replace(/%&gt;/g,"%>"),s[i[a]]={dom:r,tpl:o}}this.conf.domJson=s,e.css("display","block"),this.$root=e}var u=this.conf.domJson;for(var l in u)if(u.hasOwnProperty(l))switch(l){case"slider":this._initSlider(u[l]);break;case"volume":this.widget[l]=$(u[l].dom).box_slider({animate:!0,max:100,min:0,orientation:"horizental",progressbar:!1,range:"min",value:80}).bind("slide",T.fn.bind(function(t,e){this.active&&this.fireVolChange(+e.value,0===+e.value)},this)).bind("slidestop",T.fn.bind(function(){this.active||this.widget.volume.box_slider("option","value",this.volume)},this));break;case"mute":var h=this;this.widget[l]=$(u[l].dom).click(function(){var t=$(this).hasClass("mute");h.fireVolChange(h.volume,!t)});break;case"title":case"time":case"playList":case"album":this.widget[l]=$(u[l].dom),this.widget[l].tpl=u[l].tpl;break;case"playBtn":this.widget[l]=$(u[l].dom).bind("click",T.fn.bind(function(){var t=this.widget.playBtn.hasClass("stop");this.dispatchEvent(this.EVENTS.TOGGLEPLAY,{isPlay:t})},this))}this.conf.tpl&&this.tplToHtml()},_initSlider:function(t){var e=t.maxValue||1e4;this.widget.slider=$(t.dom).box_slider({animate:175,max:e,min:0,orientation:"horizontal",progressbar:!0,progress:0,constraintProgress:!0,range:"min",value:0}),this.widget.slider.maxValue=e,this.widget.slider.sliding=!1;var i=this;this.widget.slider.bind("slidestart",function(){i.widget.slider.isSliding=!0}).bind("slidestop",function(t,e){i.widget.slider.isSliding=!1,i.dispatchEvent(i.EVENTS.POSITIONCHANGE,{percent:e.value/i.widget.slider.maxValue}),!i.active&&i.widget.slider.box_slider("option","value",0)})},tplToHtml:function(t,e,i,n){function s(t){$(e).delegate("."+t,"click",function(){n.sendLog("click",n.logUrl,{pos:i[t]})})}if(this.widget.title){var a=this.createSongFilter(t);a.songName&&"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6"!==a.songName?this.widget.title.removeClass("grey"):this.widget.title.addClass("grey"),this.widget.title.html(baidu.template(this.widget.title.tpl,a))}if(this.widget.lrc&&this.widget.lrc.lrc("setLrc",""),this.widget.album){this.widget.album.html(baidu.template(this.widget.album.tpl,t));var r=this.widget.album.find("img");if(!r[0].src){var o=r.attr("data-src");o&&r.attr("src",o)}}this.widget.time&&this.widget.time.html(baidu.template(this.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(0)}));for(var u in i)s(u)},fireVolChange:function(t,e){return this.active?(this.volume=t,e?(this.widget.mute&&this.widget.mute.addClass("mute").attr("title","\u53D6\u6D88\u9759\u97F3"),this.widget.volume&&this.widget.volume.box_slider("option","value",0)):(this.widget.mute&&this.widget.mute.removeClass("mute").attr("title","\u9759\u97F3"),this.widget.volume&&this.widget.volume.box_slider("option","value",this.volume)),this.dispatchEvent(this.EVENTS.VOLCHANGE,{volume:t}),this.dispatchEvent(this.EVENTS.MUTECHANGE,{mute:e}),!0):!1},setActive:function(t){this.active=t,this.$root[t?"addClass":"removeClass"]("active")},setShowLink:function(t,e){var i=t.showLink,n=i?$.cutString(i,16,5):"";("2"==t.resourceType.toString()||void 0===t.resourceType)&&($(e).find(".link-source").text(n).attr("href",i),$(e).find(".source").show())},createSongFilter:function(t){var e,i,n=[],s=[],a=[];if(t){e="http://music.baidu.com/",n=t.artistId.toString().split(","),s=t.artistName.split(","),a=[];for(var r=0,o=s.length;o>r;r++)a[r]=n[r]?e+"artist/"+n[r]:"javascript:;";i={songId:t.songId,songName:t.songName||"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6",albumId:t.albumId,albumLink:t.albumId?e+"album/"+t.albumId:"javascript:;",albumName:t.albumName,all_artist:s,all_artist_id:n,all_artist_link:a}}else i={songId:"",songName:"",albumId:"",albumLink:"",albumName:"",all_artist:s,all_artist_id:n,all_artist_link:a};return i}}),function(){var t=function(t,e){if([].indexOf)return[].indexOf.call(t,e);for(var i=t.length-1;i>-1;i--)if(t[i]===e)return i;return-1};mbox.Controller=function(t){this.playctrl=t,this.uiList=[]},mbox.Controller.prototype={_init:function(){},bindUi:function(e,i){if(t(this.uiList,e)>-1||!e)return!1;if(i&&this.uiList.length>0)for(var n=this.uiList.length;n;n--)this.unbindUi(this.uiList[n-1]),this.uiList.splice(n-1,1);this.bindPlayerEvent(this.playctrl,e),this.bindSongInfoEvent(this.playctrl,e),this.bindPlayListEvent(this.playctrl,e),this.bindUIEvent(this.playctrl,e),this.uiList.push(e);var s=this.playctrl.player;return this._onPosition(e,s.getCurrentPosition()),this._onProgress(e,s.getLoadedPercent()),this._onState(e,s.getState()),e.setActive(!0),e.fireVolChange(e.volume,!e.volume),!0},unbindUi:function(t){var e,i=playctrl.player,n=t.guid,s=i.EVENTS,a=t.EVENTS;for(e in s)s.hasOwnProperty(e)&&i.removeEventListener(s[e]+"."+n);for(e in a)a.hasOwnProperty(e)&&t.removeEventListener(a[e]+"."+n);playctrl.removeEventListener("fetch:link."+n),t.setActive(!1)},bindPlayListEvent:function(){},bindPlayerEvent:function(t,e){var i=t.player,n=e.guid;i.setEventListener(i.EVENTS.POSITIONCHANGE,T.fn.bind(function(t){this._onPosition(e,t.position)},this),n),i.setEventListener(i.EVENTS.PROGRESS,T.fn.bind(function(t){this._onProgress(e,t.progress)},this),n),i.setEventListener(i.EVENTS.STATECHANGE,T.fn.bind(function(t){this._onState(e,t.newState)},this),n)},bindSongInfoEvent:function(t,e){t.addEventListener("fetch:link",T.fn.bind(function(t){this._onSongInfo(e,t.song)},this),e.guid)},bindUIEvent:function(t,e){var i=t.player;e.addEventListener(e.EVENTS.POSITIONCHANGE,function(e){i.setCurrentPosition(t.getTotalTime()*e.percent)},e.guid),e.addEventListener(e.EVENTS.VOLCHANGE,function(t){i.setVolume(t.volume)},e.guid),e.addEventListener(e.EVENTS.TOGGLEPLAY,function(e){t.player[e.isPlay?"play":"pause"]()},e.guid),e.addEventListener(e.EVENTS.MUTECHANGE,function(t){i.setMute(t.mute)},e.guid)},_onSongInfo:function(t,e){if(t.widget.title){var i=t.createSongFilter(e);i.songName&&"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6"!==i.songName?t.widget.title.removeClass("grey"):t.widget.title.addClass("grey"),t.widget.title.html(baidu.template(t.widget.title.tpl,i))}if(t.widget.lrc&&e&&mbox.SongDataModel.getLrcContent(e,{success:function(e){t.widget.lrc.lrc("setLrc",e)},error:function(){t.widget.lrc.lrc("setLrc","")}}),t.widget.album){t.widget.album.html(baidu.template(t.widget.album.tpl,e));var n=t.widget.album.find("img");if(!n[0].src){var s=n.attr("data-src");s&&n.attr("src",s)}}if(t.widget.time){var a=this.playctrl.getTotalTime();t.widget.time.html(baidu.template(t.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(a)}))}},_onPosition:function(t,e){var i=this.playctrl.getTotalTime();t.widget.slider&&!t.widget.slider.isSliding&&t.widget.slider.box_slider("option","value",e*t.widget.slider.maxValue/i||0),t.widget.lrc&&t.widget.lrc.lrc("scrollTo",e),t.widget.time&&t.widget.time.html(baidu.template(t.widget.time.tpl,{curTime:mbox.convertTime(e),totalTime:mbox.convertTime(i)}))},_onProgress:function(t,e){t.widget.slider&&!t.widget.slider.sliding&&t.widget.slider.box_slider("progress",e*t.widget.slider.maxValue)},_onState:function(t,e){if(t.widget.playBtn){var i=this.playctrl.player;playing=e===i.STATES.PLAY||e===i.STATES.PREBUFFER||e===i.STATES.BUFFERING,playing?t.widget.playBtn.removeClass("stop"):t.widget.playBtn.addClass("stop")}}}}(window);
;_.Module.define({path:"common/widget/MusicPlayer",requires:[],sub:{initial:function(t,i){window.playctrl||(window.playctrl=new window.mbox.PlayCtrl),this.api=window.playctrl.exportAPI(),this.log=window.playctrl.log,this.controller=new window.mbox.Controller(window.playctrl),this.logList={"song-name a":"song_title","artist-name a":"artist_name","album-name a":"album_name",logo:"logo","lrc-btn":"lrc","download-btn":"download","go-to-listen-btn":"to_musicbox"},this.ui=[];for(var o=0;o<t.length;o++)this.mboxInit(i[o],t[o],o);this.eventInit()},mboxInit:function(t,i,o){var n=this.ui,e=this.logList,a=this.log,l=this.api,s=this.controller;if(n[o]=new window.mbox.UiCtrl($(t)),"object"!=typeof i){var r=window.mbox.SongDataModel.createSongModel(i);window.mbox.SongDataModel.fetchSong(r[0],{success:function(i){n[o].tplToHtml(i,t,e,a),n[o].setShowLink(i,t)}})}else 1!=i.hasLink&&(i={hasLink:!0,songId:i.song_id,songName:i.title,artistId:i.ting_uid,artistName:i.author,albumId:i.album_id,albumName:i.album_title,songPicBig:i.pic_big,songPicSmall:i.pic_small,songPicRadio:i.pic_radio,resourceType:i.resource_type,relateStatus:i.relate_status,copyType:i.copy_type,lrcLink:i.lrclink,rate:i.file_bitrate,songLink:i.file_link,showLink:i.show_link,format:i.file_extension,size:i.file_size,time:i.file_duration}),n[o].tplToHtml(i,t,e,a),n[o].setShowLink(i,t);l.addSong(i),$(t).find(".ctrl-btn").click(function(){function i(t){return function(){s.bindUi(n[t],!0),l.setPlayIndex(t,!0)}}if($(t).find(".mbox-time").addClass("red_text"),!n[o].$root.hasClass("active")){window.playctrl.player.stop();var e=i(o);setTimeout(e,100)}})},eventInit:function(){$(document).delegate(".add-favour","click",function(){var t=this,i=$(this).parents(".right-top").find($(".song-name")).tbattr("songid"),o="https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.favorite.addSongFavorite&from=tieba";$.getJSON(o+"&callback=?",{songId:i},function(i){var o=i.error_code;22e3===o||22322===o?$(t).addClass("add-favour-red"):22452===o&&_.Module.use("common/widget/LoginDialog",["",""])})}).delegate(".lrc-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+t+"#song_lyric")}).delegate(".download-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+t+"/download")}).delegate(".go-to-listen-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com//box?&&__methodName=mboxCtrl.playSong&__argsValue="+t)})}}});