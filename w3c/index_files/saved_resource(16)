_.Module.define({path:"encourage/widget/firework",requires:["encourage/widget/firework/fireworkTemplate","tbmall/widget/TbeanSafeAjax"],sub:{$btn:$(".j_firework_sender"),fireworkUnits:{},dialog:null,_buyFireworkUrl:"/tbmall/submit/giftpkg/buyGiftPkg",_getFireworkUrl:"/tbmall/submit/giftpkg/getBonus",_likeForumUrl:"/f/like/commit/add",_likeUserUrl:"/home/post/follow",_productType:"frs"===PageData.page?0:1,_productId:"frs"===PageData.page?PageData.forum.forum_id:PageData.thread.thread_id,scores:PageData.user.Parr_scores&&PageData.user.Parr_scores.scores_total,FIREWORK_PRICE:99e3,FIREWORK_TYPE_99:0,FIREWORK_UNIT_COUNT:8,ERROR_TIP_MAP:{220012:"\u68C0\u6D4B\u5230\u60A8\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\uFF0C\u8BF7\u89E3\u7981\u540E\u91CD\u8BD5",220034:"\u60A8\u62A2\u5F97\u592A\u9891\u7E41\u5566\uFF0C\u8FD9\u6B21\u5C31\u8BA9\u4E00\u8BA9\u5176\u4ED6\u5C0F\u4F19\u4F34\u5427",2270055:"T\u8C46\u5DF2\u88AB\u62A2\u5149\uFF0C\u4E0B\u6B21\u8981\u773C\u75BE\u624B\u5FEB\u54E6",2270056:"\u6BCF\u4E2A\u70DF\u82B1\u53EA\u80FD\u6361\u4E00\u6B21\u54E6\uFF0C\u53BB\u6C42\u571F\u8C6A\u7EE7\u7EED\u53D1\u5427",2270057:"T\u8C46\u5DF2\u88AB\u62A2\u5149\uFF0C\u4E0B\u6B21\u8981\u773C\u75BE\u624B\u5FEB\u54E6",2270058:"\u5C0F\u4F19\u4F34\u592A\u591A\u6211\u6491\u4E0D\u4F4F\u5566\uFF0C\u5F85\u4F1A\u518D\u6765\u561B",9999990:"\u5173\u6CE8\u6210\u529F"},waitToPlayList:[],isPlayingSwf:!1,initial:function(e){this.tpl=this.requireInstance("encourage/widget/firework/fireworkTemplate"),this.banner_link=PageUnit.load("firework_banner_link"),this.banner_src=PageUnit.load("firework_banner_src"),this.button_link=PageUnit.load("firework_button_link"),this.button_txt=PageUnit.load("firework_button_txt"),this.firework_link=PageUnit.load("firework_firework_link"),this.skinConfig=e.skinConfig,this.renderPreFireworks(e.fireworks),this.bindEvents()},renderPreFireworks:function(e){if($.isArray(e))for(var i=0,t=e.length;t>i;i++){var o=this.fireworkManager(e[i].package_id);o?1==o&&this.renderFirework(e[i]):this.showFireworkSwf(e[i])}},bindEvents:function(){var e=this,i=$("body");this.observe("play.firework",function(i,t){t.location_type==e._productType&&t.location_id==e._productId&&e.showFireworkSwf(t)}),this.observe("buy.firework",function(){e.buyFirework()}),this.$btn.on("click",function(){return PageData.user.is_login?e.showFireworkDialog():e.requireInstanceAsync("common/widget/LoginDialog"),!1}).on("mouseover",function(){$(this).css("backgroundPosition","0 -50px")}).on("mouseout",function(){$(this).css("backgroundPosition","0 0")}),i.on("click",".j_firework_unit",function(){var i=$(this).tbattr("data-firework-id");PageData.user.is_login||e.requireInstanceAsync("common/widget/LoginDialog");var t=function(o){$.tb.post(e._getFireworkUrl,$.extend({package_id:i,forum_name:PageData.forum.forum_name,tbs:PageData.tbs,location_id:e._productId,location_type:e._productType,forum_id:PageData.forum.forum_id},o),function(o){if(0==o.no&&o.data.scores>0)e.removeFirework(i),e.showTdouTip(o);else switch(o.no){case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 220040:e.requireInstanceAsync("common/component/CaptchaDialog",{message:o.data.str_reason,vCode:o.data.captcha_vcode_str,vCodeType:o.data.captcha_code_type,title:"\u83B7\u53D6\u70DF\u82B1\u9A8C\u8BC1\u7801",checkUrl:"/tbmall/submit/giftpkg/checkVcode",vCodeUrl:"/tbmall/submit/giftpkg/getVcode",paramsCallback:function(){return{tbs:PageData.tbs||PageData.user.tbs}}},function(e){e.bind("onclose",function(){e.hide()}),e.bind("onaccept",function(){var i={captcha_input_str:e.getInputValue(),captcha_vcode_str:e.getVCode()};t(i)})});break;default:e.showTdouTip(o),e.removeFirework(i)}},"json")};t()})},showTdouTip:function(e){var i=e.data||{ulike:1,flike:1},t=e.no,o=this.ERROR_TIP_MAP[t]||"\u670D\u52A1\u5668\u62BD\u98CE\u4E86",r=this,n=i.scores,a=i.ulike&&i.flike,s="\u5173 \u95ED",l=this.button_txt,c=$.tb.format(this.tpl.getTdouTipBannerTpl(),{banner_link:this.banner_link,banner_src:this.banner_src});switch(a||(l="\u4E00\u952E\u5173\u6CE8",s="\u6B8B\u5FCD\u62D2\u7EDD",c=this.tpl.getTdouTipAttentionBannerTpl()),String(t)){case"0":o='\u606D\u559C\u4F60\u6361\u5230<span class="got_tdou">'+i.uname+'</span>\u6492\u843D\u7684<span class="got_tdou">'+n+"</span>T\u8C46";break;case"2270055":o="\u624B\u6162\u4E86\uFF0C<span class='got_tdou'>"+i.uname+"</span>\u6492\u843D\u7684T\u8C46\u5DF2\u88AB\u62A2\u5149"}var u=new $.dialog({html:$.tb.format(this.tpl.getTdouTipTpl(),{text:o,username:i.uname,score:n,banner:c,button_link:this.button_link,button_txt:l,close_txt:s}),width:420,noTitle:!0});u.element.find(".j_close_btn").one("click",function(){return u.close(),!1}),a||u.element.find(".j_firework_attention_btn").one("click",function(e){e.preventDefault(),r.likeForumAndUser(i.uname),u.close()})},showFireworkDialog:function(){var e=this;this.dialog=new $.dialog({holderClassName:"firework_buy_dialog",title:e.skinConfig.title,width:e.skinConfig.width,height:e.skinConfig.height,closeable:!1,html:$.tb.format(e.tpl.getDialogTpl(),{firework_link:this.firework_link,preview_style:PageUnit.load("firework_preview_style"),buy_style:PageUnit.load("firework_buy_style"),close_style:PageUnit.load("firework_close_style"),table_style:PageUnit.load("firework_table_style"),extra:PageUnit.load("firework_extra")})}),this.dialog.element.css("background","url("+PageUnit.load("firework_dialog_bg")+") no-repeat");var i=this.dialog.element.find(".j_preview_btn"),t=this.dialog.element.find(".j_buy_btn"),o=this.dialog.element.find(".j_close_btn"),r=i.height(),n=t.height(),a=o.height();i.one("click",function(){return e.dialog.close(),e.showFireworkSwf({user_name:PageData.user.user_name,preview:!0}),e.fire("firework.global_preview"),!1}).on("mouseover",function(){$(this).css("backgroundPosition","0 -"+r+"px")}).on("mouseout",function(){$(this).css("backgroundPosition","0 0")}),t.one("click",function(){return e.dialog.close(),e.scores<e.FIREWORK_PRICE?e.requireInstanceAsync("common/widget/tcharge_dialog"):e.buyFirework(),!1}).on("mouseover",function(){$(this).css("backgroundPosition","0 -"+n+"px")}).on("mouseout",function(){$(this).css("backgroundPosition","0 0")}),o.one("click",function(){return e.dialog.close(),!1}).on("mouseover",function(){$(this).css("backgroundPosition","0 -"+a+"px")}).on("mouseout",function(){$(this).css("backgroundPosition","0 0")}),e.renderRank(this.dialog.element)},buyFirework:function(){var e=this,i=this.requireInstance("tbmall/widget/TbeanSafeAjax");i.post(e._buyFireworkUrl,{location_id:e._productId,location_type:e._productType,gift_pkg_type:e.FIREWORK_TYPE_99,tbs:PageData.tbs,forum_name:PageData.forum.forum_name,forum_id:PageData.forum.forum_id,ie:"utf8"},function(i){0==i.no?(e.fire("firework.global_notice",$.extend({},i.data,{forum_name:PageData.forum.forum_name,location_id:e._productId,location_type:e._productType,scores:5e4,user_name:PageData.user.user_name,portrait:PageData.user.portrait,msg_type:1e4})),e.showFireworkSwf(i.data)):2270005==i.no&&e.requireInstanceAsync("common/widget/tcharge_dialog")},"json")},renderFirework:function(e){function i(e,i){return Math.random()*(i-e)+e}var t,o,r=$(),n=+new Date,a=e.package_id,s=e.end_time,l=this;if(!(a&&this.fireworkManager(a)>1||this.fireworkUnits[a]||n/1e3>s)){for(var c=0,u=this.FIREWORK_UNIT_COUNT;u>c;c++)t=$('<div class="firework_unit j_firework_unit" data-firework-id="'+a+'">'),t.css({marginTop:i(-200,200),marginLeft:i(-300,300)}),r=r.add(t);$("body").append(r),o=setTimeout(function(){l.removeFirework(a)},1e3*s-n),this.fireworkUnits[a]={},this.fireworkUnits[a].elements=r,this.fireworkUnits[a].timeout_id=o}},removeFirework:function(e){this.fireworkUnits[e]&&(this.fireworkUnits[e].elements.remove(),clearTimeout(this.fireworkUnits[e].timeout_id),delete this.fireworkUnits[e],this.fireworkManager(e,2))},fireworkManager:function(e,i){var t=$.parseJSON($.tb.Storage.get("fireworks"));if(t||(t=[]),"undefined"==typeof i){var o=null;return $.each(t,function(i,t){return t.pid==e?(o=t.v,!1):void 0}),o}var r=!1;$.each(t,function(t,o){return o.pid==e?(o.v=i,r=!0,!1):void 0}),r||(t.length>200&&(t=t.slice(-200)),t.push({pid:e,v:i})),$.tb.Storage.set("fireworks",$.json.encode(t),+new Date+31536e6)},closeFlash:function(){$("#firework_swf_ctn").remove(),this.flash=null,this.isPlayingSwf=!1},showFireworkSwf:function(e){var i=this,t=e.end_time,o=+new Date;if(!(e.package_id&&this.fireworkManager(e.package_id)>0||o/1e3>t))if(this.isPlayingSwf)i.waitToPlayList.push(e);else{this.isPlayingSwf=!0;var r=$('<div id="firework_swf_ctn" class="firework_swf_ctn"></div>');$("body").append(r),e.package_id&&this.fireworkManager(e.package_id,1);var n=PageUnit.load("firework_swf");this.flash=new $.swf(n,{id:"firework",container:"#firework_swf_ctn",width:980,height:470,vars:{user_name:e.user_name+"\u653E\u7684"+i.skinConfig.item},callBacks:{closeFlash:_.throttle(function(){if(i.closeFlash(),e.preview)i.showFireworkDialog(),i.fire("firework.global_preview_close");else{i.renderFirework(e);var t=i.waitToPlayList.shift();t&&i.showFireworkSwf(t)}},3e3)}})}},renderRank:function(e){var i=this;$.get("/minigame/rank/getRank",{t:(new Date).getTime()},function(t){if(t="object"==typeof t?t:$.parseJSON(t),0==t.no){var o=t.data.fireworks,r=i.tpl.getFireworkRankTpl(),n=baidu.template(r,{rank:o});e.find(".j_firework_rank_body").html(n)}})},likeForumAndUser:function(e){var i=this,t=PageData.tbs,o=PageData.forum.forum_id,r=PageData.forum.forum_name,n=$.tb.post(this._likeForumUrl,{fid:o,fname:r,tbs:t}),a=$.tb.post(this._likeUserUrl,{un:e,tbs:t});$.when(n,a).then(function(){i.showTdouTip({no:"9999990",data:{ulike:1,flike:1}})})}}});
;_.Module.define({path:"encourage/widget/firework/fireworkTemplate",sub:{_dialogTpl:{general:['<a href="#" class="btn_preview j_preview_btn" style="#{preview_style}"></a>','<a href="#" class="btn_buy j_buy_btn" style="#{buy_style}"></a>','<a href="#" class="btn_close j_close_btn" style="#{close_style}"></a>',"#{extra}",'<div class="firework_rank_body j_firework_rank_body" style="#{table_style}"></div>'].join("")},_buyDialogTpl:["<div>","\u6B63\u5728\u8D2D\u4E70","</div>"].join(""),_tdouTipResultTpl:['\u606D\u559C\u4F60\u6361\u5230<span class="got_tdou">#{username}</span>\u6492\u843D\u7684<span class="got_tdou">#{score}</span>T\u8C46'],_tdouTipTpl:['<div class="get_tdou_tip">','<p class="result">#{text}</p>',"#{banner}",'<div class="btn_wrap">','<a href="#{button_link}" locate="\u70DF\u82B1\u5E7F\u544A\u6309\u94AE#\u653E\u70DF\u82B1\u7EDF\u8BA1" target="_blank" class="ui_btn ui_btn_m button_link j_firework_attention_btn">',"<span><em>#{button_txt}</em></span>","</a>",'<a href="#" class="ui_btn ui_btn_sub_m j_close_btn">',"<span><em>#{close_txt}</em></span>","</a>","</div>","</div>"].join(""),_tdouTipBannerTpl:['<a href="#{banner_link}" locate="\u70DF\u82B1\u5E7F\u544A\u56FE#\u653E\u70DF\u82B1\u7EDF\u8BA1" target="_blank" class="banner_link">','<img src="#{banner_src}" />',"</a>"].join(""),_tdouTipAttentionBannerTpl:['<p class="firework_attention_tip">\u5173\u6CE8\u672C\u5427\u548C\u6492\u94B1\u5927\u58D5\uFF0C\u4F1A\u66F4\u5BB9\u6613\u62A2\u5230\u8C46\u5B50\u54E6</p>'].join(""),_tdouErrorTipTpl:['<div class="get_tdou_tip">','<p class="result">#{text}</p>',"#{banner}",'<div class="btn_wrap">','<a href="#{button_link}" locate="\u70DF\u82B1\u5E7F\u544A\u6309\u94AE#\u653E\u70DF\u82B1\u7EDF\u8BA1" target="_blank" class="ui_btn ui_btn_m button_link j_firework_attention_btn">',"<span><em>#{button_txt}</em></span>","</a>",'<a href="#" class="ui_btn ui_btn_m j_close_btn">',"<span><em>#{close_txt}</em></span>","</a>","</div>","</div>"].join(""),_fireworkRankTpl:["<table>",'<tr><td width="40">&nbsp;</td><td width="120">&nbsp;</td><td width="30">&nbsp;</td></tr>',"<% for (var i = 0, len = rank.length; i < len; i++) { %>","<tr>","<td><%=i + 1%></td>","<td>",'<a data-field="<%=$.json.encode({un: rank[i][\'user_name\']})%>" href="/home/main?id=<%=rank[i][\'portrait\']%>" target="_blank"><span><%=rank[i]["user_name"]%></span></a>',"</td>",'<td align="center"><%=rank[i]["win"]%></td>',"</tr>","<% } %>","</table>"].join(""),initial:function(){},getDialogTpl:function(){return this._dialogTpl.general},getBuyDialogTpl:function(){return this._buyDialogTpl},getTdouTipTpl:function(){return this._tdouTipTpl},getTdouTipBannerTpl:function(){return this._tdouTipBannerTpl},getTdouTipAttentionBannerTpl:function(){return this._tdouTipAttentionBannerTpl},getTdouErrorTipTpl:function(){return this._tdouErrorTipTpl},getFireworkRankTpl:function(){return this._fireworkRankTpl}}});_.Module.define({path:"encourage/widget/globalNotice",requires:["encourage/widget/globalMessage/barrage","encourage/widget/novel_icons"],sub:{intervalId:null,waitToRollList:[],showedFireworkMap:{},pkgIds:[],viewTotalNum:0,fireworkList:[],locationId:PageData.thread.thread_id,locationType:"frs"===PageData.page?0:1,messageTplMap:{1e4:['<div class="global_notice_unit">','<a  href="#{href}" target="_blank">','#{user_name}\u6B63\u5728<span class="forum_name">[#{forum_name}\u5427]</span>\u653E#{item}\uFF0C','  \u6389\u843D<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>','<span class="get_firework_icon"></span></a>',"</div>"].join(""),10001:['<div class="global_notice_unit">','<a  href="#{href}" target="_blank">','#{user_name}\u5728<span class="forum_name">[#{forum_name}\u5427]</span>','\u6361\u5230<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>',"</a>","</div>"].join(""),10002:['<div class="global_notice_unit">','<a  href="/f?kw=t%E8%B1%86%E5%A8%B1%E4%B9%90%E5%9F%8E&ie=utf-8" target="_blank">','#{user_name}\u5728<span class="forum_name">[#{game_name}]</span>\u6E38\u620F\u4E2D\u5927\u80DC\uFF0C','\u8D62\u53D6\u4E86<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>',"</a>","</div>"].join(""),10003:['<div class="global_notice_unit">','<a  href="/f?kw=#{forum_name}&ie=utf-8" target="_blank">','#{user_name}\u5728<span class="forum_name">[#{forum_name}\u5427]</span>','\u53D1\u5E03<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>',"\u7684\u3010#{bonus_name}\u3011\u7EA2\u5305#{bonus_num}\u4E2A","</a>","</div>"].join(""),10004:['<div class="global_notice_unit">','<a  href="http://spread.xiu8.com/spreed!baiduGo.jspa?pid=1072&sid=104&t=2&roomId=#{live_id}" target="_blank">','<span class="forum_name">#{user_name}</span>\u699C\u4E0A\u6709\u540D\uFF0C\u4E00\u63B7\u5343\u91D1\u5E7F\u53D1T\u8C46\u3001\u798F\u888B\uFF01','<span class="get_firework_icon"></span></a>',"</a>","</div>"].join(""),10005:['<div class="global_notice_unit">','<a href="/f?kw=#{forum_name}&ie=utf-8" target="_blank">','<span class="forum_name">[#{forum_name}\u5427]</span>','\u53D1\u5E03<span class="tdou_num">#{bonus_num}</span>\u4E2A',"\u73B0\u91D1\u7EA2\u5305","</a>","</div>"].join(""),10006:['<div class="global_notice_unit">','<a href="/f?kw=#{forum_name}&ie=utf-8" target="_blank">','\u4E07\u4EBA\u819C\u62DC\uFF0C\u606D\u559C <span class="forum_name">#{reader_name}</span> \u6210\u4E3A',' <span class="forum_name">[#{forum_name}]</span> \u5427\u7B2C#{level_count}\u4F4D','<i class="novel-level-icon global-novel-notice novel-level-#{fans_level}"></i>',"</a>","</div>"].join(""),10007:['<div class="global_notice_unit">','<a href="/p/#{thread_id}?from_notice=1" target="_blank">','\u4E07\u4EBA\u819C\u62DC\uFF0C<span class="forum_name">#{reader_name}</span>\u4E3A<span class="forum_name">[#{forum_name}\u5427]</span>\u6295\u7968#{month_ticket}\u5F20\uFF0C','<span class="forum_name">\u8D34\u5427\u798F\u5229\u9001\u9001\u9001\uFF01</span><span class="get_firework_icon"></span>',"</a>","</div>"].join(""),10008:['<div class="global_notice_unit">','<a  href="#{href}" target="_blank">','#{user_name}\u6B63\u5728<span class="forum_name">[#{forum_name}\u5427]</span>\u653E#{item}\uFF0C','  \u6389\u843D<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>','<span class="get_firework_icon"></span></a>',"</div>"].join("")},statusTplMap:['<div id="firework_status" class="firework_status_wrap">','<div class="user_info">','<div class="photo">','<img src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/#{portrait}" width="72" height="72" />',"</div>",'<div class="name_and_tdou">','<p class="name">#{user_name}</p>','<p class="tdou">','<i class="icon_tdou"></i>','<span class="j_user_scores">#{user_scores}</span>','<a href="javascript:;" class="j_buy_tdou"> [\u83B7\u53D6]</a>',"</p>","</div>","</div>",'<div class="firework_info">','<p>\u60A8\u4F4D\u4E8E#{item}\u8FBE\u4EBA\u699C\u7B2C<span class="orange_text">#{rank}</span>\u4F4D</p>',"</div>",'<div class="firework_operate">','<a href="javascript:;" class="btn_repeat j_btn_repeat"></a>',"</div>",'<a href="javascript:;" class="btn_close j_close"></a>',"</div>"].join(""),statusTplMapV2:['<div id="firework_status" class="firework_status_wrap">','<div class="user_info">','<div class="photo">','<img src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/#{portrait}" width="72" height="72" />',"</div>",'<div class="name_and_tdou">','<p class="name">#{user_name}</p>','<p class="tdou">','<i class="icon_tdou"></i>','<span class="j_user_scores">#{user_scores}</span>','<a href="javascript:;" class="j_buy_tdou"> [\u83B7\u53D6]</a>',"</p>","</div>","</div>",'<div class="firework_info">','<p>\u60A8\u4F4D\u4E8E#{item}\u8FBE\u4EBA\u699C\u7B2C<span class="orange_text">#{rank}</span>\u4F4D</p>',"</div>",'<div class="firework_operate">','<a href="javascript:;" class="btn_repeat j_btn_repeat"></a>',"</div>",'<a href="javascript:;" class="btn_close j_close"></a>',"</div>"].join(""),initial:function(e){var t=this,s=PageUnit.load("firework_dialog_options"),a=s.split("|");this.fireworkOptions={width:a[0],height:a[1],item:a[2]},this.isFireworkV2=e.isFireworkV2,this.$notice=$("#global_notice_wrap"),this.barrage=this.requireInstance("encourage/widget/globalMessage/barrage"),this.barrage.init(this.$notice,{speed:2,foldSpeed:15,unfoldSpeed:10,rowCount:1,rowHeight:50,scrollElementMaxLength:100,elementMarginLeft:20,containerWidth:980,containerMarginLeft:-490}),this.startPolling(),window.jsonpGlobalMessageHandler=function(e){return function(t){e.globalMessageHandler(t)}}(this),this.observe("fireworkv2.global_notice",function(e,s){t.showFireworkStatusV2(s)}),this.observe("firework.global_notice",function(e,s){var a=t.buildMessage(s);a&&t.showMessageBar($(a)),t.showFireworkStatus(s)}),this.$notice.on("click",function(){var e=$(this).data("type");$.stats.track("\u5168\u5C40\u516C\u544A\u533A\u57DF\u70B9\u51FB\u91CF_"+e,"firework_activity")}),this.observe("firework.global_preview",function(){t.previewFireworkStatus()}),this.observe("firework.global_preview_close",function(){t.previewFireworkStatusClose()}),this.observe("firework.polling",function(){t.pollingAtOnce()})},startPolling:function(){var e=this;$(document).idleTimer(6e4),$(document).on("idle.idleTimer",function(){e.pausePolling()}),$(document).on("active.idleTimer",function(){e.polling()}),e.$notice.on("mouseenter",function(){e.barrage.pause()}).on("mouseleave",function(){e.barrage.resume()}),e.polling()},polling:function(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(function(){$.getScript("//tbmsg.baidu.com/gmessage/get?mtype=1")},1e4),$.getScript("//tbmsg.baidu.com/gmessage/get?mtype=1")},pollingAtOnce:function(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(function(){$.getScript("//tbmsg.baidu.com/gmessage/get?mtype=1")},1e4),$.getScript("//tbmsg.baidu.com/gmessage/get?mtype=1")},pausePolling:function(){this.intervalId&&clearInterval(this.intervalId)},globalMessageHandler:function(e){var t,s,a=$.tb.Storage.get("global_message_cid"),i=0,n=this,o=0||$.tb.Storage.get("global_message_update_time"),r=[],l=0;if(s=n.fireworkList.length,s>0){var c;for(c=[],t=0;s>t;t++)1e3*n.fireworkList[t].msg_body.fire_start_time<=+new Date?n.handleSingleMessage(n.fireworkList[t]):c.push(n.fireworkList[t]);n.fireworkList=c}if($.isArray(e)){for(t=0,s=e.length;s>t;t++)if(10008!==e[t].msg_body.msg_type)e[t].msg_id=+e[t].msg_id,a<e[t].msg_id&&(i=i>e[t].msg_id?i:e[t].msg_id,n.handleSingleMessage(e[t]));else{if(!n.isFireworkV2)continue;e[t].msg_body.fire_pic=e[t].msg_body.fire_pic.replace(/^http:/,""),e[t].msg_body.fire_animatic=e[t].msg_body.fire_animatic.replace(/^http:/,""),e[t].msg_body.fire_update_time>o&&(1!==e[t].not_set_fire&&e[t].msg_body.location_id===n.locationId&&e[t].msg_body.location_type===n.locationType&&r.push(e[t]),1e3*e[t].msg_body.fire_start_time>+new Date?n.fireworkList.push(e[t]):n.handleSingleMessage(e[t]),l=o>e[t].msg_body.fire_update_time?o:e[t].msg_body.fire_update_time)}i>a&&$.tb.Storage.set("global_message_cid",i,+new Date+31536e6)}0!==r.length&&n.fire("firework.add_firework",JSON.stringify(r)),l&&$.tb.Storage.set("global_message_update_time",l,+new Date+6e5)},handleSingleMessage:function(e){var t,s=+new Date,a=e.end_time||e.msg_body.fire_end_time;1e3*a>s&&(t=this.buildMessage(e.msg_body),t&&this.showMessageBar(t))},buildMessage:function(e){function t(e){var t="";return t="undefined"==typeof e.location_type?"javascript:void(0);":0==e.location_type?"/f?kw="+encodeURIComponent(e.forum_name):"/p/"+e.location_id}function s(e){if(e>9999){var t=e%1e4!==0?(e/1e4).toFixed(1):e/1e4;return t+"\u4E07"}return e}var a=+new Date,i=this,n=this.messageTplMap[e.msg_type];if(e.scores=s(e.scores),n){if(e.end_time&&1e3*e.end_time<a)return;if(1e4==e.msg_type){if(i.showedFireworkMap[e.package_id])return;i.showedFireworkMap[e.package_id]=1,this.fire("play.firework",e)}else if(10001==e.msg_type)this.fire("get.firework",e);else if(10002==e.msg_type&&1!=PageUnit.load("global_notice_game_switch"))return;return this.$notice.data("type",e.msg_type),$($.tb.format(n,$.extend(e,{href:t(e)},this.fireworkOptions)))}},showMessageBar:function(e){this.barrage.addMessage(e)},previewFireworkStatus:function(){var e=$("#firework_status");if(0==e.length){var t=$.tb.format(this.statusTplMap,$.extend({portrait:PageData.user.portrait,user_name:PageData.user.user_name,user_scores:PageData.user.Parr_scores&&PageData.user.Parr_scores.scores_total||0,rank:1},this.fireworkOptions));e=$(t).insertAfter(this.$notice)}e.find(".j_view_num").text(9321332),e.find(".j_user_num").text(2321301),e.animate({bottom:0});var s={forum_name:PageData.forum.forum_name,location_id:this.locationId,location_type:this.locationType,scores:"5\u4E07",user_name:PageData.user.user_name,portrait:PageData.user.portrait,msg_type:1e4,item:"\u70DF\u82B1"},a=this.messageTplMap[s.msg_type];this.showMessageBar($($.tb.format(a,$.extend(s,this.fireworkOptions))))},previewFireworkStatusClose:function(){var e=$("#firework_status");e.length>0&&e.remove()},showFireworkStatus:function(e){this.pkgIds.push(e.package_id);var t=this,s=$("#firework_status");if(0==s.length){var a=$.tb.format(this.statusTplMap,$.extend(e,this.fireworkOptions));s=$(a).insertAfter(this.$notice),s.find(".j_close").on("click",function(){s.animate({height:0},300,function(){s.remove(),t.pkgIds.length=0})}),s.find(".j_btn_repeat").on("click",function(){t.fire("buy.firework")}),s.find(".j_buy_tdou").on("click",function(){t.requireInstanceAsync("common/widget/tcharge_dialog")})}else s.find(".j_user_scores").text(e.user_scores);s.animate({bottom:0}),this.increaseViewNum(s.find(".j_view_num"),this.viewTotalNum,this.viewTotalNum+=e.view),this.pollingVisitNum(s.find(".j_user_num"),this.pkgIds.length)},showFireworkStatusV2:function(e){var t=this,s=$("#firework_status");if(0==s.length){var a=$.tb.format(this.statusTplMapV2,$.extend(e,this.fireworkOptions));s=$(a).insertAfter(this.$notice),s.find(".j_close").on("click",function(){s.animate({height:0},300,function(){s.remove(),t.pkgIds.length=0})}),s.find(".j_btn_repeat").on("click",function(){t.fire("buy.firework")}),s.find(".j_buy_tdou").on("click",function(){t.requireInstanceAsync("common/widget/tcharge_dialog")})}else s.find(".j_user_scores").text(e.user_scores);s.animate({bottom:0})},pollingVisitNum:function(e,t){var s=this,a=0,i=function(){a>30||s.pkgIds.length>t||setTimeout(function(){$.post("/tbmall/submit/giftpkg/getView",{pids:s.pkgIds.toString()},function(t){0==t.no&&e.text(t.data.uv)}),a++,i()},1e3)};i()},increaseViewNum:function(e,t,s){var a=this,i=function(t,i){var n=a.easeOutQuint(t,i,s,3e4);e.text(parseInt(n,10))},n=0,o=function(){n>30||a.viewTotalNum>s||setTimeout(function(){n++,i(1e3*n,t),o()},1e3)};o()},easeOutQuint:function(e,t,s,a){return e/=a,e--,s*(e*e*e*e*e+1)+t}}});
;!function(e){e.idleTimer=function(i,t){var n,r=function(){var e,i=function(e,i){return""!==e?e+i.slice(0,1).toUpperCase()+i.slice(1):i},t=function(){var t=!1;return"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(n){0==t&&void 0!=document[i(n,"hidden")]&&(e=n,t=!0)}),t}(),n=function(){return t?document[i(e,"hidden")]:void 0},r=function(){return t?document[i(e,"visibilityState")]:void 0};return{hidden:n(),visibilityState:r(),visibilitychange:function(i,d){return d=!1,t&&"function"==typeof i?document.addEventListener(e+"visibilitychange",function(e){this.hidden=n(),this.visibilityState=r(),i.call(this,e)}.bind(this),d):void 0}}}(void 0);"object"==typeof i?(n=i,i=null):"number"==typeof i&&(n={timeout:i},i=null),t=t||document,n=e.extend({idle:!1,timeout:3e4,events:"mousemove keydown wheel DOMMouseScroll mousewheel mousedown touchstart touchmove MSPointerDown MSPointerMove"},n);var d=e(t),u=d.data("idleTimerObj")||{},a=function(i){var n=e.data(t,"idleTimerObj")||{};n.idle=!n.idle,n.olddate=+new Date;var r=e.Event((n.idle?"idle":"active")+".idleTimer");e(t).trigger(r,[t,e.extend({},n),i])},l=function(i){var n=e.data(t,"idleTimerObj")||{};if(null==n.remaining){if("mousemove"===i.type){if(i.pageX===n.pageX&&i.pageY===n.pageY)return;if("undefined"==typeof i.pageX&&"undefined"==typeof i.pageY)return;var r=+new Date-n.olddate;if(200>r)return}clearTimeout(n.tId),n.idle&&a(i),n.lastActive=+new Date,n.pageX=i.pageX,n.pageY=i.pageY,n.tId=setTimeout(a,n.timeout)}},o=function(){var i=e.data(t,"idleTimerObj")||{};i.idle=i.idleBackup,i.olddate=+new Date,i.lastActive=i.olddate,i.remaining=null,clearTimeout(i.tId),i.idle||(i.tId=setTimeout(a,i.timeout))},m=function(){var i=e.data(t,"idleTimerObj")||{};null==i.remaining&&(i.remaining=i.timeout-(+new Date-i.olddate),clearTimeout(i.tId))},f=function(){var i=e.data(t,"idleTimerObj")||{};null!=i.remaining&&(i.idle||(i.tId=setTimeout(a,i.remaining)),i.remaining=null)},c=function(){var i=e.data(t,"idleTimerObj")||{};clearTimeout(i.tId),d.removeData("idleTimerObj"),d.off("._idleTimer")},s=function(){var i=e.data(t,"idleTimerObj")||{};if(i.idle)return 0;if(null!=i.remaining)return i.remaining;var n=i.timeout-(+new Date-i.lastActive);return 0>n&&(n=0),n};if(null===i&&"undefined"!=typeof u.idle)return o(),d;if(null===i);else{if(null!==i&&"undefined"==typeof u.idle)return!1;if("destroy"===i)return c(),d;if("pause"===i)return m(),d;if("resume"===i)return f(),d;if("reset"===i)return o(),d;if("getRemainingTime"===i)return s();if("getElapsedTime"===i)return+new Date-u.olddate;if("getLastActiveTime"===i)return u.lastActive;if("isIdle"===i)return u.idle}return"undefined"!=typeof r.hidden?r.visibilitychange(function(){a()}):(d.on(e.trim((n.events+" ").split(" ").join("._idleTimer ")),function(e){l(e)}),u.idle||(u.tId=setTimeout(a,u.timeout))),u=e.extend({},{olddate:+new Date,lastActive:+new Date,idle:n.idle,idleBackup:n.idle,timeout:n.timeout,remaining:null,tId:null,pageX:null,pageY:null}),e.data(t,"idleTimerObj",u),d},e.fn.idleTimer=function(i){return this[0]?e.idleTimer(i,this[0]):this}}(jQuery);
;_.Module.define({path:"encourage/widget/globalMessage/barrage",requires:[],sub:{isInit:!1,initial:function(){if(!this.isInit){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.clearTimeout,this.isInit=!0;var t=function(){function t(t,i){t&&(p=$.extend(p,i),c=t,w=0==c.width(),c.html(""),m=[],f=[],u=0)}function i(){for(var t=0;t<p.rowCount;t++){var i=new l;f.push(i),c.append(i.$row)}}function e(){f=[],c.html("")}function n(t){m.push(t),d||h()}function r(){g=!0}function s(){g=!1,d||h()}function o(){if(c.width()>=p.containerWidth)w=!1,i();else{var t=c.width(),e=parseFloat(c.css("marginLeft"));t+=p.unfoldSpeed||p.speed,e-=p.unfoldSpeed||p.speed,c.css({width:t,marginLeft:e})}}function a(){w=!0,e(),c.fadeOut("normal",function(){var t=parseFloat(c.css("marginLeft"))+c.width();c.css({display:"block",width:0,marginLeft:t})})}function h(){if(g)return cancelAnimationFrame(d),d=null,void 0;var t=m.length;if(!u&&!t){if(w)return cancelAnimationFrame(d),d=null,void 0;a()}if((u||t)&&w)o();else{if(u<=p.scrollElementMaxLength&&t){var i=m.shift(),e=Math.round(Math.random()*(p.rowCount-1));f[e].add(i),u+=1}$.each(f,function(t,i){i.scroll()})}d=requestAnimationFrame(h)}function l(){this.$row=$("<div></div>"),this.scrollElementArr=[],this.containerWidth=c.width(),this.marginLeft=this.width=this.containerWidth,this.$row.css({"margin-left":this.marginLeft,height:p.rowHeight,width:this.width,position:"relative"})}var d,c,m=[],f=[],u=0,w=!0,g=!1,p={speed:5,rowCount:1,rowHeight:20,scrollElementMaxLength:30,elementMarginLeft:20,containerWidth:988,containerMarginLeft:-498};return l.prototype={add:function(t){var i=this.scrollElementArr[this.scrollElementArr.length-1],e=p.elementMarginLeft,n=this.containerWidth-this.marginLeft+e;if(i){var r=i.position(),s=i.outerWidth(!0),o=this.containerWidth-r.left-s-this.marginLeft;n=o>e?o:e}t.css({display:"inline-block","margin-left":n}),this.$row.append(t),this.width+=t.outerWidth(!0),this.$row.css({width:this.width}),this.scrollElementArr.push(t)},shift:function(){if(this.scrollElementArr.length){var t=this.scrollElementArr.shift(),i=t.outerWidth(!0);t.remove(),t=null,u-=1,this.scrollElementArr.length?(this.width-=i,this.marginLeft+=i):(this.width=this.containerWidth,this.marginLeft=0),this.$row.css({width:this.width,"margin-left":this.marginLeft})}},scroll:function(){this.scrollElementArr.length&&(this.checkElementScrollEdge(),this.marginLeft-=p.speed,this.$row.css({"margin-left":this.marginLeft}))},checkElementScrollEdge:function(){if(this.marginLeft<0){var t=this.scrollElementArr[0],i=t.outerWidth(!0);i+this.marginLeft<=0&&this.shift()}}},{init:t,addMessage:n,pause:r,resume:s}}();$.extend(this,t)}}}});_.Module.define({path:"tbmall/widget/NameplateRecast",requires:["tbmall/component/Dialog","tbmall/component/BuyController"],sub:{_cdCount:0,_dialog:null,_npContainer:null,_npId:null,_npArr:[],_timer:null,_recastData:null,initial:function(a,t){this._cdCount=a,this._recastData=t,this._bindEvent()},_bindEvent:function(){var a=this;$("body").on("click",".j_nameplate_recast",function(){var t=$(this).data("nameplate");t=a._formatNpData(t),t.cdCount=a._cdCount;var n=$.tb.format(a._tpl,t);a._dialog=new $.dialog({html:n,title:"\u94ED\u724C\u91CD\u94F8",draggable:!1,holderClassName:"np_dialog",width:550,height:265}),a._npContainer=a._dialog.element.find(".j_container"),a._bindNpEvent()}),$("body").on("click",".j_buy_recast",function(t){if(t.preventDefault(),!$(this).data("clicked")){$(this).data("clicked",!0);var n=a._recastData[0];n=$.extend(n,{name:n.title,imgsrc:n.example_url}),a._dialog.close(),a.use("tbmall/component/BuyController",$(this),n)}})},_tpl:['<div class="np_dialog_bg j_container">','<div class="np_bg">#{fmt_title}</div>','<p class="np_tips">\u8BF7\u9009\u62E9\u559C\u7231\u7684\u52A9\u8BCD\uFF0C\u5E76\u4FEE\u6539\u6D45\u8272\u5B57\u4F53\u7684\u6587\u5B57</p>','<p class="np_tips" style="font-size: 12px;">\u9700\u8981\u6D88\u8017 <span class="orange_text">1</span> \u5F20\u91CD\u94F8\u5361\uFF0C\u4FEE\u6539\u540E\u539F\u94ED\u724C\u6D88\u5931</p>','<a class="np_dialog_btn j_dialog_btn disabled" href="javascript:;">\u5F00\u59CB\u91CD\u94F8</a>','<p class="np_dialog_btm"><a class="j_buy_recast" href="#" onclick="return false">\u6211\u62E5\u6709#{cdCount}\u5F20\u91CD\u94F8\u5361,\u6211\u8981\u4E70&gt;&gt;</a></p>','<div class="np_rst_msg j_np_msg"></div>',"</div>"].join(""),_formatNpData:function(a){var t="",n=this,e=$.tb.unescapeHTML(a.title);a.titleArr=[],this._npId=a.props_id;for(var i=0,s=a.pattern.length;s>i;i++)switch(n._npArr[i]=e.charAt(i),parseInt(a.pattern[i],10)){case 1:t+=e.charAt(i);break;case 2:t+='<a class="np_selected j_selected" href="javascript:;" data-arr="'+i+'" data-optional="'+$.json.encode(a.optional_word).replace(/\"/g,"&quot;")+'"></a>';break;case 3:t+='<input class="np_input j_input" maxlength="1" data-arr="'+i+'" type="text" value="'+e.charAt(i)+'" />'}return a.fmt_title=t,a},_checkNp:function(){var a=this,t=a._npArr.join(""),n=function(n){var e="",i=a._npContainer.find(".j_dialog_btn");switch(n.no){case 0:e='<i class="np_rst_ok"></i>',0!=a._cdCount?i.removeClass("disabled"):"";break;case 2270022:e='<a href="/tbmall/propslist?category=112&ps=24&kw='+encodeURIComponent(t)+'&ie=utf-8">\u6B64\u724C\u53EF\u7528,\u53BB\u6362\u724C>></a>',i.addClass("disabled");break;case 2270023:e='<p style="color: red;">\u6B64\u94ED\u724C\u5DF2\u6709\u5176\u4ED6\u7528\u6237\u4F7F\u7528</p>',i.addClass("disabled");break;case 2270024:e='<p style="color: red;">\u7528\u8BCD\u4E0D\u5F53,\u8BF7\u91CD\u65B0\u8F93\u5165</p>',i.addClass("disabled");break;case 2270025:e='<p style="color: red;">\u7528\u8BCD\u4E0D\u5F53,\u8BF7\u91CD\u65B0\u8F93\u5165</p>',i.addClass("disabled");break;default:e='<p style="color: red;">\u6709\u70B9\u5361,\u6570\u636E\u75AF\u72C2\u8BFB\u53D6\u4E2D...</p>',i.addClass("disabled")}$(".j_np_msg").html(e)};$.get("/tbmall/get/check",{id:a._npId,new_title:t,ie:"utf-8",_:(new Date).getTime()},n)},_bindNpEvent:function(){var a=this;a._npContainer.find(".j_selected").on("click",function(){var t=$(this).data("arr");if(a._npContainer.find(".j_op_container").length>0)a._npContainer.find(".j_op_container").show();else{for(var n=this,e=$(this).data("optional"),i="string"==typeof e?$.parseJSON(e):e,s=a._npContainer.offset().left,l=$(this).offset().left,o='<div class="np_op_container j_op_container"><ul class="np_op_ul">',r=0,c=i.length;c>r;r++)o+="<li "+(0==r?'class="np_op_wd_1"':"")+'><a class="np_op_wd j_op_wd" href="javascript:;" data-op="'+i[r]+'">'+i[r]+"</a></li>";o+='</ul><i class="np_op_arrow"></i></div>',a._npContainer.append(o);var d=a._npContainer.find(".j_op_container");d.css("left",l-s-d.width()/2+10),d.find(".j_op_wd").on("click",function(){var e=$(this).data(e);a._npArr[t]=e.op,$(n).text(e.op).removeClass("np_selected").addClass("np_blank"),d.hide(),a._checkNp()})}}),a._npContainer.find(".j_input").on("keyup change paste",function(){var t=$(this).data("arr"),n=$(this).val(),e=function(){$(".j_np_msg").html(""),a._npContainer.find(".j_dialog_btn").addClass("disabled")};return 0==$.trim(n).length?($(this).val(""),a._npArr[t]="",e(),void 0):/[a-zA-Z\u4E00-\u9FA5]/.test(n)?(n=n.toLowerCase(),a._npArr[t]=n,$(this).val(n),a._timer&&clearTimeout(a._timer),a._timer=setTimeout(function(){a._checkNp()},500),void 0):($(this).val(""),a._npArr[t]="",e(),void 0)}).on("click",function(){$(this).select().css({color:"#333"})}),a._npContainer.find(".j_dialog_btn").on("click",function(){var t=$(this),n=a._npArr.join("");if(!t.hasClass("disabled")){var e=a.use("tbmall/component/Dialog");e.confirm('<div class="tip">\u94ED\u724C\u5C06\u88AB\u4FEE\u6539\u4E3A: <span class="orange_txt">'+a._npArr.join("")+"</span></div>"),e.bind("yes",function(){var t=$(this);if(!t.data("clicked")){t.data("clicked",!0);var i={ie:"utf-8",new_title:n,id:a._npId,tbs:PageData.tbs};$.post("/tbmall/post/recast",i,function(a){t.data("clicked",!1),e.close();var n="";switch(parseInt(a.no,10)){case 0:n="\u94ED\u724C\u91CD\u94F8\u6210\u529F";break;default:n="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}e.info('<div class="tip">'+n+"</div>"),0==a.no&&e.close(),e.bind("onInfoClose",function(){$.tb.location.reload()})})}}),e.bind("no",function(){e.close(),$(this).data("clicked",!1)})}}),a._npContainer.on("click",function(t){var n=t.target;if(!$(n).hasClass("np_op_container")&&!$(n).hasClass("np_selected")&&!$(n).hasClass("np_blank")){var e=a._npContainer.find(".j_op_container");e&&e.hide()}})}}});_.Module.define({path:"tbmall/widget/tshow_out_date_warn",requires:["common/widget/JoinVipDialog"],sub:{initial:function(t){var o=this;this.joinVipDialog=this.use("common/widget/JoinVipDialog"),setTimeout(function(){t.show_pre?o.buildPreHtml.call(o):t.show_suf&&o.buildSufHtml.call(o)},3e3)},buildPreHtml:function(){var t=this,o=$("#tshow_out_date_warn_pre_html").html(),e={html:o,title:"\u63D0\u9192",draggable:!1,width:601};this._dialog=new $.dialog(e),$.cookie("tshow_out_hide",1,{expires:1}),this._dialog.onclose(function(){$.cookie("tshow_out_hide",1,{expires:1})}),this._dialog.element.on("click",".j_join_vip",function(o){o.preventDefault(),t.joinVipDialog.getMemberDialog(),t._dialog.close()})},buildSufHtml:function(){var t=this,o=$("#tshow_out_date_warn_suf_html").html(),e=$("#com_userbar"),i=$("#com_userbar_message"),s=parseInt(e.css("top")),a=parseInt(i.css("top"));$(o).css("height",0).prependTo("body").animate({height:100},500,"swing",function(){$(window).trigger("resize")}),$.cookie("tshow_out_hide",1,{expires:1}),e.parent().hasClass("search_form")?e.parent().hasClass("core_title")&&(e.css({top:6}),i.animate({top:125},500)):(e.animate({top:100+s},500),i.animate({top:125},500)),$(window).on("scroll",function(){$.cookie("tshow_out_hide")||(setTimeout(function(){e.parent().hasClass("search_form")?e.css({top:s}):e.parent().hasClass("core_title")?e.css({top:6}):e.css({top:100+s})},2),setTimeout(function(){i.hasClass("ui_bubble_wrap_fixed")||i.css({top:125})},10))}),$("#tshow_out_date_warn_close_btn").click(function(){$("#tshow_out_date_warn").animate({height:0},500,"swing",function(){$("#tshow_out_date_warn").remove(),$(window).trigger("resize")}),e.animate({top:s},500),i.animate({top:a},500),$.cookie("tshow_out_hide",1,{expires:1})}),$("#tshow_out_date_warn_btn").click(function(){t.joinVipDialog.getMemberDialog(),$("#tshow_out_date_warn").animate({height:0},500,"swing",function(){$("#tshow_out_date_warn").remove(),$(window).trigger("resize")}),e.animate({top:s},500),i.animate({top:a},500),$.cookie("tshow_out_hide",1,{expires:1})})}}});_.Module.define({path:"pb/widget/PbTrack",sub:{initial:function(){try{var t=this;$(".j_benba_search").click(function(){try{t._sendTrack("\u5427\u5185\u641C\u7D22\u70B9\u51FB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:7}),e}}),$(".j_search_post").click(function(){try{t._sendTrack("\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:8}),e}}),$(".share_thread").mouseover(function(){t._sendTrack("PB\u4E00\u697C\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),$(".p_sharebar").mouseover(function(){t._sendTrack("PB\u5E95\u90E8\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")});var e=setInterval(function(){$(".tbui_fbar_share").length&&($(".tbui_fbar_share").mouseover(function(){t._sendTrack("PB\u5DE6\u4FA7\u5206\u4EAB","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}),clearInterval(e))},200);$("#tofrs_up").click(function(){try{t._sendTrack("PB\u9875\u8FD4\u56DEFRS\u94FE\u63A5-\u9875\u9996","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:17}),e}}),$("#tofrs_down").click(function(){try{t._sendTrack("PB\u9875\u8FD4\u56DEFRS\u94FE\u63A5-\u9875\u5C3E","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:18}),e}}),$(".tab_forumname").click(function(){try{t._sendTrack("PB\u9875\u8FD4\u56DEFRS\u4E3B\u9875\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:19}),e}});var c=setInterval(function(){$(".j_lzl_p_sv").length&&($(".j_lzl_p_sv").click(function(){try{t._sendTrack("\u697C\u4E2D\u697C\u8BED\u97F3\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:22}),e}}),clearInterval(c))},200),a=setInterval(function(){$(".edui-btn-voice").length&&($(".edui-btn-voice").click(function(){try{t._sendTrack("\u56DE\u590D\u6846\u8BED\u97F3\u6309\u94AE","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:28}),e}}),clearInterval(a))},200);$(".v2_tab a").eq(3).click(function(){try{t._sendTrack("PB\u9875\u7CBE\u54C1\u6807\u7B7E","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:32}),e}}),$(".sign_title_text_bright a").click(function(){try{t._sendTrack("\u7B7E\u5230\u6846\u4E0A\u4E0B\u7684\u5BA2\u6237\u7AEF\u63A8\u5E7F\u94FE\u63A5","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","pb")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:33}),e}})}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/pb_track/pb_track.js",method:"",ln:35}),n}},_sendTrack:function(t,e,c){$.stats.track(t,e,c,"click")}}});_.Module.define({path:"common/widget/umoney_promotion_dialog",sub:{storageKey:"Umoney_Promotion",$wrap:null,initial:function(o){var n=this;o=o||{},n.option=o,n.showCount=o.showCount||"1",n.userId=o.userId||$.getPageData("user.id",""),n.promotionUrl=o.promotionUrl||"",""!==n.userId&&(n.key=this.storageKey+"_"+this.userId,n.isOpened()||(n.showDialog(),n.bindEvents(),n.setOpened()))},showDialog:function(){var o=this,n='<div class="umoney-dialog">\r\n    <a class="close-bg"><span class="close-btn"></span></a>\r\n\r\n</div>',t="umoney-promotion-dialog";if(!($("."+t).length>0)){var e={modal:!0,showTitle:!1,fixed:!0,width:485,height:358,holderClassName:t,draggable:!0,html:n},i=$.dialog;o._dialog=new i(e),o._dialog.show(),o.$wrap=o._dialog.element,o.$wrap.find(".umoney-dialog").css({background:"url("+o.option.backgroundImageUrl+") no-repeat"}),o.track("show")}},bindEvents:function(){var o=this;this.$wrap.on("click",".umoney-dialog",function(n){o.stopEvent(n),window.open(o.promotionUrl),o.track("open-umoney"),o.closeDialog()}).on("click",".close-btn",function(n){o.stopEvent(n),o.closeDialog()})},closeDialog:function(){var o=this;o._dialog&&o._dialog.close(),o.track("close")},isOpened:function(){var o=this,n=$.tb.Storage.get(o.key);return n===o.showCount||""===n},setOpened:function(){var o=this;$.tb.Storage.set(o.key,o.showCount)},stopEvent:function(o){o.preventDefault(),o.stopPropagation()},track:function(o,n){$.stats.track(o,"umoney-promotion",PageData.product+"-"+n,"click")}}});_.Module.define({path:"common/widget/advertiseRight",requires:[],sub:{initial:function(){var e=$.tb.Storage.get("oldtime"),t=(new Date).getTime();t-e>864e5&&$(".advertise_right_index").css("display","block"),this.bindEvents()},bindEvents:function(){$(".adv_close_button").click(function(){$(".advertise_right_index").css("display","none"),$.tb.Storage.set("oldtime",1*new Date)})}}});_.Module.define({path:"tbmall/widget/grab_treasure_dialog_success",sub:{initial:function(s){this.opts=s,this.data=this.opts.diamondData||{},this.data.issue&&this.showDialog(this.data)},showDialog:function(s){var a='<div class="grab-treasure-dialog-success-main">     <div class="title">\u606D\u559C\u60A8\u593A\u5B9D\u6210\u529F</div>     <div class="detail">         <div class="issue-num">\u7B2C<%=issue%>\u671F</div>         <div class="goods-name"><%=goods_name%></div>     </div>     <a target="_blank" href="<%=url%>" class="address-btn"></a> </div> ',i=_.template(a)(s),t=new $.dialog({html:i,title:"\u593A\u5B9D\u89C4\u5219",showShadow:!1,showTitle:!1,holderClassName:"grab-treasure-dialog-success",width:600});t.element.find(".address-btn").on("click",function(){$.ajax({url:"/diamondmall/post/clearNotification?tbs="+PageData.tbs}).done(function(s){console.log(s)}),t.close()})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar,this.userForumList=t.userForumList||"",this.forum_name="",t.fr&&"bawu"==t.fr&&(this.forum_name=$.tb.unescapeHTML(t.forum_name));var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:95}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:98}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:101}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:104}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:105}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95F4\u63A5\u52A0\u5173\u6CE8","\u5206\u53D1\u5173\u6CE8\u5427\u63A8\u8350","","click"),PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no},t.userForumList]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap","common/widget/payMember"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.notShowSucTips=e.notShowSucTips,o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,u=t.Parr_scores,_=0;u&&(_=u.scores_money+u.scores_other);var s=_>=e.tdou_num,c=0;s||(c=e.tdou_num-_);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,u=0;d||(u=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this;if(!e._dialog)return!1;var o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var o=e.requireInstance("common/widget/payMember"),t={fr:"tbui_tdou_view_pay"};o.showCashier(t)})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t,t.notShowSucTips)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar,this.userForumList=t.userForumList||"",this.forum_name="",t.fr&&"bawu"==t.fr&&(this.forum_name=$.tb.unescapeHTML(t.forum_name));var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:95}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:98}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:101}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:104}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:105}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95F4\u63A5\u52A0\u5173\u6CE8","\u5206\u53D1\u5173\u6CE8\u5427\u63A8\u8350","","click"),PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no},t.userForumList]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});_.Module.define({path:"adsense/widget/tpl_5",requires:[],sub:{initial:function(e){var n=this;this.requireInstanceAsync("adsense/widget/loader",[],function(s){s.loadAD(e,n.extraParam,$.proxy(n.customFn,n))})},customFn:function(){"pass"}}});_.Module.define({path:"pb/widget/threadRecommend",requires:["common/component/SlideShow"],sub:{_slideConfig:{target:"#recom_scroll_list .recom_scroll_wrap",nav:"#recom_scroll_list .recom_scroll_navs",interval:5e3,prev:"#recom_scroll_list .recom_scrol_ctrl_l",next:"#recom_scroll_list .recom_scrol_ctrl_r",slide:{speed:400}},initial:function(t){try{this.args=t,t.total>2?(this.slideShow=this.requireInstance("common/component/SlideShow",this._slideConfig),$("#recom_scroll_list .recom_scrol_ctrls").show()):($(".recom_boxes").show(),$(".recom_scroll_ctrls").hide()),this.has_related=this.args.has_related,this.tids=this.args.tids.join("_"),this.model_id=this.args.model_id,this.ps_query=this.args.ps_query,this.col_related_name="related",this.track_task="pb\u5185\u5BB9\u63A8\u8350",$.stats.track("\u6A21\u5757\u6574\u4F53\u5C55\u793A\u91CF",this.track_task,"pb","show",{obj_id:this.has_related?this.tids:"",obj_type:this.has_related?this.model_id:"",obj_query:this.has_related?this.ps_query:""}),$.stats.track("\u7B2C1\u9875\u6A21\u5757\u5C55\u793A\u91CF",this.track_task,"pb","show",{obj_id:this.has_related?this.tids:"",obj_type:this.has_related?this.model_id:"",obj_query:this.has_related?this.ps_query:""}),this.ps_query&&$.stats.track("query",this.track_task,"pb","show",{obj_id:this.tids,obj_type:this.model_id,obj_query:this.ps_query}),this.bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:61}),e}},bindEvents:function(){var t=this;$(".thread_recommend [data-locate]").delegate("a","click",function(){try{var e=$(this).closest("[data-locate]").data("locate"),s=$(this).data("tid");$.stats.track(e,t.track_task,{obj_id:s,obj_type:e==t.col_related_name?t.model_id:"",obj_query:e==t.col_related_name?t.ps_query:""})}catch(r){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:r.message||r.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:74}),r}}),$(".thread_recommend .recom_scrol_ctrl").on("click",function(){try{var e=$(this).data("locate");$.stats.track(e,t.track_task,"pb");var s=t.slideShow.current;s="\u4E0B\u4E00\u4E2A"==e?++s>=t.slideShow.total?0:s:--s<0?t.slideShow.total-1:s;var r="\u7B2C"+(s+1)+"\u9875\u6A21\u5757\u5C55\u793A\u91CF",o=t.has_related&&0==s;$.stats.track(r,t.track_task,"pb","show",{obj_id:o?t.tids:"",obj_type:o?t.model_id:"",obj_query:o?t.ps_query:""})}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:96}),a}}),$(".thread_recommend .thread_recommend_query a").on("click",function(){try{$.stats.track("query",t.track_task,{obj_id:t.tids,obj_type:t.model_id,obj_query:t.ps_query})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/thread_recommend/thread_recommend.js",method:"",ln:105}),e}})}}});_.Module.define({path:"comforum/widget/AdPost",sub:{initial:function(){}}});_.Module.define({path:"adsense/widget/tpl_ext",requires:[],sub:{initial:function(e){this.requireInstanceAsync("adsense/widget/loader",[],function(t){"POST"===e.type&&t.allPost()})}}});_.Module.define({path:"common/widget/AsideFloatBar",requires:["common/widget/tbshare"],sub:{initial:function(t){"undefined"!=typeof PDC&&PDC.mark("c_afbavi"),this.options=t,this.$root=$('<ul class="tbui_aside_float_bar"></ul>');for(var e=0,i=t.buttons.length;i>e;e++){var a=t.buttons[e];this.addButton(a)}this.$root.appendTo("body");var o=this;o.relocate(),$(window).resize(function(){o.relocate()});var r=PageData.product;if("pb"==r&&this.$root.find(".tbui_fbar_favor").on("mouseenter",function(){$.stats.track("PB\u60AC\u6D6E\u7231\u901B\u7684\u5427","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click"),$(this).find(".tbui_aside_favor_list a").one("click",function(){$.stats.track("PB\u60AC\u6D6E\u7231\u901B\u5427\u5C55\u5F00\u5427","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click")})}),"frs"==r||"pb"==r||"pb_bright"==r){if("frs"==r)var n=["\u53D1\u5E16","\u5237\u65B0","\u5206\u4EAB","\u7231\u901B\u7684\u8D34\u5427","\u63A8\u8350\u6E38\u620F","\u5B9E\u9A8C\u5BA4","\u8FD4\u56DE\u9876\u90E8"];else var n=["\u56DE\u590D","\u9B54\u6CD5\u9053\u5177","\u795E\u6765\u4E00\u53E5","\u5206\u4EAB","\u7231\u901B\u7684\u8D34\u5427","\u5B9E\u9A8C\u5BA4","\u53EC\u5524\u5EA6\u5A18","\u8FD4\u56DE\u9876\u90E8"];r="pb"==r||"pb_bright"==r?"pb":"frs",this.$root.delegate(".tbui_aside_fbar_button","mouseenter",function(t){var e=$(t.target),i=e.parent().index();return 7===i?!1:($.stats.track(n[i]+"\u70B9\u51FB\u91CF","FRS/PB\u53F3\u4FA7\u5DE5\u5177\u680F\u7EDF\u8BA1",r,"click"),void 0)})}},addButton:function(t){var e=$($.tb.format('<li class="tbui_aside_fbar_button tbui_fbar_#{btnName}"><a href="#"></a></li>',{btnName:t})),i=this["_"+t];i&&i.call(this,e)&&this.$root.append(e);var a=this;$("body").click(function(){a.hidePanel()})},hidePanel:function(){$("#bdshare_tb_l").hide(),$(".tbui_aside_smiley").hide(),$("#tbui_aside_favor_list").hide(),$(".tbui_aside_props_list").hide()},relocate:function(){$(window).width()<1105?this.$root.addClass("tbui_afb_compact"):this.$root.removeClass("tbui_afb_compact")},_square:function(t){return t.children().tbattr("href","/f?kw=%D0%E3"),t.children().tbattr("target","_blank"),!0},_top:function(t){var e=$(window);0==e.scrollTop()&&t.css("visibility","hidden"),t.click(function(t){function i(){o=Math.floor(o/2),window.scrollTo(0,o),o>2?a=setTimeout(i,40):(window.scrollTo(0,0),clearTimeout(a))}t.preventDefault();var a=null,o=e.scrollTop();$.browser.msie?window.scrollTo(0,0):i()});var i,a=!1;return e.bind("scroll",function(){i&&clearTimeout(i),i=setTimeout(function(){e.scrollTop()>0?0==a&&(t.css("visibility","visible"),a=!0):a&&(t.css("visibility","hidden"),a=!1)},500)}),!0},_refresh:function(t){return t.click(function(){return $.tb.location.reload(),!1}),!0},_post:function(t){var e=this;return t.children().tbattr("href","#sub"),t.click(function(t){t.preventDefault(),t.stopPropagation(),setTimeout(function(){e.fire("wanna_post")},50)}),!0},_share:function(t){return this.requireInstance("common/widget/tbshare/tbshare_popup",[{$container:t.find("a")}]),!0},_radar:function(t){var e=this;return t.find("a").append('<img src="//tb2.bdstatic.com/tb/static-common/img/toolbar/radar_51d309d.gif" class="tbui_radar_img" />'),t.find("a").tbattr({href:$.tb.unescapeHTML(e.options.radarData&&e.options.radarData.link),target:"_blank"}),t.on("mousedown","a",function(){$.stats.track("radar","radar_banner")}),$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")),!0},_tsukkomi:function(t){var e=this;$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&t.css("marginBottom","-3px").append("<div></div>");var i=$('<div class="tbui_aside_smiley"></div>');return t.append(i),_.Module.use("common/component/InterestSmiley",{container:i,smileClass:"t_smile_bg",type:"toolbar",scrollCss:{padding:"9px 0px 0px 0px"},scrollBarHide:function(){i.width(296)},scrollBarShow:function(){i.width(306)},dataPostor:e.options.dataPostor},function(a){e.interestSmile=a,e.interestSmile.generic(),t.on("mouseenter",function(){e.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){i.fadeIn(),e.interestSmile.scrollPanel&&e.interestSmile.scrollPanel.setHeight(260)},mouseleave:function(){i.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()})}),!0},_favor:function(t){var e="//tb2.bdstatic.com/tb/static-common/widget/aside_float_bar/images/loading2_a8a93d0.gif";if(0==PageData.user.is_login)return!1;var i=PageData.user.id,a="/p/getLikeForum",o=[];$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px"));var r=$('<ul class="tbui_aside_favor_list clearfix" id="tbui_aside_favor_list"></ul>'),n='<li class="j_favor_loading"><div class="favor_loading"><img src="'+e+'">\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E\u3002\u3002\u3002</div></li>';r.append(n),$.ajax({url:a,dataType:"json",type:"GET",data:{uid:i}}).done(function(t){if(t&&0===t.errno){if(t.data&&t.data.info&&(o=t.data.info),0==o.length)return!1;if(o.length>0){var e,i=o,a=!1;i.length<=8?e=i.length:(e=7,a=!0),r.find(".j_favor_loading").hide();for(var n=0;e>n;n++){var s={kw:encodeURIComponent(i[n].forum_name),forumName:$.tb.subByte(i[n].forum_name,12)};r.append($.tb.format('<li><a href="//tieba.baidu.com/f?ie=utf-8&kw=#{kw}" target="_blank" class="ui_text_summary">#{forumName}</a></li>',s))}a&&r.append('<li><a target="_blank" class="ui_text_desc" href="//tieba.baidu.com/home/forum?id='+PageData.user.portrait+'" class="aside_float_favforum_more">\u66F4\u591A&gt;&gt;</a></li>')}}}),r.hide().appendTo(t);var s=this;return t.on("mouseenter",function(){s.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){r.fadeIn()},mouseleave:function(){r.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),!0},_lab:function(t){t.children().tbattr("target","_blank").tbattr("href","//tieba.baidu.com/idea/index");var e=$("<div class='tbui_aside_lab_tip'></div>");if(t.append(e),$.tb.Storage.remove("close_cm_bubble"),"1"!=$.tb.Storage.get("close_mt_bubble")&&+new Date<+new Date(2015,6,19)){var i={content:"<span class='ui_text_emphasize'>\u5FEB\u6377\u952E\u8D34\u5427</span>\u4E0A\u7EBF\u5566\uFF0C\u5FEB\u6765\u4F53\u9A8C\u5427~",arrow_dir:"right",bubble_css:{top:0,right:50,width:150},wrap:e,closeBtn:!0},a=new UiBubbleTipBase(i);a.bind("onclose",function(){$.tb.Storage.set("close_mt_bubble","1",(new Date).getTime()+6048e5),a.closeBubble()}),a.j_bubble.show()}return!0},_home:function(t){return t.children().tbattr("href","//www.baidu.com?tn=SE_hldp03460_124vf6k4"),t.children().addClass("j_aside_float_bar_go_home"),t.children().tbattr("target","_blank"),!0},_props:function(t){var e=this,e=this;return t.on("mouseenter",function(){e.hidePanel()}),_.Module.use("props/widget/MagicProps",{wrap:t,propsData:e.options.propsData},function(e){e.visible?$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")):t.css("display","none")}),!0}}});_.Module.define({path:"props/widget/MagicProps",requires:["props/widget/Residual"],sub:{initial:function(t){this.$wrap=t.wrap,this.dataObj=t.propsData,this.visible=!1,this.initOptions(),this.loadComponent(),this.buildProps()},initOptions:function(){this.propsOptions={1070001:{key:"worship",name:"\u9B54\u62DC",flashOptions:{width:320,height:390,marginLeft:0,marginTop:0}},1070002:{key:"egg",name:"\u9B54\u86CB",flashOptions:{width:900,height:600,marginLeft:384,marginTop:70}}},this.mallurl="/tbmall/propslist?category=107",this.poolSize=5;var t=window.navigator.userAgent.match(/chrome/i);this.page=t?$(document.body):$(document.documentElement)},loadComponent:function(){this.residual=this.use("props/widget/Residual")},buildProps:function(){this.initPropsData(),this.propsList.length>0&&(this.visible=!0,this.initPropsUI(),this.bindPropsEvents())},initPropsData:function(){for(var t=this.dataObj.owner||{},a=null,i=null,s=[],e={},o=["1070001","1070002"],r=0;r<o.length;r++)i=o[r],a={id:i,count:t[i]&&t[i].left_num||0},$.extend(a,this.propsOptions[i]),s.push(a),e[i]=a;this.propsList=s,this.propsMap=e},initPropsUI:function(){for(var t=this,a=$('<ul class="tbui_aside_props_list clearfix" id="tbui_aside_props_list"></ul>'),i=new Array,s=null,e=0;e<t.propsList.length;e++)s=t.propsList[e],i.push('<li class="props_item props_item_'+s.id+'">'),s.count>0?i.push('<a class="j_props_btn props_item_btn" href="#" data-id="'+s.id+'"><img src="//tb2.bdstatic.com/tb/static-props/img/props/'+s.key+'.png"/></a>'):i.push('<a class="props_item_btn" target="_blank" href="'+t.mallurl+'" data-id="'+s.id+'"><img src="//tb2.bdstatic.com/tb/static-props/img/props/'+s.key+'.png"/><span class="props_buy_icon"></span></a>'),i.push('<p class="props_item_title">'),i.push("<span>"+s.name+"</span>"),s.count>0&&(i.push('<span class="props_item_sign">'+String.fromCharCode(215)+"</span>"),i.push('<span class="props_item_num">'+s.count+"</span>")),i.push("</p>"),i.push("</li>");a.html(i.join("")),a.hide().appendTo(t.$wrap),t.$propsList=a},bindPropsEvents:function(){var t=this;t.$wrap.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){t.$propsList.fadeIn()},mouseleave:function(){t.$propsList.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),t.$propsList.delegate(".j_props_btn","click",function(){var a=$(this).data("id"),i=t.propsMap[a];return t.propsObj=i,i.count>0&&("pb"==PageData.product?t.buildPostArea():"ihome"==PageData.product&&t.buildIhomeArea(),t.buildMask(),t.initFlashCallbacks()),!1})},buildIhomeArea:function(){var t={jdom:$("div.userinfo_wrap"),userId:this.dataObj.home_user_id,propsData:this.dataObj.home_user_props,propsType:0},a=$("#headinfo_wrap"),i=a.offset().left,s=a.offset().top,e=i+a.width(),o={marginLeft:i,marginRight:e,marginTop:s,marginBottom:$("body").height()-28};$.extend(t,o),this.limitArea=o,this.areaList=[t]},buildPostArea:function(){for(var t=$("#j_p_postlist"),a=t.find(".j_l_post"),i=null,s=null,e=[],o=t.offset().left,r=t.offset().top,p=o+t.width(),n=0;n<a.length;n++)i=$(a[n]),s=i.getData(),this.doPostItem(i,s,o,p,e);var l={marginLeft:o,marginRight:p,marginTop:r,marginBottom:r+t.height()};this.limitArea=l,this.areaList=e},doPostItem:function(t,a,i,s,e){var o=null,r=null,p=null,n=t.offset().top,l=n+t.height(),h={userId:a.author.user_id,postId:a.content.post_id,propsData:a.content.props,marginTop:n,marginBottom:l};r={},o=t.find(".d_author"),r.jdom=o,r.marginRight=i+130,r.marginLeft=i,$.extend(r,h),e.push(r),p={},o=t.find(".d_post_content_main"),p.jdom=o,p.marginRight=s,p.marginLeft=i+130,$.extend(p,h),e.push(p)},buildMask:function(){this.flashPool=[],this.currScrollTop=0,this.currAreaObj=null,this.initMask(),this.setMaskPosition(0,0,0,0),this.bindMaskEvents()},initMask:function(){var t=$('<div class="mask_layer mask_top"></div>'),a=$('<div class="mask_layer mask_right"></div>'),i=$('<div class="mask_layer mask_bottom"></div>'),s=$('<div class="mask_layer mask_left"></div>'),e=$('<div class="mask_layer light_area"></div>'),o=$('<div id="mask_wrap" class="mask_wrap mouse_'+this.propsObj.key+'"></div>');o.append(t).append(a).append(i).append(s).append(e).css({"z-index":$.getzIndex()}),$("body").append(o),this.$maskWrap=o,this.maskMap={topMask:t,rightMask:a,bottomMask:i,leftMask:s,lightArea:e}},setMaskPosition:function(t,a,i,s){var e=this.maskMap;e.topMask.css({height:a}),e.rightMask.css({left:t+i,top:a,width:$("body").width()-(t+i),height:s}),e.bottomMask.css({top:a+s,height:$("body").height()-(a+s)}),e.leftMask.css({top:a,width:t,height:s}),e.lightArea.css({left:t,top:a,width:i,height:s})},bindMaskEvents:function(){var t=this;$("body").bind("contextmenu",function(){return!1}),$(document).bind("keydown",function(a){if(27==a.which&&null!=t.$maskWrap){if(t.disabledMove)return!1;t.clear()}}),t.$maskWrap.mousedown(function(a){if(3==a.which){if(t.disabledMove)return!1;t.clear()}return!1});var a=50,i=$("body").width()-a,s=0;t.$maskWrap.mousemove(function(a){if(t.$bulletLayer||(t.$bulletLayer=t.buildBulletLayer(),t.$maskWrap.append(t.$bulletLayer)),s=a.pageX,s>i&&(s=i),t.$bulletLayer.css({left:s,top:a.pageY}),t.disabledMove)return!1;var e=null,o=t.limitArea;if(t.isInArea=a.pageX>=o.marginLeft&&a.pageX<=o.marginRight&&a.pageY>=o.marginTop&&a.pageY<=o.marginBottom?!0:!1,t.isInArea)for(var r=0;r<t.areaList.length;r++)e=t.areaList[r],a.pageX>=e.marginLeft&&a.pageX<=e.marginRight&&a.pageY>=e.marginTop&&a.pageY<=e.marginBottom&&(t.setMaskPosition(e.marginLeft,e.marginTop,e.marginRight-e.marginLeft,e.marginBottom-e.marginTop),e.propsType=r%2,t.areaObj=e);else t.setMaskPosition(0,0,0,0)})},buildBulletLayer:function(){var t=this,a=$('<div class="bullet_layer"><span class="bullet_layer_tip">\u53F3\u952E\u53D6\u6D88</span></div>');return a.click(function(){t.isInArea?t.propsObj.count>0?t.flashPool.length<=t.poolSize&&(t.updatePosition(),t.post()):t.showTomallDialog():t.clear()}),a},clear:function(){this.clearPool(),this.$maskWrap.remove(),this.$maskWrap=null,this.$bulletLayer=null,setTimeout(function(){$("body").unbind("contextmenu")},300)},post:function(){var t=this,a="/tbmall/post/useAppraiseProps",i={props_id:t.propsObj.id,target_user_id:t.areaObj.userId||"",type:t.areaObj.propsType,post_id:t.areaObj.postId||"",tbs:PageData.tbs};$.tb.post(a,i,function(a){a&&0==a.no&&t.updatePage()})},updatePage:function(){var t=this.propsObj.id,a=".props_item_"+t;this.updatePropsBtnNum(t,a),("ihome"==PageData.product||"1"==this.areaObj.propsType)&&this.updatePostAreaNum(t,a)},updatePropsBtnNum:function(t,a){var i=$("#tbui_aside_props_list "+a),s=this.propsObj.count-1;s=s>0?s:0,this.propsObj.count=s,s>0?i.find(".props_item_num").text(s):(i.find(".props_item_btn").removeClass("j_props_btn").tbattr("target","_blank").tbattr("href",this.mallurl).append('<span class="props_buy_icon"></span>'),i.find(".props_item_sign").remove(),i.find(".props_item_num").remove())},updatePostAreaNum:function(t,a){var i=this.areaObj.propsData||{};i[t]||(this.areaObj.propsData={},this.areaObj.propsData[t]={num:0});var s=this.areaObj.propsData[t].num+1;s=s>0?s:0,this.areaObj.propsData[t].num=s;var e=this.areaObj.jdom.find("ul.props_appraise_wrap"),o=e.find(a);o[0]?o.find(".props_item_num").text(s):(htmlArr=[],htmlArr.push('<li class="props_item props_item_split"><span class="userinfo_split"></span></li>'),htmlArr.push('<li class="props_item props_item_'+t+'">'),htmlArr.push('<a href="#" data-postid="'+(this.areaObj.postId||"")+'" data-id="'+t+'" class="props_item_icon"></a>'),htmlArr.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),htmlArr.push('<span class="props_item_num">'+s+"</span></li>"),"1070001"==t?e.prepend($(htmlArr.join(""))):"1070002"==t&&e.append($(htmlArr.join(""))))},updatePosition:function(){var t=this,a=this.propsOptions[this.propsObj.id].flashOptions,i=($(window).height()-a.height)/2;i=150>i?150:i;var s=this.areaObj.jdom.offset().top-i;this.disabledMove=!0;var e=$(window).scrollTop();0==e||e!=this.currScrollTop||this.currAreaObj&&this.currAreaObj.marginTop!=this.areaObj.marginTop?(this.currAreaObj=this.areaObj,this.currScrollTop=e,t.page.animate({scrollTop:s},300,"swing",function(){t.buildFlash(s)})):t.buildFlash(s)},buildFlash:function(t){var a=this,i=0,s=0,e=$('<div class="props_flash_wrap"></div>'),o=this.propsOptions[this.propsObj.id].flashOptions,r=($(window).width()-o.width)/2,p=t+o.marginTop;r=r>0?r:0,p=p>0?p:0,"0"==a.areaObj.propsType&&"1070002"==a.propsObj.id&&("ihome"==PageData.product?(i=100,s=-15):(i=60,s=-20),r=r-(r+o.marginLeft-a.areaObj.jdom.offset().left)+i,p+=s),e.css({width:o.width,height:o.height,left:r,top:p,"z-index":$.getzIndex()});{var n="/tb/static-props/swf/"+this.propsObj.key+".swf?t=140107";new $.swf(n,{container:e,width:o.width,height:o.height,params:{wmode:"transparent"}})}a.flashPool.push(e),a.$maskWrap.append(e),a.topzIndex=$.getzIndex(),a.$bulletLayer.css({"z-index":a.topzIndex})},buildPlusOne:function(){var t=this,a="plusone_"+this.propsObj.key;$.browser.msie&&6==$.browser.version&&(a+="_png8"),a="/tb/static-props/img/"+a+".png";var i=$('<div class="props_plusone"><img src="'+a+'"/></div>'),s=0,e=0;"ihome"==PageData.product?(s=t.areaObj.marginLeft+70,e=t.areaObj.marginTop+300):(s=t.areaObj.marginLeft+(t.areaObj.marginRight-t.areaObj.marginLeft)/2-18,e=t.areaObj.marginTop+100),i.css({left:s,top:e,"z-index":t.topzIndex+1}),t.$maskWrap.append(i),i.animate({top:"-=100px",opacity:.8},800,"swing",function(){i.remove()})},clearPool:function(){for(var t=this,a=t.flashPool,i=null,s=0;s<a.length;s++)i=a.shift(),i.remove();t.disabledMove=!1},initFlashCallbacks:function(){var t=this,a={},i=null;a.finishPlay=function(){if(t.flashPool.length>0){t.buildPlusOne();var a=t.flashPool.shift();a.remove(),t.flashPool.length<=0&&(t.disabledMove=!1,"0"==t.areaObj.propsType&&("ihome"==PageData.product?i=t.areaObj.jdom.find(".userinfo_left"):"pb"==PageData.product&&(i=t.areaObj.jdom.find(".icon_relative")),t.residual.showUI({wrap:i,key:t.propsObj.key})))}},window.MagicProps=a},showTomallDialog:function(){var t=this,a=new $.dialog({title:"\u63D0\u793A",html:'<div class="props_buy_dialog"><p class="buy_dialog_content">\u4F60\u76EE\u524D\u6CA1\u6709\u53EF\u7528\u7684\u9053\u5177\u4E86\uFF0C\u5FEB\u53BB\u5546\u57CE\u8D2D\u4E70\u5427</p><a class="buy_dialog_link" target="_blank" href="'+t.mallurl+'">\u53BB\u8D2D\u4E70>></a><div>',width:400,height:80});a.element.find(".buy_dialog_link").on("click",function(){t.clear(),setTimeout(function(){t.showBuyDialog(t.mallurl)},200)})},showBuyDialog:function(t){var a='<p class="buy_txt">\u9053\u5177\u8D2D\u4E70\u6210\u529F\u540E\u5373\u53EF\u4F7F\u7528\uFF01</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>\u8D2D\u4E70\u6210\u529F</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>\u8D2D\u4E70\u5931\u8D25\uFF0C\u91CD\u65B0\u8D2D\u4E70</em></span></a></div>',i=new $.dialog({title:"\u63D0\u793A",html:$.tb.format(a,{href:$.tb.unescapeHTML(t)}),width:400,height:80});i.bind("onclose",function(){$.tb.location.reload()}),i.element.find(".btn_success").on("click",function(t){t.preventDefault(),$.tb.location.reload()})}}});